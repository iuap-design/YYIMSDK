function BaseList(){this.list={},this.array=[]}function IMFile(t){this.build(t)}function _Range(t,e){this.START=t,this.END=e,this.SIZE=e-t}function _Opcode(t,e,n){this.KEY=t,this.SEND=e,this.RECV=n||e,OPCODE_MAP.SEND.set(this.SEND,this.KEY),OPCODE_MAP.RECV.set(this.RECV,this.KEY)}function shallowClone(t){function e(){}return e.prototype=t,new e}function inheritPrototype(t,e){var n=shallowClone(e.prototype);n.constructor=t,t.prototype=n}function JumpPacket(t,e){if(this.sFrame=0,this.version=256,this.seqId=0,this.packetLen=0,t){this.content=t;try{this.packetLen="string"==typeof t?t.length:JSON.stringify(t).length}catch(t){}}this.opcode=e}function XmlHttp(){}function XmlDocument(){}function hex_sha1(t){return rstr2hex(rstr_sha1(str2rstr_utf8(t)))}function b64_sha1(t){return rstr2b64(rstr_sha1(str2rstr_utf8(t)))}function any_sha1(t,e){return rstr2any(rstr_sha1(str2rstr_utf8(t)),e)}function hex_hmac_sha1(t,e){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(t),str2rstr_utf8(e)))}function b64_hmac_sha1(t,e){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(t),str2rstr_utf8(e)))}function any_hmac_sha1(t,e,n){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(t),str2rstr_utf8(e)),n)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(t){return binb2rstr(binb_sha1(rstr2binb(t),8*t.length))}function rstr_hmac_sha1(t,e){var n=rstr2binb(t);n.length>16&&(n=binb_sha1(n,8*t.length));for(var i=Array(16),r=Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var s=binb_sha1(i.concat(rstr2binb(e)),512+8*e.length);return binb2rstr(binb_sha1(r.concat(s),672))}function rstr2binb(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(var n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function binb2rstr(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function binb_sha1(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var n=Array(80),i=1732584193,r=-271733879,o=-1732584194,s=271733878,a=-1009589776,u=0;u<t.length;u+=16){for(var c=i,l=r,h=o,d=s,p=a,f=0;f<80;f++){n[f]=f<16?t[u+f]:bit_rol(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);var g=safe_add(safe_add(bit_rol(i,5),sha1_ft(f,r,o,s)),safe_add(safe_add(a,n[f]),sha1_kt(f)));a=s,s=o,o=bit_rol(r,30),r=i,i=g}i=safe_add(i,c),r=safe_add(r,l),o=safe_add(o,h),s=safe_add(s,d),a=safe_add(a,p)}return Array(i,r,o,s,a)}function sha1_ft(t,e,n,i){return t<20?e&n|~e&i:t<40?e^n^i:t<60?e&n|e&i|n&i:e^n^i}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function hex_md5(t){return rstr2hex(rstr_md5(str2rstr_utf8(t)))}function b64_md5(t){return rstr2b64(rstr_md5(str2rstr_utf8(t)))}function any_md5(t,e){return rstr2any(rstr_md5(str2rstr_utf8(t)),e)}function hex_hmac_md5(t,e){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(t),str2rstr_utf8(e)))}function b64_hmac_md5(t,e){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(t),str2rstr_utf8(e)))}function any_hmac_md5(t,e,n){return rstr2any(rstr_hmac_md5(str2rstr_utf8(t),str2rstr_utf8(e)),n)}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(t){return binl2rstr(binl_md5(rstr2binl(t),8*t.length))}function rstr_hmac_md5(t,e){var n=rstr2binl(t);n.length>16&&(n=binl_md5(n,8*t.length));for(var i=Array(16),r=Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var s=binl_md5(i.concat(rstr2binl(e)),512+8*e.length);return binl2rstr(binl_md5(r.concat(s),640))}function rstr2hex(t){for(var e,n=hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<t.length;r++)e=t.charCodeAt(r),i+=n.charAt(e>>>4&15)+n.charAt(15&e);return i}function rstr2b64(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=t.length,r=0;r<i;r+=3)for(var o=t.charCodeAt(r)<<16|(r+1<i?t.charCodeAt(r+1)<<8:0)|(r+2<i?t.charCodeAt(r+2):0),s=0;s<4;s++)8*r+6*s>8*t.length?n+=b64pad:n+=e.charAt(o>>>6*(3-s)&63);return n}function arr2b64(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=t.length,r=0;r<i;r+=3)for(var o=t[r]<<16|(r+1<i?t[r+1]<<8:0)|(r+2<i?t[r+2]:0),s=0;s<4;s++)8*r+6*s>8*t.length?n+=b64pad:n+=e.charAt(o>>>6*(3-s)&63);return n}function rstr2any(t,e){var n,i,r,o,s,a=e.length,u=Array(Math.ceil(t.length/2));for(n=0;n<u.length;n++)u[n]=t.charCodeAt(2*n)<<8|t.charCodeAt(2*n+1);var c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),l=Array(c);for(i=0;i<c;i++){for(s=Array(),o=0,n=0;n<u.length;n++)o=(o<<16)+u[n],r=Math.floor(o/a),o-=r*a,(s.length>0||r>0)&&(s[s.length]=r);l[i]=o,u=s}var h="";for(n=l.length-1;n>=0;n--)h+=e.charAt(l[n]);return h}function str2rstr_utf8(t){for(var e,n,i="",r=-1;++r<t.length;)e=t.charCodeAt(r),n=r+1<t.length?t.charCodeAt(r+1):0,55296<=e&&e<=56319&&56320<=n&&n<=57343&&(e=65536+((1023&e)<<10)+(1023&n),r++),e<=127?i+=String.fromCharCode(e):e<=2047?i+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i}function str2rstr_utf16le(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(255&t.charCodeAt(n),t.charCodeAt(n)>>>8&255);return e}function str2rstr_utf16be(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t.charCodeAt(n)>>>8&255,255&t.charCodeAt(n));return e}function rstr2binl(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(var n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e}function binl2rstr(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}function binl_md5(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var n=1732584193,i=-271733879,r=-1732584194,o=271733878,s=0;s<t.length;s+=16){var a=n,u=i,c=r,l=o;n=md5_ff(n,i,r,o,t[s+0],7,-680876936),o=md5_ff(o,n,i,r,t[s+1],12,-389564586),r=md5_ff(r,o,n,i,t[s+2],17,606105819),i=md5_ff(i,r,o,n,t[s+3],22,-1044525330),n=md5_ff(n,i,r,o,t[s+4],7,-176418897),o=md5_ff(o,n,i,r,t[s+5],12,1200080426),r=md5_ff(r,o,n,i,t[s+6],17,-1473231341),i=md5_ff(i,r,o,n,t[s+7],22,-45705983),n=md5_ff(n,i,r,o,t[s+8],7,1770035416),o=md5_ff(o,n,i,r,t[s+9],12,-1958414417),r=md5_ff(r,o,n,i,t[s+10],17,-42063),i=md5_ff(i,r,o,n,t[s+11],22,-1990404162),n=md5_ff(n,i,r,o,t[s+12],7,1804603682),o=md5_ff(o,n,i,r,t[s+13],12,-40341101),r=md5_ff(r,o,n,i,t[s+14],17,-1502002290),i=md5_ff(i,r,o,n,t[s+15],22,1236535329),n=md5_gg(n,i,r,o,t[s+1],5,-165796510),o=md5_gg(o,n,i,r,t[s+6],9,-1069501632),r=md5_gg(r,o,n,i,t[s+11],14,643717713),i=md5_gg(i,r,o,n,t[s+0],20,-373897302),n=md5_gg(n,i,r,o,t[s+5],5,-701558691),o=md5_gg(o,n,i,r,t[s+10],9,38016083),r=md5_gg(r,o,n,i,t[s+15],14,-660478335),i=md5_gg(i,r,o,n,t[s+4],20,-405537848),n=md5_gg(n,i,r,o,t[s+9],5,568446438),o=md5_gg(o,n,i,r,t[s+14],9,-1019803690),r=md5_gg(r,o,n,i,t[s+3],14,-187363961),i=md5_gg(i,r,o,n,t[s+8],20,1163531501),n=md5_gg(n,i,r,o,t[s+13],5,-1444681467),o=md5_gg(o,n,i,r,t[s+2],9,-51403784),r=md5_gg(r,o,n,i,t[s+7],14,1735328473),i=md5_gg(i,r,o,n,t[s+12],20,-1926607734),n=md5_hh(n,i,r,o,t[s+5],4,-378558),o=md5_hh(o,n,i,r,t[s+8],11,-2022574463),r=md5_hh(r,o,n,i,t[s+11],16,1839030562),i=md5_hh(i,r,o,n,t[s+14],23,-35309556),n=md5_hh(n,i,r,o,t[s+1],4,-1530992060),o=md5_hh(o,n,i,r,t[s+4],11,1272893353),r=md5_hh(r,o,n,i,t[s+7],16,-155497632),i=md5_hh(i,r,o,n,t[s+10],23,-1094730640),n=md5_hh(n,i,r,o,t[s+13],4,681279174),o=md5_hh(o,n,i,r,t[s+0],11,-358537222),r=md5_hh(r,o,n,i,t[s+3],16,-722521979),i=md5_hh(i,r,o,n,t[s+6],23,76029189),n=md5_hh(n,i,r,o,t[s+9],4,-640364487),o=md5_hh(o,n,i,r,t[s+12],11,-421815835),r=md5_hh(r,o,n,i,t[s+15],16,530742520),i=md5_hh(i,r,o,n,t[s+2],23,-995338651),n=md5_ii(n,i,r,o,t[s+0],6,-198630844),o=md5_ii(o,n,i,r,t[s+7],10,1126891415),r=md5_ii(r,o,n,i,t[s+14],15,-1416354905),i=md5_ii(i,r,o,n,t[s+5],21,-57434055),n=md5_ii(n,i,r,o,t[s+12],6,1700485571),o=md5_ii(o,n,i,r,t[s+3],10,-1894986606),r=md5_ii(r,o,n,i,t[s+10],15,-1051523),i=md5_ii(i,r,o,n,t[s+1],21,-2054922799),n=md5_ii(n,i,r,o,t[s+8],6,1873313359),o=md5_ii(o,n,i,r,t[s+15],10,-30611744),r=md5_ii(r,o,n,i,t[s+6],15,-1560198380),i=md5_ii(i,r,o,n,t[s+13],21,1309151649),n=md5_ii(n,i,r,o,t[s+4],6,-145523070),o=md5_ii(o,n,i,r,t[s+11],10,-1120210379),r=md5_ii(r,o,n,i,t[s+2],15,718787259),i=md5_ii(i,r,o,n,t[s+9],21,-343485551),n=safe_add(n,a),i=safe_add(i,u),r=safe_add(r,c),o=safe_add(o,l)}return Array(n,i,r,o)}function md5_cmn(t,e,n,i,r,o){return safe_add(bit_rol(safe_add(safe_add(e,t),safe_add(i,o)),r),n)}function md5_ff(t,e,n,i,r,o,s){return md5_cmn(e&n|~e&i,t,e,r,o,s)}function md5_gg(t,e,n,i,r,o,s){return md5_cmn(e&i|n&~i,t,e,r,o,s)}function md5_hh(t,e,n,i,r,o,s){return md5_cmn(e^n^i,t,e,r,o,s)}function md5_ii(t,e,n,i,r,o,s){return md5_cmn(n^(e|~i),t,e,r,o,s)}function safe_add(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function bit_rol(t,e){return t<<e|t>>>32-e}function utf8t2d(t){t=t.replace(/\r\n/g,"\n");var e=new Array;if(String.fromCharCode(237).charCodeAt(0)<0)for(var n=0;n<t.length;n++){var i=t.charCodeAt(n);i>0?e[e.length]=i:(e[e.length]=256+i>>6|192,e[e.length]=256+i&63|128)}else for(var n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e[e.length]=i:i>127&&i<2048?(e[e.length]=i>>6|192,e[e.length]=63&i|128):(e[e.length]=i>>12|224,e[e.length]=i>>6&63|128,e[e.length]=63&i|128)}return e}function utf8d2t(t){for(var e=new Array,n=0;n<t.length;)t[n]<128?(e[e.length]=String.fromCharCode(t[n]),n++):t[n]>191&&t[n]<224?(e[e.length]=String.fromCharCode((31&t[n])<<6|63&t[n+1]),n+=2):(e[e.length]=String.fromCharCode((15&t[n])<<12|(63&t[n+1])<<6|63&t[n+2]),n+=3);return e.join("")}function b64arrays(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b64=new Array,f64=new Array;for(var e=0;e<t.length;e++)b64[e]=t.charAt(e),f64[t.charAt(e)]=e}function b64d2t(t){var e=new Array,n=0,i=t.length;for(i%3==1&&(t[t.length]=0,t[t.length]=0),i%3==2&&(t[t.length]=0);n<t.length;)e[e.length]=b64[t[n]>>2],e[e.length]=b64[(3&t[n])<<4|t[n+1]>>4],e[e.length]=b64[(15&t[n+1])<<2|t[n+2]>>6],e[e.length]=b64[63&t[n+2]],n+=3;return i%3==1&&(e[e.length-1]=e[e.length-2]="="),i%3==2&&(e[e.length-1]="="),e.join("")}function b64t2d(t){var e=new Array,n=0;for(t=t.replace(/\n|\r/g,""),t=t.replace(/=/g,"");n<t.length;)e[e.length]=f64[t.charAt(n)]<<2|f64[t.charAt(n+1)]>>4,e[e.length]=(15&f64[t.charAt(n+1)])<<4|f64[t.charAt(n+2)]>>2,e[e.length]=(3&f64[t.charAt(n+2)])<<6|f64[t.charAt(n+3)],n+=4;return t.length%4==2&&(e=e.slice(0,e.length-2)),t.length%4==3&&(e=e.slice(0,e.length-1)),e}function createXHR(){var t;if("undefined"!=typeof ActiveXObject)for(var e=["Microsoft.XMLHTTP","Msxml2.XMLHttp.6.0","Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","Msxml2.XMLHttp.3.0"],n=0;n<e.length;n++)try{t=new ActiveXObject(e[n])}catch(t){}else"undefined"!=typeof XMLHttpRequest&&(t=new XMLHttpRequest);return t}function JSJaCConnection(t){t&&t.httpbase&&(this._httpbase=t.httpbase),t&&t.oDbg&&t.oDbg.log?this.oDbg=t.oDbg:this.oDbg={log:function(){}},t&&t.timerval?this.setPollInterval(t.timerval):this.setPollInterval(JSJAC_TIMERVAL),t&&t.cookie_prefix?this._cookie_prefix=t.cookie_prefix:this._cookie_prefix="",this._connected=!1,this._events=[],this._keys=null,this._ID=0,this._IDPrefix="jump"+(new Date).format("yyMMdd")+"_",this._inQ=[],this._pQueue=[],this._regIDs=[],this._req=[],this._status="intialized",this._errcnt=0,this._inactivity=JSJAC_INACTIVITY,this._sendRawCallbacks=[]}function JSJaCConsoleLogger(t){this.level=t||4,this.start=function(){},this.log=function(t,e){if(!((e=e||0)>this.level)&&"undefined"!=typeof console)try{switch(e){case 0:console.warn(t);break;case 1:console.error(t);break;case 2:console.info(t);break;case 4:console.debug(t);break;default:console.log(t)}}catch(e){try{console.log(t)}catch(t){}}},this.setLevel=function(t){return this.level=t,this},this.getLevel=function(){return this.level}}function STANZA_ERROR(t,e,n){if(window==this)return new STANZA_ERROR(t,e,n);this.code=t,this.type=e,this.cond=n}function JSJaCCookieException(t){this.message=t,this.name="CookieException"}function JSJaCCookie(t,e,n,i,r){if(window==this)return new JSJaCCookie(t,e,n,i,r);this.name=t,this.value=e,this.secs=n,this.domain=i,this.path=r,this.write=function(){var t;if(this.secs){var e=new Date;e.setTime(e.getTime()+1e3*this.secs),t="; expires="+e.toGMTString()}else t="";var n=this.domain?"; domain="+this.domain:"",i=this.path?"; path="+this.path:"; path=/";document.cookie=this.getName()+"="+JSJaCCookie._escape(this.getValue())+t+n+i},this.erase=function(){new JSJaCCookie(this.getName(),"",-1).write()},this.getName=function(){return this.name},this.setName=function(t){return this.name=t,this},this.getValue=function(){return this.value},this.setValue=function(t){return this.value=t,this},this.setDomain=function(t){return this.domain=t,this},this.setPath=function(t){return this.path=t,this}}function JSJaCDebugger(){}function JSJaCError(t,e,n){var i=XmlDocument.create("error","jsjac");return i.documentElement.setAttribute("code",t),i.documentElement.setAttribute("type",e),n&&i.documentElement.appendChild(i.createElement(n)).setAttribute("xmlns",NS_STANZAS),i.documentElement}function JSJaCHttpBindingConnection(t){this.base=JSJaCConnection,this.base(t),this._hold=JSJACHBC_MAX_HOLD,this._inactivity=0,this._last_requests={},this._last_rid=0,this._min_polling=0,this._pause=0,this._wait=t.wait||JSJACHBC_MAX_WAIT,function(){function t(t,e){return this.slice(t,e)}function e(t,e){arguments.length<2&&(e=0);for(var n=0,i=t.length;n<i;++n,++e)this[e]=255&t[n]}function n(n){var i;if("number"==typeof n){i=new Array(n);for(var r=0;r<n;++r)i[r]=0}else i=n.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=e,"object"==typeof n&&n.buffer&&(i.buffer=n.buffer),i}try{new Uint8Array(1);return}catch(t){}window.Uint8Array=n,window.Uint32Array=n,window.Int32Array=n}()}function JSJaCHttpPollingConnection(t){this.base=JSJaCConnection,this.base(t),JSJACPACKET_USE_XMLNS=!1}function JSJaCJIDInvalidException(t){this.message=t,this.name="JSJaCJIDInvalidException"}function JSJaCJID(t){this._node="",this._domain="",this._resource="","string"==typeof t?(-1!=t.indexOf("@")&&(this.setNode(t.substring(0,t.indexOf("@"))),t=t.substring(t.indexOf("@")+1)),-1!=t.indexOf("/")&&(this.setResource(t.substring(t.indexOf("/")+1)),t=t.substring(0,t.indexOf("/"))),this.setDomain(t)):(this.setNode(t.node),this.setDomain(t.domain),this.setResource(t.resource))}function JSJaCJSON(){}function JSJaCKeys(t,e){var n=Math.random();if(this._k=[],this._k[0]=n.toString(),e?this.oDbg=e:(this.oDbg={},this.oDbg.log=function(){}),t)for(var i=1;i<JSJAC_NKEYS;i++)this._k[i]=t(this._k[i-1]),e.log(i+": "+this._k[i],4);this._indexAt=JSJAC_NKEYS-1,this.getKey=function(){return this._k[this._indexAt--]},this.lastKey=function(){return 0===this._indexAt},this.size=function(){return this._k.length},this._getSuspendVars=function(){return"_k,_indexAt".split(",")}}function JSJaCPacket(t){this.name=t,this.doc=void 0!==JSJACPACKET_USE_XMLNS&&JSJACPACKET_USE_XMLNS?XmlDocument.create(t,NS_CLIENT):XmlDocument.create(t,"")}function JSJaCPresence(){this.base=JSJaCPacket,this.base("presence")}function JSJaCIQ(){this.base=JSJaCPacket,this.base("iq")}function JSJaCMessage(){this.base=JSJaCPacket,this.base("message")}function JSJaCWebSocketConnection(t){this.base=JSJaCConnection,this.base(t),this._ws=null,this.registerHandler("onerror",JSJaC.bind(this._cleanupWebSocket,this))}BaseList.prototype.set=function(t,e,n){if(t&&e){var i,r=this.get(t);return r&&(i=this.array.indexOf(r)),i>-1&&r?this.array.splice(i,1,e):this.array.push(e),this.list[t]=e,"function"==typeof n&&this.array.sort.call(this.array,n),e}},BaseList.prototype.get=function(t){if(t)return this.list[t]},BaseList.prototype.getAll=function(){return this.array},BaseList.prototype.getFirst=function(){return this.array.slice(0,1)[0]},BaseList.prototype.getLast=function(){return this.array.slice(-1)[0]},BaseList.prototype.getPrev=function(t){if(this.get(t)){var e=this.array.indexOf(this.get(t));if(e>0)return this.array[e-1]}},BaseList.prototype.getNext=function(t){if(this.get(t)){var e=this.array.indexOf(this.get(t));if(e>-1)return this.array[e+1]}},BaseList.prototype.remove=function(t){if(t){var e,n=this.get(t);return this.list[t]=null,delete this.list[t],n&&(e=this.array.indexOf(n))>-1?this.array.splice(e,1)[0]:[]}},BaseList.prototype.update=function(t,e){return this.set.apply(this,arguments)},BaseList.prototype.length=function(){return this.array.length},BaseList.prototype.clear=function(){for(var t in this.list)this.list.hasOwnProperty(t)&&(this.list[t]=null,delete this.list[t]);this.array.splice(0,this.array.length),this.array.length=0},BaseList.prototype.indexOf=function(){return this.array.indexOf.apply(this.array,arguments)},BaseList.prototype.includes=function(){return this.array.includes.apply(this.array,arguments)},BaseList.prototype.lastIndexOf=function(){return this.array.lastIndexOf.apply(this.array,arguments)},BaseList.prototype.sort=function(){return this.array.sort.apply(this.array,arguments)},BaseList.prototype.some=function(){return this.array.some.apply(this.array,arguments)},BaseList.prototype.every=function(){return this.array.every.apply(this.array,arguments)},BaseList.prototype.map=function(){return this.array.map.apply(this.array,arguments)},BaseList.prototype.filter=function(){return this.array.filter.apply(this.array,arguments)},BaseList.prototype.forEach=function(){return this.array.forEach.apply(this.array,arguments)},BaseList.prototype.keys=function(){if(Object.keys)return Object.keys(this.list);var t=[];for(var e in this.list)this.list.hasOwnProperty(e)&&t.push(e);return t},IMFile.prototype.build=function(t){if(t=t||{},this.path=t.path||this.path||"",this.name=t.name||this.name||"",this.size=t.size||this.size||0,this.from=0,t.location&&(this.location=t.location||this.location),t.id&&(this.id=t.id||this.id),this.fid=t.fid||0,0!==t.original&&1!==t.original||(this.original=t.original),this.name&&!this.type){this.name=this.name.trim();var e=/.+\.(\w+)$/,n=e.exec(this.name);n&&n[1]&&(this.type=n[1])}},Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,n){var i,r=t,o=[];if(n=n||r.length,e)for(i=0;i<e;i++)o[i]=r[0|Math.random()*n];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",i=0;i<36;i++)o[i]||(s=0|16*Math.random(),o[i]=r[19==i?3&s|8:s])}return o.join("")},Math.uuidFast=function(){for(var e,n=t,i=new Array(36),r=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?i[o]="-":14==o?i[o]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[o]=n[19==o?3&e|8:e]);return i.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}}(),Object.clone=function(t){if("object"!=typeof t)return t;var e={};t.constructor==Array&&(e=[]);for(var n in t)e[n]=t[n]?Object.clone(t[n]):null;return e},Array.prototype.every||(Array.prototype.every=function(t,e){"use strict";var n,i;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof t)throw new TypeError;for(arguments.length>1&&(n=e),i=0;i<o;){var s;if(i in r){s=r[i];if(!t.call(n,s,i,r))return!1}i++}return!0}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;for(var e=Object(this),n=e.length>>>0,i=arguments.length>=2?arguments[1]:void 0,r=0;r<n;r++)if(r in e&&t.call(i,e[r],r,e))return!0;return!1}),Array.prototype.map||(Array.prototype.map=function(t,e){var n,i,r;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),i=new Array(s),r=0;r<s;){var a,u;r in o&&(a=o[r],u=t.call(n,a,r,o),i[r]=u),r++}return i}),Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=[],r=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in e){var s=e[o];t.call(r,s,o,e)&&i.push(s)}return i}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var o=+e||0;if(Math.abs(o)===1/0&&(o=0),o>=r)return-1;for(n=Math.max(o>=0?o:r-Math.abs(o),0);n<r;){if(n in i&&i[n]===t)return n;n++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,i;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),i=0;i<o;){var s;i in r&&(s=r[i],t.call(n,s,i,r)),i++}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e,n,i=Object(this),r=i.length>>>0;if(0===r)return-1;for(e=r-1,arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),n=e>=0?Math.min(e,r-1):r-Math.abs(e);n>=0;n--)if(n in i&&i[n]===t)return n;return-1}),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r}),String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.notEmpty=function(){return null!=this&&""!=this.trim()},String.prototype.isEmpty=function(){return!this.notEmpty()},String.prototype.endWith=function(t){return!(null==t||""==t||0==this.length||t.length>this.length)&&this.substring(this.length-t.length)==t},String.prototype.startWith=function(t){return!(null==t||""==t||0==this.length||t.length>this.length)&&this.substr(0,t.length)==t};var YYIMCommonUtil={isFunction:function(t){return"function"==typeof t},isStringAndNotEmpty:function(t){return"string"==typeof t&&t.notEmpty()},chatNumInString:function(t,e){if("string"==typeof t&&"string"==typeof e){var n=new RegExp("\\"+e,"gi"),i=t.match(n);if(i)return i.length}return 0},isNumber:function(t){return"[object Number]"===Object.prototype.toString.call(t)}},YYIMArrayUtil={contains:function(t,e){if("[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}return!1},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},unique:function(t){t.sort();for(var e=[t[0]],n=1;n<t.length;n++)t[n]!==e[e.length-1]&&e.push(t[n]);return e},insert:function(t,e,n){t.splice(e,0,n)}},YYIMUtil={localstorage:function(){function t(){try{return s=!0,window.localStorage}catch(t){throw s=!1,new Error(t.message)}}function e(){a&&a.clear()}function n(t,e){a&&a.setItem(t,e)}function i(t){if(a)return a.getItem(t)}function r(t){a&&a.removeItem(t)}function o(t){var e;if(YYIMUtil.isWhateType(t,"Array")){e={};for(var n in t)i(t[n])&&(e[t[n]]=i(t[n]))}var r={total:YYIMUtil.getSpace(a)};return e&&(r.expect=YYIMUtil.getSpace(e),e=null),r}var s=!1,a=t();return{enable:s,getLocalStorage:t,setItem:n,getItem:i,removeItem:r,clear:e,getSpace:o}}(),getSpace:function(t){try{return{size:unescape(encodeURIComponent(JSON.stringify(t))).length,space:YYIMUtil.bytesToSize(unescape(encodeURIComponent(JSON.stringify(t))).length)}}catch(t){return{size:0,space:"0 B"}}},cookie:{get:function(t){if(t)for(var e=document.cookie,n=e.split(";"),i=n.length,r=0;r<i;r++){var o=n[r].split("=");if(o[0].replace(/(^\s+)|(\s+$)/g,"")==t)return unescape(o[1])}return null},set:function(t,e,n,i,r,o){if(t&&e){var s=encodeURIComponent(t)+"="+encodeURIComponent(e);if(n){s+=";expires="+new Date((new Date).getTime()+6e4*n).toGMTString()}i&&(s+=";path="+i),r&&(s+=";domain="+r),o&&(s+=";secure"),document.cookie=s}},delete:function(t,e,n){if(t&&this.get(t)){var i=encodeURIComponent(t)+"=;expires=Fri, 02-Jan-1970 00:00:00 GMT";e&&(i+=";path="+e),n&&(i+=";domain="+n),document.cookie=i}}},array:{comparisonAsc:function(t){return function(e,n){return e[t]-n[t]}},comparisonDesc:function(t){return function(e,n){return n[t]-e[t]}}},isWhateType:function(t,e){return"Null"===e&&null===t||"Undefined"===e&&void 0===t||"Number"===e&&isFinite(t)||Object.prototype.toString.call(t).slice(8,-1)===e},dom:{convertToArray:function(t){var e=null;try{e=Array.prototype.slice.call(t,0)}catch(r){e=[];for(var n=0,i=t.length;n<i;n++)e.push(t[n])}return e}},bytesToSize:function(t){if(0===t)return"0 B";var e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,n)).toPrecision(3)+" "+e[n]},extend:function(t,e,n){if("[object Object]"===Object.prototype.toString.call(t)){if("[object Array]"===Object.prototype.toString.call(e))for(var i=0,r=e.length;i<r;i++)arguments.callee(t,e[i],n);try{if(e)for(var i in e)!0!==n&&t[i]||(t[i]=e[i]);return t}catch(e){return t}}return t},html:{removeHtmlTab:function(t){return t.replace(/<[^<>]+?>/g,"")},htmlEscape:function(t){return t.replace(/[<>&"]/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})},escapeHtml:function(t){var e={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return t.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(t,n){return e[n]})},nbspSpace:function(t){var e={nbsp:" "};return t.replace(/&(nbsp);/gi,function(t,n){return e[n]})},spaceNbsp:function(t){return t.replace(/\s/gi,"&nbsp;")},returnBr:function(t){return t.replace(/\r?\n/g,"<br />")},trimBr:function(t){return t=t.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n"),t=t.replace(/^((\s|&nbsp;)*\r?\n)+/g,""),t=t.replace(/((\s|&nbsp;)*\r?\n)+$/g,"")},mergeSpace:function(t){return t=t.replace(/(\s|&nbsp;)+/g," ")}},function:{bind:function(t,e){if("Function"==Object.prototype.toString.call(t).slice(8,-1))return function(){return t.apply(e,arguments)}},curry:function(t){if("Function"==Object.prototype.toString.call(t).slice(8,-1)){var e=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,e.concat(n))}}}},transcoding:{base64ToDataUrl:function(t){return t&&!/data\:image\/png\;base64\,/.test(t)?"data:image/png;base64,"+t:t},dataUrlToBase64:function(t){return t&&t.replace(/data\:image\/png\;base64\,/g,""),t},base64ToBlob:function(t){if(t){var e=window.atob(t.split(",")[1]||t),n=new ArrayBuffer(e.length),i=new Uint8Array(n);for(var r in e)e.hasOwnProperty(r)&&(i[r]=e.charCodeAt(r));return new Blob([n],{type:"image/png"})}},base64ToFormData:function(t){if(t){var e=new FormData;return e.append("file",this.base64ToBlob(t)),e}}}},YYIMRegExp={mobile:/^[1][358][0-9]{9}$/,phone:/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/};!function(t,e){"use strict";function n(t,e){for(var n,i=[],s=0;s<t.length;++s){if(!(n=o[t[s]]||r(t[s])))throw"module definition dependecy not found: "+t[s];i.push(n)}e.apply(null,i)}function i(t,i,r){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(i===e)throw"invalid module definition, dependencies must be specified";if(r===e)throw"invalid module definition, definition function must be specified";n(i,function(){o[t]=r.apply(null,arguments)})}function r(e){for(var n=t,i=e.split(/[.\/]/),r=0;r<i.length;++r){if(!n[i[r]])return;n=n[i[r]]}return n}var o={},s="moxie/core/utils/Basic",a="moxie/core/utils/Env",u="moxie/core/I18n",c="moxie/core/utils/Mime",l="moxie/core/utils/Dom",h="moxie/core/Exceptions",d="moxie/core/EventTarget",p="moxie/runtime/Runtime",f="moxie/runtime/RuntimeClient",g="moxie/file/FileInput",m="moxie/core/utils/Encode",_="moxie/file/Blob",E="moxie/file/File",S="moxie/file/FileDrop",y="moxie/file/FileReader",C="moxie/core/utils/Url",v="moxie/runtime/RuntimeTarget",b="moxie/file/FileReaderSync",R="moxie/xhr/FormData",T="moxie/xhr/XMLHttpRequest",A="moxie/runtime/Transporter",w="moxie/image/Image",I="moxie/runtime/html5/Runtime",O="moxie/core/utils/Events",N="moxie/runtime/html5/file/FileReader",x="moxie/runtime/html5/utils/BinaryReader",D="moxie/runtime/html5/image/JPEGHeaders",J="moxie/runtime/html5/image/ExifParser",P="moxie/runtime/html5/image/JPEG",M="moxie/runtime/html5/image/PNG",L="moxie/runtime/html5/image/ImageInfo",U="moxie/runtime/html5/image/MegaPixel",k="moxie/runtime/html5/image/Image",H="moxie/runtime/flash/Runtime",B="moxie/runtime/flash/file/Blob",F="moxie/runtime/flash/file/FileReader",q="moxie/runtime/flash/file/FileReaderSync",X="moxie/runtime/flash/xhr/XMLHttpRequest",j="moxie/runtime/flash/runtime/Transporter",G="moxie/runtime/flash/image/Image",z="moxie/runtime/silverlight/Runtime",V="moxie/runtime/html4/Runtime";i(s,[],function(){var t=function(t){return void 0===t?"undefined":null===t?"null":t.nodeType?"node":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},e=function(i){return n(arguments,function(r,o){o>0&&n(r,function(n,r){void 0!==n&&(t(i[r])===t(n)&&~s(t(n),["array","object"])?e(i[r],n):i[r]=n)})}),i},n=function(e,n){var i,r,o;if(e)if("number"===t(e.length)){for(o=0,i=e.length;i>o;o++)if(!1===n(e[o],o))return}else if("object"===t(e))for(r in e)if(e.hasOwnProperty(r)&&!1===n(e[r],r))return},i=function(e){var n;if(!e||"object"!==t(e))return!0;for(n in e)return!1;return!0},r=function(e,n){function i(o){"function"===t(e[o])&&e[o](function(t){++o<r&&!t?i(o):n(t)})}var r=e.length;"function"!==t(n)&&(n=function(){}),e&&e.length||n(),i(0)},o=function(t,e){var i=0,r=t.length,o=new Array(r);n(t,function(t,n){t(function(t){if(t)return e(t);var s=[].slice.call(arguments);s.shift(),o[n]=s,++i===r&&(o.unshift(null),e.apply(this,o))})})},s=function(t,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n}return-1},a=function(e,n){var i=[];"array"!==t(e)&&(e=[e]),"array"!==t(n)&&(n=[n]);for(var r in e)-1===s(e[r],n)&&i.push(e[r]);return!!i.length&&i},u=function(t,e){var i=[];return n(t,function(t){-1!==s(t,e)&&i.push(t)}),i.length?i:null},c=function(t){var e,n=[];for(e=0;e<t.length;e++)n[e]=t[e];return n},l=function(){var t=0;return function(e){var n,i=(new Date).getTime().toString(32);for(n=0;5>n;n++)i+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+i+(t++).toString(32)}}(),h=function(t){return t?String.prototype.trim?String.prototype.trim.call(t):t.toString().replace(/^\s*/,"").replace(/\s*$/,""):t},d=function(t){if("string"!=typeof t)return t;var e,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return t=/^([0-9\.]+)([tmgk]?)$/.exec(t.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),e=t[2],t=+t[1],n.hasOwnProperty(e)&&(t*=n[e]),Math.floor(t)};return{guid:l,typeOf:t,extend:e,each:n,isEmptyObj:i,inSeries:r,inParallel:o,inArray:s,arrayDiff:a,arrayIntersect:u,toArray:c,trim:h,sprintf:function(e){var n=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=n.shift();return"undefined"!==t(e)?e:""})},parseSizeStr:d}}),i(a,[s],function(t){function e(t,e,n){
var i=0,r=0,o=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},a=function(t){return t=(""+t).replace(/[_\-+]/g,"."),t=t.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),t.length?t.split("."):[-8]},u=function(t){return t?isNaN(t)?s[t]||-7:parseInt(t,10):0};for(t=a(t),e=a(e),r=Math.max(t.length,e.length),i=0;r>i;i++)if(t[i]!=e[i]){if(t[i]=u(t[i]),e[i]=u(e[i]),t[i]<e[i]){o=-1;break}if(t[i]>e[i]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return 0>=o;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return 0>o;default:return null}}var n=function(t){var e="function",n="object",i="name",r="version",o={has:function(t,e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},s={rgx:function(){for(var i,r,o,s,a,u,c,l=0,h=arguments;l<h.length;l+=2){var d=h[l],p=h[l+1];if(void 0===i){i={};for(s in p)a=p[s],typeof a===n?i[a[0]]=t:i[a]=t}for(r=o=0;r<d.length;r++)if(u=d[r].exec(this.getUA())){for(s=0;s<p.length;s++)c=u[++o],a=p[s],typeof a===n&&a.length>0?2==a.length?typeof a[1]==e?i[a[0]]=a[1].call(this,c):i[a[0]]=a[1]:3==a.length?typeof a[1]!==e||a[1].exec&&a[1].test?i[a[0]]=c?c.replace(a[1],a[2]):t:i[a[0]]=c?a[1].call(this,c,a[2]):t:4==a.length&&(i[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):t):i[a]=c||t;break}if(u)break}return i},str:function(e,i){for(var r in i)if(typeof i[r]===n&&i[r].length>0){for(var s=0;s<i[r].length;s++)if(o.has(i[r][s],e))return"?"===r?t:r}else if(o.has(i[r],e))return"?"===r?t:r;return e}},a={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},u={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[i,r],[/\s(opr)\/([\w\.]+)/i],[[i,"Opera"],r],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[i,r],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[i,"IE"],r],[/(edge)\/((\d+)?[\w\.]+)/i],[i,r],[/(yabrowser)\/([\w\.]+)/i],[[i,"Yandex"],r],[/(comodo_dragon)\/([\w\.]+)/i],[[i,/_/g," "],r],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[i,r],[/(dolfin)\/([\w\.]+)/i],[[i,"Dolphin"],r],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[i,"Chrome"],r],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[r,[i,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[r,[i,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[r,[i,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[r,[i,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[r,i],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[i,[r,s.str,a.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[i,r],[/(navigator|netscape)\/([\w\.-]+)/i],[[i,"Netscape"],r],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[i,r]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[r,[i,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,r],[/rv\:([\w\.]+).*(gecko)/i],[r,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,r],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[r,s.str,a.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[r,s.str,a.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],r],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,r],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],r],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],r],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,r],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],r],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],r],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,r],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[i,"iOS"],[r,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[i,"Mac OS"],[r,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[i,r]]};return function(t){var e=t||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return s.rgx.apply(this,u.browser)},this.getEngine=function(){return s.rgx.apply(this,u.engine)},this.getOS=function(){return s.rgx.apply(this,u.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return e},this.setUA=function(t){return e=t,this},this.setUA(e)}}(),i=function(){var e={define_property:!1,create_canvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}(),return_response_type:function(e){try{if(-1!==t.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=e,n.responseType===e}}catch(t){}return!1},use_data_uri:function(){var t=new Image;return t.onload=function(){e.use_data_uri=1===t.width&&1===t.height},setTimeout(function(){t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==o.browser||o.version>=9)},use_data_uri_of:function(t){return e.use_data_uri&&33e3>t||e.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var t=document.createElement("input");return t.setAttribute("type","file"),!t.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===t.typeOf(e[n])?e[n].apply(this,i):!!e[n]}}(),r=(new n).getResult(),o={can:i,uaParser:n,browser:r.browser.name,version:r.browser.version,os:r.os.name,osVersion:r.os.version,verComp:e,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return o.OS=o.os,o}),i(u,[s],function(t){var e={};return{addI18n:function(n){return t.extend(e,n)},translate:function(t){return e[t]||t},_:function(t){return this.translate(t)},sprintf:function(e){var n=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=n.shift();return"undefined"!==t.typeOf(e)?e:""})}}}),i(c,[s,u],function(t,e){var n={mimes:{},extensions:{},addMimeType:function(t){var e,n,i,r=t.split(/,/);for(e=0;e<r.length;e+=2){for(i=r[e+1].split(/ /),n=0;n<i.length;n++)this.mimes[i[n]]=r[e];this.extensions[r[e]]=i}},extList2mimes:function(e,n){var i,r,o,s,a=this,u=[];for(r=0;r<e.length;r++)for(i=e[r].extensions.split(/\s*,\s*/),o=0;o<i.length;o++){if("*"===i[o])return[];if(s=a.mimes[i[o]],s&&-1===t.inArray(s,u)&&u.push(s),n&&/^\w+$/.test(i[o]))u.push("."+i[o]);else if(!s)return[]}return u},mimes2exts:function(e){var n=this,i=[];return t.each(e,function(e){if("*"===e)return i=[],!1;var r=e.match(/^(\w+)\/(\*|\w+)$/);r&&("*"===r[2]?t.each(n.extensions,function(t,e){new RegExp("^"+r[1]+"/").test(e)&&[].push.apply(i,n.extensions[e])}):n.extensions[e]&&[].push.apply(i,n.extensions[e]))}),i},mimes2extList:function(n){var i=[],r=[];return"string"===t.typeOf(n)&&(n=t.trim(n).split(/\s*,\s*/)),r=this.mimes2exts(n),i.push({title:e.translate("Files"),extensions:r.length?r.join(","):"*"}),i.mimes=n,i},getFileExtension:function(t){var e=t&&t.match(/\.([^.]+)$/);return e?e[1].toLowerCase():""},getFileMime:function(t){return this.mimes[this.getFileExtension(t)]||""}};return n.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),n}),i(l,[a],function(t){var e=function(t){return"string"!=typeof t?t:document.getElementById(t)},n=function(t,e){return!!t.className&&new RegExp("(^|\\s+)"+e+"(\\s+|$)").test(t.className)},i=function(t,e){n(t,e)||(t.className=t.className?t.className.replace(/\s+$/,"")+" "+e:e)},r=function(t,e){if(t.className){var n=new RegExp("(^|\\s+)"+e+"(\\s+|$)");t.className=t.className.replace(n,function(t,e,n){return" "===e&&" "===n?" ":""})}},o=function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null)[e]:void 0},s=function(e,n){function i(t){var e,n,i=0,r=0;return t&&(n=t.getBoundingClientRect(),e="CSS1Compat"===c.compatMode?c.documentElement:c.body,i=n.left+e.scrollLeft,r=n.top+e.scrollTop),{x:i,y:r}}var r,o,s,a=0,u=0,c=document;if(e=e,n=n||c.body,e&&e.getBoundingClientRect&&"IE"===t.browser&&(!c.documentMode||c.documentMode<8))return o=i(e),s=i(n),{x:o.x-s.x,y:o.y-s.y};for(r=e;r&&r!=n&&r.nodeType;)a+=r.offsetLeft||0,u+=r.offsetTop||0,r=r.offsetParent;for(r=e.parentNode;r&&r!=n&&r.nodeType;)a-=r.scrollLeft||0,u-=r.scrollTop||0,r=r.parentNode;return{x:a,y:u}};return{get:e,hasClass:n,addClass:i,removeClass:r,getStyle:o,getPos:s,getSize:function(t){return{w:t.offsetWidth||t.clientWidth,h:t.offsetHeight||t.clientHeight}}}}),i(h,[s],function(t){function e(t,e){var n;for(n in t)if(t[n]===e)return n;return null}return{RuntimeError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return t.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function e(t){this.code=t,this.name="OperationNotAllowedException"}return t.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return t.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return t.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return t.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function e(t){this.code=t,this.name="EventException"}return t.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}}),i(d,[a,h,s],function(t,e,n){function i(){var t={};n.extend(this,{uid:null,init:function(){this.uid||(this.uid=n.guid("uid_"))},addEventListener:function(e,i,r,o){var s,a=this;return this.hasOwnProperty("uid")||(this.uid=n.guid("uid_")),e=n.trim(e),/\s/.test(e)?void n.each(e.split(/\s+/),function(t){a.addEventListener(t,i,r,o)}):(e=e.toLowerCase(),r=parseInt(r,10)||0,s=t[this.uid]&&t[this.uid][e]||[],s.push({fn:i,priority:r,scope:o||this}),t[this.uid]||(t[this.uid]={}),void(t[this.uid][e]=s))},hasEventListener:function(e){var n=e?t[this.uid]&&t[this.uid][e]:t[this.uid];return n||!1},removeEventListener:function(e,i){e=e.toLowerCase();var r,o=t[this.uid]&&t[this.uid][e];if(o){if(i){for(r=o.length-1;r>=0;r--)if(o[r].fn===i){o.splice(r,1);break}}else o=[];o.length||(delete t[this.uid][e],n.isEmptyObj(t[this.uid])&&delete t[this.uid])}},removeAllEventListeners:function(){t[this.uid]&&delete t[this.uid]},dispatchEvent:function(i){var r,o,s,a,u,c={},l=!0;if("string"!==n.typeOf(i)){if(a=i,"string"!==n.typeOf(a.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=a.type,a.total!==u&&a.loaded!==u&&(c.total=a.total,c.loaded=a.loaded),c.async=a.async||!1}if(-1!==i.indexOf("::")?function(t){r=t[0],i=t[1]}(i.split("::")):r=this.uid,i=i.toLowerCase(),o=t[r]&&t[r][i]){o.sort(function(t,e){return e.priority-t.priority}),s=[].slice.call(arguments),s.shift(),c.type=i,s.unshift(c);var h=[];n.each(o,function(t){s[0].target=t.scope,c.async?h.push(function(e){setTimeout(function(){e(!1===t.fn.apply(t.scope,s))},1)}):h.push(function(e){e(!1===t.fn.apply(t.scope,s))})}),h.length&&n.inSeries(h,function(t){l=!t})}return l},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(t){var e=this;this.bind(t.join(" "),function(t){var e="on"+t.type.toLowerCase();"function"===n.typeOf(this[e])&&this[e].apply(this,arguments)}),n.each(t,function(t){t="on"+t.toLowerCase(t),"undefined"===n.typeOf(e[t])&&(e[t]=null)})}})}return i.instance=new i,i}),i(p,[a,s,l,d],function(t,e,n,i){function r(t,i,o,a,u){var c,l=this,h=e.guid(i+"_"),d=u||"browser";t=t||{},s[h]=this,o=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},o),t.preferred_caps&&(d=r.getMode(a,t.preferred_caps,d)),c=function(){var t={};return{exec:function(e,n,i,r){return c[n]&&(t[e]||(t[e]={context:this,instance:new c[n]}),t[e].instance[i])?t[e].instance[i].apply(this,r):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:h,type:i,mode:r.getMode(a,t.required_caps,d),shimid:h+"_container",clients:0,options:t,can:function(t,n){var i=arguments[2]||o;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=r.parseCaps(t)),"object"===e.typeOf(t)){for(var s in t)if(!this.can(s,t[s],i))return!1;return!0}return"function"===e.typeOf(i[t])?i[t].call(this,n):n===i[t]},getShimContainer:function(){var t,i=n.get(this.shimid);return i||(t=this.options.container?n.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),t.appendChild(i),t=null),i},getShim:function(){return c},shimExec:function(t,e){var n=[].slice.call(arguments,2);return l.getShim().exec.call(this,this.uid,t,e,n)},exec:function(t,e){var n=[].slice.call(arguments,2);return l[t]&&l[t][e]?l[t][e].apply(this,n):l.shimExec.apply(this,arguments)},destroy:function(){if(l){var t=n.get(this.shimid);t&&t.parentNode.removeChild(t),c&&c.removeAllInstances(),this.unbindAll(),delete s[this.uid],this.uid=null,h=l=c=t=null}}}),this.mode&&t.required_caps&&!this.can(t.required_caps)&&(this.mode=!1)}var o={},s={};return r.order="html5,flash,silverlight,html4",r.getRuntime=function(t){return!!s[t]&&s[t]},r.addConstructor=function(t,e){e.prototype=i.instance,o[t]=e},r.getConstructor=function(t){return o[t]||null},r.getInfo=function(t){var e=r.getRuntime(t);return e?{uid:e.uid,type:e.type,mode:e.mode,can:function(){return e.can.apply(e,arguments)}}:null},r.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(t){n[t]=!0}),n)},r.can=function(t,e){var n,i,o=r.getConstructor(t);return!!o&&(n=new o({required_caps:e}),i=n.mode,n.destroy(),!!i)},r.thatCan=function(t,e){var n=(e||r.order).split(/\s*,\s*/);for(var i in n)if(r.can(n[i],t))return n[i];return null},r.getMode=function(t,n,i){var r=null;if("undefined"===e.typeOf(i)&&(i="browser"),n&&!e.isEmptyObj(t)){if(e.each(n,function(n,i){if(t.hasOwnProperty(i)){var o=t[i](n);if("string"==typeof o&&(o=[o]),r){if(!(r=e.arrayIntersect(r,o)))return r=!1}else r=o}}),r)return-1!==e.inArray(i,r)?i:r[0];if(!1===r)return!1}return i},r.capTrue=function(){return!0},r.capFalse=function(){return!1},r.capTest=function(t){return function(){return!!t}},r}),i(f,[a,h,s,p],function(t,e,n,i){return function(){var t;n.extend(this,{connectRuntime:function(r){function o(n){var s,u;return n.length?(s=n.shift().toLowerCase(),(u=i.getConstructor(s))?(t=new u(r),t.bind("Init",function(){t.initialized=!0,setTimeout(function(){t.clients++,a.trigger("RuntimeInit",t)},1)}),t.bind("Error",function(){t.destroy(),o(n)}),t.mode?void t.init():void t.trigger("Error")):void o(n)):(a.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),void(t=null))}var s,a=this;if("string"===n.typeOf(r)?s=r:"string"===n.typeOf(r.ruid)&&(s=r.ruid),s){if(t=i.getRuntime(s))return t.clients++,t;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}o((r.runtime_order||i.order).split(/\s*,\s*/))},disconnectRuntime:function(){t&&--t.clients<=0&&t.destroy(),t=null},getRuntime:function(){return t&&t.uid?t:t=null},exec:function(){return t?t.exec.apply(this,arguments):null}})}}),i(g,[s,a,c,l,h,d,u,p,f],function(t,e,n,i,r,o,s,a,u){function c(e){var o,c,h,d=this;if(-1!==t.inArray(t.typeOf(e),["string","node"])&&(e={browse_button:e}),!(c=i.get(e.browse_button)))throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);h={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:c.parentNode||document.body},e=t.extend({},h,e),"string"==typeof e.required_caps&&(e.required_caps=a.parseCaps(e.required_caps)),"string"==typeof e.accept&&(e.accept=n.mimes2extList(e.accept)),o=i.get(e.container),o||(o=document.body),"static"===i.getStyle(o,"position")&&(o.style.position="relative"),o=c=null,u.call(d),t.extend(d,{uid:t.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){d.bind("RuntimeInit",function(n,r){d.ruid=r.uid,d.shimid=r.shimid,d.bind("Ready",function(){d.trigger("Refresh")},999),d.bind("Refresh",function(){var n,o,s,a;s=i.get(e.browse_button),a=i.get(r.shimid),s&&(n=i.getPos(s,i.get(e.container)),o=i.getSize(s),a&&t.extend(a.style,{top:n.y+"px",left:n.x+"px",width:o.w+"px",height:o.h+"px"})),a=s=null}),r.exec.call(d,"FileInput","init",e)}),d.connectRuntime(t.extend({},e,{required_caps:{select_file:!0}}))},disable:function(e){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===t.typeOf(e)||e)},refresh:function(){d.trigger("Refresh")},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===t.typeOf(this.files)&&t.each(this.files,function(t){t.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(l)}var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return c.prototype=o.instance,c}),i(m,[],function(){var t=function(t){return unescape(encodeURIComponent(t))},e=function(t){return decodeURIComponent(escape(t))},n=function(t,n){if("function"==typeof window.atob)return n?e(window.atob(t)):window.atob(t);var i,r,o,s,a,u,c,l,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,p=0,f="",g=[];if(!t)return t;t+="";do{s=h.indexOf(t.charAt(d++)),a=h.indexOf(t.charAt(d++)),u=h.indexOf(t.charAt(d++)),c=h.indexOf(t.charAt(d++)),l=s<<18|a<<12|u<<6|c,i=l>>16&255,r=l>>8&255,o=255&l,g[p++]=64==u?String.fromCharCode(i):64==c?String.fromCharCode(i,r):String.fromCharCode(i,r,o)}while(d<t.length);return f=g.join(""),n?e(f):f},i=function(e,n){if(n&&(e=t(e)),"function"==typeof window.btoa)return window.btoa(e);var i,r,o,s,a,u,c,l,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,p=0,f="",g=[];if(!e)return e;do{i=e.charCodeAt(d++),r=e.charCodeAt(d++),o=e.charCodeAt(d++),l=i<<16|r<<8|o,s=l>>18&63,a=l>>12&63,u=l>>6&63,c=63&l,g[p++]=h.charAt(s)+h.charAt(a)+h.charAt(u)+h.charAt(c)}while(d<e.length);f=g.join("");var m=e.length%3;return(m?f.slice(0,m-3):f)+"===".slice(m||3)};return{utf8_encode:t,utf8_decode:e,atob:n,btoa:i}}),i(_,[s,m,f],function(t,e,n){function i(o,s){function a(e,n,o){var s,a=r[this.uid];return"string"===t.typeOf(a)&&a.length?(s=new i(null,{type:o,size:n-e}),s.detach(a.substr(e,s.size)),s):null}n.call(this),o&&this.connectRuntime(o),s?"string"===t.typeOf(s)&&(s={data:s}):s={},t.extend(this,{uid:s.uid||t.guid("uid_"),ruid:o,size:s.size||0,type:s.type||"",slice:function(t,e,n){return this.isDetached()?a.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),t,e,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(t){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),t=t||"","data:"==t.substr(0,5)){var n=t.indexOf(";base64,");this.type=t.substring(5,n),t=e.atob(t.substring(n+8))}this.size=t.length,r[this.uid]=t},isDetached:function(){return!this.ruid&&"string"===t.typeOf(r[this.uid])},destroy:function(){this.detach(),delete r[this.uid]}}),s.data?this.detach(s.data):r[this.uid]=s}var r={};return i}),i(E,[s,c,_],function(t,e,n){function i(i,r){r||(r={}),n.apply(this,arguments),this.type||(this.type=e.getFileMime(r.name));var o;if(r.name)o=r.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else if(this.type){var s=this.type.split("/")[0];o=t.guid((""!==s?s:"file")+"_"),e.extensions[this.type]&&(o+="."+e.extensions[this.type][0])}t.extend(this,{name:o||t.guid("file_"),relativePath:"",lastModifiedDate:r.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(S,[u,l,h,s,a,E,f,d,c],function(t,e,n,i,r,o,s,a,u){function c(n){var r,o=this;"string"==typeof n&&(n={drop_zone:n}),r={accept:[{title:t.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},r,n):r,n.container=e.get(n.drop_zone)||document.body,"static"===e.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=u.mimes2extList(n.accept)),s.call(o),i.extend(o,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){o.bind("RuntimeInit",function(t,e){o.ruid=e.uid,e.exec.call(o,"FileDrop","init",n),o.dispatchEvent("ready")}),o.connectRuntime(n)},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(l)}var l=["ready","dragenter","dragleave","drop","error"];return c.prototype=a.instance,c}),i(y,[s,m,h,d,_,f],function(t,e,n,i,r,o){function s(){function i(t,i){if(this.trigger("loadstart"),this.readyState===s.LOADING)return this.trigger("error",new n.DOMException(n.DOMException.INVALID_STATE_ERR)),void this.trigger("loadend");if(!(i instanceof r))return this.trigger("error",new n.DOMException(n.DOMException.NOT_FOUND_ERR)),void this.trigger("loadend");if(this.result=null,this.readyState=s.LOADING,i.isDetached()){var o=i.getSource();switch(t){case"readAsText":case"readAsBinaryString":this.result=o;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+e.btoa(o)}this.readyState=s.DONE,this.trigger("load"),this.trigger("loadend")}else this.connectRuntime(i.ruid),this.exec("FileReader","read",t,i)}o.call(this),t.extend(this,{uid:t.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(t){i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){i.call(this,"readAsDataURL",t)},readAsText:function(t){i.call(this,"readAsText",t)},abort:function(){this.result=null,-1===t.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(a),this.bind("Error",function(t,e){this.readyState=s.DONE,this.error=e},999),this.bind("Load",function(t){this.readyState=s.DONE},999)}var a=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=i.instance,s}),i(C,[],function(){var t=function(e,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=i.length,o={http:80,https:443},s={},a=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=a.exec(e||"");r--;)u[r]&&(s[i[r]]=u[r]);if(!s.scheme){n&&"string"!=typeof n||(n=t(n||document.location.href)),s.scheme=n.scheme,s.host=n.host,s.port=n.port;var c="";/^[^\/]/.test(s.path)&&(c=n.path,c=/\/[^\/]*\.[^\/]*$/.test(c)?c.replace(/\/[^\/]+$/,"/"):c.replace(/\/?$/,"/")),s.path=c+(s.path||"")}return s.port||(s.port=o[s.scheme]||80),s.port=parseInt(s.port,10),s.path||(s.path="/"),delete s.source,s},e=function(e){var n={http:80,https:443},i="object"==typeof e?e:t(e);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(e){function n(t){return[t.scheme,t.host,t.port].join("/")}return"string"==typeof e&&(e=t(e)),n(t())===n(e)};return{parseUrl:t,resolveUrl:e,hasSameOrigin:n}}),i(v,[s,f,d],function(t,e,n){function i(){this.uid=t.guid("uid_"),e.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(b,[s,f,m],function(t,e,n){return function(){function i(t,e){if(!e.isDetached()){var i=this.connectRuntime(e.ruid).exec.call(this,"FileReaderSync","read",t,e);return this.disconnectRuntime(),i}var r=e.getSource();switch(t){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+e.type+";base64,"+n.btoa(r);case"readAsText":for(var o="",s=0,a=r.length;a>s;s++)o+=String.fromCharCode(r[s]);return o}}e.call(this),t.extend(this,{uid:t.guid("uid_"),readAsBinaryString:function(t){return i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){return i.call(this,"readAsDataURL",t)},readAsText:function(t){return i.call(this,"readAsText",t)}})}}),i(R,[h,s,_],function(t,e,n){function i(){var t,i=[];e.extend(this,{append:function(r,o){var s=this,a=e.typeOf(o);o instanceof n?t={name:r,value:o}:"array"===a?(r+="[]",e.each(o,function(t){s.append(r,t)})):"object"===a?e.each(o,function(t,e){s.append(r+"["+e+"]",t)}):"null"===a||"undefined"===a||"number"===a&&isNaN(o)?s.append(r,"false"):i.push({name:r,value:o.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return t&&t.value||null},getBlobName:function(){return t&&t.name||null},each:function(n){e.each(i,function(t){n(t.value,t.name)}),t&&n(t.value,t.name)},destroy:function(){t=null,i=[]}})}return i}),i(T,[s,h,d,m,C,p,v,_,b,R,a,c],function(t,e,n,i,r,o,s,a,u,c,l,h){function d(){this.uid=t.guid("uid_")}function p(){function n(t,e){return A.hasOwnProperty(t)?1===arguments.length?l.can("define_property")?A[t]:T[t]:void(l.can("define_property")?A[t]=e:T[t]=e):void 0}function u(e){function i(){b&&(b.destroy(),b=null),a.dispatchEvent("loadend"),a=null}function r(r){b.bind("LoadStart",function(t){n("readyState",p.LOADING),a.dispatchEvent("readystatechange"),a.dispatchEvent(t),J&&a.upload.dispatchEvent(t)}),b.bind("Progress",function(t){n("readyState")!==p.LOADING&&(n("readyState",p.LOADING),a.dispatchEvent("readystatechange")),a.dispatchEvent(t)}),b.bind("UploadProgress",function(t){J&&a.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:t.total,loaded:t.loaded})}),b.bind("Load",function(e){n("readyState",p.DONE),n("status",Number(r.exec.call(b,"XMLHttpRequest","getStatus")||0)),n("statusText",f[n("status")]||""),n("response",r.exec.call(b,"XMLHttpRequest","getResponse",n("responseType"))),~t.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),B=r.exec.call(b,"XMLHttpRequest","getAllResponseHeaders"),a.dispatchEvent("readystatechange"),n("status")>0?(J&&a.upload.dispatchEvent(e),a.dispatchEvent(e)):(M=!0,a.dispatchEvent("error")),i()}),b.bind("Abort",function(t){a.dispatchEvent(t),i()}),b.bind("Error",function(t){M=!0,n("readyState",p.DONE),a.dispatchEvent("readystatechange"),P=!0,a.dispatchEvent(t),i()}),r.exec.call(b,"XMLHttpRequest","send",{url:_,method:E,async:w,user:S,password:y,headers:I,mimeType:N,encoding:O,responseType:a.responseType,withCredentials:a.withCredentials,options:H},e)}var a=this;C=(new Date).getTime(),b=new s,"string"==typeof H.required_caps&&(H.required_caps=o.parseCaps(H.required_caps)),H.required_caps=t.extend({},H.required_caps,{return_response_type:a.responseType}),e instanceof c&&(H.required_caps.send_multipart=!0),t.isEmptyObj(I)||(H.required_caps.send_custom_headers=!0),L||(H.required_caps.do_cors=!0),H.ruid?r(b.connectRuntime(H)):(b.bind("RuntimeInit",function(t,e){
r(e)}),b.bind("RuntimeError",function(t,e){a.dispatchEvent("RuntimeError",e)}),b.connectRuntime(H))}function m(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),C=v=null}var _,E,S,y,C,v,b,R,T=this,A={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},w=!0,I={},O=null,N=null,x=!1,D=!1,J=!1,P=!1,M=!1,L=!1,U=null,k=null,H={},B="";t.extend(this,A,{uid:t.guid("uid_"),upload:new d,open:function(o,s,a,u,c){var l;if(!o||!s)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(~t.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(E=o.toUpperCase()),~t.inArray(E,["CONNECT","TRACE","TRACK"]))throw new e.DOMException(e.DOMException.SECURITY_ERR);if(s=i.utf8_encode(s),l=r.parseUrl(s),L=r.hasSameOrigin(l),_=r.resolveUrl(s),(u||c)&&!L)throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);if(S=u||l.user,y=c||l.pass,!1===(w=a||!0)&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);x=!w,D=!1,I={},m.call(this),n("readyState",p.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(r,o){var s=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==p.OPENED||D)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new e.DOMException(e.DOMException.SYNTAX_ERR);return r=t.trim(r).toLowerCase(),!~t.inArray(r,s)&&!/^(proxy\-|sec\-)/.test(r)&&(I[r]?I[r]+=", "+o:I[r]=o,!0)},getAllResponseHeaders:function(){return B||""},getResponseHeader:function(e){return e=e.toLowerCase(),M||~t.inArray(e,["set-cookie","set-cookie2"])?null:B&&""!==B&&(R||(R={},t.each(B.split(/\r\n/),function(e){var n=e.split(/:\s+/);2===n.length&&(n[0]=t.trim(n[0]),R[n[0].toLowerCase()]={header:n[0],value:t.trim(n[1])})})),R.hasOwnProperty(e))?R[e].header+": "+R[e].value:null},overrideMimeType:function(i){var r,o;if(~t.inArray(n("readyState"),[p.LOADING,p.DONE]))throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(i=t.trim(i.toLowerCase()),/;/.test(i)&&(r=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=r[1],r[2]&&(o=r[2])),!h.mimes[i])throw new e.DOMException(e.DOMException.SYNTAX_ERR);U=i,k=o},send:function(n,r){if(H="string"===t.typeOf(r)?{ruid:r}:r||{},this.readyState!==p.OPENED||D)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(n instanceof a)H.ruid=n.ruid,N=n.type||"application/octet-stream";else if(n instanceof c){if(n.hasBlob()){var o=n.getBlob();H.ruid=o.ruid,N=o.type||"application/octet-stream"}}else"string"==typeof n&&(O="UTF-8",N="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=H.required_caps&&H.required_caps.send_browser_cookies&&!L),J=!x&&this.upload.hasEventListener(),M=!1,P=!n,x||(D=!0),u.call(this,n)},abort:function(){if(M=!0,x=!1,~t.inArray(n("readyState"),[p.UNSENT,p.OPENED,p.DONE]))n("readyState",p.UNSENT);else{if(n("readyState",p.DONE),D=!1,!b)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);b.getRuntime().exec.call(b,"XMLHttpRequest","abort",P),P=!0}},destroy:function(){b&&("function"===t.typeOf(b.destroy)&&b.destroy(),b=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(g.concat(["readystatechange"])),this.upload.handleEventProps(g)}var f={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};d.prototype=n.instance;var g=["loadstart","progress","abort","error","load","timeout","loadend"];return p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,p.prototype=n.instance,p}),i(A,[s,m,f,d],function(t,e,n,i){function r(){function i(){l=h=0,c=this.result=null}function o(e,n){var i=this;u=n,i.bind("TransportingProgress",function(e){h=e.loaded,l>h&&-1===t.inArray(i.state,[r.IDLE,r.DONE])&&s.call(i)},999),i.bind("TransportingComplete",function(){h=l,i.state=r.DONE,c=null,i.result=u.exec.call(i,"Transporter","getAsBlob",e||"")},999),i.state=r.BUSY,i.trigger("TransportingStarted"),s.call(i)}function s(){var t,n=this,i=l-h;d>i&&(d=i),t=e.btoa(c.substr(h,d)),u.exec.call(n,"Transporter","receive",t,l)}var a,u,c,l,h,d;n.call(this),t.extend(this,{uid:t.guid("uid_"),state:r.IDLE,result:null,transport:function(e,n,r){var s=this;if(r=t.extend({chunk_size:204798},r),(a=r.chunk_size%3)&&(r.chunk_size+=3-a),d=r.chunk_size,i.call(this),c=e,l=e.length,"string"===t.typeOf(r)||r.ruid)o.call(s,n,this.connectRuntime(r));else{var u=function(t,e){s.unbind("RuntimeInit",u),o.call(s,n,e)};this.bind("RuntimeInit",u),this.connectRuntime(r)}},abort:function(){var t=this;t.state=r.IDLE,u&&(u.exec.call(t,"Transporter","clear"),t.trigger("TransportingAborted")),i.call(t)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),i.call(this)}})}return r.IDLE=0,r.BUSY=1,r.DONE=2,r.prototype=i.instance,r}),i(w,[s,l,h,b,T,p,f,A,a,d,_,E,m],function(t,e,n,i,r,o,s,a,u,c,l,h,d){function p(){function i(t){t||(t=this.exec("Image","getInfo")),this.size=t.size,this.width=t.width,this.height=t.height,this.type=t.type,this.meta=t.meta,""===this.name&&(this.name=t.name)}function c(e){var i=t.typeOf(e);try{if(e instanceof p){if(!e.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);g.apply(this,arguments)}else if(e instanceof l){if(!~t.inArray(e.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);m.apply(this,arguments)}else if(-1!==t.inArray(i,["blob","file"]))c.call(this,new h(null,e),arguments[1]);else if("string"===i)"data:"===e.substr(0,5)?c.call(this,new l(null,{data:e}),arguments[1]):_.apply(this,arguments);else{if("node"!==i||"img"!==e.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);c.call(this,e.src,arguments[1])}}catch(t){this.trigger("error",t.code)}}function g(e,n){var i=this.connectRuntime(e.ruid);this.ruid=i.uid,i.exec.call(this,"Image","loadFromImage",e,"undefined"===t.typeOf(n)||n)}function m(e,n){function i(t){r.ruid=t.uid,t.exec.call(r,"Image","loadFromBlob",e)}var r=this;r.name=e.name||"",e.isDetached()?(this.bind("RuntimeInit",function(t,e){i(e)}),n&&"string"==typeof n.required_caps&&(n.required_caps=o.parseCaps(n.required_caps)),this.connectRuntime(t.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(e.ruid))}function _(t,e){var n,i=this;n=new r,n.open("get",t),n.responseType="blob",n.onprogress=function(t){i.trigger(t)},n.onload=function(){m.call(i,n.response,!0)},n.onerror=function(t){i.trigger(t)},n.onloadend=function(){n.destroy()},n.bind("RuntimeError",function(t,e){i.trigger("RuntimeError",e)}),n.send(null,e)}s.call(this),t.extend(this,{uid:t.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){c.apply(this,arguments)},downsize:function(e){var i={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};e="object"==typeof e?t.extend(i,e):t.extend(i,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",e.width,e.height,e.crop,e.preserveHeaders)}catch(t){this.trigger("error",t.code)}},crop:function(t,e,n){this.downsize(t,e,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(t,e){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",t||"image/jpeg",e||90)},getAsDataURL:function(t,e){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",t||"image/jpeg",e||90)},getAsBinaryString:function(t,e){var n=this.getAsDataURL(t,e);return d.atob(n.substring(n.indexOf("base64,")+7))},embed:function(i,r){function o(e,r){var o=this;if(u.can("create_canvas")){var l=o.getAsCanvas();if(l)return i.appendChild(l),l=null,o.destroy(),void c.trigger("embedded")}var h=o.getAsDataURL(e,r);if(!h)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",h.length))i.innerHTML='<img src="'+h+'" width="'+o.width+'" height="'+o.height+'" />',o.destroy(),c.trigger("embedded");else{var p=new a;p.bind("TransportingComplete",function(){s=c.connectRuntime(this.result.ruid),c.bind("Embedded",function(){t.extend(s.getShimContainer().style,{top:"0px",left:"0px",width:o.width+"px",height:o.height+"px"}),s=null},999),s.exec.call(c,"ImageView","display",this.result.uid,width,height),o.destroy()}),p.transport(d.atob(h.substring(h.indexOf("base64,")+7)),e,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:i})}}var s,c=this;r=t.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},r||{});try{if(!(i=e.get(i)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);this.width>p.MAX_RESIZE_WIDTH||(this.height,p.MAX_RESIZE_HEIGHT);var l=new p;return l.bind("Resize",function(){o.call(this,r.type,r.quality)}),l.bind("Load",function(){l.downsize(r)}),this.meta.thumb&&this.meta.thumb.width>=r.width&&this.meta.thumb.height>=r.height?l.load(this.meta.thumb.data):l.clone(this,!1),l}catch(t){this.trigger("error",t.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}}),this.handleEventProps(f),this.bind("Load Resize",function(){i.call(this)},999)}var f=["progress","load","error","resize","embedded"];return p.MAX_RESIZE_WIDTH=8192,p.MAX_RESIZE_HEIGHT=8192,p.prototype=c.instance,p}),i(I,[s,h,p,a],function(t,e,n,i){function r(e){var r=this,a=n.capTest,u=n.capTrue,c=t.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return r.can("access_binary")&&!!s.Image},display_media:a(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:a(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:a(function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&("IE"!==i.browser||i.verComp(i.version,9,">"))}()),filter_by_extension:a(function(){return"Chrome"===i.browser&&i.verComp(i.version,28,">=")||"IE"===i.browser&&i.verComp(i.version,10,">=")||"Safari"===i.browser&&i.verComp(i.version,7,">=")}()),return_response_headers:u,return_response_type:function(t){return!("json"!==t||!window.JSON)||i.can("return_response_type",t)},return_status_code:u,report_upload_progress:a(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return r.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return r.can("select_file")&&"Chrome"===i.browser&&i.verComp(i.version,21,">=")},select_multiple:function(){return r.can("select_file")&&!("Safari"===i.browser&&"Windows"===i.os)&&!("iOS"===i.os&&i.verComp(i.osVersion,"7.0.0",">")&&i.verComp(i.osVersion,"8.0.0","<"))},send_binary_string:a(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||r.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return r.can("slice_blob")&&r.can("send_multipart")},summon_file_dialog:function(){return r.can("select_file")&&("Firefox"===i.browser&&i.verComp(i.version,4,">=")||"Opera"===i.browser&&i.verComp(i.version,12,">=")||"IE"===i.browser&&i.verComp(i.version,10,">=")||!!~t.inArray(i.browser,["Chrome","Safari"]))},upload_filesize:u},arguments[2]);n.call(this,e,arguments[1]||o,c),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(r),t=r=null}}(this.destroy)}),t.extend(this.getShim(),s)}var o="html5",s={};return n.addConstructor(o,r),s}),i(O,[s],function(t){function e(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},r="moxie_"+t.guid(),o=function(o,s,a,u){var c,l;s=s.toLowerCase(),o.addEventListener?(c=a,o.addEventListener(s,c,!1)):o.attachEvent&&(c=function(){var t=window.event;t.target||(t.target=t.srcElement),t.preventDefault=e,t.stopPropagation=n,a(t)},o.attachEvent("on"+s,c)),o[r]||(o[r]=t.guid()),i.hasOwnProperty(o[r])||(i[o[r]]={}),l=i[o[r]],l.hasOwnProperty(s)||(l[s]=[]),l[s].push({func:c,orig:a,key:u})},s=function(e,n,o){var s,a;if(n=n.toLowerCase(),e[r]&&i[e[r]]&&i[e[r]][n]){s=i[e[r]][n];for(var u=s.length-1;u>=0&&(s[u].orig!==o&&s[u].key!==o||(e.removeEventListener?e.removeEventListener(n,s[u].func,!1):e.detachEvent&&e.detachEvent("on"+n,s[u].func),s[u].orig=null,s[u].func=null,s.splice(u,1),o===a));u--);if(s.length||delete i[e[r]][n],t.isEmptyObj(i[e[r]])){delete i[e[r]];try{delete e[r]}catch(t){e[r]=a}}}};return{addEvent:o,removeEvent:s,removeAllEvents:function(e,n){e&&e[r]&&t.each(i[e[r]],function(t,i){s(e,i,n)})}}}),i("moxie/runtime/html5/file/FileInput",[I,E,s,l,O,c,a],function(t,e,n,i,r,o,s){function a(){var t;n.extend(this,{init:function(a){var u,c,l,h,d,p,f=this,g=f.getRuntime();t=a,l=t.accept.mimes||o.extList2mimes(t.accept,g.can("filter_by_extension")),c=g.getShimContainer(),c.innerHTML='<input id="'+g.uid+'" type="file" style="font-size:999px;opacity:0;"'+(t.multiple&&g.can("select_multiple")?"multiple":"")+(t.directory&&g.can("select_folder")?"webkitdirectory directory":"")+(l?' accept="'+l.join(",")+'"':"")+" />",u=i.get(g.uid),n.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),h=i.get(t.browse_button),g.can("summon_file_dialog")&&("static"===i.getStyle(h,"position")&&(h.style.position="relative"),d=parseInt(i.getStyle(h,"z-index"),10)||1,h.style.zIndex=d,c.style.zIndex=d-1,r.addEvent(h,"click",function(t){var e=i.get(g.uid);e&&!e.disabled&&e.click(),t.preventDefault()},f.uid)),p=g.can("summon_file_dialog")?h:c,r.addEvent(p,"mouseover",function(){f.trigger("mouseenter")},f.uid),r.addEvent(p,"mouseout",function(){f.trigger("mouseleave")},f.uid),r.addEvent(p,"mousedown",function(){f.trigger("mousedown")},f.uid),r.addEvent(i.get(t.container),"mouseup",function(){f.trigger("mouseup")},f.uid),u.onchange=function i(r){if(f.files=[],n.each(this.files,function(n){var i="";return!(!t.directory||"."!=n.name)||(n.webkitRelativePath&&(i="/"+n.webkitRelativePath.replace(/^\//,"")),n=new e(g.uid,n),n.relativePath=i,void f.files.push(n))}),"IE"!==s.browser&&"IEMobile"!==s.browser)this.value="";else{var o=this.cloneNode(!0);this.parentNode.replaceChild(o,this),o.onchange=i}f.files.length&&f.trigger("change")},f.trigger({type:"ready",async:!0}),c=null},disable:function(t){var e,n=this.getRuntime();(e=i.get(n.uid))&&(e.disabled=!!t)},destroy:function(){var e=this.getRuntime(),n=e.getShim(),o=e.getShimContainer();r.removeAllEvents(o,this.uid),r.removeAllEvents(t&&i.get(t.container),this.uid),r.removeAllEvents(t&&i.get(t.browse_button),this.uid),o&&(o.innerHTML=""),n.removeInstance(this.uid),t=o=n=null}})}return t.FileInput=a}),i("moxie/runtime/html5/file/Blob",[I,_],function(t,e){function n(){function t(t,e,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(t,e,n):null;try{return t.slice(),t.slice(e,n)}catch(i){return t.slice(e,n-e)}}this.slice=function(){return new e(this.getRuntime().uid,t.apply(this,arguments))}}return t.Blob=n}),i("moxie/runtime/html5/file/FileDrop",[I,E,s,l,O,c],function(t,e,n,i,r,o){function s(){function t(t){if(!t.dataTransfer||!t.dataTransfer.types)return!1;var e=n.toArray(t.dataTransfer.types||[]);return-1!==n.inArray("Files",e)||-1!==n.inArray("public.file-url",e)||-1!==n.inArray("application/x-moz-file",e)}function s(t,n){if(u(t)){var i=new e(f,t);i.relativePath=n||"",g.push(i)}}function a(t){for(var e=[],i=0;i<t.length;i++)[].push.apply(e,t[i].extensions.split(/\s*,\s*/));return-1===n.inArray("*",e)?e:[]}function u(t){if(!m.length)return!0;var e=o.getFileExtension(t.name);return!e||-1!==n.inArray(e,m)}function c(t,e){var i=[];n.each(t,function(t){var e=t.webkitGetAsEntry();e&&(e.isFile?s(t.getAsFile(),e.fullPath):i.push(e))}),i.length?l(i,e):e()}function l(t,e){var i=[];n.each(t,function(t){i.push(function(e){h(t,e)})}),n.inSeries(i,function(){e()})}function h(t,e){t.isFile?t.file(function(n){s(n,t.fullPath),e()},function(){e()}):t.isDirectory?d(t,e):e()}function d(t,e){function n(t){r.readEntries(function(e){e.length?([].push.apply(i,e),n(t)):t()},t)}var i=[],r=t.createReader();n(function(){l(i,e)})}var p,f,g=[],m=[];n.extend(this,{init:function(e){var i,o=this;p=e,f=o.ruid,m=a(p.accept),i=p.container,r.addEvent(i,"dragover",function(e){t(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="copy")},o.uid),r.addEvent(i,"drop",function(e){t(e)&&(e.preventDefault(),g=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?c(e.dataTransfer.items,function(){o.files=g,o.trigger("drop")}):(n.each(e.dataTransfer.files,function(t){s(t)}),o.files=g,o.trigger("drop")))},o.uid),r.addEvent(i,"dragenter",function(t){o.trigger("dragenter")},o.uid),r.addEvent(i,"dragleave",function(t){o.trigger("dragleave")},o.uid)},destroy:function(){r.removeAllEvents(p&&i.get(p.container),this.uid),f=g=m=p=null}})}return t.FileDrop=s}),i(N,[I,m,s],function(t,e,n){function i(){function t(t){return e.atob(t.substring(t.indexOf("base64,")+7))}var i,r=!1;n.extend(this,{read:function(e,o){var s=this;s.result="",i=new window.FileReader,i.addEventListener("progress",function(t){s.trigger(t)}),i.addEventListener("load",function(e){s.result=r?t(i.result):i.result,s.trigger(e)}),i.addEventListener("error",function(t){s.trigger(t,i.error)}),i.addEventListener("loadend",function(t){i=null,s.trigger(t)}),"function"===n.typeOf(i[e])?(r=!1,i[e](o.getSource())):"readAsBinaryString"===e&&(r=!0,i.readAsDataURL(o.getSource()))},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return t.FileReader=i}),i("moxie/runtime/html5/xhr/XMLHttpRequest",[I,s,c,C,E,_,R,h,a],function(t,e,n,i,r,o,s,a,u){function c(){function t(t,e){var n,i,r=this;n=e.getBlob().getSource(),i=new window.FileReader,i.onload=function(){e.append(e.getBlobName(),new o(null,{type:n.type,data:i.result})),f.send.call(r,t,e)},i.readAsBinaryString(n)}function c(){return!window.XMLHttpRequest||"IE"===u.browser&&u.verComp(u.version,8,"<")?function(){for(var t=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(t){}}():new window.XMLHttpRequest}function l(t){var e=t.responseXML,n=t.responseText;return"IE"===u.browser&&n&&e&&!e.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type"))&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(n)),e&&("IE"===u.browser&&0!==e.parseError||!e.documentElement||"parsererror"===e.documentElement.tagName)?null:e}function h(t){var e="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",r="";if(!this.getRuntime().can("send_binary_string"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);return d.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),t.each(function(t,s){r+=t instanceof o?n+e+i+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(t.name||"blob"))+'"'+i+"Content-Type: "+(t.type||"application/octet-stream")+i+i+t.getSource()+i:n+e+i+'Content-Disposition: form-data; name="'+s+'"'+i+i+unescape(encodeURIComponent(t))+i}),r+=n+e+n+i}var d,p,f=this;e.extend(this,{send:function(n,r){var a=this,l="Mozilla"===u.browser&&u.verComp(u.version,4,">=")&&u.verComp(u.version,7,"<"),f="Android Browser"===u.browser,g=!1;if(p=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),d=c(),d.open(n.method,n.url,n.async,n.user,n.password),r instanceof o)r.isDetached()&&(g=!0),r=r.getSource();else if(r instanceof s){if(r.hasBlob())if(r.getBlob().isDetached())r=h.call(a,r),g=!0;else if((l||f)&&"blob"===e.typeOf(r.getBlob().getSource())&&window.FileReader)return void t.call(a,n,r);if(r instanceof s){var m=new window.FormData;r.each(function(t,e){t instanceof o?m.append(e,t.getSource()):m.append(e,t)}),r=m}}d.upload?(n.withCredentials&&(d.withCredentials=!0),d.addEventListener("load",function(t){a.trigger(t)}),d.addEventListener("error",function(t){a.trigger(t)}),d.addEventListener("progress",function(t){a.trigger(t)}),d.upload.addEventListener("progress",function(t){a.trigger({type:"UploadProgress",loaded:t.loaded,total:t.total})})):d.onreadystatechange=function(){switch(d.readyState){case 1:case 2:break;case 3:var t,e;try{i.hasSameOrigin(n.url)&&(t=d.getResponseHeader("Content-Length")||0),d.responseText&&(e=d.responseText.length)}catch(n){t=e=0}a.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:e});break;case 4:d.onreadystatechange=function(){},0===d.status?a.trigger("error"):a.trigger("load")}},e.isEmptyObj(n.headers)||e.each(n.headers,function(t,e){d.setRequestHeader(e,t)}),""!==n.responseType&&"responseType"in d&&("json"!==n.responseType||u.can("return_response_type","json")?d.responseType=n.responseType:d.responseType="text"),g?d.sendAsBinary?d.sendAsBinary(r):function(){for(var t=new Uint8Array(r.length),e=0;e<r.length;e++)t[e]=255&r.charCodeAt(e);d.send(t.buffer)}():d.send(r),a.trigger("loadstart")},getStatus:function(){try{if(d)return d.status}catch(t){}return 0},getResponse:function(t){var e=this.getRuntime();try{switch(t){case"blob":var i=new r(e.uid,d.response),o=d.getResponseHeader("Content-Disposition");if(o){var s=o.match(/filename=([\'\"'])([^\1]+)\1/);s&&(p=s[2])}return i.name=p,i.type||(i.type=n.getFileMime(p)),i;case"json":return u.can("return_response_type","json")?d.response:200===d.status&&window.JSON?JSON.parse(d.responseText):null;case"document":return l(d);default:return""!==d.responseText?d.responseText:null}}catch(t){return null}},getAllResponseHeaders:function(){try{return d.getAllResponseHeaders()}catch(t){}return""},abort:function(){d&&d.abort()},destroy:function(){f=p=null}})}return t.XMLHttpRequest=c}),i(x,[s],function(t){function e(t){t instanceof ArrayBuffer?n.apply(this,arguments):i.apply(this,arguments)}function n(e){var n=new DataView(e);t.extend(this,{readByteAt:function(t){return n.getUint8(t)},writeByteAt:function(t,e){n.setUint8(t,e)},SEGMENT:function(t,i,r){switch(arguments.length){case 2:return e.slice(t,t+i);case 1:return e.slice(t);case 3:if(null===r&&(r=new ArrayBuffer),r instanceof ArrayBuffer){var o=new Uint8Array(this.length()-i+r.byteLength);t>0&&o.set(new Uint8Array(e.slice(0,t)),0),o.set(new Uint8Array(r),t),o.set(new Uint8Array(e.slice(t+i)),t+r.byteLength),this.clear(),e=o.buffer,n=new DataView(e);break}default:return e}},length:function(){return e?e.byteLength:0},clear:function(){n=e=null}})}function i(e){function n(t,n,i){i=3===arguments.length?i:e.length-n-1,e=e.substr(0,n)+t+e.substr(i+n)}t.extend(this,{readByteAt:function(t){return e.charCodeAt(t)},writeByteAt:function(t,e){n(String.fromCharCode(e),t,1)},SEGMENT:function(t,i,r){switch(arguments.length){case 1:return e.substr(t);case 2:return e.substr(t,i);case 3:n(null!==r?r:"",t,i);break;default:return e}},length:function(){return e?e.length:0},clear:function(){e=null}})}return t.extend(e.prototype,{littleEndian:!1,read:function(t,e){var n,i,r;if(t+e>this.length())throw new Error("You are trying to read outside the source boundaries.");for(i=this.littleEndian?0:-8*(e-1),r=0,n=0;e>r;r++)n|=this.readByteAt(t+r)<<Math.abs(i+8*r);return n},write:function(t,e,n){var i,r;if(t>this.length())throw new Error("You are trying to write outside the source boundaries.");for(i=this.littleEndian?0:-8*(n-1),r=0;n>r;r++)this.writeByteAt(t+r,e>>Math.abs(i+8*r)&255)},BYTE:function(t){return this.read(t,1)},SHORT:function(t){return this.read(t,2)},LONG:function(t){return this.read(t,4)},SLONG:function(t){var e=this.read(t,4);return e>2147483647?e-4294967296:e},CHAR:function(t){return String.fromCharCode(this.read(t,1))},STRING:function(t,e){return this.asArray("CHAR",t,e).join("")},asArray:function(t,e,n){for(var i=[],r=0;n>r;r++)i[r]=this[t](e+r);return i}}),e}),i(D,[x,h],function(t,e){return function n(i){var r,o,s,a=[],u=0;if(r=new t(i),65496!==r.SHORT(0))throw r.clear(),new e.ImageError(e.ImageError.WRONG_FORMAT);for(o=2;o<=r.length();)if((s=r.SHORT(o))>=65488&&65495>=s)o+=2;else{if(65498===s||65497===s)break;u=r.SHORT(o+2)+2,s>=65505&&65519>=s&&a.push({hex:s,name:"APP"+(15&s),start:o,length:u,segment:r.SEGMENT(o,u)}),o+=u}return r.clear(),{headers:a,restore:function(e){var n,i,r;for(r=new t(e),o=65504==r.SHORT(2)?4+r.SHORT(4):2,i=0,n=a.length;n>i;i++)r.SEGMENT(o,0,a[i].segment),o+=a[i].length;return e=r.SEGMENT(),r.clear(),e},strip:function(e){var i,r,o,s;for(o=new n(e),r=o.headers,o.purge(),i=new t(e),s=r.length;s--;)i.SEGMENT(r[s].start,r[s].length,"");return e=i.SEGMENT(),i.clear(),e},get:function(t){for(var e=[],n=0,i=a.length;i>n;n++)a[n].name===t.toUpperCase()&&e.push(a[n].segment);return e},set:function(t,e){var n,i,r,o=[];for("string"==typeof e?o.push(e):o=e,n=i=0,r=a.length;r>n&&(a[n].name===t.toUpperCase()&&(a[n].segment=o[i],a[n].length=o[i].length,i++),!(i>=o.length));n++);},purge:function(){this.headers=a=[]}}}}),i(J,[s,x,h],function(t,n,i){function r(o){function s(n,r){var o,s,a,u,c,d,p,f,g=this,m=[],_={},E={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},S={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(o=g.SHORT(n),s=0;o>s;s++)if(m=[],p=n+2+12*s,(a=r[g.SHORT(p)])!==e){if(u=E[g.SHORT(p+=2)],c=g.LONG(p+=2),!(d=S[u]))throw new i.ImageError(i.ImageError.INVALID_META_ERR);if(p+=4,d*c>4&&(p=g.LONG(p)+h.tiffHeader),p+d*c>=this.length())throw new i.ImageError(i.ImageError.INVALID_META_ERR);"ASCII"!==u?(m=g.asArray(u,p,c),f=1==c?m[0]:m,l.hasOwnProperty(a)&&"object"!=typeof f?_[a]=l[a][f]:_[a]=f):_[a]=t.trim(g.STRING(p,c).replace(/\0$/,""))}return _}function a(t,e,n){var i,r,o,s=0;if("string"==typeof e){var a=c[t.toLowerCase()];for(var u in a)if(a[u]===e){e=u;break}}i=h[t.toLowerCase()+"IFD"],r=this.SHORT(i);for(var l=0;r>l;l++)if(o=i+12*l+2,this.SHORT(o)==e){s=o+8;break}if(!s)return!1;try{this.write(s,n,4)}catch(t){return!1}return!0}var u,c,l,h,d,p;if(n.call(this,o),c={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},h={tiffHeader:10},d=h.tiffHeader,u={clear:this.clear},t.extend(this,{read:function(){try{return r.prototype.read.apply(this,arguments)}catch(t){throw new i.ImageError(i.ImageError.INVALID_META_ERR)}},write:function(){try{return r.prototype.write.apply(this,arguments)}catch(t){throw new i.ImageError(i.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(t){return this.LONG(t)/this.LONG(t+4)},SRATIONAL:function(t){return this.SLONG(t)/this.SLONG(t+4)},ASCII:function(t){return this.CHAR(t)},TIFF:function(){return p||null},EXIF:function(){var e=null;if(h.exifIFD){try{e=s.call(this,h.exifIFD,c.exif)}catch(t){return null}if(e.ExifVersion&&"array"===t.typeOf(e.ExifVersion)){for(var n=0,i="";n<e.ExifVersion.length;n++)i+=String.fromCharCode(e.ExifVersion[n]);e.ExifVersion=i}}return e},GPS:function(){var e=null;if(h.gpsIFD){try{e=s.call(this,h.gpsIFD,c.gps)}catch(t){return null}
e.GPSVersionID&&"array"===t.typeOf(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join("."))}return e},thumb:function(){if(h.IFD1)try{var t=s.call(this,h.IFD1,c.thumb);if("JPEGInterchangeFormat"in t)return this.SEGMENT(h.tiffHeader+t.JPEGInterchangeFormat,t.JPEGInterchangeFormatLength)}catch(t){}return null},setExif:function(t,e){return("PixelXDimension"===t||"PixelYDimension"===t)&&a.call(this,"exif",t,e)},clear:function(){u.clear(),o=c=l=p=h=u=null}}),65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new i.ImageError(i.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(d),42!==this.SHORT(d+=2))throw new i.ImageError(i.ImageError.INVALID_META_ERR);h.IFD0=h.tiffHeader+this.LONG(d+=2),p=s.call(this,h.IFD0,c.tiff),"ExifIFDPointer"in p&&(h.exifIFD=h.tiffHeader+p.ExifIFDPointer,delete p.ExifIFDPointer),"GPSInfoIFDPointer"in p&&(h.gpsIFD=h.tiffHeader+p.GPSInfoIFDPointer,delete p.GPSInfoIFDPointer),t.isEmptyObj(p)&&(p=null);var f=this.LONG(h.IFD0+12*this.SHORT(h.IFD0)+2);f&&(h.IFD1=h.tiffHeader+f)}return r.prototype=n.prototype,r}),i(P,[s,h,D,x,J],function(t,e,n,i,r){function o(o){function s(t){var e,n,i=0;for(t||(t=u);i<=t.length();){if((e=t.SHORT(i+=2))>=65472&&65475>=e)return i+=5,{height:t.SHORT(i),width:t.SHORT(i+=2)};n=t.SHORT(i+=2),i+=n-2}return null}function a(){l&&c&&u&&(l.clear(),c.purge(),u.clear(),h=c=l=u=null)}var u,c,l,h;if(u=new i(o),65496!==u.SHORT(0))throw new e.ImageError(e.ImageError.WRONG_FORMAT);c=new n(o);try{l=new r(c.get("app1")[0])}catch(t){}h=s.call(this),t.extend(this,{type:"image/jpeg",size:u.length(),width:h&&h.width||0,height:h&&h.height||0,setExif:function(e,n){return!!l&&("object"===t.typeOf(e)?t.each(e,function(t,e){l.setExif(e,t)}):l.setExif(e,n),void c.set("app1",l.SEGMENT()))},writeHeaders:function(){return arguments.length?c.restore(arguments[0]):c.restore(o)},stripHeaders:function(t){return c.strip(t)},purge:function(){a.call(this)}}),l&&(this.meta={tiff:l.TIFF(),exif:l.EXIF(),gps:l.GPS(),thumb:function(){var t,e,n=l.thumb();return n&&(t=new i(n),e=s(t),t.clear(),e)?(e.data=n,e):null}()})}return o}),i(M,[h,s,x],function(t,e,n){function i(i){function r(){var t,e;return t=s.call(this,8),"IHDR"==t.type?(e=t.start,{width:a.LONG(e),height:a.LONG(e+=4)}):null}function o(){a&&(a.clear(),i=l=u=c=a=null)}function s(t){var e,n,i,r;return e=a.LONG(t),n=a.STRING(t+=4,4),i=t+=4,r=a.LONG(t+e),{length:e,type:n,start:i,CRC:r}}var a,u,c,l;a=new n(i),function(){var e=0,n=0,i=[35152,20039,3338,6666];for(n=0;n<i.length;n++,e+=2)if(i[n]!=a.SHORT(e))throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),l=r.call(this),e.extend(this,{type:"image/png",size:a.length(),width:l.width,height:l.height,purge:function(){o.call(this)}}),o.call(this)}return i}),i(L,[s,h,P,M],function(t,e,n,i){return function(r){var o,s=[n,i];o=function(){for(var t=0;t<s.length;t++)try{return new s[t](r)}catch(t){}throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),t.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(t){return t},stripHeaders:function(t){return t},purge:function(){r=null}}),t.extend(this,o),this.purge=function(){o.purge(),o=null}}}),i(U,[],function(){function t(t,i,r){var o=t.naturalWidth,s=t.naturalHeight,a=r.width,u=r.height,c=r.x||0,l=r.y||0,h=i.getContext("2d");e(t)&&(o/=2,s/=2);var d=1024,p=document.createElement("canvas");p.width=p.height=d;for(var f=p.getContext("2d"),g=n(t,o,s),m=0;s>m;){for(var _=m+d>s?s-m:d,E=0;o>E;){var S=E+d>o?o-E:d;f.clearRect(0,0,d,d),f.drawImage(t,-E,-m);var y=E*a/o+c<<0,C=Math.ceil(S*a/o),v=m*u/s/g+l<<0,b=Math.ceil(_*u/s/g);h.drawImage(p,0,0,S,_,y,v,C,b),E+=d}m+=d}p=f=null}function e(t){var e=t.naturalWidth;if(e*t.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var i=n.getContext("2d");return i.drawImage(t,1-e,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function n(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var r=i.getContext("2d");r.drawImage(t,0,0);for(var o=r.getImageData(0,0,1,n).data,s=0,a=n,u=n;u>s;){0===o[4*(u-1)+3]?a=u:s=u,u=a+s>>1}i=null;var c=u/n;return 0===c?1:c}return{isSubsampled:e,renderTo:t}}),i(k,[I,s,h,m,_,E,L,U,c,a],function(t,e,n,i,r,o,s,a,u,c){function l(){function t(){if(!y&&!E)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return y||E}function l(t){return i.atob(t.substring(t.indexOf("base64,")+7))}function h(t,e){return"data:"+(e||"")+";base64,"+i.btoa(t)}function d(t){var e=this;E=new Image,E.onerror=function(){_.call(this),e.trigger("error",n.ImageError.WRONG_FORMAT)},E.onload=function(){e.trigger("load")},E.src="data:"==t.substr(0,5)?t:h(t,v.type)}function p(t,e){var i,r=this;return window.FileReader?(i=new FileReader,i.onload=function(){e(this.result)},i.onerror=function(){r.trigger("error",n.ImageError.WRONG_FORMAT)},void i.readAsDataURL(t)):e(t.getAsDataURL())}function f(n,i,r,o){var s,a,u,c,l,h=this,d=0,p=0;if(T=o,l=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==e.inArray(l,[5,6,7,8])){var f=n;n=i,i=f}return a=t(),r?(n=Math.min(n,a.width),i=Math.min(i,a.height),s=Math.max(n/a.width,i/a.height)):s=Math.min(n/a.width,i/a.height),s>1&&!r&&o?void this.trigger("Resize"):(y||(y=document.createElement("canvas")),u=Math.round(a.width*s),c=Math.round(a.height*s),r?(y.width=n,y.height=i,u>n&&(d=Math.round((u-n)/2)),c>i&&(p=Math.round((c-i)/2))):(y.width=u,y.height=c),T||m(y.width,y.height,l),g.call(this,a,y,-d,-p,u,c),this.width=y.width,this.height=y.height,R=!0,void h.trigger("Resize"))}function g(t,e,n,i,r,o){if("iOS"===c.OS)a.renderTo(t,e,{width:r,height:o,x:n,y:i});else{e.getContext("2d").drawImage(t,n,i,r,o)}}function m(t,e,n){switch(n){case 5:case 6:case 7:case 8:y.width=e,y.height=t;break;default:y.width=t,y.height=e}var i=y.getContext("2d");switch(n){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,e),i.rotate(Math.PI);break;case 4:i.translate(0,e),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-e);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-e),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-t,0)}}function _(){S&&(S.purge(),S=null),C=E=y=v=null,R=!1}var E,S,y,C,v,b=this,R=!1,T=!0;e.extend(this,{loadFromBlob:function(t){var e=this,i=e.getRuntime(),r=!(arguments.length>1)||arguments[1];if(!i.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return v=t,t.isDetached()?(C=t.getSource(),void d.call(this,C)):void p.call(this,t.getSource(),function(t){r&&(C=l(t)),d.call(e,t)})},loadFromImage:function(t,e){this.meta=t.meta,v=new o(null,{name:t.name,size:t.size,type:t.type}),d.call(this,e?C=t.getAsBinaryString():t.getAsDataURL())},getInfo:function(){var e,n=this.getRuntime();return!S&&C&&n.can("access_image_binary")&&(S=new s(C)),e={width:t().width||0,height:t().height||0,type:v.type||u.getFileMime(v.name),size:C&&C.length||v.size||0,name:v.name||"",meta:S&&S.meta||this.meta||{}},!e.meta||!e.meta.thumb||e.meta.thumb.data instanceof r||(e.meta.thumb.data=new r(null,{type:"image/jpeg",data:e.meta.thumb.data})),e},downsize:function(){f.apply(this,arguments)},getAsCanvas:function(){return y&&(y.id=this.uid+"_canvas"),y},getAsBlob:function(t,e){return t!==this.type&&f.call(this,this.width,this.height,!1),new o(null,{name:v.name||"",type:t,data:b.getAsBinaryString.call(this,t,e)})},getAsDataURL:function(t){var e=arguments[1]||90;if(!R)return E.src;if("image/jpeg"!==t)return y.toDataURL("image/png");try{return y.toDataURL("image/jpeg",e/100)}catch(t){return y.toDataURL("image/jpeg")}},getAsBinaryString:function(t,e){if(!R)return C||(C=l(b.getAsDataURL(t,e))),C;if("image/jpeg"!==t)C=l(b.getAsDataURL(t,e));else{var n;e||(e=90);try{n=y.toDataURL("image/jpeg",e/100)}catch(t){n=y.toDataURL("image/jpeg")}C=l(n),S&&(C=S.stripHeaders(C),T&&(S.meta&&S.meta.exif&&S.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),C=S.writeHeaders(C)),S.purge(),S=null)}return R=!1,C},destroy:function(){b=null,_.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return t.Image=l}),i(H,[s,a,l,h,p],function(t,e,n,i,r){function o(){var t;try{t=navigator.plugins["Shockwave Flash"],t=t.description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])}function s(t){var i=n.get(t);i&&"OBJECT"==i.nodeName&&("IE"===e.browser?(i.style.display="none",function e(){4==i.readyState?a(t):setTimeout(e,10)}()):i.parentNode.removeChild(i))}function a(t){var e=n.get(t);if(e){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}}function u(a){var u,h=this;a=t.extend({swf_url:e.swf_url},a),r.call(this,a,c,{access_binary:function(t){return t&&"browser"===h.mode},access_image_binary:function(t){return t&&"browser"===h.mode},display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===h.mode},resize_image:r.capTrue,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||(!t.arrayDiff(e,["","text","document"])||"browser"===h.mode)},return_status_code:function(e){return"browser"===h.mode||!t.arrayDiff(e,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:function(t){return t&&"browser"===h.mode},send_browser_cookies:function(t){return t&&"browser"===h.mode},send_custom_headers:function(t){return t&&"browser"===h.mode},send_multipart:r.capTrue,slice_blob:function(t){return t&&"browser"===h.mode},stream_upload:function(t){return t&&"browser"===h.mode},summon_file_dialog:!1,upload_filesize:function(e){return t.parseSizeStr(e)<=2097152||"client"===h.mode},use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}},{access_binary:function(t){return t?"browser":"client"},access_image_binary:function(t){return t?"browser":"client"},report_upload_progress:function(t){return t?"browser":"client"},return_response_type:function(e){return t.arrayDiff(e,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"browser":["client","browser"]},send_binary_string:function(t){return t?"browser":"client"},send_browser_cookies:function(t){return t?"browser":"client"},send_custom_headers:function(t){return t?"browser":"client"},stream_upload:function(t){return t?"client":"browser"},upload_filesize:function(e){return t.parseSizeStr(e)>=2097152?"client":"browser"}},"client"),o()<10&&(this.mode=!1),t.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(t,e){var n=[].slice.call(arguments,2);return h.getShim().exec(this.uid,t,e,n)},init:function(){var n,r,o;o=this.getShimContainer(),t.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===e.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+e.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===e.browser?(r=document.createElement("div"),o.appendChild(r),r.outerHTML=n,r=o=null):o.innerHTML=n,u=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(t){return function(){s(h.uid),t.call(h),clearTimeout(u),a=u=t=h=null}}(this.destroy)},l)}var c="flash",l={};return r.addConstructor(c,u),l}),i("moxie/runtime/flash/file/FileInput",[H,E,s],function(t,e,n){var i={init:function(t){var i=this,r=this.getRuntime();this.bind("Change",function(){var t=r.shimExec.call(i,"FileInput","getFiles");i.files=[],n.each(t,function(t){i.files.push(new e(r.uid,t))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",{name:t.name,accept:t.accept,multiple:t.multiple}),this.trigger("ready")}};return t.FileInput=i}),i(B,[H,_],function(t,e){var n={slice:function(t,n,i,r){var o=this.getRuntime();return 0>n?n=Math.max(t.size+n,0):n>0&&(n=Math.min(n,t.size)),0>i?i=Math.max(t.size+i,0):i>0&&(i=Math.min(i,t.size)),t=o.shimExec.call(this,"Blob","slice",n,i,r||""),t&&(t=new e(o.uid,t)),t}};return t.Blob=n}),i(F,[H,m],function(t,e){function n(t,n){switch(n){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var i={read:function(t,e){var i=this;return i.result="","readAsDataURL"===t&&(i.result="data:"+(e.type||"")+";base64,"),i.bind("Progress",function(e,r){r&&(i.result+=n(r,t))},999),i.getRuntime().shimExec.call(this,"FileReader","readAsBase64",e.uid)}};return t.FileReader=i}),i(q,[H,m],function(t,e){function n(t,n){switch(n){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var i={read:function(t,e){var i;return(i=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",e.uid))?("readAsDataURL"===t&&(i="data:"+(e.type||"")+";base64,"+i),n(i,t,e.type)):null}};return t.FileReaderSync=i}),i(X,[H,s,_,E,b,R,A],function(t,e,n,i,r,o,s){var a={send:function(t,i){function r(){t.transport=l.mode,l.shimExec.call(c,"XMLHttpRequest","send",t,i)}function a(t,e){l.shimExec.call(c,"XMLHttpRequest","appendBlob",t,e.uid),i=null,r()}function u(t,e){var n=new s;n.bind("TransportingComplete",function(){e(this.result)}),n.transport(t.getSource(),t.type,{ruid:l.uid})}var c=this,l=c.getRuntime();if(e.isEmptyObj(t.headers)||e.each(t.headers,function(t,e){l.shimExec.call(c,"XMLHttpRequest","setRequestHeader",e,t.toString())}),i instanceof o){var h;if(i.each(function(t,e){t instanceof n?h=e:l.shimExec.call(c,"XMLHttpRequest","append",e,t)}),i.hasBlob()){var d=i.getBlob();d.isDetached()?u(d,function(t){d.destroy(),a(h,t)}):a(h,d)}else i=null,r()}else i instanceof n?i.isDetached()?u(i,function(t){i.destroy(),i=t.uid,r()}):(i=i.uid,r()):r()},getResponse:function(t){var n,o,s=this.getRuntime();if(o=s.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(o=new i(s.uid,o),"blob"===t)return o;try{if(n=new r,~e.inArray(t,["","text"]))return n.readAsText(o);if("json"===t&&window.JSON)return JSON.parse(n.readAsText(o))}finally{o.destroy()}}return null},abort:function(t){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return t.XMLHttpRequest=a}),i(j,[H,_],function(t,e){var n={getAsBlob:function(t){var n=this.getRuntime(),i=n.shimExec.call(this,"Transporter","getAsBlob",t);return i?new e(n.uid,i):null}};return t.Transporter=n}),i(G,[H,s,A,_,b],function(t,e,n,i,r){var o={loadFromBlob:function(t){function e(t){r.shimExec.call(i,"Image","loadFromBlob",t.uid),i=r=null}var i=this,r=i.getRuntime();if(t.isDetached()){var o=new n;o.bind("TransportingComplete",function(){e(o.result.getSource())}),o.transport(t.getSource(),t.type,{ruid:r.uid})}else e(t.getSource())},loadFromImage:function(t){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",t.uid)},getInfo:function(){var t=this.getRuntime(),e=t.shimExec.call(this,"Image","getInfo");return!e.meta||!e.meta.thumb||e.meta.thumb.data instanceof i||(e.meta.thumb.data=new i(t.uid,e.meta.thumb.data)),e},getAsBlob:function(t,e){var n=this.getRuntime(),r=n.shimExec.call(this,"Image","getAsBlob",t,e);return r?new i(n.uid,r):null},getAsDataURL:function(){var t,e=this.getRuntime(),n=e.Image.getAsBlob.apply(this,arguments);return n?(t=new r,t.readAsDataURL(n)):null}};return t.Image=o}),i(z,[s,a,l,h,p],function(t,e,n,i,r){function o(t){var e,n,i,r,o,s=!1,a=null,u=0;try{try{a=new ActiveXObject("AgControl.AgControl"),a.IsVersionSupported(t)&&(s=!0),a=null}catch(a){var c=navigator.plugins["Silverlight Plug-In"];if(c){for(e=c.description,"1.0.30226.2"===e&&(e="2.0.30226.2"),n=e.split(".");n.length>3;)n.pop();for(;n.length<4;)n.push(0);for(i=t.split(".");i.length>4;)i.pop();do{r=parseInt(i[u],10),o=parseInt(n[u],10),u++}while(u<i.length&&r===o);o>=r&&!isNaN(r)&&(s=!0)}}}catch(t){s=!1}return s}function s(s){var c,l=this;s=t.extend({xap_url:e.xap_url},s),r.call(this,s,a,{access_binary:r.capTrue,access_image_binary:r.capTrue,display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:r.capTrue,resize_image:r.capTrue,return_response_headers:function(t){return t&&"client"===l.mode},return_response_type:function(t){return"json"!==t||!!window.JSON},return_status_code:function(e){return"client"===l.mode||!t.arrayDiff(e,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:r.capTrue,send_browser_cookies:function(t){return t&&"browser"===l.mode},send_custom_headers:function(t){return t&&"client"===l.mode},send_multipart:r.capTrue,slice_blob:r.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:r.capTrue,use_http_method:function(e){return"client"===l.mode||!t.arrayDiff(e,["GET","POST"])}},{return_response_headers:function(t){return t?"client":"browser"},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"client":["client","browser"]},send_browser_cookies:function(t){return t?"browser":"client"},send_custom_headers:function(t){return t?"client":"browser"},use_http_method:function(e){return t.arrayDiff(e,["GET","POST"])?"client":["client","browser"]}}),o("2.0.31005.0")&&"Opera"!==e.browser||(this.mode=!1),t.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(t,e){var n=[].slice.call(arguments,2);return l.getShim().exec(this.uid,t,e,n)},init:function(){var t;t=this.getShimContainer(),t.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+s.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+e.global_event_dispatcher+'"/></object>',c=setTimeout(function(){l&&!l.initialized&&l.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},"Windows"!==e.OS?1e4:5e3)},destroy:function(t){return function(){t.call(l),clearTimeout(c),s=c=t=l=null}}(this.destroy)},u)}var a="silverlight",u={};return r.addConstructor(a,s),u}),i("moxie/runtime/silverlight/file/FileInput",[z,E,s],function(t,e,n){var i={init:function(t){var i=this,r=this.getRuntime();this.bind("Change",function(){var t=r.shimExec.call(i,"FileInput","getFiles");i.files=[],n.each(t,function(t){i.files.push(new e(r.uid,t))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",function(t){for(var e="",n=0;n<t.length;n++)e+=(""!==e?"|":"")+t[n].title+" | *."+t[n].extensions.replace(/,/g,";*.");return e}(t.accept),t.name,t.multiple),this.trigger("ready")}};return t.FileInput=i}),i("moxie/runtime/silverlight/file/Blob",[z,s,B],function(t,e,n){return t.Blob=e.extend({},n)}),i("moxie/runtime/silverlight/file/FileDrop",[z,l,O],function(t,e,n){var i={init:function(){var t,i=this,r=i.getRuntime();return t=r.getShimContainer(),n.addEvent(t,"dragover",function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"},i.uid),n.addEvent(t,"dragenter",function(t){t.preventDefault(),e.get(r.uid).dragEnter(t)&&t.stopPropagation()},i.uid),n.addEvent(t,"drop",function(t){t.preventDefault(),e.get(r.uid).dragDrop(t)&&t.stopPropagation()},i.uid),r.shimExec.call(this,"FileDrop","init")}};return t.FileDrop=i}),i("moxie/runtime/silverlight/file/FileReader",[z,s,F],function(t,e,n){return t.FileReader=e.extend({},n)}),i("moxie/runtime/silverlight/file/FileReaderSync",[z,s,q],function(t,e,n){return t.FileReaderSync=e.extend({},n)}),i("moxie/runtime/silverlight/xhr/XMLHttpRequest",[z,s,X],function(t,e,n){return t.XMLHttpRequest=e.extend({},n)}),i("moxie/runtime/silverlight/runtime/Transporter",[z,s,j],function(t,e,n){return t.Transporter=e.extend({},n)}),i("moxie/runtime/silverlight/image/Image",[z,s,_,G],function(t,e,n,i){return t.Image=e.extend({},i,{getInfo:function(){var t=this.getRuntime(),i=["tiff","exif","gps","thumb"],r={meta:{}},o=t.shimExec.call(this,"Image","getInfo");return o.meta&&(e.each(i,function(t){var e,n,i,s,a=o.meta[t];if(a&&a.keys)for(r.meta[t]={},n=0,i=a.keys.length;i>n;n++)e=a.keys[n],(s=a[e])&&(/^(\d|[1-9]\d+)$/.test(s)?s=parseInt(s,10):/^\d*\.\d+$/.test(s)&&(s=parseFloat(s)),r.meta[t][e]=s)}),!r.meta||!r.meta.thumb||r.meta.thumb.data instanceof n||(r.meta.thumb.data=new n(t.uid,r.meta.thumb.data))),r.width=parseInt(o.width,10),r.height=parseInt(o.height,10),r.size=parseInt(o.size,10),r.type=o.type,r.name=o.name,r}})}),i(V,[s,h,p,a],function(t,e,n,i){function r(e){var r=this,a=n.capTest,u=n.capTrue;n.call(this,e,o,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a(s.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:a(function(){return"Chrome"===i.browser&&i.verComp(i.version,28,">=")||"IE"===i.browser&&i.verComp(i.version,10,">=")||"Safari"===i.browser&&i.verComp(i.version,7,">=")}()),resize_image:function(){return s.Image&&r.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||!!~t.inArray(e,["text","document",""])},return_status_code:function(e){return!t.arrayDiff(e,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return r.can("select_file")},summon_file_dialog:function(){return r.can("select_file")&&("Firefox"===i.browser&&i.verComp(i.version,4,">=")||"Opera"===i.browser&&i.verComp(i.version,12,">=")||"IE"===i.browser&&i.verComp(i.version,10,">=")||!!~t.inArray(i.browser,["Chrome","Safari"]))},upload_filesize:u,use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}}),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(r),t=r=null}}(this.destroy)}),t.extend(this.getShim(),s)}var o="html4",s={};return n.addConstructor(o,r),s}),i("moxie/runtime/html4/file/FileInput",[V,E,s,l,O,c,a],function(t,e,n,i,r,o,s){function a(){function t(){var o,l,h,d,p,f,g=this,m=g.getRuntime();f=n.guid("uid_"),o=m.getShimContainer(),a&&(h=i.get(a+"_form"))&&n.extend(h.style,{top:"100%"}),d=document.createElement("form"),d.setAttribute("id",f+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),n.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=document.createElement("input"),p.setAttribute("id",f),p.setAttribute("type","file"),p.setAttribute("name",u.name||"Filedata"),p.setAttribute("accept",c.join(",")),n.extend(p.style,{fontSize:"999px",opacity:0}),d.appendChild(p),o.appendChild(d),n.extend(p.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===s.browser&&s.verComp(s.version,10,"<")&&n.extend(p.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),p.onchange=function(){var n;if(this.value){if(this.files){if(n=this.files[0],0===n.size)return void d.parentNode.removeChild(d)}else n={name:this.value};n=new e(m.uid,n),this.onchange=function(){},t.call(g),g.files=[n],p.setAttribute("id",n.uid),d.setAttribute("id",n.uid+"_form"),g.trigger("change"),p=d=null}},m.can("summon_file_dialog")&&(l=i.get(u.browse_button),r.removeEvent(l,"click",g.uid),r.addEvent(l,"click",function(t){p&&!p.disabled&&p.click(),t.preventDefault()},g.uid)),a=f,o=h=l=null}var a,u,c=[];n.extend(this,{init:function(e){var n,s=this,a=s.getRuntime();u=e,c=e.accept.mimes||o.extList2mimes(e.accept,a.can("filter_by_extension")),n=a.getShimContainer(),function(){var t,o,u;t=i.get(e.browse_button),a.can("summon_file_dialog")&&("static"===i.getStyle(t,"position")&&(t.style.position="relative"),o=parseInt(i.getStyle(t,"z-index"),10)||1,t.style.zIndex=o,n.style.zIndex=o-1),u=a.can("summon_file_dialog")?t:n,r.addEvent(u,"mouseover",function(){s.trigger("mouseenter")},s.uid),r.addEvent(u,"mouseout",function(){s.trigger("mouseleave")},s.uid),r.addEvent(u,"mousedown",function(){s.trigger("mousedown")},s.uid),r.addEvent(i.get(e.container),"mouseup",function(){s.trigger("mouseup")},s.uid),t=null}(),t.call(this),n=null,s.trigger({type:"ready",async:!0})},disable:function(t){var e;(e=i.get(a))&&(e.disabled=!!t)},destroy:function(){var t=this.getRuntime(),e=t.getShim(),n=t.getShimContainer();r.removeAllEvents(n,this.uid),r.removeAllEvents(u&&i.get(u.container),this.uid),r.removeAllEvents(u&&i.get(u.browse_button),this.uid),n&&(n.innerHTML=""),e.removeInstance(this.uid),a=c=u=n=e=null}})}return t.FileInput=a}),i("moxie/runtime/html4/file/FileReader",[V,N],function(t,e){return t.FileReader=e}),i("moxie/runtime/html4/xhr/XMLHttpRequest",[V,s,l,C,h,O,_,R],function(t,e,n,i,r,o,s,a){function u(){function t(t){var e,i,r,s,a=this,u=!1;if(l){if(e=l.id.replace(/_iframe$/,""),i=n.get(e+"_form")){for(r=i.getElementsByTagName("input"),s=r.length;s--;)switch(r[s].getAttribute("type")){case"hidden":r[s].parentNode.removeChild(r[s]);break;case"file":u=!0}r=[],u||i.parentNode.removeChild(i),i=null}setTimeout(function(){o.removeEvent(l,"load",a.uid),l.parentNode&&l.parentNode.removeChild(l);var e=a.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=l=null,t()},1)}}var u,c,l;e.extend(this,{send:function(h,d){var p,f,g,m,_=this,E=_.getRuntime();if(u=c=null,d instanceof a&&d.hasBlob()){if(m=d.getBlob(),p=m.uid,g=n.get(p),!(f=n.get(p+"_form")))throw new r.DOMException(r.DOMException.NOT_FOUND_ERR)}else p=e.guid("uid_"),f=document.createElement("form"),f.setAttribute("id",p+"_form"),f.setAttribute("method",h.method),f.setAttribute("enctype","multipart/form-data"),f.setAttribute("encoding","multipart/form-data"),E.getShimContainer().appendChild(f);f.setAttribute("target",p+"_iframe"),d instanceof a&&d.each(function(t,n){if(t instanceof s)g&&g.setAttribute("name",n);else{var i=document.createElement("input");e.extend(i,{type:"hidden",name:n,value:t}),g?f.insertBefore(i,g):f.appendChild(i)}}),f.setAttribute("action",h.url),function(){var n=E.getShimContainer()||document.body,r=document.createElement("div");r.innerHTML='<iframe id="'+p+'_iframe" name="'+p+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=r.firstChild,n.appendChild(l),o.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,c=e.trim(n.body.innerHTML),_.trigger({type:"progress",loaded:c.length,total:c.length}),m&&_.trigger({type:"uploadprogress",loaded:m.size||1025,total:m.size||1025}))}catch(e){if(!i.hasSameOrigin(h.url))return void t.call(_,function(){_.trigger("error")});u=404}t.call(_,function(){_.trigger("load")})},_.uid)}(),f.submit(),_.trigger("loadstart")},getStatus:function(){return u},getResponse:function(t){if("json"===t&&"string"===e.typeOf(c)&&window.JSON)try{return JSON.parse(c.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(t){return null}return c},abort:function(){var e=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),t.call(this,function(){e.dispatchEvent("abort")})}})}return t.XMLHttpRequest=u}),i("moxie/runtime/html4/image/Image",[V,k],function(t,e){return t.Image=e}),function(n){for(var i=0;i<n.length;i++){for(var r=t,s=n[i],a=s.split(/[.\/]/),u=0;u<a.length-1;++u)r[a[u]]===e&&(r[a[u]]={}),r=r[a[u]];r[a[a.length-1]]=o[s]}}([s,a,u,c,l,h,d,p,f,g,m,_,E,S,y,C,v,b,R,T,A,w,O])}(this),function(t){"use strict";var e={},n=t.moxie.core.utils.Basic.inArray;(function t(i){var r,o;for(r in i)o=typeof i[r],"object"!==o||~n(r,["Exceptions","Env","Mime"])?"function"===o&&(e[r]=i[r]):t(i[r])})(t.moxie),e.Env=t.moxie.core.utils.Env,e.Mime=t.moxie.core.utils.Mime,e.Exceptions=t.moxie.core.Exceptions,t.mOxie=e,t.o||(t.o=e)}(this),function(t,e,n){function i(t){function e(t,e,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[t]?i[r[t]]=e:n||(i[t]=e)}var n=t.required_features,i={};return"string"==typeof n?s.each(n.split(/\s*,\s*/),function(t){e(t,!0)}):"object"==typeof n?s.each(n,function(t,n){e(n,t)}):!0===n&&(t.chunk_size>0&&(i.slice_blob=!0),!t.resize.enabled&&t.multipart||(i.send_binary_string=!0),s.each(t,function(t,n){e(n,!!t,!0)})),i}var r=t.setTimeout,o={},s={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,getAll:function(t){var e,n=[];"array"!==s.typeOf(t)&&(t=[t]);for(var i=t.length;i--;)(e=s.get(t[i]))&&n.push(e);return n.length?n:null},get:e.get,each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return t?(""+t).replace(n,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(t){var e,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<n.length;e+=2)t=t.replace(n[e],n[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var n="";return s.each(e,function(t,e){n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n&&(t+=(t.indexOf("?")>0?"&":"?")+n),t},formatSize:function(t){function e(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}if(t===n||/\D/.test(t))return s.translate("N/A");var i=Math.pow(1024,4);return t>i?e(t/i,1)+" "+s.translate("tb"):t>(i/=1024)?e(t/i,1)+" "+s.translate("gb"):t>(i/=1024)?e(t/i,1)+" "+s.translate("mb"):t>1024?Math.round(t/1024)+" "+s.translate("kb"):t+" "+s.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(t,n){var i,r;return i=new s.Uploader(t),r=e.Runtime.thatCan(i.getOption().required_features,n||t.runtimes),i.destroy(),r},addFileFilter:function(t,e){o[t]=e}};s.addFileFilter("mime_types",function(t,e,n){t.length&&!t.regexp.test(e.name)?(this.trigger("Error",{code:s.FILE_EXTENSION_ERROR,message:s.translate("File extension error."),file:e}),n(!1)):n(!0)}),s.addFileFilter("max_file_size",function(t,e,n){t=s.parseSize(t),void 0!==e.size&&t&&e.size>t?(this.trigger("Error",{code:s.FILE_SIZE_ERROR,message:s.translate("File size error."),file:e}),n(!1)):n(!0)}),s.addFileFilter("prevent_duplicates",function(t,e,n){if(t)for(var i=this.files.length;i--;)if(e.name===this.files[i].name&&e.size===this.files[i].size)return this.trigger("Error",{code:s.FILE_DUPLICATE_ERROR,message:s.translate("Duplicate file error."),file:e}),void n(!1);n(!0)}),s.Uploader=function(t){function a(){var t,e,n=0;if(this.state==s.STARTED){for(e=0;e<O.length;e++)t||O[e].status!=s.QUEUED?n++:(t=O[e],this.trigger("BeforeUpload",t)&&(t.status=s.UPLOADING,
this.trigger("UploadFile",t)));n==O.length&&(this.state!==s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",O))}}function u(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,c()}function c(){var t,e;for(A.reset(),t=0;t<O.length;t++)e=O[t],e.size!==n?(A.size+=e.origSize,A.loaded+=e.loaded*e.origSize/e.size):A.size=n,e.status==s.DONE?A.uploaded++:e.status==s.FAILED?A.failed++:A.queued++;A.size===n?A.percent=O.length>0?Math.ceil(A.uploaded/O.length*100):0:(A.bytesPerSec=Math.ceil(A.loaded/((+new Date-T||1)/1e3)),A.percent=A.size>0?Math.ceil(A.loaded/A.size*100):0)}function l(){var t=x[0]||D[0];return!!t&&t.getRuntime().uid}function h(t,n){if(t.ruid){var i=e.Runtime.getInfo(t.ruid);if(i)return i.can(n)}return!1}function d(){this.bind("FilesAdded FilesRemoved",function(t){t.trigger("QueueChanged"),t.refresh()}),this.bind("CancelUpload",y),this.bind("BeforeUpload",m),this.bind("UploadFile",_),this.bind("UploadProgress",E),this.bind("StateChanged",S),this.bind("QueueChanged",c),this.bind("Error",v),this.bind("FileUploaded",C),this.bind("Destroy",b)}function p(t,n){var i=this,r=0,o=[],a={runtime_order:t.runtimes,required_caps:t.required_features,preferred_caps:N,swf_url:t.flash_swf_url,xap_url:t.silverlight_xap_url};s.each(t.runtimes.split(/\s*,\s*/),function(e){t[e]&&(a[e]=t[e])}),t.browse_button&&s.each(t.browse_button,function(n){o.push(function(o){var u=new e.FileInput(s.extend({},a,{accept:t.filters.mime_types,name:t.file_data_name,multiple:t.multi_selection,container:t.container,browse_button:n}));u.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(i.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),multi_selection:t.can("select_multiple")}),r++,x.push(this),o()},u.onchange=function(){i.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",function(i){J||(t.browse_button_hover&&("mouseenter"===i.type?e.addClass(n,t.browse_button_hover):"mouseleave"===i.type&&e.removeClass(n,t.browse_button_hover)),t.browse_button_active&&("mousedown"===i.type?e.addClass(n,t.browse_button_active):"mouseup"===i.type&&e.removeClass(n,t.browse_button_active)))}),u.bind("mousedown",function(){i.trigger("Browse")}),u.bind("error runtimeerror",function(){u=null,o()}),u.init()})}),t.drop_element&&s.each(t.drop_element,function(t){o.push(function(n){var o=new e.FileDrop(s.extend({},a,{drop_zone:t}));o.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(i.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),dragdrop:t.can("drag_and_drop")}),r++,D.push(this),n()},o.ondrop=function(){i.addFile(this.files)},o.bind("error runtimeerror",function(){o=null,n()}),o.init()})}),e.inSeries(o,function(){"function"==typeof n&&n(r)})}function f(t,i,r){var o=new e.Image;try{o.onload=function(){if(i.width>this.width&&i.height>this.height&&i.quality===n&&i.preserve_headers&&!i.crop)return this.destroy(),r(t);o.downsize(i.width,i.height,i.crop,i.preserve_headers)},o.onresize=function(){r(this.getAsBlob(t.type,i.quality)),this.destroy()},o.onerror=function(){r(t)},o.load(t)}catch(e){r(t)}}function g(t,n,r){function o(t,e,n){var i=R[t];switch(t){case"max_file_size":"max_file_size"===t&&(R.max_file_size=R.filters.max_file_size=e);break;case"chunk_size":(e=s.parseSize(e))&&(R[t]=e,R.send_file_name=!0);break;case"multipart":R[t]=e,e||(R.send_file_name=!0);break;case"unique_names":R[t]=e,e&&(R.send_file_name=!0);break;case"filters":"array"===s.typeOf(e)&&(e={mime_types:e}),n?s.extend(R.filters,e):R.filters=e,e.mime_types&&(R.filters.mime_types.regexp=function(t){var e=[];return s.each(t,function(t){s.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?e.push("\\.*"):e.push("\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+e.join("|")+")$","i")}(R.filters.mime_types));break;case"resize":n?s.extend(R.resize,e,{enabled:!0}):R.resize=e;break;case"prevent_duplicates":R.prevent_duplicates=R.filters.prevent_duplicates=!!e;break;case"container":case"browse_button":case"drop_element":e="container"===t?s.get(e):s.getAll(e);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":R[t]=e,n||(u=!0);break;default:R[t]=e}n||a.trigger("OptionChanged",t,e,i)}var a=this,u=!1;"object"==typeof t?s.each(t,function(t,e){o(e,t,r)}):o(t,n,r),r?(R.required_features=i(s.extend({},R)),N=i(s.extend({},R,{required_features:!0}))):u&&(a.trigger("Destroy"),p.call(a,R,function(t){t?(a.runtime=e.Runtime.getInfo(l()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}))}function m(t,e){if(t.settings.unique_names){var n=e.name.match(/\.([^.]+)$/),i="part";n&&(i=n[1]),e.target_name=e.id+"."+i}}function _(t,n){function i(){l-- >0?r(o,1e3):(n.loaded=p,t.trigger("Error",{code:s.HTTP_ERROR,message:s.translate("HTTP Error."),file:n,response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()}))}function o(){var h,f,g,m={};n.status===s.UPLOADING&&t.state!==s.STOPPED&&(t.settings.send_file_name&&(m.name=n.target_name||n.name),c&&d.chunks&&a.size>c?(g=Math.min(c,a.size-p),h=a.slice(p,p+g)):(g=a.size,h=a),c&&d.chunks&&(t.settings.send_chunk_number?(m.chunk=Math.ceil(p/c),m.chunks=Math.ceil(a.size/c)):(m.offset=p,m.total=a.size)),w=new e.XMLHttpRequest,w.upload&&(w.upload.onprogress=function(e){n.loaded=Math.min(n.size,p+e.loaded),t.trigger("UploadProgress",n)}),w.onload=function(){if(w.status>=400)return void i();l=t.settings.max_retries,g<a.size?(h.destroy(),p+=g,n.loaded=Math.min(p,a.size),t.trigger("ChunkUploaded",n,{offset:n.loaded,total:a.size,response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&t.trigger("UploadProgress",n)):n.loaded=n.size,h=f=null,!p||p>=a.size?(n.size!=n.origSize&&(a.destroy(),a=null),t.trigger("UploadProgress",n),n.status=s.DONE,t.trigger("FileUploaded",n,{response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()})):r(o,1)},w.onerror=function(){i()},w.onloadend=function(){this.destroy(),w=null},t.settings.multipart&&d.multipart?(w.open("post",u,!0),s.each(t.settings.headers,function(t,e){w.setRequestHeader(e,t)}),f=new e.FormData,s.each(s.extend(m,t.settings.multipart_params),function(t,e){f.append(e,t)}),f.append(t.settings.file_data_name,h),w.send(f,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:N,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})):(u=s.buildUrl(t.settings.url,s.extend(m,t.settings.multipart_params)),w.open("post",u,!0),w.setRequestHeader("Content-Type","application/octet-stream"),s.each(t.settings.headers,function(t,e){w.setRequestHeader(e,t)}),w.send(h,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:N,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})))}var a,u=t.settings.url,c=t.settings.chunk_size,l=t.settings.max_retries,d=t.features,p=0;n.loaded&&(p=n.loaded=c?c*Math.floor(n.loaded/c):0),a=n.getSource(),t.settings.resize.enabled&&h(a,"send_binary_string")&&~e.inArray(a.type,["image/jpeg","image/png"])?f.call(this,a,t.settings.resize,function(t){a=t,n.size=t.size,o()}):o()}function E(t,e){u(e)}function S(t){if(t.state==s.STARTED)T=+new Date;else if(t.state==s.STOPPED)for(var e=t.files.length-1;e>=0;e--)t.files[e].status==s.UPLOADING&&(t.files[e].status=s.QUEUED,c())}function y(){w&&w.abort()}function C(t){c(),r(function(){a.call(t)},1)}function v(t,e){e.code===s.INIT_ERROR?t.destroy():e.code===s.HTTP_ERROR&&(e.file.status=s.FAILED,u(e.file),t.state==s.STARTED&&(t.trigger("CancelUpload"),r(function(){a.call(t)},1)))}function b(t){t.stop(),s.each(O,function(t){t.destroy()}),O=[],x.length&&(s.each(x,function(t){t.destroy()}),x=[]),D.length&&(s.each(D,function(t){t.destroy()}),D=[]),N={},J=!1,T=w=null,A.reset()}var R,T,A,w,I=s.guid(),O=[],N={},x=[],D=[],J=!1;R={runtimes:e.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},g.call(this,t,null,!0),A=new s.QueueProgress,s.extend(this,{id:I,uid:I,state:s.STOPPED,features:{},runtime:null,files:O,settings:R,total:A,init:function(){var t,n,i=this;return t=i.getOption("preinit"),"function"==typeof t?t(i):s.each(t,function(t,e){i.bind(e,t)}),d.call(i),s.each(["container","browse_button","drop_element"],function(t){if(null===i.getOption(t))return n={code:s.INIT_ERROR,message:s.translate("'%' specified, but cannot be found.")},!1}),n?i.trigger("Error",n):R.browse_button||R.drop_element?void p.call(i,R,function(t){var n=i.getOption("init");"function"==typeof n?n(i):s.each(n,function(t,e){i.bind(e,t)}),t?(i.runtime=e.Runtime.getInfo(l()).type,i.trigger("Init",{runtime:i.runtime}),i.trigger("PostInit")):i.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}):i.trigger("Error",{code:s.INIT_ERROR,message:s.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(t,e){g.call(this,t,e,!this.runtime)},getOption:function(t){return t?R[t]:R},refresh:function(){x.length&&s.each(x,function(t){t.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=s.STARTED&&(this.state=s.STARTED,this.trigger("StateChanged"),a.call(this))},stop:function(){this.state!=s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){J=arguments[0]===n||arguments[0],x.length&&s.each(x,function(t){t.disable(J)}),this.trigger("DisableBrowse",J)},getFile:function(t){var e;for(e=O.length-1;e>=0;e--)if(O[e].id===t)return O[e]},addFile:function(t,n){function i(t,n){var i=[];e.each(c.settings.filters,function(e,n){o[n]&&i.push(function(i){o[n].call(c,e,t,function(t){i(!t)})})}),e.inSeries(i,n)}function a(t){var o=e.typeOf(t);if(t instanceof e.File){if(!t.ruid&&!t.isDetached()){if(!u)return!1;t.ruid=u,t.connectRuntime(u)}a(new s.File(t))}else t instanceof e.Blob?(a(t.getSource()),t.destroy()):t instanceof s.File?(n&&(t.name=n),h.push(function(e){i(t,function(n){n||(O.push(t),d.push(t),c.trigger("FileFiltered",t)),r(e,1)})})):-1!==e.inArray(o,["file","blob"])?a(new e.File(null,t)):"node"===o&&"filelist"===e.typeOf(t.files)?e.each(t.files,a):"array"===o&&(n=null,e.each(t,a))}var u,c=this,h=[],d=[];u=l(),a(t),h.length&&e.inSeries(h,function(){d.length&&c.trigger("FilesAdded",d)})},removeFile:function(t){for(var e="string"==typeof t?t:t.id,n=O.length-1;n>=0;n--)if(O[n].id===e)return this.splice(n,1)[0]},splice:function(t,e){var i=O.splice(t===n?0:t,e===n?O.length:e),r=!1;return this.state==s.STARTED&&(s.each(i,function(t){if(t.status===s.UPLOADING)return r=!0,!1}),r&&this.stop()),this.trigger("FilesRemoved",i),s.each(i,function(t){t.destroy()}),r&&this.start(),i},dispatchEvent:function(t){var e,n;if(t=t.toLowerCase(),e=this.hasEventListener(t)){e.sort(function(t,e){return e.priority-t.priority}),n=[].slice.call(arguments),n.shift(),n.unshift(this);for(var i=0;i<e.length;i++)if(!1===e[i].fn.apply(e[i].scope,n))return!1}return!0},bind:function(t,e,n,i){s.Uploader.prototype.bind.call(this,t,e,i,n)},destroy:function(){this.trigger("Destroy"),R=A=null,this.unbindAll()}})},s.Uploader.prototype=e.EventTarget.instance,s.File=function(){function t(t){s.extend(this,{id:s.guid(),name:t.name||t.fileName,type:t.type||"",size:t.size||t.fileSize,origSize:t.size||t.fileSize,loaded:0,percent:0,status:s.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var t=this.getSource().getSource();return-1!==e.inArray(e.typeOf(t),["blob","file"])?t:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete n[this.id])}}),n[this.id]=t}var n={};return t}(),s.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},t.plupload=s}(window,mOxie);var PACKET_HEADER_SIZE=13,OPCODE_MAP={RECV:new BaseList,SEND:new BaseList},OPCODE={AUTH:new _Opcode("auth",1),PING:new _Opcode("ping",2),STREAMEND:new _Opcode("streamend",4),RECEIPTS:new _Opcode("receipts",4098),USER_MESSAGE:new _Opcode("userMessage",4112),INPUT_STATE:new _Opcode("inputState",4117),CHATGROUP_MESSAGE:new _Opcode("chatGroupMessage",4144),PUBACCOUNT_MESSAGE:new _Opcode("pubaccountMessage",4176),SYNC_MESSAGE:new _Opcode("syncMessage",4208),RECEIPTS:new _Opcode("receipts",4098),NOTIFY_MESSAGE:new _Opcode("notifyMessage",4099),MUCONLINEDELIVERPACKET:new _Opcode("MucOnlineDeliverPacket",4368),PUBONLINEDELIVERPACKET:new _Opcode("PubOnlineDeliverPacket",4400),USERONLINEDELIVERPACKET:new _Opcode("UserOnlineDeliverPacket",4432),REMINDSETTINGONLINEDELIVERPACKET:new _Opcode("RemindSettingOnlineDeliverPacket",4448),INVITE_USERS:new _Opcode("inviteUsers",4865),VCARD:new _Opcode("vcard",8209),VCARDS:new _Opcode("vcards",8209,8210),IQ_RESULT:new _Opcode("iqResult",8225),QUERY_USER:new _Opcode("queryUser",8464,8465),QUERY_CHATGROUP:new _Opcode("queryChatGroup",8496,8497),QUERY_PUBACCOUNT:new _Opcode("queryPubaccount",8528,8529),ROSTER_LIST:new _Opcode("rosterList",8736,8737),CHATGROUP_LIST:new _Opcode("chatGroupList",8752,8753),CHATGROUP_MEMBER_LIST:new _Opcode("chatGroupMemberList",8768,8769),PUBACCOUNT_LIST:new _Opcode("pubaccountList",8784,8785),CHATGROUP_INFO:new _Opcode("chatGroupInfo",9008,9009),CHATGROUP_SHARED_FILES:new _Opcode("chatGroupSharedFiles",9010,9011),UPDATE_ROSTER:new _Opcode("updateRoster",9504),CONFIG_CHATGROUP:new _Opcode("chatGroupConfig",9520,9521),CREATE_GROUP:new _Opcode("createGroup",9522,9012),INVITE_GROUP_MEMBER:new _Opcode("inviteGroupMember",9523,9012),MODIFY_GROUP_INFO:new _Opcode("modifyGroupInfo",9524,9012),KICK_GROUP_MEMBER:new _Opcode("kickGroupMember",9525,9012),DISMISS_GROUP:new _Opcode("dismissgtoup",9528,9013),ON_GROUP_TRANSFER:new _Opcode("groupOwnerTransfer",9014),TRANSFER_GROUP:new _Opcode("transferGroup",9529),EXIT_GROUP:new _Opcode("exitGroup",9526,9013),ON_GROUP_UPDATE:new _Opcode("groupUpdate",9012),KICKED_GROUP:new _Opcode("kickedByGroup",9013),FAVORITED_ROSTERT:new _Opcode("favoritedRoster",9505),COLLECT_GROUP:new _Opcode("collectGroup",9527),FULL_SYNC_ROSTER:new _Opcode("fullSyncRoster",10016),DELTA_SYNC_ROSTER:new _Opcode("deltaSyncRoster",10018),FULL_SYNC_CHATGROUP:new _Opcode("fullSyncChatGroup",10032),DELTA_SYNC_CHATGROUP:new _Opcode("deltaSyncChatGroup",10034),PRESENCE:new _Opcode("presence",12289),CHATGROUP:new _Opcode("chatGroup",13057,13058),DEL_GROUPMEMBER:new _Opcode("delGroupMember",9792),OPERATE_WHITEBOARD:new _Opcode("operateWhiteBoard",10241),LISTEN_WHITEBOARD:new _Opcode("listenWhiteBoard",10241,10242),UPDATE_WHITEBOARD:new _Opcode("updateWhiteBoard",10245),PACKET_ERROR:new _Opcode("packetError",16384),STREAM_ERROR:new _Opcode("streamError",16640),MESSAGE_RANGE:new _Range(4096,8192),CREATE_NETMETTING:new _Opcode("createNetMetting",10368),NETMEETING_NOTIFY:new _Opcode("NETMeetingNotify",10369),NETMEETING_MANAGE:new _Opcode("NETMeetingManage",10370),NETMEETING_BILL:new _Opcode("NETMeetingBill",10372),IQ_RANGE:new _Range(8192,12288),PRESENCE_RANGE:new _Range(12288,16384)},SERVICE_OPCODE={SERVICE_USER_MESSAGE:new _Opcode("ServiceUserMessage",6145),SERVICE_RECEIPTS:new _Opcode("ServiceReceipts",6146)};YYIMUtil.extend(OPCODE,SERVICE_OPCODE);var PACKET_STRUCT={CONSOLE_FRAME:new _Range(0,1),OPCODE:new _Range(1,3),PACKET_LEN:new _Range(3,7),VERSION:new _Range(7,9),SEQ_ID:new _Range(9,13)};XmlHttp.create=function(){try{if(window.XMLHttpRequest){var t=new XMLHttpRequest;return null===t.readyState&&(t.readyState=1,t.addEventListener("load",function(){t.readyState=4,"function"==typeof t.onreadystatechange&&t.onreadystatechange()},!1)),t}if(window.ActiveXObject)return new ActiveXObject(XmlHttp.getPrefix()+".XmlHttp")}catch(t){}throw new Error("Your browser does not support XmlHttp objects")},XmlHttp.getPrefix=function(){if(XmlHttp.prefix)return XmlHttp.prefix;for(var t=["MSXML2","Microsoft","MSXML","MSXML3"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e]+".XmlHttp"),XmlHttp.prefix=t[e]}catch(t){}throw new Error("Could not find an installed XML parser")},XmlDocument.create=function(t,e){t=t||"foo",e=e||"";try{var n;if(document.implementation&&document.implementation.createDocument?(n=document.implementation.createDocument(e,t,null),null===n.readyState&&(n.readyState=1,n.addEventListener("load",function(){n.readyState=4,"function"==typeof n.onreadystatechange&&n.onreadystatechange()},!1))):window.ActiveXObject&&(n=new ActiveXObject(XmlDocument.getPrefix()+".DomDocument")),!n.documentElement||n.documentElement.tagName!=t||n.documentElement.namespaceURI&&n.documentElement.namespaceURI!=e)try{""!==e?n.appendChild(n.createElement(t)).setAttribute("xmlns",e):n.appendChild(n.createElement(t))}catch(i){n=document.implementation.createDocument(e,t,null),null===n.documentElement&&n.appendChild(n.createElement(t)),""!==e&&n.documentElement.getAttribute("xmlns")!=e&&n.documentElement.setAttribute("xmlns",e)}return n}catch(t){}throw new Error("Your browser does not support XmlDocument objects")},XmlDocument.getPrefix=function(){if(XmlDocument.prefix)return XmlDocument.prefix;for(var t=["MSXML2","Microsoft","MSXML","MSXML3"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e]+".DomDocument"),XmlDocument.prefix=t[e]}catch(t){}throw new Error("Could not find an installed XML parser")},"undefined"!=typeof Document&&window.DOMParser&&(Document.prototype.loadXML=function(t){for(var e=(new DOMParser).parseFromString(t,"text/xml");this.hasChildNodes();)this.removeChild(this.lastChild);for(var n=0;n<e.childNodes.length;n++)this.appendChild(this.importNode(e.childNodes[n],!0))}),window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__&&(Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}),Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}));var hexcase=0,b64pad="=";if("undefined"!=typeof atob&&"undefined"!=typeof btoa||b64arrays(),"undefined"==typeof atob?(b64decode=function(t){return utf8d2t(b64t2d(t))},b64decode_bin=function(t){for(var e=b64t2d(t),n="",i=0;i<e.length;i++)n+=String.fromCharCode(e[i]);return n}):(b64decode=function(t){return decodeURIComponent(escape(atob(t)))},b64decode_bin=atob),"undefined"==typeof btoa?b64encode=function(t){return b64d2t(utf8t2d(t))}:b64encode=function(t){return btoa(unescape(encodeURIComponent(t)))},window.XDomainRequest){window.ieXDRToXHR=function(t){"use strict";var e=t.XMLHttpRequest;t.XMLHttpRequest=function(){this.onreadystatechange=Object,this.xhr=null,this.xdr=null,this.readyState=0,this.status="",this.statusText=null,this.responseText=null,this.getResponseHeader=null,this.getAllResponseHeaders=null,this.setRequestHeader=null,this.abort=null,this.send=null,this.isxdr=!1;var t=this;t.xdrLoadedBinded=function(){t.xdrLoaded()},t.xdrErrorBinded=function(){t.xdrError()},t.xdrProgressBinded=function(){t.xdrProgress()},t.xhrReadyStateChangedBinded=function(){t.xhrReadyStateChanged()}},XMLHttpRequest.prototype.open=function(n,i,r,o,s){var a=document.createElement("a");a.href=i,a.hostname&&a.hostname!=document.domain?(null===this.xdr&&(this.xdr=new t.XDomainRequest),this.isxdr=!0,this.setXDRActive(),this.xdr.open(n,i)):(null===this.xhr&&(this.xhr=new e),this.isxdr=!1,this.setXHRActive(),this.xhr.open(n,i,r,o,s))},XMLHttpRequest.prototype.xdrGetResponseHeader=function(t){return"Content-Type"===t&&this.xdr.contentType>""?this.xdr.contentType:""},XMLHttpRequest.prototype.xdrGetAllResponseHeaders=function(){return this.xdr.contentType>""?"Content-Type: "+this.xdr.contentType:""},XMLHttpRequest.prototype.xdrSetRequestHeader=function(t,e){},XMLHttpRequest.prototype.xdrLoaded=function(){if(null!==this.onreadystatechange){if(this.readyState=4,this.status=200,this.statusText="OK",this.responseText=this.xdr.responseText,t.ActiveXObject){var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(this.responseText),this.responseXML=e}this.onreadystatechange()}},XMLHttpRequest.prototype.xdrError=function(){null!==this.onreadystatechange&&(this.readyState=4,this.status=0,this.statusText="",this.responseText="",this.onreadystatechange())},XMLHttpRequest.prototype.xdrProgress=function(){null!==this.onreadystatechange&&3!==this.status&&(this.readyState=3,this.status=3,this.statusText="",this.onreadystatechange())},XMLHttpRequest.prototype.finalXDRRequest=function(){var t=this.xdr;delete t.onload,delete t.onerror,delete t.onprogress},XMLHttpRequest.prototype.sendXDR=function(t){var e=this.xdr;e.onload=this.xdrLoadedBinded,e.onerror=this.xdr.ontimeout=this.xdrErrorBinded,e.onprogress=this.xdrProgressBinded,this.responseText=null,this.xdr.send(t)},XMLHttpRequest.prototype.abortXDR=function(){this.finalXDRRequest(),this.xdr.abort()},XMLHttpRequest.prototype.setXDRActive=function(){this.send=this.sendXDR,this.abort=this.abortXDR,this.getResponseHeader=this.xdrGetResponseHeader,this.getAllResponseHeaders=this.xdrGetAllResponseHeaders,this.setRequestHeader=this.xdrSetRequestHeader},XMLHttpRequest.prototype.xhrGetResponseHeader=function(t){return this.xhr.getResponseHeader(t)},XMLHttpRequest.prototype.xhrGetAllResponseHeaders=function(){return this.xhr.getAllResponseHeaders()},XMLHttpRequest.prototype.xhrSetRequestHeader=function(t,e){return this.xhr.setRequestHeader(t,e)},XMLHttpRequest.prototype.xhrReadyStateChanged=function(){if(null!==this.onreadystatechange&&this.readyState!==this.xhr.readyState){var t=this.xhr;this.readyState=t.readyState,4===this.readyState&&(this.status=t.status,this.statusText=t.statusText,this.responseText=t.responseText,this.responseXML=t.responseXML),this.onreadystatechange()}},XMLHttpRequest.prototype.finalXHRRequest=function(){delete this.xhr.onreadystatechange},XMLHttpRequest.prototype.abortXHR=function(){this.finalXHRRequest(),this.xhr.abort()},XMLHttpRequest.prototype.sendXHR=function(t){this.xhr.onreadystatechange=this.xhrReadyStateChangedBinded,this.xhr.send(t)},XMLHttpRequest.prototype.setXHRActive=function(){this.send=this.sendXHR,this.abort=this.abortXHR,this.getResponseHeader=this.xhrGetResponseHeader,this.getAllResponseHeaders=this.xhrGetAllResponseHeaders,this.setRequestHeader=this.xhrSetRequestHeader},t.ieXDRToXHR=void 0};var isWebsocketSupport=function(){return!(navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1)&&(window.WebSocket=window.WebSocket||window.MozWebSocket,!!window.WebSocket)}();isWebsocketSupport||window.ieXDRToXHR(window)}String.prototype.htmlEnc=function(){if(!this)return this;var t=this.replace(/&/g,"&amp;");return t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/\n/g,"<br />")},String.prototype.revertHtmlEnc=function(){if(!this)return this;var t=this.replace(/&amp;/gi,"&");return t=t.replace(/&lt;/gi,"<"),t=t.replace(/&gt;/gi,">"),t=t.replace(/&quot;/gi,'"'),t=t.replace(/<br( )?(\/)?>/gi,"\n")},Date.jab2date=function(t){var e=new Date(Date.UTC(t.substr(0,4),t.substr(5,2)-1,t.substr(8,2),t.substr(11,2),t.substr(14,2),t.substr(17,2)));if("Z"!=t.substr(t.length-6,1)){var n=new Date;n.setTime(0),n.setUTCHours(t.substr(t.length-5,2)),n.setUTCMinutes(t.substr(t.length-2,2)),"+"==t.substr(t.length-6,1)?e.setTime(e.getTime()-n.getTime()):"-"==t.substr(t.length-6,1)&&e.setTime(e.getTime()+n.getTime())}return e},Date.hrTime=function(t){return Date.jab2date(t).toLocaleString()},Date.prototype.jabberDate=function(){var t=function(t){return t<10?"0"+t:t},e=this.getUTCFullYear()+"-";return e+=t(this.getUTCMonth()+1)+"-",e+=t(this.getUTCDate())+"T",e+=t(this.getUTCHours())+":",e+=t(this.getUTCMinutes())+":",e+=t(this.getUTCSeconds())+"Z"},Number.max=function(t,e){return t>e?t:e},Number.min=function(t,e){return t<e?t:e};var JSJaC={Version:"1.4",bind:function(t,e,n){return function(i){return t.apply(e,[i,n])}}},JSJaCBuilder={buildNode:function(t,e){var n,i=arguments[4];if(arguments[2])if(JSJaCBuilder._isStringOrNumber(arguments[2])||arguments[2]instanceof Array)n=this._createElement(t,e,i),JSJaCBuilder._children(t,n,arguments[2]);else{i=arguments[2].xmlns||i,n=this._createElement(t,e,i);for(var r in arguments[2])arguments[2].hasOwnProperty(r)&&"xmlns"!=r&&n.setAttribute(r,arguments[2][r])}else n=this._createElement(t,e,i);return arguments[3]&&JSJaCBuilder._children(t,n,arguments[3],i),n},_createElement:function(t,e,n){try{if(n)return t.createElementNS(n,e)}catch(t){}var i=t.createElement(e);return n&&i.setAttribute("xmlns",n),i},_text:function(t,e){return t.createTextNode(e)},_children:function(t,e,n,i){if("object"==typeof n){for(var r in n)if(n.hasOwnProperty(r)){var o=n[r];if("object"==typeof o)if(o instanceof Array){var s=JSJaCBuilder.buildNode(t,o[0],o[1],o[2],i);e.appendChild(s)}else e.appendChild(o);else JSJaCBuilder._isStringOrNumber(o)&&e.appendChild(JSJaCBuilder._text(t,o))}}else JSJaCBuilder._isStringOrNumber(n)&&e.appendChild(JSJaCBuilder._text(t,n))},_attributes:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n+'="'+t[n].toString().htmlEnc()+'"');return e.join(" ")},_isStringOrNumber:function(t){return"string"==typeof t||"number"==typeof t}};JSJAC_HAVEKEYS=!0,JSJAC_NKEYS=16,JSJAC_INACTIVITY=300,JSJAC_ERR_COUNT=10,JSJAC_ALLOW_PLAIN=!0,JSJAC_ALLOW_SCRAM=!1,JSJAC_CHECKQUEUEINTERVAL=100,JSJAC_CHECKINQUEUEINTERVAL=100,JSJAC_TIMERVAL=2e3,JSJAC_RETRYDELAY=5e3,JSJAC_REGID_TIMEOUT=2e4,JSJACHBC_MAX_HOLD=1,JSJACHBC_MAX_WAIT=300,JSJACHBC_BOSH_VERSION="1.10",JSJACHBC_USE_BOSH_VER=!0,JSJACHBC_MAXPAUSE=120,JSJaCConnection.prototype.connect=function(t){this._setStatus("connecting"),t.appType&&(this.appType=t.appType),t.clientIdentify&&(this.clientIdentify=t.clientIdentify),this.domain=t.domain||"localhost",this.username=t.username,this.resource=t.resource,this.pass=t.password||t.pass,this.authzid=t.authzid||"",this.register=t.register,this.authhost=t.authhost||t.host||t.domain,this.authtype=t.authtype||"sasl",t.xmllang&&""!==t.xmllang?this._xmllang=t.xmllang:this._xmllang="en",t.allow_plain?this._allow_plain=t.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,t.allow_scram?this._allow_scram=t.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,this.host=t.host,this.port=t.port||5222,this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,this._rid=Math.round(100000.5+799999.99999*Math.random());var e=this._getFreeSlot();this._req[e]=this._setupRequest(!0);var n=this._getInitialRequestString();this.oDbg.log(n,4),this._req[e].r.onreadystatechange=JSJaC.bind(function(){var t=this._req[e].r;4==t.readyState&&(this.oDbg.log("async recv: "+t.responseText,4),this._handleInitialResponse(t))},this),void 0!==this._req[e].r.onerror&&(this._req[e].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this)),this._req[e].r.send(n)},JSJaCConnection.prototype.connected=function(){return this._connected},JSJaCConnection.prototype.disconnect=function(){if(this._setStatus("disconnecting"),this.connected()){this._connected=!1,clearInterval(this._interval),clearInterval(this._inQto),this._timeout&&clearTimeout(this._timeout);var t=this._getFreeSlot();this._req[t]=this._setupRequest(!1);var e=this._getRequestString(!1,!0);this.oDbg.log("Disconnecting: "+e,4);try{this._req[t].r.send(e)}catch(t){}this.oDbg.log("disconnected");try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(t){}this._handleEvent("ondisconnect")}},JSJaCConnection.prototype.getPollInterval=function(){return this._timerval},JSJaCConnection.prototype.registerHandler=function(t,e,n,i){t=t.toLowerCase();var r={handler:arguments[arguments.length-1],ns:"*",type:"*"};return arguments.length>2&&(r.ns=arguments[1]),arguments.length>3&&(r.type=arguments[2]),this._events[t]?this._events[t]=this._events[t].concat(r):this._events[t]=[r],this._events[t]=this._events[t].sort(function(t,e){var n=0,i=0;return"*"==t.type&&n++,"*"==t.ns&&n++,n++,"*"==e.type&&i++,"*"==e.ns&&i++,n>i?1:n<i?-1:0}),this.oDbg.log("registered handler for event '"+t+"'",2),this},JSJaCConnection.prototype.unregisterHandler=function(t,e){if(t=t.toLowerCase(),!this._events[t])return this;for(var n=this._events[t],i=[],r=0;r<n.length;r++)n[r].handler!=e&&i.push(n[r]);return n.length!=i.length&&(this._events[t]=i,this.oDbg.log("unregistered handler for event '"+t+"'",2)),this},JSJaCConnection.prototype.registerIQGet=function(t,e,n){return this.registerHandler("iq",t,e,"get",n)},JSJaCConnection.prototype.registerIQSet=function(t,e,n){return this.registerHandler("iq",t,e,"set",n)},JSJaCConnection.prototype.resume=function(){try{var t=JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").getValue();return this.oDbg.log("read cookie: "+t,2),JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase(),this.resumeFromData(JSJaCJSON.parse(t))}catch(t){}return!1},JSJaCConnection.prototype.resumeFromData=function(t){try{for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(this._keys){this._keys2=new JSJaCKeys;for(var n=this._keys2._getSuspendVars(),i=0;i<n.length;i++)this._keys2[n[i]]=this._keys[n[i]];this._keys=this._keys2}return this._connected?(this._setStatus("resuming"),this._handleEvent("onresume"),setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval()),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL)):this._setStatus("terminated"),!0===this._connected}catch(t){return t.message?this.oDbg.log("Resume failed: "+t.message,1):this.oDbg.log("Resume failed: "+t,1),!1}},JSJaCConnection.prototype.sendJumpPacket=function(t,e,n){if(!this.connected())return!1;if(!t||!t.opcode)return this.oDbg.log("no jumpPacket: "+t,1),!1;if(e&&this._validateCallbackable(t)){if(!t.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");t.content.id||(t.content.id=this._IDPrefix+this._ID++),this._registerPID(t,e,n)}return this._pQueue=this._pQueue.concat(t),this._handleEvent("packet_out",t),!0},JSJaCConnection.prototype.send=function(t,e,n){},JSJaCConnection.prototype.sendIQ=function(t,e,n){if(!t||"iq"!=t.pType())return!1;e=e||{};var i=e.error_handler||JSJaC.bind(function(t){this.oDbg.log(t.xml(),1)},this),r=e.result_handler||JSJaC.bind(function(t){this.oDbg.log(t.xml(),2)},this),o=function(t,e){switch(t.getType()){case"error":i(t);break;case"result":r(t,e)}};return this.send(t,o,n)},JSJaCConnection.prototype.setPollInterval=function(t){return t&&!isNaN(t)&&(this._timerval=t),this._timerval},JSJaCConnection.prototype.status=function(){return this._status},JSJaCConnection.prototype.suspend=function(){var t=this.suspendToData();try{var e=new JSJaCCookie(this._cookie_prefix+"JSJaC_State",JSJaCJSON.toString(t));this.oDbg.log("writing cookie: "+e.getValue()+"\n(length:"+e.getValue().length+")",2),e.write();var n=JSJaCCookie.get(this._cookie_prefix+"JSJaC_State");return e.getValue()==n||(this.oDbg.log("Suspend failed writing cookie.\nread: "+n,1),e.erase(),!1)}catch(t){this.oDbg.log("Failed creating cookie '"+this._cookie_prefix+"JSJaC_State': "+t.message,1)}return!1},JSJaCConnection.prototype.suspendToData=function(){clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._suspend();var t="_connected,_keys,_ID,_xmllang,_inQ,_pQueue,_regIDs,_errcnt,_inactivity,domain,username,resource,jid,fulljid,_sid,_httpbase,_timerval,_is_polling".split(",");t=t.concat(this._getSuspendVars());for(var e={},n=0;n<t.length;n++)if(this[t[n]]){var i={};if(this[t[n]]._getSuspendVars)for(var r=this[t[n]]._getSuspendVars(),o=0;o<r.length;o++)i[r[o]]=this[t[n]][r[o]];else i=this[t[n]];e[t[n]]=i}return this._connected=!1,
this._setStatus("suspending"),e},JSJaCConnection.prototype._abort=function(){clearTimeout(this._timeout),clearInterval(this._inQto),clearInterval(this._interval),this._connected=!1,this._setStatus("aborted"),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("500","cancel","service-unavailable"))},JSJaCConnection.prototype._checkInQ=function(){for(var t=0;t<this._inQ.length&&t<10;t++){var e=this._inQ[0],n=e.body,i=e.event;if(this._inQ=this._inQ.slice(1,this._inQ.length),!n)return this._handleEvent("packet_in"),void this._handleEvent(i);this._handlePID(n)||(this._handleEvent("packet_in",n),this._handleEvent(i,n))}},JSJaCConnection.prototype._checkQueue=function(){return this._pQueue.length>0&&this._process(),!0},JSJaCConnection.prototype._doAuth=function(){return this._sendJumpPacket(this._getAuthPacket(),function(t){if(t.event==OPCODE.AUTH.KEY){var e=t.body;if(200!=e.code)return void this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this._handleEvent("packet_in",e),this._handleEvent(OPCODE.AUTH.KEY,e),this._handleEvent("onconnect")}}),!0},JSJaCConnection.prototype._doInBandReg=function(){if("saslanon"!=this.authtype&&"anonymous"!=this.authtype){var t=new JSJaCIQ;t.setType("set"),t.setID("reg1"),t.appendNode("query",{xmlns:NS_REGISTER},[["username",this.username],["password",this.pass]]),this.send(t,this._doInBandRegDone)}},JSJaCConnection.prototype._doInBandRegDone=function(t){if(t&&"error"==t.getType())return this.oDbg.log("registration failed for "+this.username,0),void this._handleEvent("onerror",t.getChild("error"));this.oDbg.log(this.username+" registered succesfully",0),this._doAuth()},JSJaCConnection.prototype._doLegacyAuth=function(){if("nonsasl"!=this.authtype&&"anonymous"!=this.authtype)return!1;var t=new JSJaCIQ;return t.setIQ(null,"get","auth1"),t.appendNode("query",{xmlns:NS_AUTH},[["username",this.username]]),this.send(t,this._doLegacyAuth2),!0},JSJaCConnection.prototype._doLegacyAuth2=function(t){if(!t||"result"!=t.getType())return t&&"error"==t.getType()&&this._handleEvent("onerror",t.getChild("error")),void this.disconnect();var e=null!==t.getChild("digest"),n=new JSJaCIQ;n.setIQ(null,"set","auth2");var i=n.appendNode("query",{xmlns:NS_AUTH},[["username",this.username],["resource",this.resource]]);if(e)i.appendChild(n.buildNode("digest",{xmlns:NS_AUTH},hex_sha1(this.streamid+this.pass)));else{if(!this._allow_plain)return this.oDbg.log("no valid login mechanism found",1),void this.disconnect();i.appendChild(n.buildNode("password",{xmlns:NS_AUTH},this.pass))}this.send(n,this._doLegacyAuthDone)},JSJaCConnection.prototype._doLegacyAuthDone=function(t){"result"!=t.getType()?("error"==t.getType()&&this._handleEvent("onerror",t.getChild("error")),this.disconnect()):this._handleEvent("onconnect")},JSJaCConnection.prototype._doSASLAuth=function(){if("nonsasl"==this.authtype||"anonymous"==this.authtype)return!1;if(void 0!==this.username&&null!=this.username&&""!=this.username||"saslanon"!=this.authtype){if(this._allow_scram&&this.mechs["SCRAM-SHA-1"]){this.oDbg.log("SASL using mechanism 'SCRAM-SHA-1'",2),this._clientFirstMessageBare="n="+this.username.replace(/=/g,"=3D").replace(/,/g,"=2C")+",r="+JSJaCUtils.cnonce(16);var t;t=this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,";var e=t+this._clientFirstMessageBare;return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SCRAM-SHA-1'>"+b64encode(e)+"</auth>",this._doSASLAuthScramSha1S1)}if(this._allow_plain&&this.mechs.PLAIN){this.oDbg.log("SASL using mechanism 'PLAIN'",2);var n=this.authzid+String.fromCharCode(0)+this.username+String.fromCharCode(0)+this.pass;return this.oDbg.log("authenticating with '"+n+"'",2),n=b64encode(n),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='PLAIN'>"+n+"</auth>",this._doSASLAuthDone)}this.oDbg.log("No SASL mechanism applied",1),this.authtype="nonsasl"}else{if(this.mechs.ANONYMOUS)return this.oDbg.log("SASL using mechanism 'ANONYMOUS'",2),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='ANONYMOUS'/>",this._doSASLAuthDone);this.oDbg.log("SASL ANONYMOUS requested but not supported",1)}return!1},JSJaCConnection.prototype._doSASLAuthScramSha1S1=function(t){if("challenge"!=t.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var e=b64decode(t.firstChild.nodeValue);this.oDbg.log("got challenge: "+e,2);var n={},i=e.split(",");for(var r in i){var o=i[r].substring(2);n[i[r].substring(0,1)]=o}for(var s,a=str2rstr_utf8(this.pass),u=b64decode_bin(n.s)+"\0\0\0",c=parseInt(n.i,10),l=0;l<c;l++)u=rstr_hmac_sha1(a,u),s=JSJaCUtils.xor(s,u);var h;h=this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,";var d="c="+b64encode(h)+",r="+n.r;this._saltedPassword=s;var p=rstr_hmac_sha1(this._saltedPassword,"Client Key"),f=rstr_sha1(p);this._authMessage=this._clientFirstMessageBare+","+e+","+d;var g=rstr_hmac_sha1(f,str2rstr_utf8(this._authMessage)),m=JSJaCUtils.xor(p,g),_=d+",p="+rstr2b64(m);this.oDbg.log("response: "+_,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(_)+"</response>",this._doSASLAuthScramSha1S2)}},JSJaCConnection.prototype._doSASLAuthScramSha1S2=function(t){if("success"!=t.nodeName)this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var e=b64decode(t.firstChild.nodeValue);this.oDbg.log("got success: "+e,2);var n={},i=e.split(",");for(var r in i){var o=i[r].substring(2);n[i[r].substring(0,1)]=o}rstr_hmac_sha1(rstr_hmac_sha1(this._saltedPassword,"Server Key"),str2rstr_utf8(this._authMessage))!==b64decode_bin(n.v)?(this.oDbg.log("server auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))}},JSJaCConnection.prototype._doSASLAuthDigestMd5S1=function(t){if("challenge"!=t.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var e,n=b64decode(t.firstChild.nodeValue);if(this.oDbg.log("got challenge: "+n,2),-1===(e=n.indexOf('nonce="')))return this.oDbg.log("no valid nonce found, aborting",1),void this.disconnect();this._nonce=n.substring(e+7),this._nonce=this._nonce.substring(0,this._nonce.indexOf('"')),this.oDbg.log("nonce: "+this._nonce,2),e=n.indexOf('realm="'),-1!==e&&(this._realm=n.substring(e+7),this._realm=this._realm.substring(0,this._realm.indexOf('"'))),this._realm=this._realm||this.domain,this.oDbg.log("realm: "+this._realm,2),this._digest_uri="xmpp/"+this.domain,this._cnonce=JSJaCUtils.cnonce(14),this._nc="00000001";var i=this.username+":"+this._realm+":"+this.pass,r=rstr_md5(str2rstr_utf8(i)),o=r+":"+this._nonce+":"+this._cnonce;this.authzid&&(o=o+":"+this.authzid);var s=rstr2hex(rstr_md5(o)),a="AUTHENTICATE:"+this._digest_uri,u=hex_md5(a),c=hex_md5(s+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+u),l='username="'+this.username+'",realm="'+this._realm+'",nonce="'+this._nonce+'",cnonce="'+this._cnonce+'",nc='+this._nc+',qop=auth,digest-uri="'+this._digest_uri+'",response='+c+",charset=utf-8";this.authzid&&(l='authzid="'+this.authzid+'",'+l),this.oDbg.log("response: "+l,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(l)+"</response>",this._doSASLAuthDigestMd5S2)}},JSJaCConnection.prototype._doSASLAuthDigestMd5S2=function(t){if("failure"==t.nodeName)return t.xml?this.oDbg.log("auth error: "+t.xml,1):this.oDbg.log("auth error",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),void this.disconnect();var e=b64decode(t.firstChild.nodeValue);this.oDbg.log("response: "+e,2);var n=e.substring(e.indexOf("rspauth=")+8);this.oDbg.log("rspauth: "+n,2);var i=this.username+":"+this._realm+":"+this.pass,r=rstr_md5(str2rstr_utf8(i)),o=r+":"+this._nonce+":"+this._cnonce;this.authzid&&(o=o+":"+this.authzid);var s=rstr2hex(rstr_md5(o)),a=":"+this._digest_uri,u=hex_md5(a),c=hex_md5(s+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+u);if(this.oDbg.log("rsptest: "+c,2),c!=n)return this.oDbg.log("SASL Digest-MD5: server repsonse with wrong rspauth",1),void this.disconnect();"success"==t.nodeName?this._reInitStream(JSJaC.bind(this._doStreamBind,this)):this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>",this._doSASLAuthDone)},JSJaCConnection.prototype._doSASLAuthDone=function(t){"success"!=t.nodeName?(this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))},JSJaCConnection.prototype._doStreamBind=function(){var t=new JSJaCIQ;t.setIQ(null,"set","bind_1"),t.appendNode("bind",{xmlns:NS_BIND},[["resource",this.resource]]),this.oDbg.log(t.xml()),this.send(t,this._doXMPPSess)},JSJaCConnection.prototype._doXMPPSess=function(t){if("result"!=t.getType()||"error"==t.getType())return this.disconnect(),void("error"==t.getType()&&this._handleEvent("onerror",t.getChild("error")));this.fulljid=t.getChildVal("jid"),this.jid=this.fulljid.substring(0,this.fulljid.lastIndexOf("/")),t=new JSJaCIQ,t.setIQ(null,"set","sess_1"),t.appendNode("session",{xmlns:NS_SESSION},[]),this.oDbg.log(t.xml()),this.send(t,this._doXMPPSessDone)},JSJaCConnection.prototype._doXMPPSessDone=function(t){if("result"!=t.getType()||"error"==t.getType())return this.disconnect(),void("error"==t.getType()&&this._handleEvent("onerror",t.getChild("error")));this._handleEvent("onconnect")},JSJaCConnection.prototype._handleEvent=function(t,e){if(t=t.toLowerCase(),this.oDbg.log("incoming event '"+t+"'",3),this._events[t]){this.oDbg.log("handling event '"+t+"'",2);for(var n=0;n<this._events[t].length;n++){var i=this._events[t][n];if("function"==typeof i.handler)if(e){if("*"!=i.ns&&e.ns!=i.ns)continue;if("*"!=i.type&&e.type!=i.type)continue;if(this.oDbg.log(i.ns+"/"+i.type+" => match for handler "+i.handler,3),i.handler(e))break}else if(i.handler())break}}},JSJaCConnection.prototype._handlePID=function(t){if(!t.id)return!1;var e=this.jid,n=t.id;if(this._regIDs[e]&&this._regIDs[e][n]){this.oDbg.log("handling id "+n,3);var i=this._regIDs[e][n];return!1!==i.cb.call(this,t,i.arg)&&(delete this._regIDs[e][n],!0)}return this.oDbg.log("not handling id '"+n+"' from jid "+e,1),!1},JSJaCConnection.prototype._handleResponse=function(t){var e=this._parseResponse(t);if(e){if(this._sendRawCallbacks.length){var n=this._sendRawCallbacks[0];this._sendRawCallbacks=this._sendRawCallbacks.slice(1,this._sendRawCallbacks.length),n.fn.call(this,e,n.arg)}this._inQ=this._inQ.concat(e)}},JSJaCConnection.prototype._parseStreamFeatures=function(t){if(!t)return this.oDbg.log("nothing to parse ... aborting",1),!1;var e,n;if(t.getElementsByTagNameNS)e=t.getElementsByTagNameNS(NS_STREAM,"error").item(0);else{var i=t.getElementsByTagName("error");for(n=0;n<i.length;n++)if(i.item(n).namespaceURI==NS_STREAM||i.item(n).getAttribute("xmlns")==NS_STREAM){e=i.item(n);break}}if(e)return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),!1;this.mechs={};var r=t.getElementsByTagName("mechanisms");if(!r.length)return!1;for(this.has_sasl=!1,n=0;n<r.length;n++)if(r.item(n).getAttribute("xmlns")==NS_SASL){this.has_sasl=!0;for(var o=r.item(n).getElementsByTagName("mechanism"),s=0;s<o.length;s++)this.mechs[o.item(s).firstChild.nodeValue]=!0;break}return this.has_sasl?(this.oDbg.log("SASL detected",2),!0):(this.oDbg.log("No support for SASL detected",2),!0)},JSJaCConnection.prototype._process=function(t){if(!this.connected())return this.oDbg.log("Connection lost ...",1),void(this._interval&&clearInterval(this._interval));this.setPollInterval(t),this._timeout&&clearTimeout(this._timeout);var e=this._getFreeSlot();if(!(e<0)){if(void 0!==this._req[e]&&void 0!==this._req[e].r&&4!=this._req[e].r.readyState)return void this.oDbg.log("Slot "+e+" is not ready");if(!this.isPolling()&&0===this._pQueue.length&&this._req[(e+1)%2]&&4!=this._req[(e+1)%2].r.readyState)return void this.oDbg.log("all slots busy, standby ...",2);this.isPolling()||this.oDbg.log("Found working slot at "+e,2);var n=this._getRequestPacket();this._req[e]=n instanceof JumpPacket?this._setupJumpRequest(!0):this._setupRequest(!0),this._req[e].r.onreadystatechange=JSJaC.bind(function(){this.connected()&&4==this._req[e].r.readyState&&(this.oDbg.log("async recv: "+this._req[e].r.responseText,4),this._handleResponse(this._req[e]),this._setStatus("processing"),this._pQueue.length?this._timeout=setTimeout(JSJaC.bind(this._process,this),100):(this.oDbg.log("scheduling next poll in "+this.getPollInterval()+" msec",4),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())))},this);try{this._req[e].r.onerror=JSJaC.bind(function(){if(this.connected()){if(this._errcnt++,this.oDbg.log("XmlHttpRequest error ("+this._errcnt+")",1),this._errcnt>JSJAC_ERR_COUNT)return void this._abort();this._setStatus("onerror_fallback"),setTimeout(JSJaC.bind(this._repeat,this),JSJAC_RETRYDELAY)}},this)}catch(t){}void 0!==this._rid&&(this._req[e].rid=this._rid),n instanceof JumpPacket?this._buildAndSend(n,this._req[e].r):this._req[e].r.send(n&&n.xml?n.xml:this._getRequestString())}},JSJaCConnection.prototype._registerPID=function(t,e,n){this.oDbg.log("registering id for packet "+JSON.stringify(t.content),3);var i=t.content.id;if(!i)return this.oDbg.log("id missing",1),!1;if("function"!=typeof e)return this.oDbg.log("callback is not a function",1),!1;var r=this.jid;return this._regIDs[r]||(this._regIDs[r]={}),null!=this._regIDs[r][i]?(this.oDbg.log("id already registered: "+i,1),!1):(this._regIDs[r][i]={cb:e,arg:n,ts:JSJaCUtils.now()},this.oDbg.log("registered id "+i,3),this._cleanupRegisteredPIDs(),!0)},JSJaCConnection.prototype._cleanupRegisteredPIDs=function(){var t=Date.now();for(var e in this._regIDs)if(this._regIDs.hasOwnProperty(e))for(var n in this._regIDs[e])this._regIDs[e].hasOwnProperty(n)&&this._regIDs[e][n].ts+JSJAC_REGID_TIMEOUT<t&&(this.oDbg.log("deleting registered id '"+n+"' due to timeout",1),delete this._regIDs[e][n])},JSJaCConnection.prototype._prepSendEmpty=function(t,e){return function(){e._sendEmpty(JSJaC.bind(t,e))}},JSJaCConnection.prototype._sendEmpty=function(t){var e=this._getFreeSlot();this._req[e]=this._setupRequest(!0),this._req[e].r.onreadystatechange=JSJaC.bind(function(){4==this._req[e].r.readyState&&(this.oDbg.log("async recv: "+this._req[e].r.responseText,4),t(this._req[e].r))},this),void 0!==this._req[e].r.onerror&&(this._req[e].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this));var n=this._getRequestString();this.oDbg.log("sending: "+n,4),this._req[e].r.send(n)},JSJaCConnection.prototype._sendJumpPacket=function(t,e,n){return e&&this._sendRawCallbacks.push({fn:e,arg:n}),this._pQueue.push(t),this._process(),!0},JSJaCConnection.prototype._sendRaw=function(t,e,n){return e&&this._sendRawCallbacks.push({fn:e,arg:n}),this._pQueue.push(t),this._process(),!0},JSJaCConnection.prototype._setStatus=function(t){t&&""!==t&&t!=this._status&&(this._status=t,this._handleEvent("onstatuschanged",t),this._handleEvent("status_changed",t))},JSJaCConnection.prototype._buildAndSend=function(t,e){var n=null,i=null==t.content||void 0===t.content,r=JSON.stringify(t.content);n=this._stringToBytes(r);var o=new Uint8Array(PACKET_HEADER_SIZE);o.set(this._numToBytes(t.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),o.set(this._numToBytes(t.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),i?o.set(this._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):o.set(this._numToBytes(n.length,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),o.set(this._numToBytes(t.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),o.set(this._numToBytes(t.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START);var s;s=i?o:this._concatUint8Array(o,new Uint8Array(n));var a=s.subarray(0,s.byteLength),u=arr2b64(a);e.send(u)},JSJaCConnection.prototype._validateCallbackable=function(t){return this._isIQPacket(t.opcode)||this._isMessagePacket(t.opcode)||this._isPresencePacket(t.opcode)},JSJaCConnection.prototype._isMessagePacket=function(t){return t>=OPCODE.MESSAGE_RANGE.START&&t<OPCODE.MESSAGE_RANGE.END},JSJaCConnection.prototype._isIQPacket=function(t){return t>=OPCODE.IQ_RANGE.START&&t<OPCODE.IQ_RANGE.END},JSJaCConnection.prototype._isPresencePacket=function(t){return t>=OPCODE.PRESENCE_RANGE.START&&t<OPCODE.PRESENCE_RANGE.END},JSJaCConnection.prototype._concatUint8Array=function(t,e){var n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n},JSJaCConnection.prototype._numToBytes=function(t,e){var n=new Uint8Array(e),i=e;do{n[--i]=255&t,t>>=8}while(i);return n},JSJaCConnection.prototype._uint8ArrayToString=function(t){var e,n,i,r,o,s;for(e="",i=t.length,n=0;n<i;)switch((r=t[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(r);break;case 12:case 13:o=t[n++],e+=String.fromCharCode((31&r)<<6|63&o);break;case 14:o=t[n++],s=t[n++],e+=String.fromCharCode((15&r)<<12|(63&o)<<6|(63&s)<<0)}return e},JSJaCConnection.prototype._bytesToInteger=function(t){for(var e=0,n=0;n<t.length;++n)e+=t[n],n<t.length-1&&(e<<=8);return e},JSJaCConnection.prototype._stringToBytes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(n++,i=65536+((1023&i)<<10|1023&t.charCodeAt(n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},JSJaCConnection.prototype._getAuthPacket=function(){var t={usr:this.username,atk:this.pass,br:this.resource};return this.appType&&(t.appType=this.appType),this.clientIdentify&&(t.clientIdentify=this.clientIdentify),new JumpPacket(t,OPCODE.AUTH.SEND)};var NS_ORGANIZATION="http://jabber.org/protocol/org",NS_DISCO_ITEMS="http://jabber.org/protocol/disco#items",NS_DISCO_INFO="http://jabber.org/protocol/disco#info",NS_VCARD="vcard-temp",NS_VCARD_UPDATE="vcard-temp:x:update",NS_AUTH="jabber:iq:auth",NS_AUTH_ERROR="jabber:iq:auth:error",NS_REGISTER="jabber:iq:register",NS_SEARCH="jabber:iq:search",NS_ROSTER="jabber:iq:roster",NS_PUBACCOUNT="jabber:iq:pubaccount",NS_PRIVACY="jabber:iq:privacy",NS_PRIVATE="jabber:iq:private",NS_VERSION="jabber:iq:version",NS_TIME="jabber:iq:time",NS_TIME_NEW="urn:xmpp:time",NS_LAST="jabber:iq:last",NS_XDATA="jabber:x:data",NS_IQDATA="jabber:iq:data",NS_DELAY="jabber:x:delay",NS_DELAY_NEW="urn:xmpp:delay",NS_RECEIPTS="urn:xmpp:receipts",NS_EXPIRE="jabber:x:expire",NS_EVENT="jabber:x:event",NS_XCONFERENCE="jabber:x:conference",NS_PING="urn:xmpp:ping",NS_BOOKSMARKS="storage:bookmarks",NS_FORWARD_0="urn:xmpp:forward:0",NS_CARBONS_2="urn:xmpp:carbons:2",NS_CHAT_STATES="http://jabber.org/protocol/chatstates",NS_STATS="http://jabber.org/protocol/stats",NS_MUC="http://jabber.org/protocol/muc",NS_MUC_USER="http://jabber.org/protocol/muc#user",NS_MUC_ADMIN="http://jabber.org/protocol/muc#admin",NS_MUC_OWNER="http://jabber.org/protocol/muc#owner",NS_PUBSUB="http://jabber.org/protocol/pubsub",NS_PUBSUB_EVENT="http://jabber.org/protocol/pubsub#event",NS_PUBSUB_OWNER="http://jabber.org/protocol/pubsub#owner",NS_PUBSUB_ERRORS="http://jabber.org/protocol/pubsub#errors",NS_PUBSUB_NMI="http://jabber.org/protocol/pubsub#node-meta-info",NS_COMMANDS="http://jabber.org/protocol/commands",NS_CAPS="http://jabber.org/protocol/caps",NS_STREAM="http://etherx.jabber.org/streams",NS_CLIENT="jabber:client",NS_BOSH="http://jabber.org/protocol/httpbind",NS_XBOSH="urn:xmpp:xbosh",NS_STANZAS="urn:ietf:params:xml:ns:xmpp-stanzas",NS_STREAMS="urn:ietf:params:xml:ns:xmpp-streams",NS_TLS="urn:ietf:params:xml:ns:xmpp-tls",NS_SASL="urn:ietf:params:xml:ns:xmpp-sasl",NS_SESSION="urn:ietf:params:xml:ns:xmpp-session",NS_BIND="urn:ietf:params:xml:ns:xmpp-bind",NS_FEATURE_IQAUTH="http://jabber.org/features/iq-auth",NS_FEATURE_IQREGISTER="http://jabber.org/features/iq-register",NS_FEATURE_COMPRESS="http://jabber.org/features/compress",NS_COMPRESS="http://jabber.org/protocol/compress",ERR_BAD_REQUEST=STANZA_ERROR("400","modify","bad-request"),ERR_CONFLICT=STANZA_ERROR("409","cancel","conflict"),ERR_FEATURE_NOT_IMPLEMENTED=STANZA_ERROR("501","cancel","feature-not-implemented"),ERR_FORBIDDEN=STANZA_ERROR("403","auth","forbidden"),ERR_GONE=STANZA_ERROR("302","modify","gone"),ERR_INTERNAL_SERVER_ERROR=STANZA_ERROR("500","wait","internal-server-error"),ERR_ITEM_NOT_FOUND=STANZA_ERROR("404","cancel","item-not-found"),ERR_JID_MALFORMED=STANZA_ERROR("400","modify","jid-malformed"),ERR_NOT_ACCEPTABLE=STANZA_ERROR("406","modify","not-acceptable"),ERR_NOT_ALLOWED=STANZA_ERROR("405","cancel","not-allowed"),ERR_NOT_AUTHORIZED=STANZA_ERROR("401","auth","not-authorized"),ERR_PAYMENT_REQUIRED=STANZA_ERROR("402","auth","payment-required"),ERR_RECIPIENT_UNAVAILABLE=STANZA_ERROR("404","wait","recipient-unavailable"),ERR_REDIRECT=STANZA_ERROR("302","modify","redirect"),ERR_REGISTRATION_REQUIRED=STANZA_ERROR("407","auth","registration-required"),ERR_REMOTE_SERVER_NOT_FOUND=STANZA_ERROR("404","cancel","remote-server-not-found"),ERR_REMOTE_SERVER_TIMEOUT=STANZA_ERROR("504","wait","remote-server-timeout"),ERR_RESOURCE_CONSTRAINT=STANZA_ERROR("500","wait","resource-constraint"),ERR_SERVICE_UNAVAILABLE=STANZA_ERROR("503","cancel","service-unavailable"),ERR_SUBSCRIPTION_REQUIRED=STANZA_ERROR("407","auth","subscription-required"),ERR_UNEXPECTED_REQUEST=STANZA_ERROR("400","wait","unexpected-request");JSJaCCookie.read=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return new JSJaCCookie(t,JSJaCCookie._unescape(r.substring(e.length,r.length)))}throw new JSJaCCookieException("Cookie not found")},JSJaCCookie.get=function(t){return JSJaCCookie.read(t).getValue()},JSJaCCookie.remove=function(t){JSJaCCookie.read(t).erase()},JSJaCCookie._escape=function(t){return t.replace(/;/g,"%3AB")},JSJaCCookie._unescape=function(t){return t.replace(/%3AB/g,";")},JSJaCDebugger.prototype.log=function(t,e){},JSJaCHttpBindingConnection.prototype=new JSJaCConnection,JSJaCHttpBindingConnection.prototype.inherit=function(t){if(t.jid){var e=new JSJaCJID(t.jid);this.domain=e.getDomain(),this.username=e.getNode(),this.resource=e.getResource()}else this.domain=t.domain||"localhost",this.username=t.username,this.resource=t.resource;this._sid=t.sid,this._rid=t.rid,this._min_polling=t.polling,this._inactivity=t.inactivity,this._setHold(t.requests-1),this.setPollInterval(this._timerval),t.wait&&(this._wait=t.wait),this._connected=!0,this._handleEvent("onconnect"),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())},JSJaCHttpBindingConnection.prototype.setPollInterval=function(t){return t&&!isNaN(t)&&(this.isPolling()?this._min_polling&&t<1e3*this._min_polling?this._timerval=1e3*this._min_polling:this._inactivity&&t>1e3*this._inactivity?this._timerval=1e3*this._inactivity:this._timerval=t:this._timerval=100),this._timerval},JSJaCHttpBindingConnection.prototype.isPolling=function(){return 0===this._hold},JSJaCHttpBindingConnection.prototype._getFreeSlot=function(){for(var t=0;t<this._hold+1;t++)if(void 0===this._req[t]||void 0===this._req[t].r||4==this._req[t].r.readyState)return t;return-1},JSJaCHttpBindingConnection.prototype._getHold=function(){return this._hold},JSJaCHttpBindingConnection.prototype._getRequestPacket=function(t,e){var n;if(this._rid<this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid];else{this._pQueue.length&&(n=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)),this._last_requests[this._rid]={},this._last_requests[this._rid]=n,this._last_rid=this._rid;for(var i in this._last_requests)this._last_requests.hasOwnProperty(i)&&i<this._rid-this._hold&&delete this._last_requests[i]}return n},JSJaCHttpBindingConnection.prototype._getRequestString=function(t,e){t=t||"";var n="";if(this._rid<=this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid].xml;else{for(var i="";this._pQueue.length;){i+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}n="<body rid='"+this._rid+"' sid='"+this._sid+"' xmlns='http://jabber.org/protocol/httpbind'",JSJAC_HAVEKEYS&&(n+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),n+=" newkey='"+this._keys.getKey()+"'")),e?n+=" type='terminate'":this._reinit&&(JSJACHBC_USE_BOSH_VER&&(n+=" xml:lang='"+this._xmllang+"' xmpp:restart='true' xmlns:xmpp='urn:xmpp:xbosh' to='"+this.domain+"'"),this._reinit=!1),n+=""!==i||""!==t?">"+t+i+"</body>":"/>",this._last_requests[this._rid]={},this._last_requests[this._rid].xml=n,this._last_rid=this._rid;for(var r in this._last_requests)this._last_requests.hasOwnProperty(r)&&r<this._rid-this._hold&&delete this._last_requests[r]}return n},JSJaCHttpBindingConnection.prototype._getInitialRequestString=function(){var t="<body content='text/xml; charset=utf-8' hold='"+this._hold+"' xmlns='http://jabber.org/protocol/httpbind' to='"+this.authhost+"' wait='"+this._wait+"' rid='"+this._rid+"'";if(this.host&&this.port&&(t+=" route='xmpp:"+this.host+":"+this.port+"'"),JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(hex_sha1,this.oDbg);t+=" newkey='"+this._keys.getKey()+"'"}return t+=" xml:lang='"+this._xmllang+"'",JSJACHBC_USE_BOSH_VER&&(t+=" ver='"+JSJACHBC_BOSH_VERSION+"'",t+=" xmlns:xmpp='urn:xmpp:xbosh'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(t+=" xmpp:version='1.0'")),t+="/>"},JSJaCHttpBindingConnection.prototype._getStreamID=function(t){if(this.oDbg.log(t.responseText,4),!t.responseXML||!t.responseXML.documentElement)return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));var e=t.responseXML.documentElement;return"terminate"==e.getAttribute("type")?void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")):(e.getAttribute("authid")&&(this.streamid=e.getAttribute("authid"),this.oDbg.log("got streamid: "+this.streamid,2)),this._parseStreamFeatures(e)?(this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval()),void(this.register?this._doInBandReg():this._doAuth())):void this._sendEmpty(JSJaC.bind(this._getStreamID,this)))},JSJaCHttpBindingConnection.prototype._getSuspendVars=function(){return"host,port,_rid,_last_rid,_wait,_min_polling,_inactivity,_hold,_last_requests,_pause".split(",")},JSJaCHttpBindingConnection.prototype._handleInitialResponse=function(t){try{this.oDbg.log(t.getAllResponseHeaders(),4),this.oDbg.log(t.responseText,4)}catch(t){this.oDbg.log("No response",4)}if(200!=t.status||!t.responseXML)return this.oDbg.log("initial response broken (status: "+t.status+")",1),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));var e=t.responseXML.documentElement;return e&&"body"==e.tagName&&e.namespaceURI==NS_BOSH?"terminate"==e.getAttribute("type")?(this.oDbg.log("invalid response:\n"+t.responseText,1),clearTimeout(this._timeout),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))):(this._sid=e.getAttribute("sid"),this.oDbg.log("got sid: "+this._sid,2),e.getAttribute("polling")&&(this._min_polling=e.getAttribute("polling")),e.getAttribute("inactivity")&&(this._inactivity=e.getAttribute("inactivity")),e.getAttribute("requests")&&this._setHold(e.getAttribute("requests")-1),this.oDbg.log("set hold to "+this._getHold(),2),e.getAttribute("ver")&&(this._bosh_version=e.getAttribute("ver")),e.getAttribute("maxpause")&&(this._pause=Number.min(e.getAttribute("maxpause"),JSJACHBC_MAXPAUSE)),this.setPollInterval(this._timerval),this._connected=!0,this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),void this._getStreamID(t)):(this.oDbg.log("no body element or incorrect body in initial response",1),void this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error")))},JSJaCHttpBindingConnection.prototype._parseResponse=function(t){if(!this.connected()||!t)return null;var e=t.r;try{if(404==e.status||403==e.status)return this._abort(),null;if(200!=e.status||!e.responseText&&""!=e.responseText){this._errcnt++;var n="invalid response ("+e.status+"):\n"+e.getAllResponseHeaders()+"\n"+e.responseText;return e.responseXML||(n+="\nResponse failed to parse!"),(this.oDbg.log(n,1),this._errcnt>JSJAC_ERR_COUNT)?(this._abort(),null):(this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null)}}catch(t){return this.oDbg.log("XMLHttpRequest error: status not available",1),this._errcnt++,this._errcnt>JSJAC_ERR_COUNT?this._abort():this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null}for(var i="<"==e.responseText[0]?e.responseText:b64decode(e.responseText),r=[],o=0,s=i.length;o<PACKET_HEADER_SIZE&&PACKET_HEADER_SIZE<=s;o++)r[o]=i.charCodeAt(o);var a=new Uint8Array(r),u=a.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),c=OPCODE_MAP.RECV.get(this._bytesToInteger(u)),l=i.slice(PACKET_HEADER_SIZE);if(void 0!==t.rid&&this._last_requests[t.rid]){if(this._last_requests[t.rid].handled)return this.oDbg.log("already handled "+t.rid,2),null;this._last_requests[t.rid].handled=!0}return this._errcnt=0,c?{event:c,body:l?JSON.parse(0==l.indexOf("{")?l:"{"+l):null}:null},JSJaCHttpBindingConnection.prototype._reInitStream=function(t){this._reinit=!0,this._sendEmpty(this._prepReInitStreamWait(t))},JSJaCHttpBindingConnection.prototype._prepReInitStreamWait=function(t){return JSJaC.bind(function(e){this._reInitStreamWait(e,t)},this)},JSJaCHttpBindingConnection.prototype._reInitStreamWait=function(t,e){this.oDbg.log("checking for stream features");var n,i,r=t.responseXML.documentElement;if(this.oDbg.log(r),r.getElementsByTagNameNS)this.oDbg.log("checking with namespace"),(n=r.getElementsByTagNameNS(NS_STREAM,"features").item(0))&&(i=n.getElementsByTagNameNS(NS_BIND,"bind").item(0));else{var o,s,a=r.getElementsByTagName("stream:features");for(o=0,s=a.length;o<s;o++)if(a.item(o).namespaceURI==NS_STREAM||a.item(o).getAttribute("xmlns")==NS_STREAM){n=a.item(o);break}if(n)for(i=n.getElementsByTagName("bind"),o=0,s=i.length;o<s;o++)if(i.item(o).namespaceURI==NS_BIND||i.item(o).getAttribute("xmlns")==NS_BIND){i=i.item(o);break}}this.oDbg.log(n),this.oDbg.log(i),n?i?e():(this.oDbg.log("no bind feature - giving up",1),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this._sendEmpty(this._prepReInitStreamWait(e))},JSJaCHttpBindingConnection.prototype._repeat=function(){this._rid>=this._last_rid&&(this._rid=this._last_rid-1),this._process()},JSJaCHttpBindingConnection.prototype._resume=function(){0===this._pause?this._repeat():this._process()},JSJaCHttpBindingConnection.prototype._setHold=function(t){return!t||isNaN(t)||t<0?t=0:t>JSJACHBC_MAX_HOLD&&(t=JSJACHBC_MAX_HOLD),this._hold=t,this._hold},JSJaCHttpBindingConnection.prototype._setupJumpRequest=function(t){
var e={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase+"?rid="+this._rid+"&sid="+this._sid+"&useBase64=1",t),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(t){this.oDbg.log(t,1)}return e.r=n,e.rid=this._rid,e},JSJaCHttpBindingConnection.prototype._setupRequest=function(t){var e={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase,t),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(t){this.oDbg.log(t,1)}return e.r=n,e.rid=this._rid,e},JSJaCHttpBindingConnection.prototype._suspend=function(){if(0!==this._pause){var t=this._getFreeSlot();this._req[t]=this._setupRequest(!1);var e="<body pause='"+this._pause+"' xmlns='http://jabber.org/protocol/httpbind' sid='"+this._sid+"' rid='"+this._rid+"'";for(JSJAC_HAVEKEYS&&(e+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),e+=" newkey='"+this._keys.getKey()+"'")),e+=">";this._pQueue.length;){e+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}e+="</body>",this.oDbg.log("Disconnecting: "+e,4),this._req[t].r.send(e)}},JSJaCHttpPollingConnection.prototype=new JSJaCConnection,JSJaCHttpPollingConnection.prototype.isPolling=function(){return!0},JSJaCHttpPollingConnection.prototype._getFreeSlot=function(){return void 0===this._req[0]||void 0===this._req[0].r||4==this._req[0].r.readyState?0:-1},JSJaCHttpPollingConnection.prototype._getInitialRequestString=function(){var t="0";if(JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(b64_sha1,this.oDbg);t+=";"+this._keys.getKey()}var e=this.domain;return this.authhost&&(e=this.authhost),t+=",<stream:stream to='"+e+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(t+=" version='1.0'"),t+=">"},JSJaCHttpPollingConnection.prototype._getRequestString=function(t,e){var n=this._sid;for(JSJAC_HAVEKEYS&&(n+=";"+this._keys.getKey(),this._keys.lastKey()&&(this._keys=new JSJaCKeys(b64_sha1,this.oDbg),n+=";"+this._keys.getKey())),n+=",",t&&(n+=t);this._pQueue.length;)n+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length);return e&&(n+="</stream:stream>"),n},JSJaCHttpPollingConnection.prototype._getStreamID=function(){if(""===this._req[0].r.responseText)return this.oDbg.log("waiting for stream id",2),void(this._timeout=setTimeout(JSJaC.bind(this._sendEmpty,this),1e3));this.oDbg.log(this._req[0].r.responseText,4),this._req[0].r.responseText.match(/id=[\'\"]([^\'\"]+)[\'\"]/)&&(this.streamid=RegExp.$1),this.oDbg.log("got streamid: "+this.streamid,2);var t;try{var e=this._req[0].r.responseText;if(e.match(/<\/stream:stream>\s*$/)||(e+="</stream:stream>"),t=XmlDocument.create("doc"),t.loadXML(e),!this._parseStreamFeatures(t))return void(this.authtype="nonsasl")}catch(t){this.oDbg.log("loadXML: "+t.toString(),1)}this._connected=!0,this.register?this._doInBandReg():this._doAuth(),this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._getSuspendVars=function(){return[]},JSJaCHttpPollingConnection.prototype._handleInitialResponse=function(){this.oDbg.log(this._req[0].r.getAllResponseHeaders(),4);var t=this._req[0].r.getResponseHeader("Set-Cookie");t=t.split(";");for(var e=0;e<t.length;e++){var n=t[e].split("=");"ID"==n[0]&&(this._sid=n[1])}this.oDbg.log("got sid: "+this._sid,2),this._connected=!0,this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._getStreamID()},JSJaCHttpPollingConnection.prototype._parseResponse=function(t){var e=t.r;if(!this.connected())return null;if(200!=e.status)return this.oDbg.log("invalid response ("+e.status+"):"+e.responseText+"\n"+e.getAllResponseHeaders(),1),this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),null;this.oDbg.log(e.getAllResponseHeaders(),4);var n,i=e.getResponseHeader("Set-Cookie");if(null===i)n="-1:0";else{i=i.split(";");for(var r=0;r<i.length;r++){var o=i[r].split("=");"ID"==o[0]&&(n=o[1])}}if(void 0!==n&&-1!=n.indexOf(":0")){switch(n.substring(0,n.indexOf(":0"))){case"0":this.oDbg.log("invalid response:"+e.responseText,1);break;case"-1":this.oDbg.log("Internal Server Error",1);break;case"-2":this.oDbg.log("Bad Request",1);break;case"-3":this.oDbg.log("Key Sequence Error",1)}return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("500","wait","internal-server-error")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}if(!e.responseText)return null;try{var s=e.responseText.replace(/<\?xml.+\?>/,"");s.match(/<stream:stream/)&&(s+="</stream:stream>");var a=JSJaCHttpPollingConnection._parseTree("<body>"+s+"</body>");return a&&"parsererror"!=a.tagName?a:(this.oDbg.log("parsererror",1),a=JSJaCHttpPollingConnection._parseTree("<stream:stream xmlns:stream='http://etherx.jabber.org/streams'>"+e.responseText),a&&"parsererror"!=a.tagName?(this.oDbg.log("stream closed",1),a.getElementsByTagName("conflict").length>0&&this._setStatus("session-terminate-conflict"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this.oDbg.log("parsererror:"+a,1),a)}catch(t){this.oDbg.log("parse error:"+t.message,1)}return null},JSJaCHttpPollingConnection.prototype._reInitStream=function(t){var e=this.authhost?this.authhost:this.domain;this._sendRaw("<stream:stream xmlns:stream='http://etherx.jabber.org/streams' xmlns='jabber:client' to='"+e+"' version='1.0'>",t)},JSJaCHttpPollingConnection.prototype._repeat=function(){this._resume()},JSJaCHttpPollingConnection.prototype._resume=function(){this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._setupRequest=function(t){var e=XmlHttp.create();try{e.open("POST",this._httpbase,t),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(t){this.oDbg.log(t,1)}var n={};return n.r=e,n},JSJaCHttpPollingConnection.prototype._suspend=function(){},JSJaCHttpPollingConnection._parseTree=function(t){try{var e=XmlDocument.create("body","foo");if(void 0!==e.loadXML)return e.loadXML(t),e.documentElement;if(window.DOMParser)return(new DOMParser).parseFromString(t,"text/xml").documentElement}catch(t){}return null};var JSJACJID_FORBIDDEN=['"'," ","&","'","/",":","<",">","@"];JSJaCJID.prototype.getBareJID=function(){return this.getNode()+"@"+this.getDomain()},JSJaCJID.prototype.getNode=function(){return this._node},JSJaCJID.prototype.getDomain=function(){return this._domain},JSJaCJID.prototype.getResource=function(){return this._resource},JSJaCJID.prototype.setNode=function(t){return JSJaCJID._checkNodeName(t),this._node=t||"",this},JSJaCJID.prototype.setDomain=function(t){if(!t||""===t)throw new JSJaCJIDInvalidException("domain name missing");return JSJaCJID._checkNodeName(t),this._domain=t,this},JSJaCJID.prototype.setResource=function(t){return this._resource=t||"",this},JSJaCJID.prototype.toString=function(){var t="";return this.getNode()&&""!==this.getNode()&&(t=this.getNode()+"@"),t+=this.getDomain(),this.getResource()&&""!==this.getResource()&&(t+="/"+this.getResource()),t},JSJaCJID.prototype.removeResource=function(){return this.setResource()},JSJaCJID.prototype.clone=function(){return new JSJaCJID(this.toString())},JSJaCJID.prototype.isEntity=function(t){return t="string"==typeof t?new JSJaCJID(t):t.clone(),t.removeResource(),this.clone().removeResource().toString()===t.toString()},JSJaCJID._checkNodeName=function(t){if(t&&""!==t)for(var e=0;e<JSJACJID_FORBIDDEN.length;e++)if(-1!=t.indexOf(JSJACJID_FORBIDDEN[e]))throw new JSJaCJIDInvalidException("forbidden char in nodename: "+JSJACJID_FORBIDDEN[e])},JSJaCJSON.toString=function(t){var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n={array:function(t){var e,i,r,o,s=["["],a=t.length;for(r=0;r<a;r+=1)if(o=t[r],i=n[typeof o])try{o=i(o),"string"==typeof o&&(e&&(s[s.length]=","),s[s.length]=o,e=!0)}catch(t){}return s[s.length]="]",s.join("")},boolean:function(t){return String(t)},null:function(){return"null"},number:function(t){return isFinite(t)?String(t):"null"},object:function(t){if(t){if(t instanceof Array)return n.array(t);var e,i,r,o,s=[];s.push("{");for(r in t)if(t.hasOwnProperty(r)&&(o=t[r],i=n[typeof o]))try{o=i(o),"string"==typeof o&&(e&&(s[s.length]=","),s.push(n.string(r),":",o),e=!0)}catch(t){}return s[s.length]="}",s.join("")}return"null"},string:function(t){return/["\\\x00-\x1f]/.test(t)&&(t=t.replace(/([\x00-\x1f\\"])/g,function(t,n){var i=e[n];return i||(i=n.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})),'"'+t+'"'}};switch(typeof t){case"object":return n.object(t);case"array":return n.array(t)}},JSJaCJSON.parse=function(str){try{return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+str+")")}catch(t){return!1}};var JSJACPACKET_USE_XMLNS=!0;JSJaCPacket.prototype.pType=function(){return this.name},JSJaCPacket.prototype.getDoc=function(){return this.doc},JSJaCPacket.prototype.getNode=function(){return this.getDoc()&&this.getDoc().documentElement?this.getDoc().documentElement:null},JSJaCPacket.prototype.setTo=function(t){return t?"string"==typeof t?this.getNode().setAttribute("to",t):this.getNode().setAttribute("to",t.toString()):this.getNode().removeAttribute("to"),this},JSJaCPacket.prototype.setFrom=function(t){return t?"string"==typeof t?this.getNode().setAttribute("from",t):this.getNode().setAttribute("from",t.toString()):this.getNode().removeAttribute("from"),this},JSJaCPacket.prototype.setID=function(t){return t?this.getNode().setAttribute("id",t):this.getNode().removeAttribute("id"),this},JSJaCPacket.prototype.setType=function(t){return t?this.getNode().setAttribute("type",t):this.getNode().removeAttribute("type"),this},JSJaCPacket.prototype.setXMLLang=function(t){return t?this.getNode().setAttribute("xml:lang",t):this.getNode().removeAttribute("xml:lang"),this},JSJaCPacket.prototype.getTo=function(){return this.getNode().getAttribute("to")},JSJaCPacket.prototype.getFrom=function(){return this.getNode().getAttribute("from")},JSJaCPacket.prototype.getToJID=function(){return new JSJaCJID(this.getTo())},JSJaCPacket.prototype.getFromJID=function(){return new JSJaCJID(this.getFrom())},JSJaCPacket.prototype.getID=function(){return this.getNode().getAttribute("id")},JSJaCPacket.prototype.getType=function(){return this.getNode().getAttribute("type")},JSJaCPacket.prototype.getXMLLang=function(){return this.getNode().getAttribute("xml:lang")},JSJaCPacket.prototype.getXMLNS=function(){return this.getNode().namespaceURI||this.getNode().getAttribute("xmlns")},JSJaCPacket.prototype.getChild=function(t,e){if(!this.getNode())return null;if(t=t||"*",e=e||"*",this.getNode().getElementsByTagNameNS)return this.getNode().getElementsByTagNameNS(e,t).item(0);var n=this.getNode().getElementsByTagName(t);if("*"==e)return n.item(0);for(var i=0;i<n.length;i++)if(n.item(i).namespaceURI==e||n.item(i).getAttribute("xmlns")==e)return n.item(i);return null},JSJaCPacket.prototype.getChildVal=function(t,e){var n=this.getChild(t,e),i="";if(n&&n.hasChildNodes())for(var r=0;r<n.childNodes.length;r++)n.childNodes.item(r).nodeValue&&(i+=n.childNodes.item(r).nodeValue);return i},JSJaCPacket.prototype.clone=function(){return JSJaCPacket.wrapNode(this.getNode())},JSJaCPacket.prototype.isError=function(){return"error"==this.getType()},JSJaCPacket.prototype.errorReply=function(t){var e=this.clone();return e.setTo(this.getFrom()),e.setFrom(),e.setType("error"),e.appendNode("error",{code:t.code,type:t.type},[[t.cond,{xmlns:NS_STANZAS}]]),e},JSJaCPacket.prototype.xml="undefined"!=typeof XMLSerializer?function(){var t=(new XMLSerializer).serializeToString(this.getNode());return void 0===t&&(t=(new XMLSerializer).serializeToString(this.doc)),t}:function(){return this.getDoc().xml},JSJaCPacket.prototype._getAttribute=function(t){return this.getNode().getAttribute(t)},document.ELEMENT_NODE||(document.ELEMENT_NODE=1,document.ATTRIBUTE_NODE=2,document.TEXT_NODE=3,document.CDATA_SECTION_NODE=4,document.ENTITY_REFERENCE_NODE=5,document.ENTITY_NODE=6,document.PROCESSING_INSTRUCTION_NODE=7,document.COMMENT_NODE=8,document.DOCUMENT_NODE=9,document.DOCUMENT_TYPE_NODE=10,document.DOCUMENT_FRAGMENT_NODE=11,document.NOTATION_NODE=12),JSJaCPacket.prototype._importNode=function(t,e){switch(t.nodeType){case document.ELEMENT_NODE:var n;n=this.getDoc().createElementNS?this.getDoc().createElementNS(t.namespaceURI,t.nodeName):this.getDoc().createElement(t.nodeName);var i,r;if(t.attributes&&t.attributes.length>0)for(i=0,r=t.attributes.length;i<r;i++){var o=t.attributes.item(i);("xmlns"!=o.nodeName||null===n.getAttribute("xmlns")&&!n.namespaceURI)&&(n.setAttributeNS&&o.namespaceURI?n.setAttributeNS(o.namespaceURI,o.name,o.value):n.setAttribute(o.name,o.value))}if(e&&t.childNodes&&t.childNodes.length>0)for(i=0,r=t.childNodes.length;i<r;i++)n.appendChild(this._importNode(t.childNodes.item(i),e));return n;case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return this.getDoc().createTextNode(t.nodeValue)}},JSJaCPacket.prototype._setChildNode=function(t,e){var n=this.getChild(t),i=this.getDoc().createTextNode(e);if(n)try{n.replaceChild(i,n.firstChild)}catch(t){}else{try{n=this.getDoc().createElementNS(this.getNode().namespaceURI,t)}catch(e){n=this.getDoc().createElement(t)}this.getNode().appendChild(n),n.appendChild(i)}return n},JSJaCPacket.prototype.buildNode=function(t){return JSJaCBuilder.buildNode(this.getDoc(),t,arguments[1],arguments[2],arguments[3])},JSJaCPacket.prototype.appendNode=function(t){return"object"==typeof t?this.getNode().appendChild(t):this.getNode().appendChild(this.buildNode(t,arguments[1],arguments[2],this.getNode().namespaceURI)),this},JSJaCPresence.prototype=new JSJaCPacket,JSJaCPresence.prototype.setStatus=function(t){return this._setChildNode("status",t),this},JSJaCPresence.prototype.setShow=function(t){return"chat"!=t&&"away"!=t&&"xa"!=t&&"dnd"!=t&&"unavailable"!=t||this._setChildNode("show",t),this},JSJaCPresence.prototype.setPriority=function(t){return this._setChildNode("priority",t),this},JSJaCPresence.prototype.setPresence=function(t,e,n){return t&&this.setShow(t),e&&this.setStatus(e),n&&this.setPriority(n),this},JSJaCPresence.prototype.getStatus=function(){return this.getChildVal("status")},JSJaCPresence.prototype.getShow=function(){return this.getChildVal("show")},JSJaCPresence.prototype.getPriority=function(){return this.getChildVal("priority")},JSJaCIQ.prototype=new JSJaCPacket,JSJaCIQ.prototype.setIQ=function(t,e,n){return t&&this.setTo(t),e&&this.setType(e),n&&this.setID(n),this},JSJaCIQ.prototype.setQuery=function(t){var e;try{e=this.getDoc().createElementNS(t,"query")}catch(n){e=this.getDoc().createElement("query"),e.setAttribute("xmlns",t)}return this.getNode().appendChild(e),e},JSJaCIQ.prototype.getQuery=function(){return this.getNode().getElementsByTagName("query").item(0)},JSJaCIQ.prototype.getQueryXMLNS=function(){return this.getQuery()?this.getQuery().namespaceURI||this.getQuery().getAttribute("xmlns"):null},JSJaCIQ.prototype.reply=function(t){var e=this.clone();if(e.setTo(this.getFrom()),e.setFrom(),e.setType("result"),t)if("string"==typeof t)e.getChild().appendChild(e.getDoc().loadXML(t));else if(t.constructor==Array)for(var n=e.getChild(),i=0;i<t.length;i++)"string"==typeof t[i]?n.appendChild(e.getDoc().loadXML(t[i])):"object"==typeof t[i]&&n.appendChild(t[i]);else"object"==typeof t&&e.getChild().appendChild(t);return e},JSJaCMessage.prototype=new JSJaCPacket,JSJaCMessage.prototype.setBody=function(t){return this._setChildNode("body",t),this},JSJaCMessage.prototype.setSubject=function(t){return this._setChildNode("subject",t),this},JSJaCMessage.prototype.setThread=function(t){return this._setChildNode("thread",t),this},JSJaCMessage.prototype.getThread=function(){return this.getChildVal("thread")},JSJaCMessage.prototype.getBody=function(){return this.getChildVal("body")},JSJaCMessage.prototype.getSubject=function(){return this.getChildVal("subject")},JSJaCPacket.wrapNode=function(t){var e=null;switch(t.nodeName.toLowerCase()){case"presence":e=new JSJaCPresence;break;case"message":e=new JSJaCMessage;break;case"iq":e=new JSJaCIQ}return e&&(e.getDoc().replaceChild(e._importNode(t,!0),e.getNode()),null==e.getDoc().xml&&null!=t&&null!=t.xml&&(e.getDoc().xml=t.xml)),e};var JSJaCUtils={xor:function(t,e){if(!t)return e;if(!e)return t;for(var n="",i=0;i<t.length;i++)n+=String.fromCharCode(t.charCodeAt(i)^e.charCodeAt(i));return n},cnonce:function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",i=0;i<t;i++)n+=e.charAt(Math.round(Math.random((new Date).getTime())*(e.length-1)));return n},now:function(){return Date.now&&"function"==typeof Date.now?Date.now():(new Date).getTime()}};JSJaCWebSocketConnection.prototype=new JSJaCConnection,JSJaCWebSocketConnection.prototype._cleanupWebSocket=function(){null!==this._ws&&(this._ws.onclose=null,this._ws.onerror=null,this._ws.onopen=null,this._ws.onmessage=null,this._ws.close(),this._ws=null)},JSJaCWebSocketConnection.prototype.connect=function(t){if(this._cleanupWebSocket(),this._setStatus("connecting"),t.appType&&(this.appType=t.appType),t.clientIdentify&&(this.clientIdentify=t.clientIdentify),this.domain=t.domain||"localhost",this.username=t.username,this.resource=t.resource,this.pass=t.password||t.pass,this.authzid=t.authzid||"",this.register=t.register,this.authhost=t.authhost||this.domain,this.authtype=t.authtype||"sasl",this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,t.allow_plain?this._allow_plain=t.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,t.allow_scram?this._allow_scram=t.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,t.xmllang&&""!==t.xmllang?this._xmllang=t.xmllang:this._xmllang="en","undefined"==typeof WebSocket)return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this._ws=new WebSocket(this._httpbase,"xmpp"),this._ws.onclose=JSJaC.bind(this._onclose,this),this._ws.onerror=JSJaC.bind(this._onerror,this),this._ws.onopen=JSJaC.bind(this._onopen,this)},JSJaCWebSocketConnection.prototype._onopen=function(){var t={usr:this.username,atk:this.pass,br:this.resource};this.appType&&(t.appType=this.appType),this.clientIdentify&&(t.clientIdentify=this.clientIdentify),this._buildAndSend(new JumpPacket(t,OPCODE.AUTH.SEND)),this._ws.onmessage=JSJaC.bind(this._onAuthMessage,this)},JSJaCWebSocketConnection.prototype._onAuthMessage=function(t){var e=this;if(t.data instanceof Blob){var n=t.data,i=new FileReader;i.onload=function(t){if(t.target.readyState==FileReader.DONE){var n=new Uint8Array(t.target.result),i=e._bytesToInteger(n.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),r=n.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),o=n.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+i);if(e._bytesToInteger(r)==OPCODE.AUTH.RECV){var s=JSON.parse(e._uint8ArrayToString(o));if(YYIMChat.log("recv\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(s),3),200!=s.code)return void e._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"});e._handleEvent("packet_in",s),e._handleEvent(OPCODE.AUTH.KEY,s),e._connected=!0,e._handleEvent("onconnect"),e._ws.onmessage=JSJaC.bind(e._onJumpMessage,e)}else if(e._bytesToInteger(r)==OPCODE.STREAM_ERROR.RECV){var s=JSON.parse(e._uint8ArrayToString(o));if(YYIMChat.log("recv\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(s),3),200!=s.code)return void e._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"})}}},i.readAsArrayBuffer(n)}},JSJaCWebSocketConnection.prototype.sendJumpPacket=function(t,e,n){if(!this.connected())return!1;if(!t||!t.opcode)return!1;if(e&&this._validateCallbackable(t)){if(!t.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");t.content.id||(t.content.id=this._IDPrefix+this._ID++),this._registerPID(t,e,n)}t instanceof JumpPacket&&YYIMChat.log("send\t "+OPCODE_MAP.SEND.get(t.opcode)+"\n\t"+JSON.stringify(t),3,new Date);try{this._handleEvent("packet_out",t)}catch(t){return this.oDbg.log(t.toString(),1),!1}return this._buildAndSend(t),!0},JSJaCWebSocketConnection.prototype._buildAndSend=function(t){var e=null,n="Undefined"==Object.prototype.toString.call(t.content).slice(8,-1)||"Null"==Object.prototype.toString.call(t.content).slice(8,-1),i=new Blob([n?"":JSON.stringify(t.content)],{type:"text/json"}),r=new FileReader,o=this;r.onload=function(i){if(i.target.readyState==FileReader.DONE){e=this.result;var r=new Uint8Array(PACKET_HEADER_SIZE);r.set(o._numToBytes(t.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),r.set(o._numToBytes(t.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),n?r.set(o._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):r.set(o._numToBytes(e.byteLength,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),r.set(o._numToBytes(t.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),r.set(o._numToBytes(t.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START);var s;s=n?r:o._concatUint8Array(r,new Uint8Array(e)),o._ws.send(s)}},r.readAsArrayBuffer(i)},JSJaCWebSocketConnection.prototype._handleOpenStream=function(t){var e,n;if(this.oDbg.log(t.data,4),e=t.data,e=e.substr(e.indexOf("<stream:stream")),"/>"!==e.substr(-2)&&"</stream:stream>"!==e.substr(-16)&&(e+="</stream:stream>"),!(n=this._parseXml(e)))return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this.streamid=n.getAttribute("id"),this.oDbg.log("got streamid: "+this.streamid,2),this._ws.onmessage=JSJaC.bind(this._handleInitialResponse,this)},JSJaCWebSocketConnection.prototype._handleInitialResponse=function(t){var e=this._parseXml(t.data);if(!this._parseStreamFeatures(e))return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this._connected=!0,this.register?this._doInBandReg():this._doAuth()},JSJaCWebSocketConnection.prototype.disconnect=function(){this._setStatus("disconnecting"),this.connected()&&(this._connected=!1,this.oDbg.log("Disconnecting",4),this._cleanupWebSocket(),this.oDbg.log("Disconnected",2),this._handleEvent("ondisconnect"))},JSJaCWebSocketConnection.prototype._onclose=function(){this.oDbg.log("websocket closed",2),"disconnecting"!==this._status&&(this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")))},JSJaCWebSocketConnection.prototype._onerror=function(){this.oDbg.log("websocket error",1),this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype._onJumpMessage=function(t){var e=this;if(t.data instanceof Blob){var n=t.data,i=new FileReader;i.onload=function(t){if(t.target.readyState==FileReader.DONE){var n=new Uint8Array(t.target.result),i=e._bytesToInteger(n.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),r=n.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),o=n.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+i);e._parseUint8Array(r,o)}},i.readAsArrayBuffer(n)}},JSJaCWebSocketConnection.prototype._onmessage=function(t){var e,n,i;if(e=t.data,!0===this._connected&&this._setStatus("processing"),e&&""!==e){if(n=this._parseXml(e),n.namespaceURI===NS_STREAM&&"error"===n.localName)return n.getElementsByTagNameNS(NS_STREAMS,"conflict").length>0&&this._setStatus("session-terminate-conflict"),this._connected=!1,void this._handleEvent("onerror",JSJaCError("503","cancel","remote-stream-error"));i=JSJaCPacket.wrapNode(n),i&&(this.oDbg.log("async recv: "+t.data,4),this._handleEvent("packet_in",i),i.pType&&!this._handlePID(i)&&(this._handleEvent(i.pType()+"_in",i),this._handleEvent(i.pType(),i)))}},JSJaCWebSocketConnection.prototype._parseXml=function(t){var e;this.oDbg.log("Parsing: "+t,4);try{if(e=XmlDocument.create("stream",NS_STREAM),"</stream:stream>"==t.trim()){this.oDbg.log("session terminated",1),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto);try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(t){}return this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}return-1===t.indexOf("<stream:stream")?(e.loadXML("<stream:stream xmlns:stream='"+NS_STREAM+"' xmlns='jabber:client'>"+t+"</stream:stream>"),void 0===e.documentElement.firstChild.xml&&(e.documentElement.firstChild.xml=t),e.documentElement.firstChild):(e.loadXML(t),e.documentElement)}catch(t){this.oDbg.log("Error: "+t),this._connected=!1,this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error"))}return null},JSJaCWebSocketConnection.prototype._getInitialRequestString=function(){var t,e;return t=this.domain,this.authhost&&(t=this.authhost),e='<stream:stream to="'+t+'" xmlns="jabber:client" xmlns:stream="'+NS_STREAM+'"',"sasl"!==this.authtype&&"saslanon"!==this.authtype||(e+=' version="1.0"'),e+=">"},JSJaCWebSocketConnection.prototype.send=function(t,e,n){if(this._ws.onmessage=JSJaC.bind(this._onmessage,this),!t||!t.pType)return this.oDbg.log("no packet: "+t,1),!1;if(!this.connected())return!1;e&&(t.getID()||t.setID("JSJaCID_"+this._ID++),this._registerPID(t,e,n));try{this._handleEvent(t.pType()+"_out",t),this._handleEvent("packet_out",t),this._ws.send(t.xml())}catch(t){return this.oDbg.log(t.toString(),1),!1}return!0},JSJaCWebSocketConnection.prototype.resume=function(){return!1},JSJaCWebSocketConnection.prototype.suspend=function(){return!1},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S1=function(t){var e=this._parseXml(t.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S1,this)(e)},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S2=function(t){var e=this._parseXml(t.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S2,this)(e)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S1=function(t){var e=this._parseXml(t.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S1,this)(e)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S2=function(t){var e=this._parseXml(t.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S2,this)(e)},JSJaCWebSocketConnection.prototype._doSASLAuthDone=function(t){var e=this._parseXml(t.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDone,this)(e)},JSJaCWebSocketConnection.prototype._reInitStream=function(t){var e,n=this.domain;this.authhost&&(n=this.authhost),e='<stream:stream xmlns:stream="'+NS_STREAM+'" xmlns="jabber:client" to="'+n+'" version="1.0">',this._sendRaw(e,t)},JSJaCWebSocketConnection.prototype._sendRaw=function(t,e,n){return!!this._ws&&(e&&(this._ws.onmessage=JSJaC.bind(e,this,n)),this._ws.send(t),!0)},JSJaCWebSocketConnection.prototype._parseUint8Array=function(t,e){if(!0===this._connected&&this._setStatus("processing"),t&&e){var n=OPCODE_MAP.RECV.get(this._bytesToInteger(t));if(YYIMChat.log("recv\t"+OPCODE_MAP.RECV.get(this._bytesToInteger(t))+"\n\t"+this._uint8ArrayToString(e),3,new Date),0==e.byteLength)return this._handleEvent("packet_in"),void this._handleEvent(n);try{var i=JSON.parse(this._uint8ArrayToString(e));this._handlePID(i)||(this._handleEvent("packet_in",i),this._handleEvent(n,i))}catch(t){}}};var YYAIAbility=function(){function t(){this.dicts=[],this.stopKeyword={"":1},this.isOpenFilter=!1,this.isAIAbility=!0}return t.prototype.openAIAbility=function(t){this.isAIAbility=t},t.prototype.openFilterWords=function(t){this.isOpenFilter=t},t.prototype.setDictionaries=function(t){if(t)for(var e=0;e<t.length;e++)this.dicts.push(t[e])},t.prototype.intelligentAnalysis=function(t){if(!this.isOpenFilter)return!0;if(t&&this.isAIAbility){var e=new YYIMAITrie;e.init(this.dicts);return e.splitWords(t).length>0}return!1},new t}(),YYIMAITrie=function(){function t(){this.root=new YYIMAINode(null)}return t.prototype.toBytes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):e=e.concat(this.toUTF8(i))}return e},t.prototype.toUTF8=function(t){return[224|t>>12&15,128|t>>6&63,128|63&t]},t.prototype.toUTF16=function(t,e,n){return(255&(t<<4|e>>2&15))<<8|(3&e)<<6|63&n},t.prototype.add=function(t){for(var e=this.root,n=this.toBytes(t),i=n.length,r=0;r<i;r++){var o=n[r];o in e.childs||(e.childs[o]=new YYIMAINode(o)),e=e.childs[o]}e.asWord()},t.prototype.search=function(t){for(var e=this.root,n=t.length,i=[],r=[],o=0,s=0;s<n;s++){var a=t[s],u=e.childs;if(!(a in u))return i;if(a<128)r.push(String.fromCharCode(a));else if(++o%3==0){var c=t[s-2],l=t[s-1],h=a;r.push(String.fromCharCode(this.toUTF16(c,l,h)))}if(r.join("")in stop)return i;var d=u[a];d.isWord()&&(d.addCount(),i.push(r.join(""))),e=d}return i},t.prototype.splitWords=function(t){for(var e=this.toBytes(t),n=0,i=e.length-1,r=[];n!=i;){for(var o=[],s=n;s<=i;s++){var a=e[s];o.push(a);var u=this.search(o);!1!==u&&u.length>0&&(r=r.concat(u))}n++}return r},t.prototype.init=function(t){for(var e=0;e<t.length;e++)this.add(t[e])},t}(),YYIMAINode=function(){function t(t){this.childs={},this._byte=t||null,this._isWord=!1,this._count=0}return t.prototype.isWord=function(){return this._isWord&&0==this._count},t.prototype.asWord=function(){this._isWord=!0},t.prototype.addCount=function(){this._count++},t.prototype.getCount=function(){return this._count},t}(),YYIMChat=function(){function t(t){this.level=t||(0==t?0:3),this.start=function(){},this.log=function(t,e,n,i){if(a.LOG.ENABLE&&!((e=e||(0==e?0:3))>this.level)&&"undefined"!=typeof console&&void 0!==console.group)try{switch(console.group(t),e){case 0:console.error(t),console.trace();break;case 1:console.warn(t),console.trace();break;case 2:console.info(t);break;case 4:console.debug(t);break;default:console.log(t)}var r=arguments.length;if(r>2)for(var o=2;o<r;o++){var s=arguments[o];s&&(s instanceof JSJaCPacket?console.info(s.doc.xml):console.debug(s))}console.groupEnd()}catch(t){try{console.error(t)}catch(t){}}},this.logParam=function(t){t=t||3;var e=this.logParam.caller;this.log("arguments:",t,e.arguments)},this.setLevel=function(t){return this.level=t,this},this.getLevel=function(){return this.level}}function e(){this.lastPongTime=Date.now(),this.pingInterval,this.pingTimeout,this.interval=0}function n(){this._inited=!1}function i(){this.daemon=new e,this.eventHandler=new n,this.connection=this.getConnection(),this.connectArg,this.waitingList=[],this.sending=!1,this.lastSendTime=0}function r(t){this.url=t.url,this.data=t.data,this.sCallback=t.successCallback,this.eCallback=t.errorCallback,this.xhr=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}(),this.timeout=1e4,this.timeoutIndex,this.loop=!1}function o(){this._user,this._token={},this.appkey,this.connectStatus=c.INIT,this.offlineStatus=[c.ERROR,c.OFFLINE,c.CONFLICT,c.AUTHERROR,c.ONCLIENTKICKOUT,c.INIT,c.ONUPDATEPASSWORD],this.onlineStatus=[c.CONNECTED,c.PROCESSING],this.apiKey,this.init()}var s={};s.getBareJID=function(t){var e,n=o.getInstance().getUserBareJID();if(t){if(t instanceof JSJaCJID)return t.getBareJID()==n?t.toString():t.getBareJID();if("string"==typeof t)return e=new JSJaCJID(t),e.getBareJID()==n?e.toString():e.getBareJID();if(t.jid&&t.jid instanceof JSJaCJID)return e=t.jid,e.getBareJID()==n?e.toString():e.getBareJID()}throw new JSJaCJIDInvalidException("invalid jid: "+t)},
s.getID=function(t){var e,n,i,r;return r=YYIMCommonUtil.isStringAndNotEmpty(t)?(e=o.getInstance().getAppkey(),i=t.indexOf("@"),-1!=i?(n=t.substring(0,i),n.indexOf(e)>0?n.replace(e,""):n):t.indexOf(e)>0?t.replace(e,""):t):null,r?r.toString():r},s.getNode=function(t){if(t=t.toString(),YYIMCommonUtil.isStringAndNotEmpty(t)){var e=o.getInstance().getAppkey(),n=t;if(n.indexOf("@")>-1){if(0===n.indexOf("@"))throw'"'+t+'" Can\'t start with  "@"!';n=n.substring(0,n.indexOf("@"))}if(n.indexOf(".")>-1){if(0===n.indexOf("."))throw'"'+t+'" Can\'t start with "."!';n=n.substring(0,n.indexOf("."))}return n?n+e:n}throw'"'+t+"\" Can't be Number Or Empty!"},s.getResource=function(t){return YYIMCommonUtil.isStringAndNotEmpty(t)&&-1!=t.indexOf("/")?t.substring(t.indexOf("/")+1):null},s.buildUserJID=function(t,e){return YYIMCommonUtil.isStringAndNotEmpty(t)?-1!=t.indexOf("@")?t:t+"@"+a.YY_IM_DOMAIN+(e?"/"+e:""):null},s.getDomain=function(t){return YYIMCommonUtil.isStringAndNotEmpty(t)&&-1!=t.indexOf("@")?t.substring(t.indexOf("@")+1):null},s.buildChatGroupJID=function(t){return YYIMCommonUtil.isStringAndNotEmpty(t)?-1!=t.indexOf("@")?t:t+"@"+a.DOMAIN.CHATROOM:null},s.buildPubAccountJID=function(t){return YYIMCommonUtil.isStringAndNotEmpty(t)?-1!=t.indexOf("@")?t:t+"@"+a.DOMAIN.PUBACCOUNT:null},s.getChatTypeByJid=function(t){if(t)switch(s.getDomain(t)){case a.DOMAIN.CHATROOM:return g.GROUP_CHAT;case a.DOMAIN.PUBACCOUNT:return g.PUB_ACCOUNT;default:return g.CHAT}},jQuery.support.cors=!0;var a,u=function(){function t(t){t=t||{},l=t.clientMark||l,o=t.wsurl||o,s=t.wsport||s,u=t.hbport||u,c=t.servlet||c,h=t.todoServlet||h,n()&&(c=c.replace(/^https?:\/\//,location.protocol+"//")),(/https/.test(location.protocol)||!0===t.useHttps)&&(s=5225),a={YY_IM_DOMAIN:r,RESOURCE:l+"-v2.6",MULTI_TENANCY:{ENABLE:!0,ETP_KEY:t.etp||"etp",APP_KEY:t.app||"app",SEPARATOR:"."},SENDINTERVAL:30,GROUP:{MEMBERSLIMIT:5},BETCH_MAXLIMIT:{ROSTER:50,PUBACCOUNT:50},INPUT_STATE:{INTERVAL:2e3},UPLOAD:{AUTO_SEND:!0,MULTI_SELECTION:!1,PREVENT_DUPLICATES:!1,PREVIEW_SIZE:{WIDTH:100,HEIGHT:100},FLASH_SWF_URL:t.flash_swf_url||"./Moxie.swf",SILVERLIGHT_XAP_URL:t.silverlight_xap_url||"./Moxie.xap",MEDIATYPE:{IMAGE:1,FILE:2,DOC:3},IMAGE_TYPES:/\.(png|jpe?g|gif)$/i},TIMECORRECTION:{AUTOCORRECTION:!0,TIMES:3,RESIDUAL:50,RESULT:0,LOAD:!1},MULTIPARTYCALL:{ADDRESS:"http://dudu.yonyoutelecom.cn/httpIntf/createConference.do",ACCOUNT:"",KEY:"",PHONESMAXLENGTH:200},SERVLET:{REST_RESOURCE_SERVLET:c+"sysadmin/rest/resource/",REST_VERSION_SERVLET:c+"sysadmin/rest/version/",REST_USER_SERVLET:c+"sysadmin/rest/user/",REST_UPLOAD_SERVLET:c+"im_upload/rest/resource/",REST_DOWNLOAD_SERVLET:c+"im_download/rest/resource/",REST_TRANSFORM_SERVLET:c+"im_download/rest/transform/resource/",REST_SYSTEM_SERVLET:c+"sysadmin/rest/system/",REST_SYSTEM_CUSTOMER_USER:c+"sysadmin/rest/customer/user/",REST_TODO_USER:h+"todocenter/user/todo/"},SUPPORT:{isWebSocketSupport:function(){return window.WebSocket=window.WebSocket||window.MozWebSocket,!!window.WebSocket}()},CONNECTION:{TIMERVAL:2e3,WAIT:300,SECURE:!1,ALLOW_PLAIN:!0,ENABLE_WEBSOCKET:!0,ENABLE_LOCAL_CONNECTION:!0,USE_HTTPS:function(){return!(!/https/.test(location.protocol)&&!0!==t.useHttps)}(),SERVER_NAME:r,HTTP_BASE:o,HTTP_BIND_PORT:u,WS_PORT:s},PING:{INTERVAL:1e4,SLOW_INTERVAL:3e4,TIMEOUT:1e4},DOMAIN:{CHATROOM:"conference."+r,SEARCH:"search."+r,PUBACCOUNT:"pubaccount."+r},EXPIRATION:{INVALID:216e5,INSPECTION_INTERVAL:18e5},LOG:{ENABLE:!!t.logEnable,FILTER_LEVEL:3},BROWSER:e()},a.getHttpBindUrl=function(){return(this.CONNECTION.USE_HTTPS?"https://":"http://")+this.CONNECTION.HTTP_BASE+":"+this.CONNECTION.HTTP_BIND_PORT+"/http-bind/"},a.getWebSocketUrl=function(){return(this.CONNECTION.USE_HTTPS?"wss://":"ws://")+this.CONNECTION.HTTP_BASE+":"+this.CONNECTION.WS_PORT},a.useWebSocket=function(){return this.SUPPORT.isWebSocketSupport&&this.CONNECTION.ENABLE_WEBSOCKET},a.getConnectionArgObj=function(){return{domain:this.CONNECTION.SERVER_NAME,resource:this.RESOURCE,allow_plain:this.CONNECTION.ALLOW_PLAIN,secure:this.CONNECTION.SECURE,register:!1}},a.getLocationOrigin=function(){return location.origin?location.origin:location.protocol+"//"+location.host},a.getClientMark=i}function e(){var t=navigator.userAgent.toLowerCase();return{version:(t.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],webkit:/webkit/.test(t),opera:/opera/.test(t),msie:/msie/.test(t)&&!/opera/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit)/.test(t)}}function n(){var t=e();return!!(t.msie&&parseInt(t.version)<10)}function i(){return l}var r="im.yyuap.com",o="stellar.yyuap.com",s=5227,u=7075,c="http://im.yyuap.com/",l="web",h="https://pubaccount.yonyoucloud.com/";return{init:t}}();u.init();var c={INIT:"init",OFFLINE:"offline",CONNECTING:"connecting",PROCESSING:"processing",CONFLICT:"conflict",CONNECTED:"connected",ERROR:"error",AUTHERROR:"AuthError",ONCLIENTKICKOUT:"onClientKickout",ONUPDATEPASSWORD:"onUpdatePassword"},l={FAVORITE:"favorite",REMOVE:"remove",NONE:"none"},h={CHAT:"chat",AWAY:"away",XA:"xa",DND:"dnd",UNAVAILABLE:"unavailable"},d={SET:"set",RESULT:"result",GET:"get",SUBMIT:"submit",UNAVAILABLE:"unavailable"},p={SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",PROBE:"probe",UNAVAILABLE:"unavailable",COLLECT:"collect"},f={ADD:"add",REMOVE:"remove"},g={CHAT:"chat",GROUP_CHAT:"groupchat",PUB_ACCOUNT:"pubaccount"},m={TEXT:2,FILE:4,IMAGE:8,REDPACKET:9,SMALLVIDEO:10,REVOCATION:13,MERGEFORWARD:15,SINGLEGRAPHIC:16,MOREGRAPHIC:32,AUDO:64,LOCATION:128,SHARE:256,WHITEBOARD:1024};return e.prototype.startPing=function(t){!0===t&&(this.isOnline=t),i.getInstance().connected()?(this.interval=this.interval?a.PING.INTERVAL:a.PING.SLOW_INTERVAL,this.ping()):this.stopPing()},e.prototype.stopPing=function(t){!1===t&&(this.isOnline=t),clearTimeout(this.pingTimeout),clearTimeout(this.pingInterval)},e.prototype.ping=function(){var t=this;if(this.isOnline){if(!this.sending){this.stopPing(),this.interval=this.interval||a.PING.SLOW_INTERVAL;var e=Date.now()-(this.lastPongTime+this.interval);if(e>=0)try{this.sending=!0,this.interval=a.PING.SLOW_INTERVAL,i.getInstance().send(new JumpPacket(null,OPCODE.PING.SEND))}catch(e){t.stopPing(),o.getInstance().log("Ping_Error.",0,e),o.getInstance().onConnectError({errorCode:408,message:""})}else this.pingInterval=setTimeout(this.ping.bind(this),-e)}}else this.stopPing()},e.prototype.pong=function(){this.lastPongTime=Date.now(),this.isOnline?(o.getInstance().log("pong\t"+new Date(this.lastPongTime),3,this.lastPongTime),this.sending=!1,this.ping()):this.stopPing()},e.prototype.setTimeout=function(){if(this.isOnline){var t=Date.now();o.getInstance().log("setPingTimeout\t"+new Date(t),3,t),clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(this.timeoutHandler.bind(this),a.PING.TIMEOUT)}else this.stopPing()},e.prototype.timeoutHandler=function(){this.sending=!1,this.stopPing(),o.getInstance().log("Ping_Timeout.",0),o.getInstance().onConnectError({errorCode:408,message:""})},n.prototype._init=function(){if(o.getInstance().log("YYIMConnectEventHandler.prototype.registerHandler",3),!this._inited){var t=i.getInstance();t.registerHandler("onConnect",this.onConnected),t.registerHandler("onError",this.onConnectError),t.registerHandler("onDisconnect",this.onDisConnect),t.registerHandler("onStatusChanged",this.connectStatusChangeHandler),t.registerHandler(OPCODE.STREAM_ERROR.KEY,this.onStreamError),t.registerHandler(OPCODE.PACKET_ERROR.KEY,this.onPacketError),t.registerHandler("packet_in",t.getDaemon().pong.bind(t.getDaemon())),this._inited=!0}},n.prototype.onConnected=function(){o.getInstance().onOpened(),i.getInstance().getDaemon().startPing(!0)},n.prototype.onConnectError=function(t){o.getInstance().log("YYIMConnectEventHandler.prototype.onConnectError ",0,t),errorCode=t.getAttribute("code"),i.getInstance().getDaemon().stopPing(!1),401==errorCode?o.getInstance().onAuthError({errorCode:401,message:""}):409==errorCode?o.getInstance().onConflicted({errorCode:409,message:""}):4010==errorCode?o.getInstance().onClientKickout({errorCode:4010,message:""}):4011==errorCode?o.getInstance().onUpdatePassword({errorCode:4011,message:""}):o.getInstance().onConnectError({errorCode:errorCode,message:""})},n.prototype.onStreamError=function(t){o.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,t),i.getInstance().getDaemon().stopPing(!1),errorCode=t.code,401==errorCode?o.getInstance().onAuthError({errorCode:401,message:""}):409==errorCode?o.getInstance().onConflicted({errorCode:409,message:""}):4010==errorCode?o.getInstance().onClientKickout({errorCode:4010,message:""}):4011==errorCode?o.getInstance().onUpdatePassword({errorCode:4011,message:""}):o.getInstance().onConnectError({errorCode:errorCode,message:""})},n.prototype.onPacketError=function(t){o.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,t)},n.prototype.onDisConnect=function(){o.getInstance().onClosed(),i.getInstance().getDaemon().stopPing(!1)},n.prototype.connectStatusChangeHandler=function(t){o.getInstance().onStatusChanged(t)},i.getInstance=function(){return i._instance||(i._instance=new i,i._instance._init()),i._instance},i.prototype.getDaemon=function(){return this.daemon},i.prototype._init=function(){o.getInstance().exeBackhander("monitor"),this.eventHandler._init(),this.registerHandler(OPCODE.AUTH.KEY,function(t){var e=new JSJaCJID(t.jid),n=s.getID(t.jid);o.getInstance()._user={jid:e,name:n},o.getInstance().onUserBind(n,e.getResource())})},i.prototype.registerHandler=function(t,e,n,i){if(this.connection)return void this.connection.registerHandler.apply(this.connection,arguments);throw"connection is undefined!"},i.prototype.connected=function(){return!(!this.connection||!this.connection.connected())},i.prototype.getConnection=function(){return this.connection||(a.useWebSocket()?this.connection=new JSJaCWebSocketConnection({httpbase:a.getWebSocketUrl()}):this.connection=new JSJaCHttpBindingConnection({httpbase:a.getHttpBindUrl(),timerval:a.CONNECTION.TIMERVAL,wait:a.CONNECTION.WAIT})),this.connection},i.prototype.connect=function(t){t=t||{},this.connectArg||(this.connectArg=a.getConnectionArgObj()),t.username&&(this.connectArg.username=t.username),t.token&&(this.connectArg.password=t.token),t.appType&&(this.connectArg.appType=t.appType),t.identify&&(this.connectArg.clientIdentify=t.identify),o.getInstance()._user={jid:new JSJaCJID(this.connectArg.username+"@"+a.YY_IM_DOMAIN+"/"+this.connectArg.resource),name:this.connectArg.username},this.connection.connect(this.connectArg)},i.prototype.disconnect=function(){this.daemon.stopPing(!1),this.connection&&this.connection.disconnect()},i.prototype.send=function(t,e,n,i){this.waitingList.push({packet:t,callback:e,data:n,callbackContext:i}),this.sending||this.sendInterval()},i.prototype.sendInterval=function(){var t=this;if(this.waitingList.length){this.sending=!0;var e=(new Date).getTime()-this.lastSendTime;if(e>=a.SENDINTERVAL){var n=this.waitingList.shift();this.sendJumpPacket(n),n.packet&&n.packet.opcode!=OPCODE.PING.SEND&&this.getDaemon().startPing(),n.packet&&n.packet.opcode==OPCODE.PING.SEND&&this.getDaemon().setTimeout(),this.lastSendTime=(new Date).getTime(),this.sendInterval()}else setTimeout(function(){t.sendInterval()},a.SENDINTERVAL-e)}else this.sending=!1},i.prototype.sendJumpPacket=function(t){if(t)return t.callbackContext?this.connection.sendJumpPacket(t.packet,t.callback.bind(t.callbackContext),t.data):this.connection.sendJumpPacket(t.packet,t.callback,t.data)},r.prototype.get=function(){var t=this.xhr;t.open("GET",this.url,!0),r.prototype._listenFn.call(this),t.send()},r.prototype.post=function(){var t=this.xhr;t.open("POST",this.url,!0),r.prototype._listenFn.call(this),t.setRequestHeader("Content-Type","x-www-form-urlencoded"),t.send(this.data)},r.prototype.isLoop=function(t){this.loop=t},r.prototype.stopLoop=function(){clearTimeout(_self.timeoutIndex)},r.prototype._listenFn=function(){var t=this,e=this.xhr;this.timeoutIndex=setTimeout(function(){t.loop&&r.prototype.get.call(t),t.eCallback(e.responseText)},t.timeout),e.onreadystatechange=function(){4==e.readyState&&(clearTimeout(t.timeoutIndex),200==e.status?t.sCallback(e.responseText):t.eCallback(e.responseText))}},o.getInstance=function(){return o._instance||(o._instance=new o),o._instance},o.prototype.log=function(e,n,i,r){this._logger=this._logger||new t(a.LOG.FILTER_LEVEL),this._logger.log(e,n,i,r)},o.prototype.init=function(t){var e=this;t=t||{},this.onClosed=function(e){this.onConnectStatusChanged(c.OFFLINE),t.onClosed&&t.onClosed(e)},this.onAuthError=function(e){this.onConnectStatusChanged(c.AUTHERROR),t.onAuthError&&t.onAuthError(e)},this.onStatusChanged=function(t){YYIMCommonUtil.isStringAndNotEmpty(t)&&this.onConnectStatusChanged(t)},this.onConnectStatusChanged=function(t){this.connectStatus=t||this.connectStatus,this.log("connectStatus: ",3,this.connectStatus)},this.onOpened=function(e){this.onConnectStatusChanged(c.CONNECTED),this.getTimeCorrection&&this.getTimeCorrection(),t.onOpened&&t.onOpened(e)},this.onUpdatePassword=function(e){this.disConnect(c.ONUPDATEPASSWORD),t.onUpdatePassword&&t.onUpdatePassword(e)},this.onClientKickout=function(e){this.disConnect(c.ONCLIENTKICKOUT),t.onClientKickout&&t.onClientKickout(e)},this.onConflicted=function(e){this.disConnect(c.CONFLICT),t.onConflicted&&t.onConflicted(e)},this.onConnectError=function(n){this.connectStatus==c.OFFLINE||this.connectStatus==c.INIT||this.connectStatus==c.CONFLICT||this.connectStatus==c.AUTHERROR||this.connectStatus==c.ONCLIENTKICKOUT||this.connectStatus==c.ONUPDATEPASSWORD?this.ConnectErrorTimer&&(clearInterval(this.ConnectErrorTimer),this.ConnectErrorTimer=null):(this.onConnectStatusChanged(c.ERROR),this.ConnectErrorTimer||(this.ConnectErrorTimer=setInterval(function(){e.connectStatus==c.CONNECTED||e.connectStatus==c.PROCESSING||e.connectStatus==c.OFFLINE||e.connectStatus==c.INIT?(clearInterval(e.ConnectErrorTimer),e.ConnectErrorTimer=null):e.connectStatus==c.ERROR&&(e.log("",3,n),e.connect(),e.onConnectStatusChanged(c.CONNECTING))},500)),t.onConnectError&&t.onConnectError(n))},this.onUserBind=t.onUserBind||function(){},this.onExpiration=t.onExpiration,this.exeBackhander("initCallback",t),function(){jQuery(window).on({"unload offline":function(){e.connectStatus!=c.INIT&&e.disConnect()},online:function(){e.connectStatus!=c.INIT&&e.connectStatus!=c.CONFLICT&&e.connectStatus!=c.AUTHERROR&&e.connectStatus!=c.ONCLIENTKICKOUT&&e.connectStatus!=c.ONUPDATEPASSWORD&&e.connect()}})}(),jQuery.ajaxSetup({statusCode:{401:function(){t.onExpirationed&&t.onExpirationed()}}})},o.prototype.initSDK=function(t){u.init(t);var e=a.MULTI_TENANCY;this.appkey=e.SEPARATOR+e.APP_KEY+e.SEPARATOR+e.ETP_KEY,this.apiKey=t.apiKey},o.prototype.logEnable=function(t){YYIMUtil.isWhateType(t,"Boolean")?a.LOG.ENABLE=t:a.LOG.ENABLE=!a.LOG.ENABLE},o.prototype.getTenancy=function(){return a.MULTI_TENANCY},o.prototype.getAppkey=function(){return this.appkey},o.prototype.getApiKey=function(){return this.apiKey},o.prototype.isOnline=function(){return this.onlineStatus.indexOf(this.connectStatus)>-1},o.prototype.disConnect=function(t){this.getExpirationTimer&&(clearInterval(this.getExpirationTimer),this.getExpirationTimer=0),i.getInstance().disconnect(),this.onConnectStatusChanged(t||c.OFFLINE)},o.prototype.connect=function(){this.isOnline()||i.getInstance().connect()},o.prototype.getToken=function(){try{if(this.getExpiration()&&YYIMUtil.isWhateType(this.onExpiration,"Function")&&this.getExpiration()-this.getServerNow()<=a.EXPIRATION.INVALID){var t=this;this.onExpiration(function(e,n){e&&(t._token.token=e),n&&(t._token.expiration=n)})}}catch(t){this.log("Token winll Invalid. Auto Get Token Error.",0)}return this._token.token},o.prototype.getExpiration=function(){return this._token.expiration},o.prototype.login=function(t){if(t=t||{},this._token={token:t.token,expiration:t.expiration},t.username&&t.token){if(this.isOnline()||i.getInstance().connect({username:s.getNode(t.username),token:t.token,appType:t.appType,identify:t.identify}),YYIMUtil.isWhateType(this.onExpiration,"Function")&&!this.getExpirationTimer){var e=this;this.getExpirationTimer=setInterval(function(){e.getToken()},a.EXPIRATION.INSPECTION_INTERVAL)}}else this.log((t.username?"":"Username ")+(t.token?"":"Token ")+" Illegal.",0)},o.prototype.getConnectStatus=function(){return this.connectStatus},o.prototype.logout=function(){this.disConnect.apply(this,arguments),this.onConnectStatusChanged(c.INIT)},o.prototype.getUserBareJID=function(){return this._user.jid.getBareJID()},o.prototype.getUserFullJID=function(){return this._user.jid.toString()},o.prototype.getUserNode=function(){return s.getNode(this.getUserBareJID())},o.prototype.getUserID=function(){return s.getID(this.getUserBareJID())},o.prototype.getResource=function(){return a.RESOURCE},o.prototype.getServerName=function(){return a.CONNECTION.SERVER_NAME},o.prototype.getServletPath=function(){return a.SERVLET},o.prototype.getJIDUtil=function(){return s},o.prototype.getServerNow=function(){return a.TIMECORRECTION.AUTOCORRECTION?(new Date).getTime()+YYIMChat.getConfig().TIMECORRECTION.RESULT:(new Date).getTime()},o.prototype.getBrowser=function(){return a.BROWSER},o.prototype.getConstants=function(){return{FAVORITE_TYPE:l,STATUS:h,TYPE:d,PRESENCE_TYPE:p,COLLECT_TYPE:f,CHAT_TYPE:g,MESSAGE_CONTENT_TYPE:m}},o.prototype.getConfig=function(){return a},o.prototype.getConnection=function(){return i.getInstance()},o.prototype.getJIDUtil=function(){return s},o.prototype.getUtil=function(){return YYIMUtil},o.prototype.setBackhander=function(t){if(t){this.backhanders=this.backhanders||{};for(var e in t)this.backhanders[e]=this.backhanders[e]||{},jQuery.extend(this.backhanders[e],t[e])}},o.prototype.exeBackhander=function(t,e){if(this.backhanders=this.backhanders||{},t&&this.backhanders[t])for(var n in this.backhanders[t])if(YYIMUtil.isWhateType(this.backhanders[t][n],"Function"))try{this.backhanders[t][n](e||{})}catch(e){this.log("exeBackhander: "+t+" "+n+" Error.",0)}},o.getInstance()}();