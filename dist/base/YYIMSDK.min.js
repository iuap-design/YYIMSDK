function BaseList(){this.list={},this.array=[]}function IMFile(e){this.build(e)}function _Range(e,t){this.START=e,this.END=t,this.SIZE=t-e}function _Opcode(e,t,n){this.KEY=e,this.SEND=t,this.RECV=n||t,OPCODE_MAP.SEND.set(this.SEND,this.KEY),OPCODE_MAP.RECV.set(this.RECV,this.KEY)}function shallowClone(e){function t(){}return t.prototype=e,new t}function inheritPrototype(e,t){var n=shallowClone(t.prototype);n.constructor=e,e.prototype=n}function JumpPacket(e,t){if(this.sFrame=0,this.version=256,this.seqId=0,this.packetLen=0,e){this.content=e;try{this.packetLen="string"==typeof e?e.length:JSON.stringify(e).length}catch(e){}}this.opcode=t}function XmlHttp(){}function XmlDocument(){}function JSJaCConnection(e){e&&e.httpbase&&(this._httpbase=e.httpbase),e&&e.oDbg&&e.oDbg.log?this.oDbg=e.oDbg:this.oDbg={log:function(){}},e&&e.timerval?this.setPollInterval(e.timerval):this.setPollInterval(JSJAC_TIMERVAL),e&&e.cookie_prefix?this._cookie_prefix=e.cookie_prefix:this._cookie_prefix="",this._connected=!1,this._events=[],this._keys=null,this._ID=0,this._IDPrefix="jump"+(new Date).format("yyMMdd")+"_",this._inQ=[],this._pQueue=[],this._regIDs=[],this._req=[],this._status="intialized",this._errcnt=0,this._inactivity=JSJAC_INACTIVITY,this._sendRawCallbacks=[]}function JSJaCConsoleLogger(e){this.level=e||4,this.start=function(){},this.log=function(e,t){if(!((t=t||0)>this.level)&&"undefined"!=typeof console)try{switch(t){case 0:console.warn(e);break;case 1:console.error(e);break;case 2:console.info(e);break;case 4:console.debug(e);break;default:console.log(e)}}catch(t){try{console.log(e)}catch(e){}}},this.setLevel=function(e){return this.level=e,this},this.getLevel=function(){return this.level}}function STANZA_ERROR(e,t,n){if(window==this)return new STANZA_ERROR(e,t,n);this.code=e,this.type=t,this.cond=n}function JSJaCCookieException(e){this.message=e,this.name="CookieException"}function JSJaCCookie(e,t,n,r,i){if(window==this)return new JSJaCCookie(e,t,n,r,i);this.name=e,this.value=t,this.secs=n,this.domain=r,this.path=i,this.write=function(){var e;if(this.secs){var t=new Date;t.setTime(t.getTime()+1e3*this.secs),e="; expires="+t.toGMTString()}else e="";var n=this.domain?"; domain="+this.domain:"",r=this.path?"; path="+this.path:"; path=/";document.cookie=this.getName()+"="+JSJaCCookie._escape(this.getValue())+e+n+r},this.erase=function(){new JSJaCCookie(this.getName(),"",-1).write()},this.getName=function(){return this.name},this.setName=function(e){return this.name=e,this},this.getValue=function(){return this.value},this.setValue=function(e){return this.value=e,this},this.setDomain=function(e){return this.domain=e,this},this.setPath=function(e){return this.path=e,this}}function JSJaCDebugger(){}function JSJaCError(e,t,n){var r=XmlDocument.create("error","jsjac");return r.documentElement.setAttribute("code",e),r.documentElement.setAttribute("type",t),n&&r.documentElement.appendChild(r.createElement(n)).setAttribute("xmlns",NS_STANZAS),r.documentElement}function JSJaCHttpBindingConnection(e){this.base=JSJaCConnection,this.base(e),this._hold=JSJACHBC_MAX_HOLD,this._inactivity=0,this._last_requests={},this._last_rid=0,this._min_polling=0,this._pause=0,this._wait=e.wait||JSJACHBC_MAX_WAIT,function(){function e(e,t){return this.slice(e,t)}function t(e,t){arguments.length<2&&(t=0);for(var n=0,r=e.length;n<r;++n,++t)this[t]=255&e[n]}function n(n){var r;if("number"==typeof n){r=new Array(n);for(var i=0;i<n;++i)r[i]=0}else r=n.slice(0);return r.subarray=e,r.buffer=r,r.byteLength=r.length,r.set=t,"object"==typeof n&&n.buffer&&(r.buffer=n.buffer),r}try{new Uint8Array(1);return}catch(e){}window.Uint8Array=n,window.Uint32Array=n,window.Int32Array=n}()}function JSJaCHttpPollingConnection(e){this.base=JSJaCConnection,this.base(e),JSJACPACKET_USE_XMLNS=!1}function JSJaCJIDInvalidException(e){this.message=e,this.name="JSJaCJIDInvalidException"}function JSJaCJID(e){this._node="",this._domain="",this._resource="","string"==typeof e?(-1!=e.indexOf("@")&&(this.setNode(e.substring(0,e.indexOf("@"))),e=e.substring(e.indexOf("@")+1)),-1!=e.indexOf("/")&&(this.setResource(e.substring(e.indexOf("/")+1)),e=e.substring(0,e.indexOf("/"))),this.setDomain(e)):(this.setNode(e.node),this.setDomain(e.domain),this.setResource(e.resource))}function JSJaCJSON(){}function JSJaCKeys(e,t){var n=Math.random();if(this._k=[],this._k[0]=n.toString(),t?this.oDbg=t:(this.oDbg={},this.oDbg.log=function(){}),e)for(var r=1;r<JSJAC_NKEYS;r++)this._k[r]=e(this._k[r-1]),t.log(r+": "+this._k[r],4);this._indexAt=JSJAC_NKEYS-1,this.getKey=function(){return this._k[this._indexAt--]},this.lastKey=function(){return 0===this._indexAt},this.size=function(){return this._k.length},this._getSuspendVars=function(){return"_k,_indexAt".split(",")}}function JSJaCPacket(e){this.name=e,this.doc=void 0!==JSJACPACKET_USE_XMLNS&&JSJACPACKET_USE_XMLNS?XmlDocument.create(e,NS_CLIENT):XmlDocument.create(e,"")}function JSJaCPresence(){this.base=JSJaCPacket,this.base("presence")}function JSJaCIQ(){this.base=JSJaCPacket,this.base("iq")}function JSJaCMessage(){this.base=JSJaCPacket,this.base("message")}function JSJaCWebSocketConnection(e){this.base=JSJaCConnection,this.base(e),this._ws=null,this.registerHandler("onerror",JSJaC.bind(this._cleanupWebSocket,this))}function hex_sha1(e){return rstr2hex(rstr_sha1(str2rstr_utf8(e)))}function b64_sha1(e){return rstr2b64(rstr_sha1(str2rstr_utf8(e)))}function any_sha1(e,t){return rstr2any(rstr_sha1(str2rstr_utf8(e)),t)}function hex_hmac_sha1(e,t){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_sha1(e,t){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_sha1(e,t,n){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(e){return binb2rstr(binb_sha1(rstr2binb(e),8*e.length))}function rstr_hmac_sha1(e,t){var n=rstr2binb(e);n.length>16&&(n=binb_sha1(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=binb_sha1(r.concat(rstr2binb(t)),512+8*t.length);return binb2rstr(binb_sha1(i.concat(s),672))}function rstr2binb(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(var n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function binb2rstr(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function binb_sha1(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n=Array(80),r=1732584193,i=-271733879,o=-1732584194,s=271733878,a=-1009589776,u=0;u<e.length;u+=16){for(var c=r,l=i,h=o,d=s,p=a,f=0;f<80;f++){n[f]=f<16?e[u+f]:bit_rol(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);var g=safe_add(safe_add(bit_rol(r,5),sha1_ft(f,i,o,s)),safe_add(safe_add(a,n[f]),sha1_kt(f)));a=s,s=o,o=bit_rol(i,30),i=r,r=g}r=safe_add(r,c),i=safe_add(i,l),o=safe_add(o,h),s=safe_add(s,d),a=safe_add(a,p)}return Array(r,i,o,s,a)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,t){return rstr2any(rstr_md5(str2rstr_utf8(e)),t)}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_md5(e,t){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_md5(e,t,n){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);n.length>16&&(n=binl_md5(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=binl_md5(r.concat(rstr2binl(t)),512+8*t.length);return binl2rstr(binl_md5(i.concat(s),640))}function rstr2hex(e){for(var t,n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i=0;i<e.length;i++)t=e.charCodeAt(i),r+=n.charAt(t>>>4&15)+n.charAt(15&t);return r}function rstr2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=e.length,i=0;i<r;i+=3)for(var o=e.charCodeAt(i)<<16|(i+1<r?e.charCodeAt(i+1)<<8:0)|(i+2<r?e.charCodeAt(i+2):0),s=0;s<4;s++)8*i+6*s>8*e.length?n+=b64pad:n+=t.charAt(o>>>6*(3-s)&63);return n}function arr2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=e.length,i=0;i<r;i+=3)for(var o=e[i]<<16|(i+1<r?e[i+1]<<8:0)|(i+2<r?e[i+2]:0),s=0;s<4;s++)8*i+6*s>8*e.length?n+=b64pad:n+=t.charAt(o>>>6*(3-s)&63);return n}function rstr2any(e,t){var n,r,i,o,s,a=t.length,u=Array(Math.ceil(e.length/2));for(n=0;n<u.length;n++)u[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);var c=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),l=Array(c);for(r=0;r<c;r++){for(s=Array(),o=0,n=0;n<u.length;n++)o=(o<<16)+u[n],i=Math.floor(o/a),o-=i*a,(s.length>0||i>0)&&(s[s.length]=i);l[r]=o,u=s}var h="";for(n=l.length-1;n>=0;n--)h+=t.charAt(l[n]);return h}function str2rstr_utf8(e){for(var t,n,r="",i=-1;++i<e.length;)t=e.charCodeAt(i),n=i+1<e.length?e.charCodeAt(i+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),i++),t<=127?r+=String.fromCharCode(t):t<=2047?r+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r}function str2rstr_utf16le(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n),e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,255&e.charCodeAt(n));return t}function rstr2binl(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(var n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function binl2rstr(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,u=r,c=i,l=o;n=md5_ff(n,r,i,o,e[s+0],7,-680876936),o=md5_ff(o,n,r,i,e[s+1],12,-389564586),i=md5_ff(i,o,n,r,e[s+2],17,606105819),r=md5_ff(r,i,o,n,e[s+3],22,-1044525330),n=md5_ff(n,r,i,o,e[s+4],7,-176418897),o=md5_ff(o,n,r,i,e[s+5],12,1200080426),i=md5_ff(i,o,n,r,e[s+6],17,-1473231341),r=md5_ff(r,i,o,n,e[s+7],22,-45705983),n=md5_ff(n,r,i,o,e[s+8],7,1770035416),o=md5_ff(o,n,r,i,e[s+9],12,-1958414417),i=md5_ff(i,o,n,r,e[s+10],17,-42063),r=md5_ff(r,i,o,n,e[s+11],22,-1990404162),n=md5_ff(n,r,i,o,e[s+12],7,1804603682),o=md5_ff(o,n,r,i,e[s+13],12,-40341101),i=md5_ff(i,o,n,r,e[s+14],17,-1502002290),r=md5_ff(r,i,o,n,e[s+15],22,1236535329),n=md5_gg(n,r,i,o,e[s+1],5,-165796510),o=md5_gg(o,n,r,i,e[s+6],9,-1069501632),i=md5_gg(i,o,n,r,e[s+11],14,643717713),r=md5_gg(r,i,o,n,e[s+0],20,-373897302),n=md5_gg(n,r,i,o,e[s+5],5,-701558691),o=md5_gg(o,n,r,i,e[s+10],9,38016083),i=md5_gg(i,o,n,r,e[s+15],14,-660478335),r=md5_gg(r,i,o,n,e[s+4],20,-405537848),n=md5_gg(n,r,i,o,e[s+9],5,568446438),o=md5_gg(o,n,r,i,e[s+14],9,-1019803690),i=md5_gg(i,o,n,r,e[s+3],14,-187363961),r=md5_gg(r,i,o,n,e[s+8],20,1163531501),n=md5_gg(n,r,i,o,e[s+13],5,-1444681467),o=md5_gg(o,n,r,i,e[s+2],9,-51403784),i=md5_gg(i,o,n,r,e[s+7],14,1735328473),r=md5_gg(r,i,o,n,e[s+12],20,-1926607734),n=md5_hh(n,r,i,o,e[s+5],4,-378558),o=md5_hh(o,n,r,i,e[s+8],11,-2022574463),i=md5_hh(i,o,n,r,e[s+11],16,1839030562),r=md5_hh(r,i,o,n,e[s+14],23,-35309556),n=md5_hh(n,r,i,o,e[s+1],4,-1530992060),o=md5_hh(o,n,r,i,e[s+4],11,1272893353),i=md5_hh(i,o,n,r,e[s+7],16,-155497632),r=md5_hh(r,i,o,n,e[s+10],23,-1094730640),n=md5_hh(n,r,i,o,e[s+13],4,681279174),o=md5_hh(o,n,r,i,e[s+0],11,-358537222),i=md5_hh(i,o,n,r,e[s+3],16,-722521979),r=md5_hh(r,i,o,n,e[s+6],23,76029189),n=md5_hh(n,r,i,o,e[s+9],4,-640364487),o=md5_hh(o,n,r,i,e[s+12],11,-421815835),i=md5_hh(i,o,n,r,e[s+15],16,530742520),r=md5_hh(r,i,o,n,e[s+2],23,-995338651),n=md5_ii(n,r,i,o,e[s+0],6,-198630844),o=md5_ii(o,n,r,i,e[s+7],10,1126891415),i=md5_ii(i,o,n,r,e[s+14],15,-1416354905),r=md5_ii(r,i,o,n,e[s+5],21,-57434055),n=md5_ii(n,r,i,o,e[s+12],6,1700485571),o=md5_ii(o,n,r,i,e[s+3],10,-1894986606),i=md5_ii(i,o,n,r,e[s+10],15,-1051523),r=md5_ii(r,i,o,n,e[s+1],21,-2054922799),n=md5_ii(n,r,i,o,e[s+8],6,1873313359),o=md5_ii(o,n,r,i,e[s+15],10,-30611744),i=md5_ii(i,o,n,r,e[s+6],15,-1560198380),r=md5_ii(r,i,o,n,e[s+13],21,1309151649),n=md5_ii(n,r,i,o,e[s+4],6,-145523070),o=md5_ii(o,n,r,i,e[s+11],10,-1120210379),i=md5_ii(i,o,n,r,e[s+2],15,718787259),r=md5_ii(r,i,o,n,e[s+9],21,-343485551),n=safe_add(n,a),r=safe_add(r,u),i=safe_add(i,c),o=safe_add(o,l)}return Array(n,r,i,o)}function md5_cmn(e,t,n,r,i,o){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,o)),i),n)}function md5_ff(e,t,n,r,i,o,s){return md5_cmn(t&n|~t&r,e,t,i,o,s)}function md5_gg(e,t,n,r,i,o,s){return md5_cmn(t&r|n&~r,e,t,i,o,s)}function md5_hh(e,t,n,r,i,o,s){return md5_cmn(t^n^r,e,t,i,o,s)}function md5_ii(e,t,n,r,i,o,s){return md5_cmn(n^(t|~r),e,t,i,o,s)}function safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}function utf8t2d(e){e=e.replace(/\r\n/g,"\n");var t=new Array;if(String.fromCharCode(237).charCodeAt(0)<0)for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r>0?t[t.length]=r:(t[t.length]=256+r>>6|192,t[t.length]=256+r&63|128)}else for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t[t.length]=r:r>127&&r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128)}return t}function utf8d2t(e){for(var t=new Array,n=0;n<e.length;)e[n]<128?(t[t.length]=String.fromCharCode(e[n]),n++):e[n]>191&&e[n]<224?(t[t.length]=String.fromCharCode((31&e[n])<<6|63&e[n+1]),n+=2):(t[t.length]=String.fromCharCode((15&e[n])<<12|(63&e[n+1])<<6|63&e[n+2]),n+=3);return t.join("")}function b64arrays(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b64=new Array,f64=new Array;for(var t=0;t<e.length;t++)b64[t]=e.charAt(t),f64[e.charAt(t)]=t}function b64d2t(e){var t=new Array,n=0,r=e.length;for(r%3==1&&(e[e.length]=0,e[e.length]=0),r%3==2&&(e[e.length]=0);n<e.length;)t[t.length]=b64[e[n]>>2],t[t.length]=b64[(3&e[n])<<4|e[n+1]>>4],t[t.length]=b64[(15&e[n+1])<<2|e[n+2]>>6],t[t.length]=b64[63&e[n+2]],n+=3;return r%3==1&&(t[t.length-1]=t[t.length-2]="="),r%3==2&&(t[t.length-1]="="),t.join("")}function b64t2d(e){var t=new Array,n=0;for(e=e.replace(/\n|\r/g,""),e=e.replace(/=/g,"");n<e.length;)t[t.length]=f64[e.charAt(n)]<<2|f64[e.charAt(n+1)]>>4,t[t.length]=(15&f64[e.charAt(n+1)])<<4|f64[e.charAt(n+2)]>>2,t[t.length]=(3&f64[e.charAt(n+2)])<<6|f64[e.charAt(n+3)],n+=4;return e.length%4==2&&(t=t.slice(0,t.length-2)),e.length%4==3&&(t=t.slice(0,t.length-1)),t}function createXHR(){var e;if("undefined"!=typeof ActiveXObject)for(var t=["Microsoft.XMLHTTP","Msxml2.XMLHttp.6.0","Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","Msxml2.XMLHttp.3.0"],n=0;n<t.length;n++)try{e=new ActiveXObject(t[n])}catch(e){}else"undefined"!=typeof XMLHttpRequest&&(e=new XMLHttpRequest);return e}BaseList.prototype.set=function(e,t,n){if(e&&t){var r,i=this.get(e);return i&&(r=this.array.indexOf(i)),r>-1&&i?this.array.splice(r,1,t):this.array.push(t),this.list[e]=t,"function"==typeof n&&this.array.sort.call(this.array,n),t}},BaseList.prototype.get=function(e){if(e)return this.list[e]},BaseList.prototype.getAll=function(){return this.array},BaseList.prototype.getFirst=function(){return this.array.slice(0,1)[0]},BaseList.prototype.getLast=function(){return this.array.slice(-1)[0]},BaseList.prototype.getPrev=function(e){if(this.get(e)){var t=this.array.indexOf(this.get(e));if(t>0)return this.array[t-1]}},BaseList.prototype.getNext=function(e){if(this.get(e)){var t=this.array.indexOf(this.get(e));if(t>-1)return this.array[t+1]}},BaseList.prototype.remove=function(e){if(e){var t,n=this.get(e);return this.list[e]=null,delete this.list[e],n&&(t=this.array.indexOf(n))>-1?this.array.splice(t,1)[0]:[]}},BaseList.prototype.update=function(e,t){return this.set.apply(this,arguments)},BaseList.prototype.length=function(){return this.array.length},BaseList.prototype.clear=function(){for(var e in this.list)this.list.hasOwnProperty(e)&&(this.list[e]=null,delete this.list[e]);this.array.splice(0,this.array.length),this.array.length=0},BaseList.prototype.indexOf=function(){return this.array.indexOf.apply(this.array,arguments)},BaseList.prototype.includes=function(){return this.array.includes.apply(this.array,arguments)},BaseList.prototype.lastIndexOf=function(){return this.array.lastIndexOf.apply(this.array,arguments)},BaseList.prototype.sort=function(){return this.array.sort.apply(this.array,arguments)},BaseList.prototype.some=function(){return this.array.some.apply(this.array,arguments)},BaseList.prototype.every=function(){return this.array.every.apply(this.array,arguments)},BaseList.prototype.map=function(){return this.array.map.apply(this.array,arguments)},BaseList.prototype.filter=function(){return this.array.filter.apply(this.array,arguments)},BaseList.prototype.forEach=function(){return this.array.forEach.apply(this.array,arguments)},BaseList.prototype.keys=function(){if(Object.keys)return Object.keys(this.list);var e=[];for(var t in this.list)this.list.hasOwnProperty(t)&&e.push(t);return e},IMFile.prototype.build=function(e){if(e=e||{},this.path=e.path||this.path||"",this.name=e.name||this.name||"",this.size=e.size||this.size||0,this.from=0,e.location&&(this.location=e.location||this.location),e.id&&(this.id=e.id||this.id),this.fid=e.fid||0,0!==e.original&&1!==e.original||(this.original=e.original),this.name&&!this.type){this.name=this.name.trim();var t=/.+\.(\w+)$/,n=t.exec(this.name);n&&n[1]&&(this.type=n[1])}},Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r,i=e,o=[];if(n=n||i.length,t)for(r=0;r<t;r++)o[r]=i[0|Math.random()*n];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(s=0|16*Math.random(),o[r]=i[19==r?3&s|8:s])}return o.join("")},Math.uuidFast=function(){for(var t,n=e,r=new Array(36),i=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,r[o]=n[19==o?3&t|8:t]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),Object.clone=function(e){if("object"!=typeof e)return e;var t={};e.constructor==Array&&(t=[]);for(var n in e)t[n]=e[n]?Object.clone(e[n]):null;return t},Array.prototype.every||(Array.prototype.every=function(e,t){"use strict";var n,r;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError;for(arguments.length>1&&(n=t),r=0;r<o;){var s;if(r in i){s=i[r];if(!e.call(n,s,r,i))return!1}r++}return!0}),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),n=t.length>>>0,r=arguments.length>=2?arguments[1]:void 0,i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=new Array(s),i=0;i<s;){var a,u;i in o&&(a=o[i],u=e.call(n,a,i,o),r[i]=u),i++}return r}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in t){var s=t[o];e.call(i,s,o,t)&&r.push(s)}return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0===i)return-1;var o=+t||0;if(Math.abs(o)===1/0&&(o=0),o>=i)return-1;for(n=Math.max(o>=0?o:i-Math.abs(o),0);n<i;){if(n in r&&r[n]===e)return n;n++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<o;){var s;r in i&&(s=i[r],e.call(n,s,r,i)),r++}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t,n,r=Object(this),i=r.length>>>0;if(0===i)return-1;for(t=i-1,arguments.length>1&&(t=Number(arguments[1]),t!=t?t=0:0!=t&&t!=1/0&&t!=-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),n=t>=0?Math.min(t,i-1):i-Math.abs(t);n>=0;n--)if(n in r&&r[n]===e)return n;return-1}),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.notEmpty=function(){return null!=this&&""!=this.trim()},String.prototype.isEmpty=function(){return!this.notEmpty()},String.prototype.endWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substring(this.length-e.length)==e},String.prototype.startWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substr(0,e.length)==e};var YYIMCommonUtil={isFunction:function(e){return"function"==typeof e},isStringAndNotEmpty:function(e){return"string"==typeof e&&e.notEmpty()},chatNumInString:function(e,t){if("string"==typeof e&&"string"==typeof t){var n=new RegExp("\\"+t,"gi"),r=e.match(n);if(r)return r.length}return 0},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)}},YYIMArrayUtil={contains:function(e,t){if("[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}return!1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},unique:function(e){e.sort();for(var t=[e[0]],n=1;n<e.length;n++)e[n]!==t[t.length-1]&&t.push(e[n]);return t},insert:function(e,t,n){e.splice(t,0,n)}},YYIMUtil={localstorage:function(){function e(){try{return s=!0,window.localStorage}catch(e){throw s=!1,new Error(e.message)}}function t(){a&&a.clear()}function n(e,t){a&&a.setItem(e,t)}function r(e){if(a)return a.getItem(e)}function i(e){a&&a.removeItem(e)}function o(e){var t;if(YYIMUtil.isWhateType(e,"Array")){t={};for(var n in e)r(e[n])&&(t[e[n]]=r(e[n]))}var i={total:YYIMUtil.getSpace(a)};return t&&(i.expect=YYIMUtil.getSpace(t),t=null),i}var s=!1,a=e();return{enable:s,getLocalStorage:e,setItem:n,getItem:r,removeItem:i,clear:t,getSpace:o}}(),getSpace:function(e){try{return{size:unescape(encodeURIComponent(JSON.stringify(e))).length,space:YYIMUtil.bytesToSize(unescape(encodeURIComponent(JSON.stringify(e))).length)}}catch(e){return{size:0,space:"0 B"}}},cookie:{get:function(e){if(e)for(var t=document.cookie,n=t.split(";"),r=n.length,i=0;i<r;i++){var o=n[i].split("=");if(o[0].replace(/(^\s+)|(\s+$)/g,"")==e)return unescape(o[1])}return null},set:function(e,t,n,r,i,o){if(e&&t){var s=encodeURIComponent(e)+"="+encodeURIComponent(t);if(n){s+=";expires="+new Date((new Date).getTime()+6e4*n).toGMTString()}r&&(s+=";path="+r),i&&(s+=";domain="+i),o&&(s+=";secure"),document.cookie=s}},delete:function(e,t,n){if(e&&this.get(e)){var r=encodeURIComponent(e)+"=;expires=Fri, 02-Jan-1970 00:00:00 GMT";t&&(r+=";path="+t),n&&(r+=";domain="+n),document.cookie=r}}},array:{comparisonAsc:function(e){return function(t,n){return t[e]-n[e]}},comparisonDesc:function(e){return function(t,n){return n[e]-t[e]}}},isWhateType:function(e,t){return"Null"===t&&null===e||"Undefined"===t&&void 0===e||"Number"===t&&isFinite(e)||Object.prototype.toString.call(e).slice(8,-1)===t},dom:{convertToArray:function(e){var t=null;try{t=Array.prototype.slice.call(e,0)}catch(i){t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n])}return t}},bytesToSize:function(e){if(0===e)return"0 B";var t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,n)).toPrecision(3)+" "+t[n]},extend:function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e)){if("[object Array]"===Object.prototype.toString.call(t))for(var r=0,i=t.length;r<i;r++)arguments.callee(e,t[r],n);try{if(t)for(var r in t)!0!==n&&e[r]||(e[r]=t[r]);return e}catch(t){return e}}return e},html:{removeHtmlTab:function(e){return e.replace(/<[^<>]+?>/g,"")},htmlEscape:function(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})},escapeHtml:function(e){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(e,n){return t[n]})},nbspSpace:function(e){var t={nbsp:" "};return e.replace(/&(nbsp);/gi,function(e,n){return t[n]})},spaceNbsp:function(e){return e.replace(/\s/gi,"&nbsp;")},returnBr:function(e){return e.replace(/\r?\n/g,"<br />")},trimBr:function(e){return e=e.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n"),e=e.replace(/^((\s|&nbsp;)*\r?\n)+/g,""),e=e.replace(/((\s|&nbsp;)*\r?\n)+$/g,"")},mergeSpace:function(e){return e=e.replace(/(\s|&nbsp;)+/g," ")}},function:{bind:function(e,t){if("Function"==Object.prototype.toString.call(e).slice(8,-1))return function(){return e.apply(t,arguments)}},curry:function(e){if("Function"==Object.prototype.toString.call(e).slice(8,-1)){var t=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,t.concat(n))}}}},transcoding:{base64ToDataUrl:function(e){return e&&!/data\:image\/png\;base64\,/.test(e)?"data:image/png;base64,"+e:e},dataUrlToBase64:function(e){return e&&e.replace(/data\:image\/png\;base64\,/g,""),e},base64ToBlob:function(e){if(e){var t=window.atob(e.split(",")[1]||e),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(var i in t)t.hasOwnProperty(i)&&(r[i]=t.charCodeAt(i));return new Blob([n],{type:"image/png"})}},base64ToFormData:function(e){if(e){var t=new FormData;return t.append("file",this.base64ToBlob(e)),t}}}},YYIMRegExp={mobile:/^[1][358][0-9]{9}$/,phone:/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/};!function(e,t){"use strict";function n(e,t){for(var n,r=[],s=0;s<e.length;++s){if(!(n=o[e[s]]||i(e[s])))throw"module definition dependecy not found: "+e[s];r.push(n)}t.apply(null,r)}function r(e,r,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(i===t)throw"invalid module definition, definition function must be specified";n(r,function(){o[e]=i.apply(null,arguments)})}function i(t){for(var n=e,r=t.split(/[.\/]/),i=0;i<r.length;++i){if(!n[r[i]])return;n=n[r[i]]}return n}var o={},s="moxie/core/utils/Basic",a="moxie/core/utils/Env",u="moxie/core/I18n",c="moxie/core/utils/Mime",l="moxie/core/utils/Dom",h="moxie/core/Exceptions",d="moxie/core/EventTarget",p="moxie/runtime/Runtime",f="moxie/runtime/RuntimeClient",g="moxie/file/FileInput",m="moxie/core/utils/Encode",_="moxie/file/Blob",E="moxie/file/File",S="moxie/file/FileDrop",y="moxie/file/FileReader",C="moxie/core/utils/Url",v="moxie/runtime/RuntimeTarget",b="moxie/file/FileReaderSync",R="moxie/xhr/FormData",T="moxie/xhr/XMLHttpRequest",A="moxie/runtime/Transporter",w="moxie/image/Image",I="moxie/runtime/html5/Runtime",O="moxie/core/utils/Events",x="moxie/runtime/html5/file/FileReader",N="moxie/runtime/html5/utils/BinaryReader",D="moxie/runtime/html5/image/JPEGHeaders",J="moxie/runtime/html5/image/ExifParser",P="moxie/runtime/html5/image/JPEG",L="moxie/runtime/html5/image/PNG",M="moxie/runtime/html5/image/ImageInfo",U="moxie/runtime/html5/image/MegaPixel",k="moxie/runtime/html5/image/Image",H="moxie/runtime/flash/Runtime",B="moxie/runtime/flash/file/Blob",F="moxie/runtime/flash/file/FileReader",q="moxie/runtime/flash/file/FileReaderSync",X="moxie/runtime/flash/xhr/XMLHttpRequest",j="moxie/runtime/flash/runtime/Transporter",G="moxie/runtime/flash/image/Image",z="moxie/runtime/silverlight/Runtime",V="moxie/runtime/html4/Runtime";r(s,[],function(){var e=function(e){return void 0===e?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(r){return n(arguments,function(i,o){o>0&&n(i,function(n,i){void 0!==n&&(e(r[i])===e(n)&&~s(e(n),["array","object"])?t(r[i],n):r[i]=n)})}),r},n=function(t,n){var r,i,o;if(t)if("number"===e(t.length)){for(o=0,r=t.length;r>o;o++)if(!1===n(t[o],o))return}else if("object"===e(t))for(i in t)if(t.hasOwnProperty(i)&&!1===n(t[i],i))return},r=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},i=function(t,n){function r(o){"function"===e(t[o])&&t[o](function(e){++o<i&&!e?r(o):n(e)})}var i=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),r(0)},o=function(e,t){var r=0,i=e.length,o=new Array(i);n(e,function(e,n){e(function(e){if(e)return t(e);var s=[].slice.call(arguments);s.shift(),o[n]=s,++r===i&&(o.unshift(null),t.apply(this,o))})})},s=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n}return-1},a=function(t,n){var r=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var i in t)-1===s(t[i],n)&&r.push(t[i]);return!!r.length&&r},u=function(e,t){var r=[];return n(e,function(e){-1!==s(e,t)&&r.push(e)}),r.length?r:null},c=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},l=function(){var e=0;return function(t){var n,r=(new Date).getTime().toString(32);for(n=0;5>n;n++)r+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+r+(e++).toString(32)}}(),h=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},d=function(e){if("string"!=typeof e)return e;var t,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return e=/^([0-9\.]+)([tmgk]?)$/.exec(e.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),t=e[2],e=+e[1],n.hasOwnProperty(t)&&(e*=n[t]),Math.floor(e)};return{guid:l,typeOf:e,extend:t,each:n,isEmptyObj:r,inSeries:i,inParallel:o,inArray:s,arrayDiff:a,arrayIntersect:u,toArray:c,trim:h,sprintf:function(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e(t)?t:""})},parseSizeStr:d}}),r(a,[s],function(e){function t(e,t,n){
var r=0,i=0,o=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},a=function(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8]},u=function(e){return e?isNaN(e)?s[e]||-7:parseInt(e,10):0};for(e=a(e),t=a(t),i=Math.max(e.length,t.length),r=0;i>r;r++)if(e[r]!=t[r]){if(e[r]=u(e[r]),t[r]=u(t[r]),e[r]<t[r]){o=-1;break}if(e[r]>t[r]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return 0>=o;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return 0>o;default:return null}}var n=function(e){var t="function",n="object",r="name",i="version",o={has:function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},s={rgx:function(){for(var r,i,o,s,a,u,c,l=0,h=arguments;l<h.length;l+=2){var d=h[l],p=h[l+1];if(void 0===r){r={};for(s in p)a=p[s],typeof a===n?r[a[0]]=e:r[a]=e}for(i=o=0;i<d.length;i++)if(u=d[i].exec(this.getUA())){for(s=0;s<p.length;s++)c=u[++o],a=p[s],typeof a===n&&a.length>0?2==a.length?typeof a[1]==t?r[a[0]]=a[1].call(this,c):r[a[0]]=a[1]:3==a.length?typeof a[1]!==t||a[1].exec&&a[1].test?r[a[0]]=c?c.replace(a[1],a[2]):e:r[a[0]]=c?a[1].call(this,c,a[2]):e:4==a.length&&(r[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):e):r[a]=c||e;break}if(u)break}return r},str:function(t,r){for(var i in r)if(typeof r[i]===n&&r[i].length>0){for(var s=0;s<r[i].length;s++)if(o.has(r[i][s],t))return"?"===i?e:i}else if(o.has(r[i],t))return"?"===i?e:i;return t}},a={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},u={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[r,i],[/\s(opr)\/([\w\.]+)/i],[[r,"Opera"],i],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[r,i],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[r,"IE"],i],[/(edge)\/((\d+)?[\w\.]+)/i],[r,i],[/(yabrowser)\/([\w\.]+)/i],[[r,"Yandex"],i],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],i],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[r,i],[/(dolfin)\/([\w\.]+)/i],[[r,"Dolphin"],i],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[r,"Chrome"],i],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[i,[r,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[i,[r,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[i,[r,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[i,[r,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[i,r],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[r,[i,s.str,a.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[r,i],[/(navigator|netscape)\/([\w\.-]+)/i],[[r,"Netscape"],i],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[r,i]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[i,[r,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,i],[/rv\:([\w\.]+).*(gecko)/i],[i,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,i],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[i,s.str,a.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[i,s.str,a.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],i],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[r,i],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[r,"Symbian"],i],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],i],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[r,i],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],i],[/(sunos)\s?([\w\.]+\d)*/i],[[r,"Solaris"],i],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[r,i],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[r,"iOS"],[i,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[r,"Mac OS"],[i,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[r,i]]};return function(e){var t=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return s.rgx.apply(this,u.browser)},this.getEngine=function(){return s.rgx.apply(this,u.engine)},this.getOS=function(){return s.rgx.apply(this,u.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return t},this.setUA=function(e){return t=e,this},this.setUA(t)}}(),r=function(){var t={define_property:!1,create_canvas:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType===t}}catch(e){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==o.browser||o.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var r=[].slice.call(arguments);return r.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,r):!!t[n]}}(),i=(new n).getResult(),o={can:r,uaParser:n,browser:i.browser.name,version:i.browser.version,os:i.os.name,osVersion:i.os.version,verComp:t,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return o.OS=o.os,o}),r(u,[s],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e.typeOf(t)?t:""})}}}),r(c,[s,u],function(e,t){var n={mimes:{},extensions:{},addMimeType:function(e){var t,n,r,i=e.split(/,/);for(t=0;t<i.length;t+=2){for(r=i[t+1].split(/ /),n=0;n<r.length;n++)this.mimes[r[n]]=i[t];this.extensions[i[t]]=r}},extList2mimes:function(t,n){var r,i,o,s,a=this,u=[];for(i=0;i<t.length;i++)for(r=t[i].extensions.split(/\s*,\s*/),o=0;o<r.length;o++){if("*"===r[o])return[];if(s=a.mimes[r[o]],s&&-1===e.inArray(s,u)&&u.push(s),n&&/^\w+$/.test(r[o]))u.push("."+r[o]);else if(!s)return[]}return u},mimes2exts:function(t){var n=this,r=[];return e.each(t,function(t){if("*"===t)return r=[],!1;var i=t.match(/^(\w+)\/(\*|\w+)$/);i&&("*"===i[2]?e.each(n.extensions,function(e,t){new RegExp("^"+i[1]+"/").test(t)&&[].push.apply(r,n.extensions[t])}):n.extensions[t]&&[].push.apply(r,n.extensions[t]))}),r},mimes2extList:function(n){var r=[],i=[];return"string"===e.typeOf(n)&&(n=e.trim(n).split(/\s*,\s*/)),i=this.mimes2exts(n),r.push({title:t.translate("Files"),extensions:i.length?i.join(","):"*"}),r.mimes=n,r},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return n.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),n}),r(l,[a],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){return!!e.className&&new RegExp("(^|\\s+)"+t+"(\\s+|$)").test(e.className)},r=function(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t)},i=function(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})}},o=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},s=function(t,n){function r(e){var t,n,r=0,i=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===c.compatMode?c.documentElement:c.body,r=n.left+t.scrollLeft,i=n.top+t.scrollTop),{x:r,y:i}}var i,o,s,a=0,u=0,c=document;if(t=t,n=n||c.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!c.documentMode||c.documentMode<8))return o=r(t),s=r(n),{x:o.x-s.x,y:o.y-s.y};for(i=t;i&&i!=n&&i.nodeType;)a+=i.offsetLeft||0,u+=i.offsetTop||0,i=i.offsetParent;for(i=t.parentNode;i&&i!=n&&i.nodeType;)a-=i.scrollLeft||0,u-=i.scrollTop||0,i=i.parentNode;return{x:a,y:u}};return{get:t,hasClass:n,addClass:r,removeClass:i,getStyle:o,getPos:s,getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}}}}),r(h,[s],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": RuntimeError "+this.code}var r={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,r),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": ImageError "+this.code}var r={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return e.extend(n,r),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": FileException "+this.code}var r={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,r),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": DOMException "+this.code}var r={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,r),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),r(d,[a,h,s],function(e,t,n){function r(){var e={};n.extend(this,{uid:null,init:function(){this.uid||(this.uid=n.guid("uid_"))},addEventListener:function(t,r,i,o){var s,a=this;return this.hasOwnProperty("uid")||(this.uid=n.guid("uid_")),t=n.trim(t),/\s/.test(t)?void n.each(t.split(/\s+/),function(e){a.addEventListener(e,r,i,o)}):(t=t.toLowerCase(),i=parseInt(i,10)||0,s=e[this.uid]&&e[this.uid][t]||[],s.push({fn:r,priority:i,scope:o||this}),e[this.uid]||(e[this.uid]={}),void(e[this.uid][t]=s))},hasEventListener:function(t){var n=t?e[this.uid]&&e[this.uid][t]:e[this.uid];return n||!1},removeEventListener:function(t,r){t=t.toLowerCase();var i,o=e[this.uid]&&e[this.uid][t];if(o){if(r){for(i=o.length-1;i>=0;i--)if(o[i].fn===r){o.splice(i,1);break}}else o=[];o.length||(delete e[this.uid][t],n.isEmptyObj(e[this.uid])&&delete e[this.uid])}},removeAllEventListeners:function(){e[this.uid]&&delete e[this.uid]},dispatchEvent:function(r){var i,o,s,a,u,c={},l=!0;if("string"!==n.typeOf(r)){if(a=r,"string"!==n.typeOf(a.type))throw new t.EventException(t.EventException.UNSPECIFIED_EVENT_TYPE_ERR);r=a.type,a.total!==u&&a.loaded!==u&&(c.total=a.total,c.loaded=a.loaded),c.async=a.async||!1}if(-1!==r.indexOf("::")?function(e){i=e[0],r=e[1]}(r.split("::")):i=this.uid,r=r.toLowerCase(),o=e[i]&&e[i][r]){o.sort(function(e,t){return t.priority-e.priority}),s=[].slice.call(arguments),s.shift(),c.type=r,s.unshift(c);var h=[];n.each(o,function(e){s[0].target=e.scope,c.async?h.push(function(t){setTimeout(function(){t(!1===e.fn.apply(e.scope,s))},1)}):h.push(function(t){t(!1===e.fn.apply(e.scope,s))})}),h.length&&n.inSeries(h,function(e){l=!e})}return l},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(e){var t=this;this.bind(e.join(" "),function(e){var t="on"+e.type.toLowerCase();"function"===n.typeOf(this[t])&&this[t].apply(this,arguments)}),n.each(e,function(e){e="on"+e.toLowerCase(e),"undefined"===n.typeOf(t[e])&&(t[e]=null)})}})}return r.instance=new r,r}),r(p,[a,s,l,d],function(e,t,n,r){function i(e,r,o,a,u){var c,l=this,h=t.guid(r+"_"),d=u||"browser";e=e||{},s[h]=this,o=t.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},o),e.preferred_caps&&(d=i.getMode(a,e.preferred_caps,d)),c=function(){var e={};return{exec:function(t,n,r,i){return c[n]&&(e[t]||(e[t]={context:this,instance:new c[n]}),e[t].instance[r])?e[t].instance[r].apply(this,i):void 0},removeInstance:function(t){delete e[t]},removeAllInstances:function(){var n=this;t.each(e,function(e,r){"function"===t.typeOf(e.instance.destroy)&&e.instance.destroy.call(e.context),n.removeInstance(r)})}}}(),t.extend(this,{initialized:!1,uid:h,type:r,mode:i.getMode(a,e.required_caps,d),shimid:h+"_container",clients:0,options:e,can:function(e,n){var r=arguments[2]||o;if("string"===t.typeOf(e)&&"undefined"===t.typeOf(n)&&(e=i.parseCaps(e)),"object"===t.typeOf(e)){for(var s in e)if(!this.can(s,e[s],r))return!1;return!0}return"function"===t.typeOf(r[e])?r[e].call(this,n):n===r[e]},getShimContainer:function(){var e,r=n.get(this.shimid);return r||(e=this.options.container?n.get(this.options.container):document.body,r=document.createElement("div"),r.id=this.shimid,r.className="moxie-shim moxie-shim-"+this.type,t.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.appendChild(r),e=null),r},getShim:function(){return c},shimExec:function(e,t){var n=[].slice.call(arguments,2);return l.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return l[e]&&l[e][t]?l[e][t].apply(this,n):l.shimExec.apply(this,arguments)},destroy:function(){if(l){var e=n.get(this.shimid);e&&e.parentNode.removeChild(e),c&&c.removeAllInstances(),this.unbindAll(),delete s[this.uid],this.uid=null,h=l=c=e=null}}}),this.mode&&e.required_caps&&!this.can(e.required_caps)&&(this.mode=!1)}var o={},s={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(e){return!!s[e]&&s[e]},i.addConstructor=function(e,t){t.prototype=r.instance,o[e]=t},i.getConstructor=function(e){return o[e]||null},i.getInfo=function(e){var t=i.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},i.parseCaps=function(e){var n={};return"string"!==t.typeOf(e)?e||{}:(t.each(e.split(","),function(e){n[e]=!0}),n)},i.can=function(e,t){var n,r,o=i.getConstructor(e);return!!o&&(n=new o({required_caps:t}),r=n.mode,n.destroy(),!!r)},i.thatCan=function(e,t){var n=(t||i.order).split(/\s*,\s*/);for(var r in n)if(i.can(n[r],e))return n[r];return null},i.getMode=function(e,n,r){var i=null;if("undefined"===t.typeOf(r)&&(r="browser"),n&&!t.isEmptyObj(e)){if(t.each(n,function(n,r){if(e.hasOwnProperty(r)){var o=e[r](n);if("string"==typeof o&&(o=[o]),i){if(!(i=t.arrayIntersect(i,o)))return i=!1}else i=o}}),i)return-1!==t.inArray(r,i)?r:i[0];if(!1===i)return!1}return r},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(e){return function(){return!!e}},i}),r(f,[a,h,s,p],function(e,t,n,r){return function(){var e;n.extend(this,{connectRuntime:function(i){function o(n){var s,u;return n.length?(s=n.shift().toLowerCase(),(u=r.getConstructor(s))?(e=new u(i),e.bind("Init",function(){e.initialized=!0,setTimeout(function(){e.clients++,a.trigger("RuntimeInit",e)},1)}),e.bind("Error",function(){e.destroy(),o(n)}),e.mode?void e.init():void e.trigger("Error")):void o(n)):(a.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),void(e=null))}var s,a=this;if("string"===n.typeOf(i)?s=i:"string"===n.typeOf(i.ruid)&&(s=i.ruid),s){if(e=r.getRuntime(s))return e.clients++,e;throw new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)}o((i.runtime_order||r.order).split(/\s*,\s*/))},disconnectRuntime:function(){e&&--e.clients<=0&&e.destroy(),e=null},getRuntime:function(){return e&&e.uid?e:e=null},exec:function(){return e?e.exec.apply(this,arguments):null}})}}),r(g,[s,a,c,l,h,d,u,p,f],function(e,t,n,r,i,o,s,a,u){function c(t){var o,c,h,d=this;if(-1!==e.inArray(e.typeOf(t),["string","node"])&&(t={browse_button:t}),!(c=r.get(t.browse_button)))throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);h={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:c.parentNode||document.body},t=e.extend({},h,t),"string"==typeof t.required_caps&&(t.required_caps=a.parseCaps(t.required_caps)),"string"==typeof t.accept&&(t.accept=n.mimes2extList(t.accept)),o=r.get(t.container),o||(o=document.body),"static"===r.getStyle(o,"position")&&(o.style.position="relative"),o=c=null,u.call(d),e.extend(d,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){d.bind("RuntimeInit",function(n,i){d.ruid=i.uid,d.shimid=i.shimid,d.bind("Ready",function(){d.trigger("Refresh")},999),d.bind("Refresh",function(){var n,o,s,a;s=r.get(t.browse_button),a=r.get(i.shimid),s&&(n=r.getPos(s,r.get(t.container)),o=r.getSize(s),a&&e.extend(a.style,{top:n.y+"px",left:n.x+"px",width:o.w+"px",height:o.h+"px"})),a=s=null}),i.exec.call(d,"FileInput","init",t)}),d.connectRuntime(e.extend({},t,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)||t)},refresh:function(){d.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(l)}var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return c.prototype=o.instance,c}),r(m,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var r,i,o,s,a,u,c,l,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,p=0,f="",g=[];if(!e)return e;e+="";do{s=h.indexOf(e.charAt(d++)),a=h.indexOf(e.charAt(d++)),u=h.indexOf(e.charAt(d++)),c=h.indexOf(e.charAt(d++)),l=s<<18|a<<12|u<<6|c,r=l>>16&255,i=l>>8&255,o=255&l,g[p++]=64==u?String.fromCharCode(r):64==c?String.fromCharCode(r,i):String.fromCharCode(r,i,o)}while(d<e.length);return f=g.join(""),n?t(f):f},r=function(t,n){if(n&&(t=e(t)),"function"==typeof window.btoa)return window.btoa(t);var r,i,o,s,a,u,c,l,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,p=0,f="",g=[];if(!t)return t;do{r=t.charCodeAt(d++),i=t.charCodeAt(d++),o=t.charCodeAt(d++),l=r<<16|i<<8|o,s=l>>18&63,a=l>>12&63,u=l>>6&63,c=63&l,g[p++]=h.charAt(s)+h.charAt(a)+h.charAt(u)+h.charAt(c)}while(d<t.length);f=g.join("");var m=t.length%3;return(m?f.slice(0,m-3):f)+"===".slice(m||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:r}}),r(_,[s,m,f],function(e,t,n){function r(o,s){function a(t,n,o){var s,a=i[this.uid];return"string"===e.typeOf(a)&&a.length?(s=new r(null,{type:o,size:n-t}),s.detach(a.substr(t,s.size)),s):null}n.call(this),o&&this.connectRuntime(o),s?"string"===e.typeOf(s)&&(s={data:s}):s={},e.extend(this,{uid:s.uid||e.guid("uid_"),ruid:o,size:s.size||0,type:s.type||"",slice:function(e,t,n){return this.isDetached()?a.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return i[this.uid]?i[this.uid]:null},detach:function(e){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),e=e||"","data:"==e.substr(0,5)){var n=e.indexOf(";base64,");this.type=e.substring(5,n),e=t.atob(e.substring(n+8))}this.size=e.length,i[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(i[this.uid])},destroy:function(){this.detach(),delete i[this.uid]}}),s.data?this.detach(s.data):i[this.uid]=s}var i={};return r}),r(E,[s,c,_],function(e,t,n){function r(r,i){i||(i={}),n.apply(this,arguments),this.type||(this.type=t.getFileMime(i.name));var o;if(i.name)o=i.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else if(this.type){var s=this.type.split("/")[0];o=e.guid((""!==s?s:"file")+"_"),t.extensions[this.type]&&(o+="."+t.extensions[this.type][0])}e.extend(this,{name:o||e.guid("file_"),relativePath:"",lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString()})}return r.prototype=n.prototype,r}),r(S,[u,l,h,s,a,E,f,d,c],function(e,t,n,r,i,o,s,a,u){function c(n){var i,o=this;"string"==typeof n&&(n={drop_zone:n}),i={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?r.extend({},i,n):i,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=u.mimes2extList(n.accept)),s.call(o),r.extend(o,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){o.bind("RuntimeInit",function(e,t){o.ruid=t.uid,t.exec.call(o,"FileDrop","init",n),o.dispatchEvent("ready")}),o.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(l)}var l=["ready","dragenter","dragleave","drop","error"];return c.prototype=a.instance,c}),r(y,[s,m,h,d,_,f],function(e,t,n,r,i,o){function s(){function r(e,r){if(this.trigger("loadstart"),this.readyState===s.LOADING)return this.trigger("error",new n.DOMException(n.DOMException.INVALID_STATE_ERR)),void this.trigger("loadend");if(!(r instanceof i))return this.trigger("error",new n.DOMException(n.DOMException.NOT_FOUND_ERR)),void this.trigger("loadend");if(this.result=null,this.readyState=s.LOADING,r.isDetached()){var o=r.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=o;break;case"readAsDataURL":this.result="data:"+r.type+";base64,"+t.btoa(o)}this.readyState=s.DONE,this.trigger("load"),this.trigger("loadend")}else this.connectRuntime(r.ruid),this.exec("FileReader","read",e,r)}o.call(this),e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){r.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){r.call(this,"readAsDataURL",e)},readAsText:function(e){r.call(this,"readAsText",e)},abort:function(){this.result=null,-1===e.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(a),this.bind("Error",function(e,t){this.readyState=s.DONE,this.error=t},999),this.bind("Load",function(e){this.readyState=s.DONE},999)}var a=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=r.instance,s}),r(C,[],function(){var e=function(t,n){for(var r=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=r.length,o={http:80,https:443},s={},a=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=a.exec(t||"");i--;)u[i]&&(s[r[i]]=u[i]);if(!s.scheme){n&&"string"!=typeof n||(n=e(n||document.location.href)),s.scheme=n.scheme,s.host=n.host,s.port=n.port;var c="";/^[^\/]/.test(s.path)&&(c=n.path,c=/\/[^\/]*\.[^\/]*$/.test(c)?c.replace(/\/[^\/]+$/,"/"):c.replace(/\/?$/,"/")),s.path=c+(s.path||"")}return s.port||(s.port=o[s.scheme]||80),s.port=parseInt(s.port,10),s.path||(s.path="/"),delete s.source,s},t=function(t){var n={http:80,https:443},r="object"==typeof t?t:e(t);return r.scheme+"://"+r.host+(r.port!==n[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),r(v,[s,f,d],function(e,t,n){function r(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return r.prototype=n.instance,r}),r(b,[s,f,m],function(e,t,n){return function(){function r(e,t){if(!t.isDetached()){var r=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),r}var i=t.getSource();switch(e){case"readAsBinaryString":return i;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(i);case"readAsText":for(var o="",s=0,a=i.length;a>s;s++)o+=String.fromCharCode(i[s]);return o}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return r.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return r.call(this,"readAsDataURL",e)},readAsText:function(e){return r.call(this,"readAsText",e)}})}}),r(R,[h,s,_],function(e,t,n){function r(){var e,r=[];t.extend(this,{append:function(i,o){var s=this,a=t.typeOf(o);o instanceof n?e={name:i,value:o}:"array"===a?(i+="[]",t.each(o,function(e){s.append(i,e)})):"object"===a?t.each(o,function(e,t){s.append(i+"["+t+"]",e)}):"null"===a||"undefined"===a||"number"===a&&isNaN(o)?s.append(i,"false"):r.push({name:i,value:o.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(n){t.each(r,function(e){n(e.value,e.name)}),e&&n(e.value,e.name)},destroy:function(){e=null,r=[]}})}return r}),r(T,[s,h,d,m,C,p,v,_,b,R,a,c],function(e,t,n,r,i,o,s,a,u,c,l,h){function d(){this.uid=e.guid("uid_")}function p(){function n(e,t){return A.hasOwnProperty(e)?1===arguments.length?l.can("define_property")?A[e]:T[e]:void(l.can("define_property")?A[e]=t:T[e]=t):void 0}function u(t){function r(){b&&(b.destroy(),b=null),a.dispatchEvent("loadend"),a=null}function i(i){b.bind("LoadStart",function(e){n("readyState",p.LOADING),a.dispatchEvent("readystatechange"),a.dispatchEvent(e),J&&a.upload.dispatchEvent(e)}),b.bind("Progress",function(e){n("readyState")!==p.LOADING&&(n("readyState",p.LOADING),a.dispatchEvent("readystatechange")),a.dispatchEvent(e)}),b.bind("UploadProgress",function(e){J&&a.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),b.bind("Load",function(t){n("readyState",p.DONE),n("status",Number(i.exec.call(b,"XMLHttpRequest","getStatus")||0)),n("statusText",f[n("status")]||""),n("response",i.exec.call(b,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),B=i.exec.call(b,"XMLHttpRequest","getAllResponseHeaders"),a.dispatchEvent("readystatechange"),n("status")>0?(J&&a.upload.dispatchEvent(t),a.dispatchEvent(t)):(L=!0,a.dispatchEvent("error")),r()}),b.bind("Abort",function(e){a.dispatchEvent(e),r()}),b.bind("Error",function(e){L=!0,n("readyState",p.DONE),a.dispatchEvent("readystatechange"),P=!0,a.dispatchEvent(e),r()}),i.exec.call(b,"XMLHttpRequest","send",{url:_,method:E,async:w,user:S,password:y,headers:I,mimeType:x,encoding:O,responseType:a.responseType,withCredentials:a.withCredentials,options:H},t)}var a=this;C=(new Date).getTime(),b=new s,"string"==typeof H.required_caps&&(H.required_caps=o.parseCaps(H.required_caps)),H.required_caps=e.extend({},H.required_caps,{return_response_type:a.responseType}),t instanceof c&&(H.required_caps.send_multipart=!0),e.isEmptyObj(I)||(H.required_caps.send_custom_headers=!0),M||(H.required_caps.do_cors=!0),H.ruid?i(b.connectRuntime(H)):(b.bind("RuntimeInit",function(e,t){
i(t)}),b.bind("RuntimeError",function(e,t){a.dispatchEvent("RuntimeError",t)}),b.connectRuntime(H))}function m(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),C=v=null}var _,E,S,y,C,v,b,R,T=this,A={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},w=!0,I={},O=null,x=null,N=!1,D=!1,J=!1,P=!1,L=!1,M=!1,U=null,k=null,H={},B="";e.extend(this,A,{uid:e.guid("uid_"),upload:new d,open:function(o,s,a,u,c){var l;if(!o||!s)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||r.utf8_encode(o)!==o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(E=o.toUpperCase()),~e.inArray(E,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(s=r.utf8_encode(s),l=i.parseUrl(s),M=i.hasSameOrigin(l),_=i.resolveUrl(s),(u||c)&&!M)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(S=u||l.user,y=c||l.pass,!1===(w=a||!0)&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);N=!w,D=!1,I={},m.call(this),n("readyState",p.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(i,o){var s=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==p.OPENED||D)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(i)||r.utf8_encode(i)!==i)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return i=e.trim(i).toLowerCase(),!~e.inArray(i,s)&&!/^(proxy\-|sec\-)/.test(i)&&(I[i]?I[i]+=", "+o:I[i]=o,!0)},getAllResponseHeaders:function(){return B||""},getResponseHeader:function(t){return t=t.toLowerCase(),L||~e.inArray(t,["set-cookie","set-cookie2"])?null:B&&""!==B&&(R||(R={},e.each(B.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),R[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),R.hasOwnProperty(t))?R[t].header+": "+R[t].value:null},overrideMimeType:function(r){var i,o;if(~e.inArray(n("readyState"),[p.LOADING,p.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(r=e.trim(r.toLowerCase()),/;/.test(r)&&(i=r.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(r=i[1],i[2]&&(o=i[2])),!h.mimes[r])throw new t.DOMException(t.DOMException.SYNTAX_ERR);U=r,k=o},send:function(n,i){if(H="string"===e.typeOf(i)?{ruid:i}:i||{},this.readyState!==p.OPENED||D)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof a)H.ruid=n.ruid,x=n.type||"application/octet-stream";else if(n instanceof c){if(n.hasBlob()){var o=n.getBlob();H.ruid=o.ruid,x=o.type||"application/octet-stream"}}else"string"==typeof n&&(O="UTF-8",x="text/plain;charset=UTF-8",n=r.utf8_encode(n));this.withCredentials||(this.withCredentials=H.required_caps&&H.required_caps.send_browser_cookies&&!M),J=!N&&this.upload.hasEventListener(),L=!1,P=!n,N||(D=!0),u.call(this,n)},abort:function(){if(L=!0,N=!1,~e.inArray(n("readyState"),[p.UNSENT,p.OPENED,p.DONE]))n("readyState",p.UNSENT);else{if(n("readyState",p.DONE),D=!1,!b)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);b.getRuntime().exec.call(b,"XMLHttpRequest","abort",P),P=!0}},destroy:function(){b&&("function"===e.typeOf(b.destroy)&&b.destroy(),b=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(g.concat(["readystatechange"])),this.upload.handleEventProps(g)}var f={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};d.prototype=n.instance;var g=["loadstart","progress","abort","error","load","timeout","loadend"];return p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,p.prototype=n.instance,p}),r(A,[s,m,f,d],function(e,t,n,r){function i(){function r(){l=h=0,c=this.result=null}function o(t,n){var r=this;u=n,r.bind("TransportingProgress",function(t){h=t.loaded,l>h&&-1===e.inArray(r.state,[i.IDLE,i.DONE])&&s.call(r)},999),r.bind("TransportingComplete",function(){h=l,r.state=i.DONE,c=null,r.result=u.exec.call(r,"Transporter","getAsBlob",t||"")},999),r.state=i.BUSY,r.trigger("TransportingStarted"),s.call(r)}function s(){var e,n=this,r=l-h;d>r&&(d=r),e=t.btoa(c.substr(h,d)),u.exec.call(n,"Transporter","receive",e,l)}var a,u,c,l,h,d;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:i.IDLE,result:null,transport:function(t,n,i){var s=this;if(i=e.extend({chunk_size:204798},i),(a=i.chunk_size%3)&&(i.chunk_size+=3-a),d=i.chunk_size,r.call(this),c=t,l=t.length,"string"===e.typeOf(i)||i.ruid)o.call(s,n,this.connectRuntime(i));else{var u=function(e,t){s.unbind("RuntimeInit",u),o.call(s,n,t)};this.bind("RuntimeInit",u),this.connectRuntime(i)}},abort:function(){var e=this;e.state=i.IDLE,u&&(u.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),r.call(e)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),r.call(this)}})}return i.IDLE=0,i.BUSY=1,i.DONE=2,i.prototype=r.instance,i}),r(w,[s,l,h,b,T,p,f,A,a,d,_,E,m],function(e,t,n,r,i,o,s,a,u,c,l,h,d){function p(){function r(e){e||(e=this.exec("Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name)}function c(t){var r=e.typeOf(t);try{if(t instanceof p){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);g.apply(this,arguments)}else if(t instanceof l){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);m.apply(this,arguments)}else if(-1!==e.inArray(r,["blob","file"]))c.call(this,new h(null,t),arguments[1]);else if("string"===r)"data:"===t.substr(0,5)?c.call(this,new l(null,{data:t}),arguments[1]):_.apply(this,arguments);else{if("node"!==r||"img"!==t.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);c.call(this,t.src,arguments[1])}}catch(e){this.trigger("error",e.code)}}function g(t,n){var r=this.connectRuntime(t.ruid);this.ruid=r.uid,r.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)||n)}function m(t,n){function r(e){i.ruid=e.uid,e.exec.call(i,"Image","loadFromBlob",t)}var i=this;i.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){r(t)}),n&&"string"==typeof n.required_caps&&(n.required_caps=o.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):r(this.connectRuntime(t.ruid))}function _(e,t){var n,r=this;n=new i,n.open("get",e),n.responseType="blob",n.onprogress=function(e){r.trigger(e)},n.onload=function(){m.call(r,n.response,!0)},n.onerror=function(e){r.trigger(e)},n.onloadend=function(){n.destroy()},n.bind("RuntimeError",function(e,t){r.trigger("RuntimeError",t)}),n.send(null,t)}s.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){c.apply(this,arguments)},downsize:function(t){var r={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};t="object"==typeof t?e.extend(r,t):e.extend(r,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(e){this.trigger("error",e.code)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",e||"image/jpeg",t||90)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",e||"image/jpeg",t||90)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return d.atob(n.substring(n.indexOf("base64,")+7))},embed:function(r,i){function o(t,i){var o=this;if(u.can("create_canvas")){var l=o.getAsCanvas();if(l)return r.appendChild(l),l=null,o.destroy(),void c.trigger("embedded")}var h=o.getAsDataURL(t,i);if(!h)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",h.length))r.innerHTML='<img src="'+h+'" width="'+o.width+'" height="'+o.height+'" />',o.destroy(),c.trigger("embedded");else{var p=new a;p.bind("TransportingComplete",function(){s=c.connectRuntime(this.result.ruid),c.bind("Embedded",function(){e.extend(s.getShimContainer().style,{top:"0px",left:"0px",width:o.width+"px",height:o.height+"px"}),s=null},999),s.exec.call(c,"ImageView","display",this.result.uid,width,height),o.destroy()}),p.transport(d.atob(h.substring(h.indexOf("base64,")+7)),t,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r})}}var s,c=this;i=e.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},i||{});try{if(!(r=t.get(r)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);this.width>p.MAX_RESIZE_WIDTH||(this.height,p.MAX_RESIZE_HEIGHT);var l=new p;return l.bind("Resize",function(){o.call(this,i.type,i.quality)}),l.bind("Load",function(){l.downsize(i)}),this.meta.thumb&&this.meta.thumb.width>=i.width&&this.meta.thumb.height>=i.height?l.load(this.meta.thumb.data):l.clone(this,!1),l}catch(e){this.trigger("error",e.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}}),this.handleEventProps(f),this.bind("Load Resize",function(){r.call(this)},999)}var f=["progress","load","error","resize","embedded"];return p.MAX_RESIZE_WIDTH=8192,p.MAX_RESIZE_HEIGHT=8192,p.prototype=c.instance,p}),r(I,[s,h,p,a],function(e,t,n,r){function i(t){var i=this,a=n.capTest,u=n.capTrue,c=e.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return i.can("access_binary")&&!!s.Image},display_media:a(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:a(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:a(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==r.browser||r.verComp(r.version,9,">"))}()),filter_by_extension:a(function(){return"Chrome"===r.browser&&r.verComp(r.version,28,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||"Safari"===r.browser&&r.verComp(r.version,7,">=")}()),return_response_headers:u,return_response_type:function(e){return!("json"!==e||!window.JSON)||r.can("return_response_type",e)},return_status_code:u,report_upload_progress:a(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return i.can("access_binary")&&r.can("create_canvas")},select_file:function(){return r.can("use_fileinput")&&window.File},select_folder:function(){return i.can("select_file")&&"Chrome"===r.browser&&r.verComp(r.version,21,">=")},select_multiple:function(){return i.can("select_file")&&!("Safari"===r.browser&&"Windows"===r.os)&&!("iOS"===r.os&&r.verComp(r.osVersion,"7.0.0",">")&&r.verComp(r.osVersion,"8.0.0","<"))},send_binary_string:a(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||i.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return i.can("slice_blob")&&i.can("send_multipart")},summon_file_dialog:function(){return i.can("select_file")&&("Firefox"===r.browser&&r.verComp(r.version,4,">=")||"Opera"===r.browser&&r.verComp(r.version,12,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||!!~e.inArray(r.browser,["Chrome","Safari"]))},upload_filesize:u},arguments[2]);n.call(this,t,arguments[1]||o,c),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(i),e=i=null}}(this.destroy)}),e.extend(this.getShim(),s)}var o="html5",s={};return n.addConstructor(o,i),s}),r(O,[s],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var r={},i="moxie_"+e.guid(),o=function(o,s,a,u){var c,l;s=s.toLowerCase(),o.addEventListener?(c=a,o.addEventListener(s,c,!1)):o.attachEvent&&(c=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,a(e)},o.attachEvent("on"+s,c)),o[i]||(o[i]=e.guid()),r.hasOwnProperty(o[i])||(r[o[i]]={}),l=r[o[i]],l.hasOwnProperty(s)||(l[s]=[]),l[s].push({func:c,orig:a,key:u})},s=function(t,n,o){var s,a;if(n=n.toLowerCase(),t[i]&&r[t[i]]&&r[t[i]][n]){s=r[t[i]][n];for(var u=s.length-1;u>=0&&(s[u].orig!==o&&s[u].key!==o||(t.removeEventListener?t.removeEventListener(n,s[u].func,!1):t.detachEvent&&t.detachEvent("on"+n,s[u].func),s[u].orig=null,s[u].func=null,s.splice(u,1),o===a));u--);if(s.length||delete r[t[i]][n],e.isEmptyObj(r[t[i]])){delete r[t[i]];try{delete t[i]}catch(e){t[i]=a}}}};return{addEvent:o,removeEvent:s,removeAllEvents:function(t,n){t&&t[i]&&e.each(r[t[i]],function(e,r){s(t,r,n)})}}}),r("moxie/runtime/html5/file/FileInput",[I,E,s,l,O,c,a],function(e,t,n,r,i,o,s){function a(){var e;n.extend(this,{init:function(a){var u,c,l,h,d,p,f=this,g=f.getRuntime();e=a,l=e.accept.mimes||o.extList2mimes(e.accept,g.can("filter_by_extension")),c=g.getShimContainer(),c.innerHTML='<input id="'+g.uid+'" type="file" style="font-size:999px;opacity:0;"'+(e.multiple&&g.can("select_multiple")?"multiple":"")+(e.directory&&g.can("select_folder")?"webkitdirectory directory":"")+(l?' accept="'+l.join(",")+'"':"")+" />",u=r.get(g.uid),n.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),h=r.get(e.browse_button),g.can("summon_file_dialog")&&("static"===r.getStyle(h,"position")&&(h.style.position="relative"),d=parseInt(r.getStyle(h,"z-index"),10)||1,h.style.zIndex=d,c.style.zIndex=d-1,i.addEvent(h,"click",function(e){var t=r.get(g.uid);t&&!t.disabled&&t.click(),e.preventDefault()},f.uid)),p=g.can("summon_file_dialog")?h:c,i.addEvent(p,"mouseover",function(){f.trigger("mouseenter")},f.uid),i.addEvent(p,"mouseout",function(){f.trigger("mouseleave")},f.uid),i.addEvent(p,"mousedown",function(){f.trigger("mousedown")},f.uid),i.addEvent(r.get(e.container),"mouseup",function(){f.trigger("mouseup")},f.uid),u.onchange=function r(i){if(f.files=[],n.each(this.files,function(n){var r="";return!(!e.directory||"."!=n.name)||(n.webkitRelativePath&&(r="/"+n.webkitRelativePath.replace(/^\//,"")),n=new t(g.uid,n),n.relativePath=r,void f.files.push(n))}),"IE"!==s.browser&&"IEMobile"!==s.browser)this.value="";else{var o=this.cloneNode(!0);this.parentNode.replaceChild(o,this),o.onchange=r}f.files.length&&f.trigger("change")},f.trigger({type:"ready",async:!0}),c=null},disable:function(e){var t,n=this.getRuntime();(t=r.get(n.uid))&&(t.disabled=!!e)},destroy:function(){var t=this.getRuntime(),n=t.getShim(),o=t.getShimContainer();i.removeAllEvents(o,this.uid),i.removeAllEvents(e&&r.get(e.container),this.uid),i.removeAllEvents(e&&r.get(e.browse_button),this.uid),o&&(o.innerHTML=""),n.removeInstance(this.uid),e=o=n=null}})}return e.FileInput=a}),r("moxie/runtime/html5/file/Blob",[I,_],function(e,t){function n(){function e(e,t,n){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),r("moxie/runtime/html5/file/FileDrop",[I,E,s,l,O,c],function(e,t,n,r,i,o){function s(){function e(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var t=n.toArray(e.dataTransfer.types||[]);return-1!==n.inArray("Files",t)||-1!==n.inArray("public.file-url",t)||-1!==n.inArray("application/x-moz-file",t)}function s(e,n){if(u(e)){var r=new t(f,e);r.relativePath=n||"",g.push(r)}}function a(e){for(var t=[],r=0;r<e.length;r++)[].push.apply(t,e[r].extensions.split(/\s*,\s*/));return-1===n.inArray("*",t)?t:[]}function u(e){if(!m.length)return!0;var t=o.getFileExtension(e.name);return!t||-1!==n.inArray(t,m)}function c(e,t){var r=[];n.each(e,function(e){var t=e.webkitGetAsEntry();t&&(t.isFile?s(e.getAsFile(),t.fullPath):r.push(t))}),r.length?l(r,t):t()}function l(e,t){var r=[];n.each(e,function(e){r.push(function(t){h(e,t)})}),n.inSeries(r,function(){t()})}function h(e,t){e.isFile?e.file(function(n){s(n,e.fullPath),t()},function(){t()}):e.isDirectory?d(e,t):t()}function d(e,t){function n(e){i.readEntries(function(t){t.length?([].push.apply(r,t),n(e)):e()},e)}var r=[],i=e.createReader();n(function(){l(r,t)})}var p,f,g=[],m=[];n.extend(this,{init:function(t){var r,o=this;p=t,f=o.ruid,m=a(p.accept),r=p.container,i.addEvent(r,"dragover",function(t){e(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")},o.uid),i.addEvent(r,"drop",function(t){e(t)&&(t.preventDefault(),g=[],t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry?c(t.dataTransfer.items,function(){o.files=g,o.trigger("drop")}):(n.each(t.dataTransfer.files,function(e){s(e)}),o.files=g,o.trigger("drop")))},o.uid),i.addEvent(r,"dragenter",function(e){o.trigger("dragenter")},o.uid),i.addEvent(r,"dragleave",function(e){o.trigger("dragleave")},o.uid)},destroy:function(){i.removeAllEvents(p&&r.get(p.container),this.uid),f=g=m=p=null}})}return e.FileDrop=s}),r(x,[I,m,s],function(e,t,n){function r(){function e(e){return t.atob(e.substring(e.indexOf("base64,")+7))}var r,i=!1;n.extend(this,{read:function(t,o){var s=this;s.result="",r=new window.FileReader,r.addEventListener("progress",function(e){s.trigger(e)}),r.addEventListener("load",function(t){s.result=i?e(r.result):r.result,s.trigger(t)}),r.addEventListener("error",function(e){s.trigger(e,r.error)}),r.addEventListener("loadend",function(e){r=null,s.trigger(e)}),"function"===n.typeOf(r[t])?(i=!1,r[t](o.getSource())):"readAsBinaryString"===t&&(i=!0,r.readAsDataURL(o.getSource()))},abort:function(){r&&r.abort()},destroy:function(){r=null}})}return e.FileReader=r}),r("moxie/runtime/html5/xhr/XMLHttpRequest",[I,s,c,C,E,_,R,h,a],function(e,t,n,r,i,o,s,a,u){function c(){function e(e,t){var n,r,i=this;n=t.getBlob().getSource(),r=new window.FileReader,r.onload=function(){t.append(t.getBlobName(),new o(null,{type:n.type,data:r.result})),f.send.call(i,e,t)},r.readAsBinaryString(n)}function c(){return!window.XMLHttpRequest||"IE"===u.browser&&u.verComp(u.version,8,"<")?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}():new window.XMLHttpRequest}function l(e){var t=e.responseXML,n=e.responseText;return"IE"===u.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===u.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function h(e){var t="----moxieboundary"+(new Date).getTime(),n="--",r="\r\n",i="";if(!this.getRuntime().can("send_binary_string"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);return d.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,s){i+=e instanceof o?n+t+r+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+r+"Content-Type: "+(e.type||"application/octet-stream")+r+r+e.getSource()+r:n+t+r+'Content-Disposition: form-data; name="'+s+'"'+r+r+unescape(encodeURIComponent(e))+r}),i+=n+t+n+r}var d,p,f=this;t.extend(this,{send:function(n,i){var a=this,l="Mozilla"===u.browser&&u.verComp(u.version,4,">=")&&u.verComp(u.version,7,"<"),f="Android Browser"===u.browser,g=!1;if(p=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),d=c(),d.open(n.method,n.url,n.async,n.user,n.password),i instanceof o)i.isDetached()&&(g=!0),i=i.getSource();else if(i instanceof s){if(i.hasBlob())if(i.getBlob().isDetached())i=h.call(a,i),g=!0;else if((l||f)&&"blob"===t.typeOf(i.getBlob().getSource())&&window.FileReader)return void e.call(a,n,i);if(i instanceof s){var m=new window.FormData;i.each(function(e,t){e instanceof o?m.append(t,e.getSource()):m.append(t,e)}),i=m}}d.upload?(n.withCredentials&&(d.withCredentials=!0),d.addEventListener("load",function(e){a.trigger(e)}),d.addEventListener("error",function(e){a.trigger(e)}),d.addEventListener("progress",function(e){a.trigger(e)}),d.upload.addEventListener("progress",function(e){a.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):d.onreadystatechange=function(){switch(d.readyState){case 1:case 2:break;case 3:var e,t;try{r.hasSameOrigin(n.url)&&(e=d.getResponseHeader("Content-Length")||0),d.responseText&&(t=d.responseText.length)}catch(n){e=t=0}a.trigger({type:"progress",lengthComputable:!!e,total:parseInt(e,10),loaded:t});break;case 4:d.onreadystatechange=function(){},0===d.status?a.trigger("error"):a.trigger("load")}},t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){d.setRequestHeader(t,e)}),""!==n.responseType&&"responseType"in d&&("json"!==n.responseType||u.can("return_response_type","json")?d.responseType=n.responseType:d.responseType="text"),g?d.sendAsBinary?d.sendAsBinary(i):function(){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++)e[t]=255&i.charCodeAt(t);d.send(e.buffer)}():d.send(i),a.trigger("loadstart")},getStatus:function(){try{if(d)return d.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var r=new i(t.uid,d.response),o=d.getResponseHeader("Content-Disposition");if(o){var s=o.match(/filename=([\'\"'])([^\1]+)\1/);s&&(p=s[2])}return r.name=p,r.type||(r.type=n.getFileMime(p)),r;case"json":return u.can("return_response_type","json")?d.response:200===d.status&&window.JSON?JSON.parse(d.responseText):null;case"document":return l(d);default:return""!==d.responseText?d.responseText:null}}catch(e){return null}},getAllResponseHeaders:function(){try{return d.getAllResponseHeaders()}catch(e){}return""},abort:function(){d&&d.abort()},destroy:function(){f=p=null}})}return e.XMLHttpRequest=c}),r(N,[s],function(e){function t(e){e instanceof ArrayBuffer?n.apply(this,arguments):r.apply(this,arguments)}function n(t){var n=new DataView(t);e.extend(this,{readByteAt:function(e){return n.getUint8(e)},writeByteAt:function(e,t){n.setUint8(e,t)},SEGMENT:function(e,r,i){switch(arguments.length){case 2:return t.slice(e,e+r);case 1:return t.slice(e);case 3:if(null===i&&(i=new ArrayBuffer),i instanceof ArrayBuffer){var o=new Uint8Array(this.length()-r+i.byteLength);e>0&&o.set(new Uint8Array(t.slice(0,e)),0),o.set(new Uint8Array(i),e),o.set(new Uint8Array(t.slice(e+r)),e+i.byteLength),this.clear(),t=o.buffer,n=new DataView(t);break}default:return t}},length:function(){return t?t.byteLength:0},clear:function(){n=t=null}})}function r(t){function n(e,n,r){r=3===arguments.length?r:t.length-n-1,t=t.substr(0,n)+e+t.substr(r+n)}e.extend(this,{readByteAt:function(e){return t.charCodeAt(e)},writeByteAt:function(e,t){n(String.fromCharCode(t),e,1)},SEGMENT:function(e,r,i){switch(arguments.length){case 1:return t.substr(e);case 2:return t.substr(e,r);case 3:n(null!==i?i:"",e,r);break;default:return t}},length:function(){return t?t.length:0},clear:function(){t=null}})}return e.extend(t.prototype,{littleEndian:!1,read:function(e,t){var n,r,i;if(e+t>this.length())throw new Error("You are trying to read outside the source boundaries.");for(r=this.littleEndian?0:-8*(t-1),i=0,n=0;t>i;i++)n|=this.readByteAt(e+i)<<Math.abs(r+8*i);return n},write:function(e,t,n){var r,i;if(e>this.length())throw new Error("You are trying to write outside the source boundaries.");for(r=this.littleEndian?0:-8*(n-1),i=0;n>i;i++)this.writeByteAt(e+i,t>>Math.abs(r+8*i)&255)},BYTE:function(e){return this.read(e,1)},SHORT:function(e){return this.read(e,2)},LONG:function(e){return this.read(e,4)},SLONG:function(e){var t=this.read(e,4);return t>2147483647?t-4294967296:t},CHAR:function(e){return String.fromCharCode(this.read(e,1))},STRING:function(e,t){return this.asArray("CHAR",e,t).join("")},asArray:function(e,t,n){for(var r=[],i=0;n>i;i++)r[i]=this[e](t+i);return r}}),t}),r(D,[N,h],function(e,t){return function n(r){var i,o,s,a=[],u=0;if(i=new e(r),65496!==i.SHORT(0))throw i.clear(),new t.ImageError(t.ImageError.WRONG_FORMAT);for(o=2;o<=i.length();)if((s=i.SHORT(o))>=65488&&65495>=s)o+=2;else{if(65498===s||65497===s)break;u=i.SHORT(o+2)+2,s>=65505&&65519>=s&&a.push({hex:s,name:"APP"+(15&s),start:o,length:u,segment:i.SEGMENT(o,u)}),o+=u}return i.clear(),{headers:a,restore:function(t){var n,r,i;for(i=new e(t),o=65504==i.SHORT(2)?4+i.SHORT(4):2,r=0,n=a.length;n>r;r++)i.SEGMENT(o,0,a[r].segment),o+=a[r].length;return t=i.SEGMENT(),i.clear(),t},strip:function(t){var r,i,o,s;for(o=new n(t),i=o.headers,o.purge(),r=new e(t),s=i.length;s--;)r.SEGMENT(i[s].start,i[s].length,"");return t=r.SEGMENT(),r.clear(),t},get:function(e){for(var t=[],n=0,r=a.length;r>n;n++)a[n].name===e.toUpperCase()&&t.push(a[n].segment);return t},set:function(e,t){var n,r,i,o=[];for("string"==typeof t?o.push(t):o=t,n=r=0,i=a.length;i>n&&(a[n].name===e.toUpperCase()&&(a[n].segment=o[r],a[n].length=o[r].length,r++),!(r>=o.length));n++);},purge:function(){this.headers=a=[]}}}}),r(J,[s,N,h],function(e,n,r){function i(o){function s(n,i){var o,s,a,u,c,d,p,f,g=this,m=[],_={},E={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},S={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(o=g.SHORT(n),s=0;o>s;s++)if(m=[],p=n+2+12*s,(a=i[g.SHORT(p)])!==t){if(u=E[g.SHORT(p+=2)],c=g.LONG(p+=2),!(d=S[u]))throw new r.ImageError(r.ImageError.INVALID_META_ERR);if(p+=4,d*c>4&&(p=g.LONG(p)+h.tiffHeader),p+d*c>=this.length())throw new r.ImageError(r.ImageError.INVALID_META_ERR);"ASCII"!==u?(m=g.asArray(u,p,c),f=1==c?m[0]:m,l.hasOwnProperty(a)&&"object"!=typeof f?_[a]=l[a][f]:_[a]=f):_[a]=e.trim(g.STRING(p,c).replace(/\0$/,""))}return _}function a(e,t,n){var r,i,o,s=0;if("string"==typeof t){var a=c[e.toLowerCase()];for(var u in a)if(a[u]===t){t=u;break}}r=h[e.toLowerCase()+"IFD"],i=this.SHORT(r);for(var l=0;i>l;l++)if(o=r+12*l+2,this.SHORT(o)==t){s=o+8;break}if(!s)return!1;try{this.write(s,n,4)}catch(e){return!1}return!0}var u,c,l,h,d,p;if(n.call(this,o),c={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},h={tiffHeader:10},d=h.tiffHeader,u={clear:this.clear},e.extend(this,{read:function(){try{return i.prototype.read.apply(this,arguments)}catch(e){throw new r.ImageError(r.ImageError.INVALID_META_ERR)}},write:function(){try{return i.prototype.write.apply(this,arguments)}catch(e){throw new r.ImageError(r.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(e){return this.LONG(e)/this.LONG(e+4)},SRATIONAL:function(e){return this.SLONG(e)/this.SLONG(e+4)},ASCII:function(e){return this.CHAR(e)},TIFF:function(){return p||null},EXIF:function(){var t=null;if(h.exifIFD){try{t=s.call(this,h.exifIFD,c.exif)}catch(e){return null}if(t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,r="";n<t.ExifVersion.length;n++)r+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=r}}return t},GPS:function(){var t=null;if(h.gpsIFD){try{t=s.call(this,h.gpsIFD,c.gps)}catch(e){return null}
t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join("."))}return t},thumb:function(){if(h.IFD1)try{var e=s.call(this,h.IFD1,c.thumb);if("JPEGInterchangeFormat"in e)return this.SEGMENT(h.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}catch(e){}return null},setExif:function(e,t){return("PixelXDimension"===e||"PixelYDimension"===e)&&a.call(this,"exif",e,t)},clear:function(){u.clear(),o=c=l=p=h=u=null}}),65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new r.ImageError(r.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(d),42!==this.SHORT(d+=2))throw new r.ImageError(r.ImageError.INVALID_META_ERR);h.IFD0=h.tiffHeader+this.LONG(d+=2),p=s.call(this,h.IFD0,c.tiff),"ExifIFDPointer"in p&&(h.exifIFD=h.tiffHeader+p.ExifIFDPointer,delete p.ExifIFDPointer),"GPSInfoIFDPointer"in p&&(h.gpsIFD=h.tiffHeader+p.GPSInfoIFDPointer,delete p.GPSInfoIFDPointer),e.isEmptyObj(p)&&(p=null);var f=this.LONG(h.IFD0+12*this.SHORT(h.IFD0)+2);f&&(h.IFD1=h.tiffHeader+f)}return i.prototype=n.prototype,i}),r(P,[s,h,D,N,J],function(e,t,n,r,i){function o(o){function s(e){var t,n,r=0;for(e||(e=u);r<=e.length();){if((t=e.SHORT(r+=2))>=65472&&65475>=t)return r+=5,{height:e.SHORT(r),width:e.SHORT(r+=2)};n=e.SHORT(r+=2),r+=n-2}return null}function a(){l&&c&&u&&(l.clear(),c.purge(),u.clear(),h=c=l=u=null)}var u,c,l,h;if(u=new r(o),65496!==u.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);c=new n(o);try{l=new i(c.get("app1")[0])}catch(e){}h=s.call(this),e.extend(this,{type:"image/jpeg",size:u.length(),width:h&&h.width||0,height:h&&h.height||0,setExif:function(t,n){return!!l&&("object"===e.typeOf(t)?e.each(t,function(e,t){l.setExif(t,e)}):l.setExif(t,n),void c.set("app1",l.SEGMENT()))},writeHeaders:function(){return arguments.length?c.restore(arguments[0]):c.restore(o)},stripHeaders:function(e){return c.strip(e)},purge:function(){a.call(this)}}),l&&(this.meta={tiff:l.TIFF(),exif:l.EXIF(),gps:l.GPS(),thumb:function(){var e,t,n=l.thumb();return n&&(e=new r(n),t=s(e),e.clear(),t)?(t.data=n,t):null}()})}return o}),r(L,[h,s,N],function(e,t,n){function r(r){function i(){var e,t;return e=s.call(this,8),"IHDR"==e.type?(t=e.start,{width:a.LONG(t),height:a.LONG(t+=4)}):null}function o(){a&&(a.clear(),r=l=u=c=a=null)}function s(e){var t,n,r,i;return t=a.LONG(e),n=a.STRING(e+=4,4),r=e+=4,i=a.LONG(e+t),{length:t,type:n,start:r,CRC:i}}var a,u,c,l;a=new n(r),function(){var t=0,n=0,r=[35152,20039,3338,6666];for(n=0;n<r.length;n++,t+=2)if(r[n]!=a.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),l=i.call(this),t.extend(this,{type:"image/png",size:a.length(),width:l.width,height:l.height,purge:function(){o.call(this)}}),o.call(this)}return r}),r(M,[s,h,P,L],function(e,t,n,r){return function(i){var o,s=[n,r];o=function(){for(var e=0;e<s.length;e++)try{return new s[e](i)}catch(e){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){i=null}}),e.extend(this,o),this.purge=function(){o.purge(),o=null}}}),r(U,[],function(){function e(e,r,i){var o=e.naturalWidth,s=e.naturalHeight,a=i.width,u=i.height,c=i.x||0,l=i.y||0,h=r.getContext("2d");t(e)&&(o/=2,s/=2);var d=1024,p=document.createElement("canvas");p.width=p.height=d;for(var f=p.getContext("2d"),g=n(e,o,s),m=0;s>m;){for(var _=m+d>s?s-m:d,E=0;o>E;){var S=E+d>o?o-E:d;f.clearRect(0,0,d,d),f.drawImage(e,-E,-m);var y=E*a/o+c<<0,C=Math.ceil(S*a/o),v=m*u/s/g+l<<0,b=Math.ceil(_*u/s/g);h.drawImage(p,0,0,S,_,y,v,C,b),E+=d}m+=d}p=f=null}function t(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var r=n.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}function n(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var o=i.getImageData(0,0,1,n).data,s=0,a=n,u=n;u>s;){0===o[4*(u-1)+3]?a=u:s=u,u=a+s>>1}r=null;var c=u/n;return 0===c?1:c}return{isSubsampled:t,renderTo:e}}),r(k,[I,s,h,m,_,E,M,U,c,a],function(e,t,n,r,i,o,s,a,u,c){function l(){function e(){if(!y&&!E)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return y||E}function l(e){return r.atob(e.substring(e.indexOf("base64,")+7))}function h(e,t){return"data:"+(t||"")+";base64,"+r.btoa(e)}function d(e){var t=this;E=new Image,E.onerror=function(){_.call(this),t.trigger("error",n.ImageError.WRONG_FORMAT)},E.onload=function(){t.trigger("load")},E.src="data:"==e.substr(0,5)?e:h(e,v.type)}function p(e,t){var r,i=this;return window.FileReader?(r=new FileReader,r.onload=function(){t(this.result)},r.onerror=function(){i.trigger("error",n.ImageError.WRONG_FORMAT)},void r.readAsDataURL(e)):t(e.getAsDataURL())}function f(n,r,i,o){var s,a,u,c,l,h=this,d=0,p=0;if(T=o,l=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(l,[5,6,7,8])){var f=n;n=r,r=f}return a=e(),i?(n=Math.min(n,a.width),r=Math.min(r,a.height),s=Math.max(n/a.width,r/a.height)):s=Math.min(n/a.width,r/a.height),s>1&&!i&&o?void this.trigger("Resize"):(y||(y=document.createElement("canvas")),u=Math.round(a.width*s),c=Math.round(a.height*s),i?(y.width=n,y.height=r,u>n&&(d=Math.round((u-n)/2)),c>r&&(p=Math.round((c-r)/2))):(y.width=u,y.height=c),T||m(y.width,y.height,l),g.call(this,a,y,-d,-p,u,c),this.width=y.width,this.height=y.height,R=!0,void h.trigger("Resize"))}function g(e,t,n,r,i,o){if("iOS"===c.OS)a.renderTo(e,t,{width:i,height:o,x:n,y:r});else{t.getContext("2d").drawImage(e,n,r,i,o)}}function m(e,t,n){switch(n){case 5:case 6:case 7:case 8:y.width=t,y.height=e;break;default:y.width=e,y.height=t}var r=y.getContext("2d");switch(n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-e,0)}}function _(){S&&(S.purge(),S=null),C=E=y=v=null,R=!1}var E,S,y,C,v,b=this,R=!1,T=!0;t.extend(this,{loadFromBlob:function(e){var t=this,r=t.getRuntime(),i=!(arguments.length>1)||arguments[1];if(!r.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return v=e,e.isDetached()?(C=e.getSource(),void d.call(this,C)):void p.call(this,e.getSource(),function(e){i&&(C=l(e)),d.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,v=new o(null,{name:e.name,size:e.size,type:e.type}),d.call(this,t?C=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var t,n=this.getRuntime();return!S&&C&&n.can("access_image_binary")&&(S=new s(C)),t={width:e().width||0,height:e().height||0,type:v.type||u.getFileMime(v.name),size:C&&C.length||v.size||0,name:v.name||"",meta:S&&S.meta||this.meta||{}},!t.meta||!t.meta.thumb||t.meta.thumb.data instanceof i||(t.meta.thumb.data=new i(null,{type:"image/jpeg",data:t.meta.thumb.data})),t},downsize:function(){f.apply(this,arguments)},getAsCanvas:function(){return y&&(y.id=this.uid+"_canvas"),y},getAsBlob:function(e,t){return e!==this.type&&f.call(this,this.width,this.height,!1),new o(null,{name:v.name||"",type:e,data:b.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!R)return E.src;if("image/jpeg"!==e)return y.toDataURL("image/png");try{return y.toDataURL("image/jpeg",t/100)}catch(e){return y.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!R)return C||(C=l(b.getAsDataURL(e,t))),C;if("image/jpeg"!==e)C=l(b.getAsDataURL(e,t));else{var n;t||(t=90);try{n=y.toDataURL("image/jpeg",t/100)}catch(e){n=y.toDataURL("image/jpeg")}C=l(n),S&&(C=S.stripHeaders(C),T&&(S.meta&&S.meta.exif&&S.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),C=S.writeHeaders(C)),S.purge(),S=null)}return R=!1,C},destroy:function(){b=null,_.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=l}),r(H,[s,a,l,h,p],function(e,t,n,r,i){function o(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function s(e){var r=n.get(e);r&&"OBJECT"==r.nodeName&&("IE"===t.browser?(r.style.display="none",function t(){4==r.readyState?a(e):setTimeout(t,10)}()):r.parentNode.removeChild(r))}function a(e){var t=n.get(e);if(t){for(var r in t)"function"==typeof t[r]&&(t[r]=null);t.parentNode.removeChild(t)}}function u(a){var u,h=this;a=e.extend({swf_url:t.swf_url},a),i.call(this,a,c,{access_binary:function(e){return e&&"browser"===h.mode},access_image_binary:function(e){return e&&"browser"===h.mode},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===h.mode},resize_image:i.capTrue,return_response_headers:!1,return_response_type:function(t){return!("json"!==t||!window.JSON)||(!e.arrayDiff(t,["","text","document"])||"browser"===h.mode)},return_status_code:function(t){return"browser"===h.mode||!e.arrayDiff(t,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:function(e){return e&&"browser"===h.mode},send_browser_cookies:function(e){return e&&"browser"===h.mode},send_custom_headers:function(e){return e&&"browser"===h.mode},send_multipart:i.capTrue,slice_blob:function(e){return e&&"browser"===h.mode},stream_upload:function(e){return e&&"browser"===h.mode},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===h.mode},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),o()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return h.getShim().exec(this.uid,e,t,n)},init:function(){var n,i,o;o=this.getShimContainer(),e.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===t.browser?(i=document.createElement("div"),o.appendChild(i),i.outerHTML=n,i=o=null):o.innerHTML=n,u=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){s(h.uid),e.call(h),clearTimeout(u),a=u=e=h=null}}(this.destroy)},l)}var c="flash",l={};return i.addConstructor(c,u),l}),r("moxie/runtime/flash/file/FileInput",[H,E,s],function(e,t,n){var r={init:function(e){var r=this,i=this.getRuntime();this.bind("Change",function(){var e=i.shimExec.call(r,"FileInput","getFiles");r.files=[],n.each(e,function(e){r.files.push(new t(i.uid,e))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=r}),r(B,[H,_],function(e,t){var n={slice:function(e,n,r,i){var o=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>r?r=Math.max(e.size+r,0):r>0&&(r=Math.min(r,e.size)),e=o.shimExec.call(this,"Blob","slice",n,r,i||""),e&&(e=new t(o.uid,e)),e}};return e.Blob=n}),r(F,[H,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r=this;return r.result="","readAsDataURL"===e&&(r.result="data:"+(t.type||"")+";base64,"),r.bind("Progress",function(t,i){i&&(r.result+=n(i,e))},999),r.getRuntime().shimExec.call(this,"FileReader","readAsBase64",t.uid)}};return e.FileReader=r}),r(q,[H,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r;return(r=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(r="data:"+(t.type||"")+";base64,"+r),n(r,e,t.type)):null}};return e.FileReaderSync=r}),r(X,[H,s,_,E,b,R,A],function(e,t,n,r,i,o,s){var a={send:function(e,r){function i(){e.transport=l.mode,l.shimExec.call(c,"XMLHttpRequest","send",e,r)}function a(e,t){l.shimExec.call(c,"XMLHttpRequest","appendBlob",e,t.uid),r=null,i()}function u(e,t){var n=new s;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:l.uid})}var c=this,l=c.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){l.shimExec.call(c,"XMLHttpRequest","setRequestHeader",t,e.toString())}),r instanceof o){var h;if(r.each(function(e,t){e instanceof n?h=t:l.shimExec.call(c,"XMLHttpRequest","append",t,e)}),r.hasBlob()){var d=r.getBlob();d.isDetached()?u(d,function(e){d.destroy(),a(h,e)}):a(h,d)}else r=null,i()}else r instanceof n?r.isDetached()?u(r,function(e){r.destroy(),r=e.uid,i()}):(r=r.uid,i()):i()},getResponse:function(e){var n,o,s=this.getRuntime();if(o=s.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(o=new r(s.uid,o),"blob"===e)return o;try{if(n=new i,~t.inArray(e,["","text"]))return n.readAsText(o);if("json"===e&&window.JSON)return JSON.parse(n.readAsText(o))}finally{o.destroy()}}return null},abort:function(e){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=a}),r(j,[H,_],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),r=n.shimExec.call(this,"Transporter","getAsBlob",e);return r?new t(n.uid,r):null}};return e.Transporter=n}),r(G,[H,s,A,_,b],function(e,t,n,r,i){var o={loadFromBlob:function(e){function t(e){i.shimExec.call(r,"Image","loadFromBlob",e.uid),r=i=null}var r=this,i=r.getRuntime();if(e.isDetached()){var o=new n;o.bind("TransportingComplete",function(){t(o.result.getSource())}),o.transport(e.getSource(),e.type,{ruid:i.uid})}else t(e.getSource())},loadFromImage:function(e){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",e.uid)},getInfo:function(){var e=this.getRuntime(),t=e.shimExec.call(this,"Image","getInfo");return!t.meta||!t.meta.thumb||t.meta.thumb.data instanceof r||(t.meta.thumb.data=new r(e.uid,t.meta.thumb.data)),t},getAsBlob:function(e,t){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getAsBlob",e,t);return i?new r(n.uid,i):null},getAsDataURL:function(){var e,t=this.getRuntime(),n=t.Image.getAsBlob.apply(this,arguments);return n?(e=new i,e.readAsDataURL(n)):null}};return e.Image=o}),r(z,[s,a,l,h,p],function(e,t,n,r,i){function o(e){var t,n,r,i,o,s=!1,a=null,u=0;try{try{a=new ActiveXObject("AgControl.AgControl"),a.IsVersionSupported(e)&&(s=!0),a=null}catch(a){var c=navigator.plugins["Silverlight Plug-In"];if(c){for(t=c.description,"1.0.30226.2"===t&&(t="2.0.30226.2"),n=t.split(".");n.length>3;)n.pop();for(;n.length<4;)n.push(0);for(r=e.split(".");r.length>4;)r.pop();do{i=parseInt(r[u],10),o=parseInt(n[u],10),u++}while(u<r.length&&i===o);o>=i&&!isNaN(i)&&(s=!0)}}}catch(e){s=!1}return s}function s(s){var c,l=this;s=e.extend({xap_url:t.xap_url},s),i.call(this,s,a,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function(e){return e&&"client"===l.mode},return_response_type:function(e){return"json"!==e||!!window.JSON},return_status_code:function(t){return"client"===l.mode||!e.arrayDiff(t,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function(e){return e&&"browser"===l.mode},send_custom_headers:function(e){return e&&"client"===l.mode},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:i.capTrue,use_http_method:function(t){return"client"===l.mode||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}}),o("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return l.getShim().exec(this.uid,e,t,n)},init:function(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+s.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/></object>',c=setTimeout(function(){l&&!l.initialized&&l.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3)},destroy:function(e){return function(){e.call(l),clearTimeout(c),s=c=e=l=null}}(this.destroy)},u)}var a="silverlight",u={};return i.addConstructor(a,s),u}),r("moxie/runtime/silverlight/file/FileInput",[z,E,s],function(e,t,n){var r={init:function(e){var r=this,i=this.getRuntime();this.bind("Change",function(){var e=i.shimExec.call(r,"FileInput","getFiles");r.files=[],n.each(e,function(e){r.files.push(new t(i.uid,e))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",function(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=r}),r("moxie/runtime/silverlight/file/Blob",[z,s,B],function(e,t,n){return e.Blob=t.extend({},n)}),r("moxie/runtime/silverlight/file/FileDrop",[z,l,O],function(e,t,n){var r={init:function(){var e,r=this,i=r.getRuntime();return e=i.getShimContainer(),n.addEvent(e,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},r.uid),n.addEvent(e,"dragenter",function(e){e.preventDefault(),t.get(i.uid).dragEnter(e)&&e.stopPropagation()},r.uid),n.addEvent(e,"drop",function(e){e.preventDefault(),t.get(i.uid).dragDrop(e)&&e.stopPropagation()},r.uid),i.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=r}),r("moxie/runtime/silverlight/file/FileReader",[z,s,F],function(e,t,n){return e.FileReader=t.extend({},n)}),r("moxie/runtime/silverlight/file/FileReaderSync",[z,s,q],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),r("moxie/runtime/silverlight/xhr/XMLHttpRequest",[z,s,X],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),r("moxie/runtime/silverlight/runtime/Transporter",[z,s,j],function(e,t,n){return e.Transporter=t.extend({},n)}),r("moxie/runtime/silverlight/image/Image",[z,s,_,G],function(e,t,n,r){return e.Image=t.extend({},r,{getInfo:function(){var e=this.getRuntime(),r=["tiff","exif","gps","thumb"],i={meta:{}},o=e.shimExec.call(this,"Image","getInfo");return o.meta&&(t.each(r,function(e){var t,n,r,s,a=o.meta[e];if(a&&a.keys)for(i.meta[e]={},n=0,r=a.keys.length;r>n;n++)t=a.keys[n],(s=a[t])&&(/^(\d|[1-9]\d+)$/.test(s)?s=parseInt(s,10):/^\d*\.\d+$/.test(s)&&(s=parseFloat(s)),i.meta[e][t]=s)}),!i.meta||!i.meta.thumb||i.meta.thumb.data instanceof n||(i.meta.thumb.data=new n(e.uid,i.meta.thumb.data))),i.width=parseInt(o.width,10),i.height=parseInt(o.height,10),i.size=parseInt(o.size,10),i.type=o.type,i.name=o.name,i}})}),r(V,[s,h,p,a],function(e,t,n,r){function i(t){var i=this,a=n.capTest,u=n.capTrue;n.call(this,t,o,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a(s.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:a(function(){return"Chrome"===r.browser&&r.verComp(r.version,28,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||"Safari"===r.browser&&r.verComp(r.version,7,">=")}()),resize_image:function(){return s.Image&&i.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return!("json"!==t||!window.JSON)||!!~e.inArray(t,["text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return r.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return i.can("select_file")},summon_file_dialog:function(){return i.can("select_file")&&("Firefox"===r.browser&&r.verComp(r.version,4,">=")||"Opera"===r.browser&&r.verComp(r.version,12,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||!!~e.inArray(r.browser,["Chrome","Safari"]))},upload_filesize:u,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(i),e=i=null}}(this.destroy)}),e.extend(this.getShim(),s)}var o="html4",s={};return n.addConstructor(o,i),s}),r("moxie/runtime/html4/file/FileInput",[V,E,s,l,O,c,a],function(e,t,n,r,i,o,s){function a(){function e(){var o,l,h,d,p,f,g=this,m=g.getRuntime();f=n.guid("uid_"),o=m.getShimContainer(),a&&(h=r.get(a+"_form"))&&n.extend(h.style,{top:"100%"}),d=document.createElement("form"),d.setAttribute("id",f+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),n.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=document.createElement("input"),p.setAttribute("id",f),p.setAttribute("type","file"),p.setAttribute("name",u.name||"Filedata"),p.setAttribute("accept",c.join(",")),n.extend(p.style,{fontSize:"999px",opacity:0}),d.appendChild(p),o.appendChild(d),n.extend(p.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===s.browser&&s.verComp(s.version,10,"<")&&n.extend(p.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),p.onchange=function(){var n;if(this.value){if(this.files){if(n=this.files[0],0===n.size)return void d.parentNode.removeChild(d)}else n={name:this.value};n=new t(m.uid,n),this.onchange=function(){},e.call(g),g.files=[n],p.setAttribute("id",n.uid),d.setAttribute("id",n.uid+"_form"),g.trigger("change"),p=d=null}},m.can("summon_file_dialog")&&(l=r.get(u.browse_button),i.removeEvent(l,"click",g.uid),i.addEvent(l,"click",function(e){p&&!p.disabled&&p.click(),e.preventDefault()},g.uid)),a=f,o=h=l=null}var a,u,c=[];n.extend(this,{init:function(t){var n,s=this,a=s.getRuntime();u=t,c=t.accept.mimes||o.extList2mimes(t.accept,a.can("filter_by_extension")),n=a.getShimContainer(),function(){var e,o,u;e=r.get(t.browse_button),a.can("summon_file_dialog")&&("static"===r.getStyle(e,"position")&&(e.style.position="relative"),o=parseInt(r.getStyle(e,"z-index"),10)||1,e.style.zIndex=o,n.style.zIndex=o-1),u=a.can("summon_file_dialog")?e:n,i.addEvent(u,"mouseover",function(){s.trigger("mouseenter")},s.uid),i.addEvent(u,"mouseout",function(){s.trigger("mouseleave")},s.uid),i.addEvent(u,"mousedown",function(){s.trigger("mousedown")},s.uid),i.addEvent(r.get(t.container),"mouseup",function(){s.trigger("mouseup")},s.uid),e=null}(),e.call(this),n=null,s.trigger({type:"ready",async:!0})},disable:function(e){var t;(t=r.get(a))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),n=e.getShimContainer();i.removeAllEvents(n,this.uid),i.removeAllEvents(u&&r.get(u.container),this.uid),i.removeAllEvents(u&&r.get(u.browse_button),this.uid),n&&(n.innerHTML=""),t.removeInstance(this.uid),a=c=u=n=t=null}})}return e.FileInput=a}),r("moxie/runtime/html4/file/FileReader",[V,x],function(e,t){return e.FileReader=t}),r("moxie/runtime/html4/xhr/XMLHttpRequest",[V,s,l,C,h,O,_,R],function(e,t,n,r,i,o,s,a){function u(){function e(e){var t,r,i,s,a=this,u=!1;if(l){if(t=l.id.replace(/_iframe$/,""),r=n.get(t+"_form")){for(i=r.getElementsByTagName("input"),s=i.length;s--;)switch(i[s].getAttribute("type")){case"hidden":i[s].parentNode.removeChild(i[s]);break;case"file":u=!0}i=[],u||r.parentNode.removeChild(r),r=null}setTimeout(function(){o.removeEvent(l,"load",a.uid),l.parentNode&&l.parentNode.removeChild(l);var t=a.getRuntime().getShimContainer();t.children.length||t.parentNode.removeChild(t),t=l=null,e()},1)}}var u,c,l;t.extend(this,{send:function(h,d){var p,f,g,m,_=this,E=_.getRuntime();if(u=c=null,d instanceof a&&d.hasBlob()){if(m=d.getBlob(),p=m.uid,g=n.get(p),!(f=n.get(p+"_form")))throw new i.DOMException(i.DOMException.NOT_FOUND_ERR)}else p=t.guid("uid_"),f=document.createElement("form"),f.setAttribute("id",p+"_form"),f.setAttribute("method",h.method),f.setAttribute("enctype","multipart/form-data"),f.setAttribute("encoding","multipart/form-data"),E.getShimContainer().appendChild(f);f.setAttribute("target",p+"_iframe"),d instanceof a&&d.each(function(e,n){if(e instanceof s)g&&g.setAttribute("name",n);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:n,value:e}),g?f.insertBefore(r,g):f.appendChild(r)}}),f.setAttribute("action",h.url),function(){var n=E.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+p+'_iframe" name="'+p+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,n.appendChild(l),o.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,c=t.trim(n.body.innerHTML),_.trigger({type:"progress",loaded:c.length,total:c.length}),m&&_.trigger({type:"uploadprogress",loaded:m.size||1025,total:m.size||1025}))}catch(t){if(!r.hasSameOrigin(h.url))return void e.call(_,function(){_.trigger("error")});u=404}e.call(_,function(){_.trigger("load")})},_.uid)}(),f.submit(),_.trigger("loadstart")},getStatus:function(){return u},getResponse:function(e){if("json"===e&&"string"===t.typeOf(c)&&window.JSON)try{return JSON.parse(c.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(e){return null}return c},abort:function(){var t=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort")})}})}return e.XMLHttpRequest=u}),r("moxie/runtime/html4/image/Image",[V,k],function(e,t){return e.Image=t}),function(n){for(var r=0;r<n.length;r++){for(var i=e,s=n[r],a=s.split(/[.\/]/),u=0;u<a.length-1;++u)i[a[u]]===t&&(i[a[u]]={}),i=i[a[u]];i[a[a.length-1]]=o[s]}}([s,a,u,c,l,h,d,p,f,g,m,_,E,S,y,C,v,b,R,T,A,w,O])}(this),function(e){"use strict";var t={},n=e.moxie.core.utils.Basic.inArray;(function e(r){var i,o;for(i in r)o=typeof r[i],"object"!==o||~n(i,["Exceptions","Env","Mime"])?"function"===o&&(t[i]=r[i]):e(r[i])})(e.moxie),t.Env=e.moxie.core.utils.Env,t.Mime=e.moxie.core.utils.Mime,t.Exceptions=e.moxie.core.Exceptions,e.mOxie=t,e.o||(e.o=t)}(this),function(e,t,n){function r(e){function t(e,t,n){var i={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};i[e]?r[i[e]]=t:n||(r[e]=t)}var n=e.required_features,r={};return"string"==typeof n?s.each(n.split(/\s*,\s*/),function(e){t(e,!0)}):"object"==typeof n?s.each(n,function(e,n){t(n,e)}):!0===n&&(e.chunk_size>0&&(r.slice_blob=!0),!e.resize.enabled&&e.multipart||(r.send_binary_string=!0),s.each(e,function(e,n){t(n,!!e,!0)})),r}var i=e.setTimeout,o={},s={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,getAll:function(e){var t,n=[];"array"!==s.typeOf(e)&&(e=[e]);for(var r=e.length;r--;)(t=s.get(e[r]))&&n.push(t);return n.length?n:null},get:t.get,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var n="";return s.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\D/.test(e))return s.translate("N/A");var r=Math.pow(1024,4);return e>r?t(e/r,1)+" "+s.translate("tb"):e>(r/=1024)?t(e/r,1)+" "+s.translate("gb"):e>(r/=1024)?t(e/r,1)+" "+s.translate("mb"):e>1024?Math.round(e/1024)+" "+s.translate("kb"):e+" "+s.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var r,i;return r=new s.Uploader(e),i=t.Runtime.thatCan(r.getOption().required_features,n||e.runtimes),r.destroy(),i},addFileFilter:function(e,t){o[e]=t}};s.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:s.FILE_EXTENSION_ERROR,message:s.translate("File extension error."),file:t}),n(!1)):n(!0)}),s.addFileFilter("max_file_size",function(e,t,n){e=s.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:s.FILE_SIZE_ERROR,message:s.translate("File size error."),file:t}),n(!1)):n(!0)}),s.addFileFilter("prevent_duplicates",function(e,t,n){if(e)for(var r=this.files.length;r--;)if(t.name===this.files[r].name&&t.size===this.files[r].size)return this.trigger("Error",{code:s.FILE_DUPLICATE_ERROR,message:s.translate("Duplicate file error."),file:t}),void n(!1);n(!0)}),s.Uploader=function(e){function a(){var e,t,n=0;if(this.state==s.STARTED){for(t=0;t<O.length;t++)e||O[t].status!=s.QUEUED?n++:(e=O[t],this.trigger("BeforeUpload",e)&&(e.status=s.UPLOADING,
this.trigger("UploadFile",e)));n==O.length&&(this.state!==s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",O))}}function u(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,c()}function c(){var e,t;for(A.reset(),e=0;e<O.length;e++)t=O[e],t.size!==n?(A.size+=t.origSize,A.loaded+=t.loaded*t.origSize/t.size):A.size=n,t.status==s.DONE?A.uploaded++:t.status==s.FAILED?A.failed++:A.queued++;A.size===n?A.percent=O.length>0?Math.ceil(A.uploaded/O.length*100):0:(A.bytesPerSec=Math.ceil(A.loaded/((+new Date-T||1)/1e3)),A.percent=A.size>0?Math.ceil(A.loaded/A.size*100):0)}function l(){var e=N[0]||D[0];return!!e&&e.getRuntime().uid}function h(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n)}return!1}function d(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",y),this.bind("BeforeUpload",m),this.bind("UploadFile",_),this.bind("UploadProgress",E),this.bind("StateChanged",S),this.bind("QueueChanged",c),this.bind("Error",v),this.bind("FileUploaded",C),this.bind("Destroy",b)}function p(e,n){var r=this,i=0,o=[],a={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:x,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};s.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(a[t]=e[t])}),e.browse_button&&s.each(e.browse_button,function(n){o.push(function(o){var u=new t.FileInput(s.extend({},a,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));u.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),i++,N.push(this),o()},u.onchange=function(){r.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",function(r){J||(e.browse_button_hover&&("mouseenter"===r.type?t.addClass(n,e.browse_button_hover):"mouseleave"===r.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===r.type?t.addClass(n,e.browse_button_active):"mouseup"===r.type&&t.removeClass(n,e.browse_button_active)))}),u.bind("mousedown",function(){r.trigger("Browse")}),u.bind("error runtimeerror",function(){u=null,o()}),u.init()})}),e.drop_element&&s.each(e.drop_element,function(e){o.push(function(n){var o=new t.FileDrop(s.extend({},a,{drop_zone:e}));o.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),i++,D.push(this),n()},o.ondrop=function(){r.addFile(this.files)},o.bind("error runtimeerror",function(){o=null,n()}),o.init()})}),t.inSeries(o,function(){"function"==typeof n&&n(i)})}function f(e,r,i){var o=new t.Image;try{o.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===n&&r.preserve_headers&&!r.crop)return this.destroy(),i(e);o.downsize(r.width,r.height,r.crop,r.preserve_headers)},o.onresize=function(){i(this.getAsBlob(e.type,r.quality)),this.destroy()},o.onerror=function(){i(e)},o.load(e)}catch(t){i(e)}}function g(e,n,i){function o(e,t,n){var r=R[e];switch(e){case"max_file_size":"max_file_size"===e&&(R.max_file_size=R.filters.max_file_size=t);break;case"chunk_size":(t=s.parseSize(t))&&(R[e]=t,R.send_file_name=!0);break;case"multipart":R[e]=t,t||(R.send_file_name=!0);break;case"unique_names":R[e]=t,t&&(R.send_file_name=!0);break;case"filters":"array"===s.typeOf(t)&&(t={mime_types:t}),n?s.extend(R.filters,t):R.filters=t,t.mime_types&&(R.filters.mime_types.regexp=function(e){var t=[];return s.each(e,function(e){s.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(R.filters.mime_types));break;case"resize":n?s.extend(R.resize,t,{enabled:!0}):R.resize=t;break;case"prevent_duplicates":R.prevent_duplicates=R.filters.prevent_duplicates=!!t;break;case"container":case"browse_button":case"drop_element":t="container"===e?s.get(t):s.getAll(t);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":R[e]=t,n||(u=!0);break;default:R[e]=t}n||a.trigger("OptionChanged",e,t,r)}var a=this,u=!1;"object"==typeof e?s.each(e,function(e,t){o(t,e,i)}):o(e,n,i),i?(R.required_features=r(s.extend({},R)),x=r(s.extend({},R,{required_features:!0}))):u&&(a.trigger("Destroy"),p.call(a,R,function(e){e?(a.runtime=t.Runtime.getInfo(l()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}))}function m(e,t){if(e.settings.unique_names){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r}}function _(e,n){function r(){l-- >0?i(o,1e3):(n.loaded=p,e.trigger("Error",{code:s.HTTP_ERROR,message:s.translate("HTTP Error."),file:n,response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()}))}function o(){var h,f,g,m={};n.status===s.UPLOADING&&e.state!==s.STOPPED&&(e.settings.send_file_name&&(m.name=n.target_name||n.name),c&&d.chunks&&a.size>c?(g=Math.min(c,a.size-p),h=a.slice(p,p+g)):(g=a.size,h=a),c&&d.chunks&&(e.settings.send_chunk_number?(m.chunk=Math.ceil(p/c),m.chunks=Math.ceil(a.size/c)):(m.offset=p,m.total=a.size)),w=new t.XMLHttpRequest,w.upload&&(w.upload.onprogress=function(t){n.loaded=Math.min(n.size,p+t.loaded),e.trigger("UploadProgress",n)}),w.onload=function(){if(w.status>=400)return void r();l=e.settings.max_retries,g<a.size?(h.destroy(),p+=g,n.loaded=Math.min(p,a.size),e.trigger("ChunkUploaded",n,{offset:n.loaded,total:a.size,response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&e.trigger("UploadProgress",n)):n.loaded=n.size,h=f=null,!p||p>=a.size?(n.size!=n.origSize&&(a.destroy(),a=null),e.trigger("UploadProgress",n),n.status=s.DONE,e.trigger("FileUploaded",n,{response:w.responseText,status:w.status,responseHeaders:w.getAllResponseHeaders()})):i(o,1)},w.onerror=function(){r()},w.onloadend=function(){this.destroy(),w=null},e.settings.multipart&&d.multipart?(w.open("post",u,!0),s.each(e.settings.headers,function(e,t){w.setRequestHeader(t,e)}),f=new t.FormData,s.each(s.extend(m,e.settings.multipart_params),function(e,t){f.append(t,e)}),f.append(e.settings.file_data_name,h),w.send(f,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:x,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(u=s.buildUrl(e.settings.url,s.extend(m,e.settings.multipart_params)),w.open("post",u,!0),w.setRequestHeader("Content-Type","application/octet-stream"),s.each(e.settings.headers,function(e,t){w.setRequestHeader(t,e)}),w.send(h,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:x,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})))}var a,u=e.settings.url,c=e.settings.chunk_size,l=e.settings.max_retries,d=e.features,p=0;n.loaded&&(p=n.loaded=c?c*Math.floor(n.loaded/c):0),a=n.getSource(),e.settings.resize.enabled&&h(a,"send_binary_string")&&~t.inArray(a.type,["image/jpeg","image/png"])?f.call(this,a,e.settings.resize,function(e){a=e,n.size=e.size,o()}):o()}function E(e,t){u(t)}function S(e){if(e.state==s.STARTED)T=+new Date;else if(e.state==s.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==s.UPLOADING&&(e.files[t].status=s.QUEUED,c())}function y(){w&&w.abort()}function C(e){c(),i(function(){a.call(e)},1)}function v(e,t){t.code===s.INIT_ERROR?e.destroy():t.code===s.HTTP_ERROR&&(t.file.status=s.FAILED,u(t.file),e.state==s.STARTED&&(e.trigger("CancelUpload"),i(function(){a.call(e)},1)))}function b(e){e.stop(),s.each(O,function(e){e.destroy()}),O=[],N.length&&(s.each(N,function(e){e.destroy()}),N=[]),D.length&&(s.each(D,function(e){e.destroy()}),D=[]),x={},J=!1,T=w=null,A.reset()}var R,T,A,w,I=s.guid(),O=[],x={},N=[],D=[],J=!1;R={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},g.call(this,e,null,!0),A=new s.QueueProgress,s.extend(this,{id:I,uid:I,state:s.STOPPED,features:{},runtime:null,files:O,settings:R,total:A,init:function(){var e,n,r=this;return e=r.getOption("preinit"),"function"==typeof e?e(r):s.each(e,function(e,t){r.bind(t,e)}),d.call(r),s.each(["container","browse_button","drop_element"],function(e){if(null===r.getOption(e))return n={code:s.INIT_ERROR,message:s.translate("'%' specified, but cannot be found.")},!1}),n?r.trigger("Error",n):R.browse_button||R.drop_element?void p.call(r,R,function(e){var n=r.getOption("init");"function"==typeof n?n(r):s.each(n,function(e,t){r.bind(t,e)}),e?(r.runtime=t.Runtime.getInfo(l()).type,r.trigger("Init",{runtime:r.runtime}),r.trigger("PostInit")):r.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})}):r.trigger("Error",{code:s.INIT_ERROR,message:s.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(e,t){g.call(this,e,t,!this.runtime)},getOption:function(e){return e?R[e]:R},refresh:function(){N.length&&s.each(N,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=s.STARTED&&(this.state=s.STARTED,this.trigger("StateChanged"),a.call(this))},stop:function(){this.state!=s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){J=arguments[0]===n||arguments[0],N.length&&s.each(N,function(e){e.disable(J)}),this.trigger("DisableBrowse",J)},getFile:function(e){var t;for(t=O.length-1;t>=0;t--)if(O[t].id===e)return O[t]},addFile:function(e,n){function r(e,n){var r=[];t.each(c.settings.filters,function(t,n){o[n]&&r.push(function(r){o[n].call(c,t,e,function(e){r(!e)})})}),t.inSeries(r,n)}function a(e){var o=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!u)return!1;e.ruid=u,e.connectRuntime(u)}a(new s.File(e))}else e instanceof t.Blob?(a(e.getSource()),e.destroy()):e instanceof s.File?(n&&(e.name=n),h.push(function(t){r(e,function(n){n||(O.push(e),d.push(e),c.trigger("FileFiltered",e)),i(t,1)})})):-1!==t.inArray(o,["file","blob"])?a(new t.File(null,e)):"node"===o&&"filelist"===t.typeOf(e.files)?t.each(e.files,a):"array"===o&&(n=null,t.each(e,a))}var u,c=this,h=[],d=[];u=l(),a(e),h.length&&t.inSeries(h,function(){d.length&&c.trigger("FilesAdded",d)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,n=O.length-1;n>=0;n--)if(O[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var r=O.splice(e===n?0:e,t===n?O.length:t),i=!1;return this.state==s.STARTED&&(s.each(r,function(e){if(e.status===s.UPLOADING)return i=!0,!1}),i&&this.stop()),this.trigger("FilesRemoved",r),s.each(r,function(e){e.destroy()}),i&&this.start(),r},dispatchEvent:function(e){var t,n;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort(function(e,t){return t.priority-e.priority}),n=[].slice.call(arguments),n.shift(),n.unshift(this);for(var r=0;r<t.length;r++)if(!1===t[r].fn.apply(t[r].scope,n))return!1}return!0},bind:function(e,t,n,r){s.Uploader.prototype.bind.call(this,e,t,r,n)},destroy:function(){this.trigger("Destroy"),R=A=null,this.unbindAll()}})},s.Uploader.prototype=t.EventTarget.instance,s.File=function(){function e(e){s.extend(this,{id:s.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:s.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),["blob","file"])?e:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete n[this.id])}}),n[this.id]=e}var n={};return e}(),s.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=s}(window,mOxie);var PACKET_HEADER_SIZE=13,OPCODE_MAP={RECV:new BaseList,SEND:new BaseList},OPCODE={AUTH:new _Opcode("auth",1),PING:new _Opcode("ping",2),STREAMEND:new _Opcode("streamend",4),RECEIPTS:new _Opcode("receipts",4098),USER_MESSAGE:new _Opcode("userMessage",4112),INPUT_STATE:new _Opcode("inputState",4117),CHATGROUP_MESSAGE:new _Opcode("chatGroupMessage",4144),PUBACCOUNT_MESSAGE:new _Opcode("pubaccountMessage",4176),SYNC_MESSAGE:new _Opcode("syncMessage",4208),RECEIPTS:new _Opcode("receipts",4098),NOTIFY_MESSAGE:new _Opcode("notifyMessage",4099),MUCONLINEDELIVERPACKET:new _Opcode("MucOnlineDeliverPacket",4368),PUBONLINEDELIVERPACKET:new _Opcode("PubOnlineDeliverPacket",4400),USERONLINEDELIVERPACKET:new _Opcode("UserOnlineDeliverPacket",4432),REMINDSETTINGONLINEDELIVERPACKET:new _Opcode("RemindSettingOnlineDeliverPacket",4448),INVITE_USERS:new _Opcode("inviteUsers",4865),VCARD:new _Opcode("vcard",8209),VCARDS:new _Opcode("vcards",8209,8210),IQ_RESULT:new _Opcode("iqResult",8225),QUERY_USER:new _Opcode("queryUser",8464,8465),QUERY_CHATGROUP:new _Opcode("queryChatGroup",8496,8497),QUERY_PUBACCOUNT:new _Opcode("queryPubaccount",8528,8529),ROSTER_LIST:new _Opcode("rosterList",8736,8737),CHATGROUP_LIST:new _Opcode("chatGroupList",8752,8753),CHATGROUP_MEMBER_LIST:new _Opcode("chatGroupMemberList",8768,8769),PUBACCOUNT_LIST:new _Opcode("pubaccountList",8784,8785),CHATGROUP_INFO:new _Opcode("chatGroupInfo",9008,9009),CHATGROUP_SHARED_FILES:new _Opcode("chatGroupSharedFiles",9010,9011),UPDATE_ROSTER:new _Opcode("updateRoster",9504),CONFIG_CHATGROUP:new _Opcode("chatGroupConfig",9520,9521),CREATE_GROUP:new _Opcode("createGroup",9522,9012),INVITE_GROUP_MEMBER:new _Opcode("inviteGroupMember",9523,9012),MODIFY_GROUP_INFO:new _Opcode("modifyGroupInfo",9524,9012),KICK_GROUP_MEMBER:new _Opcode("kickGroupMember",9525,9012),DISMISS_GROUP:new _Opcode("dismissgtoup",9528,9013),ON_GROUP_TRANSFER:new _Opcode("groupOwnerTransfer",9014),TRANSFER_GROUP:new _Opcode("transferGroup",9529),EXIT_GROUP:new _Opcode("exitGroup",9526,9013),ON_GROUP_UPDATE:new _Opcode("groupUpdate",9012),KICKED_GROUP:new _Opcode("kickedByGroup",9013),FAVORITED_ROSTERT:new _Opcode("favoritedRoster",9505),COLLECT_GROUP:new _Opcode("collectGroup",9527),FULL_SYNC_ROSTER:new _Opcode("fullSyncRoster",10016),DELTA_SYNC_ROSTER:new _Opcode("deltaSyncRoster",10018),FULL_SYNC_CHATGROUP:new _Opcode("fullSyncChatGroup",10032),DELTA_SYNC_CHATGROUP:new _Opcode("deltaSyncChatGroup",10034),PRESENCE:new _Opcode("presence",12289),CHATGROUP:new _Opcode("chatGroup",13057,13058),DEL_GROUPMEMBER:new _Opcode("delGroupMember",9792),OPERATE_WHITEBOARD:new _Opcode("operateWhiteBoard",10241),LISTEN_WHITEBOARD:new _Opcode("listenWhiteBoard",10241,10242),UPDATE_WHITEBOARD:new _Opcode("updateWhiteBoard",10245),PACKET_ERROR:new _Opcode("packetError",16384),STREAM_ERROR:new _Opcode("streamError",16640),MESSAGE_RANGE:new _Range(4096,8192),CREATE_NETMETTING:new _Opcode("createNetMetting",10368),NETMEETING_NOTIFY:new _Opcode("NETMeetingNotify",10369),NETMEETING_MANAGE:new _Opcode("NETMeetingManage",10370),NETMEETING_BILL:new _Opcode("NETMeetingBill",10372),IQ_RANGE:new _Range(8192,12288),PRESENCE_RANGE:new _Range(12288,16384)},SERVICE_OPCODE={SERVICE_USER_MESSAGE:new _Opcode("ServiceUserMessage",6145),SERVICE_RECEIPTS:new _Opcode("ServiceReceipts",6146)};YYIMUtil.extend(OPCODE,SERVICE_OPCODE);var PACKET_STRUCT={CONSOLE_FRAME:new _Range(0,1),OPCODE:new _Range(1,3),PACKET_LEN:new _Range(3,7),VERSION:new _Range(7,9),SEQ_ID:new _Range(9,13)};XmlHttp.create=function(){try{if(window.XMLHttpRequest){var e=new XMLHttpRequest;return null===e.readyState&&(e.readyState=1,e.addEventListener("load",function(){e.readyState=4,"function"==typeof e.onreadystatechange&&e.onreadystatechange()},!1)),e}if(window.ActiveXObject)return new ActiveXObject(XmlHttp.getPrefix()+".XmlHttp")}catch(e){}throw new Error("Your browser does not support XmlHttp objects")},XmlHttp.getPrefix=function(){if(XmlHttp.prefix)return XmlHttp.prefix;for(var e=["MSXML2","Microsoft","MSXML","MSXML3"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t]+".XmlHttp"),XmlHttp.prefix=e[t]}catch(e){}throw new Error("Could not find an installed XML parser")},XmlDocument.create=function(e,t){e=e||"foo",t=t||"";try{var n;if(document.implementation&&document.implementation.createDocument?(n=document.implementation.createDocument(t,e,null),null===n.readyState&&(n.readyState=1,n.addEventListener("load",function(){n.readyState=4,"function"==typeof n.onreadystatechange&&n.onreadystatechange()},!1))):window.ActiveXObject&&(n=new ActiveXObject(XmlDocument.getPrefix()+".DomDocument")),!n.documentElement||n.documentElement.tagName!=e||n.documentElement.namespaceURI&&n.documentElement.namespaceURI!=t)try{""!==t?n.appendChild(n.createElement(e)).setAttribute("xmlns",t):n.appendChild(n.createElement(e))}catch(r){n=document.implementation.createDocument(t,e,null),null===n.documentElement&&n.appendChild(n.createElement(e)),""!==t&&n.documentElement.getAttribute("xmlns")!=t&&n.documentElement.setAttribute("xmlns",t)}return n}catch(e){}throw new Error("Your browser does not support XmlDocument objects")},XmlDocument.getPrefix=function(){if(XmlDocument.prefix)return XmlDocument.prefix;for(var e=["MSXML2","Microsoft","MSXML","MSXML3"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t]+".DomDocument"),XmlDocument.prefix=e[t]}catch(e){}throw new Error("Could not find an installed XML parser")},"undefined"!=typeof Document&&window.DOMParser&&(Document.prototype.loadXML=function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml");this.hasChildNodes();)this.removeChild(this.lastChild);for(var n=0;n<t.childNodes.length;n++)this.appendChild(this.importNode(t.childNodes[n],!0))}),window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__&&(Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}),Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}));var JSJaC={Version:"1.4",bind:function(e,t,n){return function(r){return e.apply(t,[r,n])}}},JSJaCBuilder={buildNode:function(e,t){var n,r=arguments[4];if(arguments[2])if(JSJaCBuilder._isStringOrNumber(arguments[2])||arguments[2]instanceof Array)n=this._createElement(e,t,r),JSJaCBuilder._children(e,n,arguments[2]);else{r=arguments[2].xmlns||r,n=this._createElement(e,t,r);for(var i in arguments[2])arguments[2].hasOwnProperty(i)&&"xmlns"!=i&&n.setAttribute(i,arguments[2][i])}else n=this._createElement(e,t,r);return arguments[3]&&JSJaCBuilder._children(e,n,arguments[3],r),n},_createElement:function(e,t,n){try{if(n)return e.createElementNS(n,t)}catch(e){}var r=e.createElement(t);return n&&r.setAttribute("xmlns",n),r},_text:function(e,t){return e.createTextNode(t)},_children:function(e,t,n,r){if("object"==typeof n){for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if("object"==typeof o)if(o instanceof Array){var s=JSJaCBuilder.buildNode(e,o[0],o[1],o[2],r);t.appendChild(s)}else t.appendChild(o);else JSJaCBuilder._isStringOrNumber(o)&&t.appendChild(JSJaCBuilder._text(e,o))}}else JSJaCBuilder._isStringOrNumber(n)&&t.appendChild(JSJaCBuilder._text(e,n))},_attributes:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n].toString().htmlEnc()+'"');return t.join(" ")},_isStringOrNumber:function(e){return"string"==typeof e||"number"==typeof e}};JSJAC_HAVEKEYS=!0,JSJAC_NKEYS=16,JSJAC_INACTIVITY=300,JSJAC_ERR_COUNT=10,JSJAC_ALLOW_PLAIN=!0,JSJAC_ALLOW_SCRAM=!1,JSJAC_CHECKQUEUEINTERVAL=100,JSJAC_CHECKINQUEUEINTERVAL=100,JSJAC_TIMERVAL=2e3,JSJAC_RETRYDELAY=5e3,JSJAC_REGID_TIMEOUT=2e4,JSJACHBC_MAX_HOLD=1,JSJACHBC_MAX_WAIT=300,JSJACHBC_BOSH_VERSION="1.10",JSJACHBC_USE_BOSH_VER=!0,JSJACHBC_MAXPAUSE=120,JSJaCConnection.prototype.connect=function(e){this._setStatus("connecting"),e.appType&&(this.appType=e.appType),e.clientIdentify&&(this.clientIdentify=e.clientIdentify),this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource,this.pass=e.password||e.pass,this.authzid=e.authzid||"",this.register=e.register,this.authhost=e.authhost||e.host||e.domain,this.authtype=e.authtype||"sasl",e.xmllang&&""!==e.xmllang?this._xmllang=e.xmllang:this._xmllang="en",e.allow_plain?this._allow_plain=e.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,e.allow_scram?this._allow_scram=e.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,this.host=e.host,this.port=e.port||5222,this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,this._rid=Math.round(100000.5+799999.99999*Math.random());var t=this._getFreeSlot();this._req[t]=this._setupRequest(!0);var n=this._getInitialRequestString();this.oDbg.log(n,4),this._req[t].r.onreadystatechange=JSJaC.bind(function(){var e=this._req[t].r;4==e.readyState&&(this.oDbg.log("async recv: "+e.responseText,4),this._handleInitialResponse(e))},this),void 0!==this._req[t].r.onerror&&(this._req[t].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this)),this._req[t].r.send(n)},JSJaCConnection.prototype.connected=function(){return this._connected},JSJaCConnection.prototype.disconnect=function(){if(this._setStatus("disconnecting"),this.connected()){this._connected=!1,clearInterval(this._interval),clearInterval(this._inQto),this._timeout&&clearTimeout(this._timeout);var e=this._getFreeSlot();this._req[e]=this._setupRequest(!1);var t=this._getRequestString(!1,!0);this.oDbg.log("Disconnecting: "+t,4);try{this._req[e].r.send(t)}catch(e){}this.oDbg.log("disconnected");try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(e){}this._handleEvent("ondisconnect")}},JSJaCConnection.prototype.getPollInterval=function(){return this._timerval},JSJaCConnection.prototype.registerHandler=function(e,t,n,r){e=e.toLowerCase();var i={handler:arguments[arguments.length-1],ns:"*",type:"*"};return arguments.length>2&&(i.ns=arguments[1]),arguments.length>3&&(i.type=arguments[2]),this._events[e]?this._events[e]=this._events[e].concat(i):this._events[e]=[i],this._events[e]=this._events[e].sort(function(e,t){var n=0,r=0;return"*"==e.type&&n++,"*"==e.ns&&n++,n++,"*"==t.type&&r++,"*"==t.ns&&r++,n>r?1:n<r?-1:0}),this.oDbg.log("registered handler for event '"+e+"'",2),this},JSJaCConnection.prototype.unregisterHandler=function(e,t){if(e=e.toLowerCase(),!this._events[e])return this;for(var n=this._events[e],r=[],i=0;i<n.length;i++)n[i].handler!=t&&r.push(n[i]);return n.length!=r.length&&(this._events[e]=r,this.oDbg.log("unregistered handler for event '"+e+"'",2)),this},JSJaCConnection.prototype.registerIQGet=function(e,t,n){return this.registerHandler("iq",e,t,"get",n)},JSJaCConnection.prototype.registerIQSet=function(e,t,n){return this.registerHandler("iq",e,t,"set",n)},JSJaCConnection.prototype.resume=function(){try{var e=JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").getValue();return this.oDbg.log("read cookie: "+e,2),JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase(),this.resumeFromData(JSJaCJSON.parse(e))}catch(e){}return!1},JSJaCConnection.prototype.resumeFromData=function(e){try{for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(this._keys){this._keys2=new JSJaCKeys;for(var n=this._keys2._getSuspendVars(),r=0;r<n.length;r++)this._keys2[n[r]]=this._keys[n[r]];this._keys=this._keys2}return this._connected?(this._setStatus("resuming"),this._handleEvent("onresume"),setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval()),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL)):this._setStatus("terminated"),!0===this._connected}catch(e){return e.message?this.oDbg.log("Resume failed: "+e.message,1):this.oDbg.log("Resume failed: "+e,1),!1}},JSJaCConnection.prototype.sendJumpPacket=function(e,t,n){if(!this.connected())return!1;if(!e||!e.opcode)return this.oDbg.log("no jumpPacket: "+e,1),!1;if(t&&this._validateCallbackable(e)){if(!e.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");e.content.id||(e.content.id=this._IDPrefix+this._ID++),this._registerPID(e,t,n)}return this._pQueue=this._pQueue.concat(e),this._handleEvent("packet_out",e),!0},JSJaCConnection.prototype.send=function(e,t,n){},JSJaCConnection.prototype.sendIQ=function(e,t,n){if(!e||"iq"!=e.pType())return!1;t=t||{};var r=t.error_handler||JSJaC.bind(function(e){this.oDbg.log(e.xml(),1)},this),i=t.result_handler||JSJaC.bind(function(e){this.oDbg.log(e.xml(),2)},this),o=function(e,t){switch(e.getType()){case"error":r(e);break;case"result":i(e,t)}};return this.send(e,o,n)},JSJaCConnection.prototype.setPollInterval=function(e){return e&&!isNaN(e)&&(this._timerval=e),this._timerval},JSJaCConnection.prototype.status=function(){return this._status},JSJaCConnection.prototype.suspend=function(){var e=this.suspendToData();try{var t=new JSJaCCookie(this._cookie_prefix+"JSJaC_State",JSJaCJSON.toString(e));this.oDbg.log("writing cookie: "+t.getValue()+"\n(length:"+t.getValue().length+")",2),t.write();var n=JSJaCCookie.get(this._cookie_prefix+"JSJaC_State");return t.getValue()==n||(this.oDbg.log("Suspend failed writing cookie.\nread: "+n,1),t.erase(),!1)}catch(e){this.oDbg.log("Failed creating cookie '"+this._cookie_prefix+"JSJaC_State': "+e.message,1)}return!1},JSJaCConnection.prototype.suspendToData=function(){clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._suspend();var e="_connected,_keys,_ID,_xmllang,_inQ,_pQueue,_regIDs,_errcnt,_inactivity,domain,username,resource,jid,fulljid,_sid,_httpbase,_timerval,_is_polling".split(",");e=e.concat(this._getSuspendVars());for(var t={},n=0;n<e.length;n++)if(this[e[n]]){var r={};if(this[e[n]]._getSuspendVars)for(var i=this[e[n]]._getSuspendVars(),o=0;o<i.length;o++)r[i[o]]=this[e[n]][i[o]];else r=this[e[n]];t[e[n]]=r}return this._connected=!1,this._setStatus("suspending"),t},JSJaCConnection.prototype._abort=function(){clearTimeout(this._timeout),clearInterval(this._inQto),clearInterval(this._interval),this._connected=!1,this._setStatus("aborted"),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("500","cancel","service-unavailable"))},JSJaCConnection.prototype._checkInQ=function(){for(var e=0;e<this._inQ.length&&e<10;e++){var t=this._inQ[0],n=t.body,r=t.event;if(this._inQ=this._inQ.slice(1,this._inQ.length),!n)return this._handleEvent("packet_in"),void this._handleEvent(r);this._handlePID(n)||(this._handleEvent("packet_in",n),this._handleEvent(r,n))}},JSJaCConnection.prototype._checkQueue=function(){return this._pQueue.length>0&&this._process(),!0},JSJaCConnection.prototype._doAuth=function(){return this._sendJumpPacket(this._getAuthPacket(),function(e){if(e.event==OPCODE.AUTH.KEY){var t=e.body;if(200!=t.code)return void this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this._handleEvent("packet_in",t),this._handleEvent(OPCODE.AUTH.KEY,t),this._handleEvent("onconnect")}}),!0},JSJaCConnection.prototype._doInBandReg=function(){if("saslanon"!=this.authtype&&"anonymous"!=this.authtype){var e=new JSJaCIQ;e.setType("set"),e.setID("reg1"),e.appendNode("query",{xmlns:NS_REGISTER},[["username",this.username],["password",this.pass]]),this.send(e,this._doInBandRegDone)}},JSJaCConnection.prototype._doInBandRegDone=function(e){if(e&&"error"==e.getType())return this.oDbg.log("registration failed for "+this.username,0),void this._handleEvent("onerror",e.getChild("error"));this.oDbg.log(this.username+" registered succesfully",0),this._doAuth()},JSJaCConnection.prototype._doLegacyAuth=function(){if("nonsasl"!=this.authtype&&"anonymous"!=this.authtype)return!1;var e=new JSJaCIQ;return e.setIQ(null,"get","auth1"),e.appendNode("query",{xmlns:NS_AUTH},[["username",this.username]]),this.send(e,this._doLegacyAuth2),!0},JSJaCConnection.prototype._doLegacyAuth2=function(e){if(!e||"result"!=e.getType())return e&&"error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")),void this.disconnect();var t=null!==e.getChild("digest"),n=new JSJaCIQ;n.setIQ(null,"set","auth2");var r=n.appendNode("query",{xmlns:NS_AUTH},[["username",this.username],["resource",this.resource]]);if(t)r.appendChild(n.buildNode("digest",{xmlns:NS_AUTH},hex_sha1(this.streamid+this.pass)));else{if(!this._allow_plain)return this.oDbg.log("no valid login mechanism found",1),void this.disconnect();r.appendChild(n.buildNode("password",{xmlns:NS_AUTH},this.pass))}this.send(n,this._doLegacyAuthDone)},JSJaCConnection.prototype._doLegacyAuthDone=function(e){"result"!=e.getType()?("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")),this.disconnect()):this._handleEvent("onconnect")},JSJaCConnection.prototype._doSASLAuth=function(){if("nonsasl"==this.authtype||"anonymous"==this.authtype)return!1;if(void 0!==this.username&&null!=this.username&&""!=this.username||"saslanon"!=this.authtype){if(this._allow_scram&&this.mechs["SCRAM-SHA-1"]){this.oDbg.log("SASL using mechanism 'SCRAM-SHA-1'",2),this._clientFirstMessageBare="n="+this.username.replace(/=/g,"=3D").replace(/,/g,"=2C")+",r="+JSJaCUtils.cnonce(16);var e;e=this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,";var t=e+this._clientFirstMessageBare;return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SCRAM-SHA-1'>"+b64encode(t)+"</auth>",this._doSASLAuthScramSha1S1)}if(this._allow_plain&&this.mechs.PLAIN){this.oDbg.log("SASL using mechanism 'PLAIN'",2);var n=this.authzid+String.fromCharCode(0)+this.username+String.fromCharCode(0)+this.pass;return this.oDbg.log("authenticating with '"+n+"'",2),n=b64encode(n),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='PLAIN'>"+n+"</auth>",this._doSASLAuthDone)}this.oDbg.log("No SASL mechanism applied",1),this.authtype="nonsasl"}else{if(this.mechs.ANONYMOUS)return this.oDbg.log("SASL using mechanism 'ANONYMOUS'",2),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='ANONYMOUS'/>",this._doSASLAuthDone);this.oDbg.log("SASL ANONYMOUS requested but not supported",1)}return!1},JSJaCConnection.prototype._doSASLAuthScramSha1S1=function(e){if("challenge"!=e.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("got challenge: "+t,2);var n={},r=t.split(",");for(var i in r){var o=r[i].substring(2);n[r[i].substring(0,1)]=o}for(var s,a=str2rstr_utf8(this.pass),u=b64decode_bin(n.s)+"\0\0\0",c=parseInt(n.i,10),l=0;l<c;l++)u=rstr_hmac_sha1(a,u),s=JSJaCUtils.xor(s,u);var h;h=this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,";var d="c="+b64encode(h)+",r="+n.r;this._saltedPassword=s;var p=rstr_hmac_sha1(this._saltedPassword,"Client Key"),f=rstr_sha1(p);this._authMessage=this._clientFirstMessageBare+","+t+","+d;var g=rstr_hmac_sha1(f,str2rstr_utf8(this._authMessage)),m=JSJaCUtils.xor(p,g),_=d+",p="+rstr2b64(m);this.oDbg.log("response: "+_,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(_)+"</response>",this._doSASLAuthScramSha1S2)}},JSJaCConnection.prototype._doSASLAuthScramSha1S2=function(e){if("success"!=e.nodeName)this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("got success: "+t,2);var n={},r=t.split(",");for(var i in r){var o=r[i].substring(2);n[r[i].substring(0,1)]=o}rstr_hmac_sha1(rstr_hmac_sha1(this._saltedPassword,"Server Key"),str2rstr_utf8(this._authMessage))!==b64decode_bin(n.v)?(this.oDbg.log("server auth failed",1),
this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))}},JSJaCConnection.prototype._doSASLAuthDigestMd5S1=function(e){if("challenge"!=e.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t,n=b64decode(e.firstChild.nodeValue);if(this.oDbg.log("got challenge: "+n,2),-1===(t=n.indexOf('nonce="')))return this.oDbg.log("no valid nonce found, aborting",1),void this.disconnect();this._nonce=n.substring(t+7),this._nonce=this._nonce.substring(0,this._nonce.indexOf('"')),this.oDbg.log("nonce: "+this._nonce,2),t=n.indexOf('realm="'),-1!==t&&(this._realm=n.substring(t+7),this._realm=this._realm.substring(0,this._realm.indexOf('"'))),this._realm=this._realm||this.domain,this.oDbg.log("realm: "+this._realm,2),this._digest_uri="xmpp/"+this.domain,this._cnonce=JSJaCUtils.cnonce(14),this._nc="00000001";var r=this.username+":"+this._realm+":"+this.pass,i=rstr_md5(str2rstr_utf8(r)),o=i+":"+this._nonce+":"+this._cnonce;this.authzid&&(o=o+":"+this.authzid);var s=rstr2hex(rstr_md5(o)),a="AUTHENTICATE:"+this._digest_uri,u=hex_md5(a),c=hex_md5(s+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+u),l='username="'+this.username+'",realm="'+this._realm+'",nonce="'+this._nonce+'",cnonce="'+this._cnonce+'",nc='+this._nc+',qop=auth,digest-uri="'+this._digest_uri+'",response='+c+",charset=utf-8";this.authzid&&(l='authzid="'+this.authzid+'",'+l),this.oDbg.log("response: "+l,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(l)+"</response>",this._doSASLAuthDigestMd5S2)}},JSJaCConnection.prototype._doSASLAuthDigestMd5S2=function(e){if("failure"==e.nodeName)return e.xml?this.oDbg.log("auth error: "+e.xml,1):this.oDbg.log("auth error",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),void this.disconnect();var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("response: "+t,2);var n=t.substring(t.indexOf("rspauth=")+8);this.oDbg.log("rspauth: "+n,2);var r=this.username+":"+this._realm+":"+this.pass,i=rstr_md5(str2rstr_utf8(r)),o=i+":"+this._nonce+":"+this._cnonce;this.authzid&&(o=o+":"+this.authzid);var s=rstr2hex(rstr_md5(o)),a=":"+this._digest_uri,u=hex_md5(a),c=hex_md5(s+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+u);if(this.oDbg.log("rsptest: "+c,2),c!=n)return this.oDbg.log("SASL Digest-MD5: server repsonse with wrong rspauth",1),void this.disconnect();"success"==e.nodeName?this._reInitStream(JSJaC.bind(this._doStreamBind,this)):this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>",this._doSASLAuthDone)},JSJaCConnection.prototype._doSASLAuthDone=function(e){"success"!=e.nodeName?(this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))},JSJaCConnection.prototype._doStreamBind=function(){var e=new JSJaCIQ;e.setIQ(null,"set","bind_1"),e.appendNode("bind",{xmlns:NS_BIND},[["resource",this.resource]]),this.oDbg.log(e.xml()),this.send(e,this._doXMPPSess)},JSJaCConnection.prototype._doXMPPSess=function(e){if("result"!=e.getType()||"error"==e.getType())return this.disconnect(),void("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")));this.fulljid=e.getChildVal("jid"),this.jid=this.fulljid.substring(0,this.fulljid.lastIndexOf("/")),e=new JSJaCIQ,e.setIQ(null,"set","sess_1"),e.appendNode("session",{xmlns:NS_SESSION},[]),this.oDbg.log(e.xml()),this.send(e,this._doXMPPSessDone)},JSJaCConnection.prototype._doXMPPSessDone=function(e){if("result"!=e.getType()||"error"==e.getType())return this.disconnect(),void("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")));this._handleEvent("onconnect")},JSJaCConnection.prototype._handleEvent=function(e,t){if(e=e.toLowerCase(),this.oDbg.log("incoming event '"+e+"'",3),this._events[e]){this.oDbg.log("handling event '"+e+"'",2);for(var n=0;n<this._events[e].length;n++){var r=this._events[e][n];if("function"==typeof r.handler)if(t){if("*"!=r.ns&&t.ns!=r.ns)continue;if("*"!=r.type&&t.type!=r.type)continue;if(this.oDbg.log(r.ns+"/"+r.type+" => match for handler "+r.handler,3),r.handler(t))break}else if(r.handler())break}}},JSJaCConnection.prototype._handlePID=function(e){if(!e.id)return!1;var t=this.jid,n=e.id;if(this._regIDs[t]&&this._regIDs[t][n]){this.oDbg.log("handling id "+n,3);var r=this._regIDs[t][n];return!1!==r.cb.call(this,e,r.arg)&&(delete this._regIDs[t][n],!0)}return this.oDbg.log("not handling id '"+n+"' from jid "+t,1),!1},JSJaCConnection.prototype._handleResponse=function(e){var t=this._parseResponse(e);if(t){if(this._sendRawCallbacks.length){var n=this._sendRawCallbacks[0];this._sendRawCallbacks=this._sendRawCallbacks.slice(1,this._sendRawCallbacks.length),n.fn.call(this,t,n.arg)}this._inQ=this._inQ.concat(t)}},JSJaCConnection.prototype._parseStreamFeatures=function(e){if(!e)return this.oDbg.log("nothing to parse ... aborting",1),!1;var t,n;if(e.getElementsByTagNameNS)t=e.getElementsByTagNameNS(NS_STREAM,"error").item(0);else{var r=e.getElementsByTagName("error");for(n=0;n<r.length;n++)if(r.item(n).namespaceURI==NS_STREAM||r.item(n).getAttribute("xmlns")==NS_STREAM){t=r.item(n);break}}if(t)return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),!1;this.mechs={};var i=e.getElementsByTagName("mechanisms");if(!i.length)return!1;for(this.has_sasl=!1,n=0;n<i.length;n++)if(i.item(n).getAttribute("xmlns")==NS_SASL){this.has_sasl=!0;for(var o=i.item(n).getElementsByTagName("mechanism"),s=0;s<o.length;s++)this.mechs[o.item(s).firstChild.nodeValue]=!0;break}return this.has_sasl?(this.oDbg.log("SASL detected",2),!0):(this.oDbg.log("No support for SASL detected",2),!0)},JSJaCConnection.prototype._process=function(e){if(!this.connected())return this.oDbg.log("Connection lost ...",1),void(this._interval&&clearInterval(this._interval));this.setPollInterval(e),this._timeout&&clearTimeout(this._timeout);var t=this._getFreeSlot();if(!(t<0)){if(void 0!==this._req[t]&&void 0!==this._req[t].r&&4!=this._req[t].r.readyState)return void this.oDbg.log("Slot "+t+" is not ready");if(!this.isPolling()&&0===this._pQueue.length&&this._req[(t+1)%2]&&4!=this._req[(t+1)%2].r.readyState)return void this.oDbg.log("all slots busy, standby ...",2);this.isPolling()||this.oDbg.log("Found working slot at "+t,2);var n=this._getRequestPacket();this._req[t]=n instanceof JumpPacket?this._setupJumpRequest(!0):this._setupRequest(!0),this._req[t].r.onreadystatechange=JSJaC.bind(function(){this.connected()&&4==this._req[t].r.readyState&&(this.oDbg.log("async recv: "+this._req[t].r.responseText,4),this._handleResponse(this._req[t]),this._setStatus("processing"),this._pQueue.length?this._timeout=setTimeout(JSJaC.bind(this._process,this),100):(this.oDbg.log("scheduling next poll in "+this.getPollInterval()+" msec",4),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())))},this);try{this._req[t].r.onerror=JSJaC.bind(function(){if(this.connected()){if(this._errcnt++,this.oDbg.log("XmlHttpRequest error ("+this._errcnt+")",1),this._errcnt>JSJAC_ERR_COUNT)return void this._abort();this._setStatus("onerror_fallback"),setTimeout(JSJaC.bind(this._repeat,this),JSJAC_RETRYDELAY)}},this)}catch(e){}void 0!==this._rid&&(this._req[t].rid=this._rid),n instanceof JumpPacket?this._buildAndSend(n,this._req[t].r):this._req[t].r.send(n&&n.xml?n.xml:this._getRequestString())}},JSJaCConnection.prototype._registerPID=function(e,t,n){this.oDbg.log("registering id for packet "+JSON.stringify(e.content),3);var r=e.content.id;if(!r)return this.oDbg.log("id missing",1),!1;if("function"!=typeof t)return this.oDbg.log("callback is not a function",1),!1;var i=this.jid;return this._regIDs[i]||(this._regIDs[i]={}),null!=this._regIDs[i][r]?(this.oDbg.log("id already registered: "+r,1),!1):(this._regIDs[i][r]={cb:t,arg:n,ts:JSJaCUtils.now()},this.oDbg.log("registered id "+r,3),this._cleanupRegisteredPIDs(),!0)},JSJaCConnection.prototype._cleanupRegisteredPIDs=function(){var e=Date.now();for(var t in this._regIDs)if(this._regIDs.hasOwnProperty(t))for(var n in this._regIDs[t])this._regIDs[t].hasOwnProperty(n)&&this._regIDs[t][n].ts+JSJAC_REGID_TIMEOUT<e&&(this.oDbg.log("deleting registered id '"+n+"' due to timeout",1),delete this._regIDs[t][n])},JSJaCConnection.prototype._prepSendEmpty=function(e,t){return function(){t._sendEmpty(JSJaC.bind(e,t))}},JSJaCConnection.prototype._sendEmpty=function(e){var t=this._getFreeSlot();this._req[t]=this._setupRequest(!0),this._req[t].r.onreadystatechange=JSJaC.bind(function(){4==this._req[t].r.readyState&&(this.oDbg.log("async recv: "+this._req[t].r.responseText,4),e(this._req[t].r))},this),void 0!==this._req[t].r.onerror&&(this._req[t].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this));var n=this._getRequestString();this.oDbg.log("sending: "+n,4),this._req[t].r.send(n)},JSJaCConnection.prototype._sendJumpPacket=function(e,t,n){return t&&this._sendRawCallbacks.push({fn:t,arg:n}),this._pQueue.push(e),this._process(),!0},JSJaCConnection.prototype._sendRaw=function(e,t,n){return t&&this._sendRawCallbacks.push({fn:t,arg:n}),this._pQueue.push(e),this._process(),!0},JSJaCConnection.prototype._setStatus=function(e){e&&""!==e&&e!=this._status&&(this._status=e,this._handleEvent("onstatuschanged",e),this._handleEvent("status_changed",e))},JSJaCConnection.prototype._buildAndSend=function(e,t){var n=null,r=null==e.content||void 0===e.content,i=JSON.stringify(e.content);n=this._stringToBytes(i);var o=new Uint8Array(PACKET_HEADER_SIZE);o.set(this._numToBytes(e.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),o.set(this._numToBytes(e.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),r?o.set(this._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):o.set(this._numToBytes(n.length,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),o.set(this._numToBytes(e.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),o.set(this._numToBytes(e.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START);var s;s=r?o:this._concatUint8Array(o,new Uint8Array(n));var a=s.subarray(0,s.byteLength),u=arr2b64(a);t.send(u)},JSJaCConnection.prototype._validateCallbackable=function(e){return this._isIQPacket(e.opcode)||this._isMessagePacket(e.opcode)||this._isPresencePacket(e.opcode)},JSJaCConnection.prototype._isMessagePacket=function(e){return e>=OPCODE.MESSAGE_RANGE.START&&e<OPCODE.MESSAGE_RANGE.END},JSJaCConnection.prototype._isIQPacket=function(e){return e>=OPCODE.IQ_RANGE.START&&e<OPCODE.IQ_RANGE.END},JSJaCConnection.prototype._isPresencePacket=function(e){return e>=OPCODE.PRESENCE_RANGE.START&&e<OPCODE.PRESENCE_RANGE.END},JSJaCConnection.prototype._concatUint8Array=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},JSJaCConnection.prototype._numToBytes=function(e,t){var n=new Uint8Array(t),r=t;do{n[--r]=255&e,e>>=8}while(r);return n},JSJaCConnection.prototype._uint8ArrayToString=function(e){var t,n,r,i,o,s;for(t="",r=e.length,n=0;n<r;)switch((i=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:o=e[n++],t+=String.fromCharCode((31&i)<<6|63&o);break;case 14:o=e[n++],s=e[n++],t+=String.fromCharCode((15&i)<<12|(63&o)<<6|(63&s)<<0)}return t},JSJaCConnection.prototype._bytesToInteger=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n],n<e.length-1&&(t<<=8);return t},JSJaCConnection.prototype._stringToBytes=function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t},JSJaCConnection.prototype._getAuthPacket=function(){var e={usr:this.username,atk:this.pass,br:this.resource};return this.appType&&(e.appType=this.appType),this.clientIdentify&&(e.clientIdentify=this.clientIdentify),new JumpPacket(e,OPCODE.AUTH.SEND)};var NS_ORGANIZATION="http://jabber.org/protocol/org",NS_DISCO_ITEMS="http://jabber.org/protocol/disco#items",NS_DISCO_INFO="http://jabber.org/protocol/disco#info",NS_VCARD="vcard-temp",NS_VCARD_UPDATE="vcard-temp:x:update",NS_AUTH="jabber:iq:auth",NS_AUTH_ERROR="jabber:iq:auth:error",NS_REGISTER="jabber:iq:register",NS_SEARCH="jabber:iq:search",NS_ROSTER="jabber:iq:roster",NS_PUBACCOUNT="jabber:iq:pubaccount",NS_PRIVACY="jabber:iq:privacy",NS_PRIVATE="jabber:iq:private",NS_VERSION="jabber:iq:version",NS_TIME="jabber:iq:time",NS_TIME_NEW="urn:xmpp:time",NS_LAST="jabber:iq:last",NS_XDATA="jabber:x:data",NS_IQDATA="jabber:iq:data",NS_DELAY="jabber:x:delay",NS_DELAY_NEW="urn:xmpp:delay",NS_RECEIPTS="urn:xmpp:receipts",NS_EXPIRE="jabber:x:expire",NS_EVENT="jabber:x:event",NS_XCONFERENCE="jabber:x:conference",NS_PING="urn:xmpp:ping",NS_BOOKSMARKS="storage:bookmarks",NS_FORWARD_0="urn:xmpp:forward:0",NS_CARBONS_2="urn:xmpp:carbons:2",NS_CHAT_STATES="http://jabber.org/protocol/chatstates",NS_STATS="http://jabber.org/protocol/stats",NS_MUC="http://jabber.org/protocol/muc",NS_MUC_USER="http://jabber.org/protocol/muc#user",NS_MUC_ADMIN="http://jabber.org/protocol/muc#admin",NS_MUC_OWNER="http://jabber.org/protocol/muc#owner",NS_PUBSUB="http://jabber.org/protocol/pubsub",NS_PUBSUB_EVENT="http://jabber.org/protocol/pubsub#event",NS_PUBSUB_OWNER="http://jabber.org/protocol/pubsub#owner",NS_PUBSUB_ERRORS="http://jabber.org/protocol/pubsub#errors",NS_PUBSUB_NMI="http://jabber.org/protocol/pubsub#node-meta-info",NS_COMMANDS="http://jabber.org/protocol/commands",NS_CAPS="http://jabber.org/protocol/caps",NS_STREAM="http://etherx.jabber.org/streams",NS_CLIENT="jabber:client",NS_BOSH="http://jabber.org/protocol/httpbind",NS_XBOSH="urn:xmpp:xbosh",NS_STANZAS="urn:ietf:params:xml:ns:xmpp-stanzas",NS_STREAMS="urn:ietf:params:xml:ns:xmpp-streams",NS_TLS="urn:ietf:params:xml:ns:xmpp-tls",NS_SASL="urn:ietf:params:xml:ns:xmpp-sasl",NS_SESSION="urn:ietf:params:xml:ns:xmpp-session",NS_BIND="urn:ietf:params:xml:ns:xmpp-bind",NS_FEATURE_IQAUTH="http://jabber.org/features/iq-auth",NS_FEATURE_IQREGISTER="http://jabber.org/features/iq-register",NS_FEATURE_COMPRESS="http://jabber.org/features/compress",NS_COMPRESS="http://jabber.org/protocol/compress",ERR_BAD_REQUEST=STANZA_ERROR("400","modify","bad-request"),ERR_CONFLICT=STANZA_ERROR("409","cancel","conflict"),ERR_FEATURE_NOT_IMPLEMENTED=STANZA_ERROR("501","cancel","feature-not-implemented"),ERR_FORBIDDEN=STANZA_ERROR("403","auth","forbidden"),ERR_GONE=STANZA_ERROR("302","modify","gone"),ERR_INTERNAL_SERVER_ERROR=STANZA_ERROR("500","wait","internal-server-error"),ERR_ITEM_NOT_FOUND=STANZA_ERROR("404","cancel","item-not-found"),ERR_JID_MALFORMED=STANZA_ERROR("400","modify","jid-malformed"),ERR_NOT_ACCEPTABLE=STANZA_ERROR("406","modify","not-acceptable"),ERR_NOT_ALLOWED=STANZA_ERROR("405","cancel","not-allowed"),ERR_NOT_AUTHORIZED=STANZA_ERROR("401","auth","not-authorized"),ERR_PAYMENT_REQUIRED=STANZA_ERROR("402","auth","payment-required"),ERR_RECIPIENT_UNAVAILABLE=STANZA_ERROR("404","wait","recipient-unavailable"),ERR_REDIRECT=STANZA_ERROR("302","modify","redirect"),ERR_REGISTRATION_REQUIRED=STANZA_ERROR("407","auth","registration-required"),ERR_REMOTE_SERVER_NOT_FOUND=STANZA_ERROR("404","cancel","remote-server-not-found"),ERR_REMOTE_SERVER_TIMEOUT=STANZA_ERROR("504","wait","remote-server-timeout"),ERR_RESOURCE_CONSTRAINT=STANZA_ERROR("500","wait","resource-constraint"),ERR_SERVICE_UNAVAILABLE=STANZA_ERROR("503","cancel","service-unavailable"),ERR_SUBSCRIPTION_REQUIRED=STANZA_ERROR("407","auth","subscription-required"),ERR_UNEXPECTED_REQUEST=STANZA_ERROR("400","wait","unexpected-request");JSJaCCookie.read=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return new JSJaCCookie(e,JSJaCCookie._unescape(i.substring(t.length,i.length)))}throw new JSJaCCookieException("Cookie not found")},JSJaCCookie.get=function(e){return JSJaCCookie.read(e).getValue()},JSJaCCookie.remove=function(e){JSJaCCookie.read(e).erase()},JSJaCCookie._escape=function(e){return e.replace(/;/g,"%3AB")},JSJaCCookie._unescape=function(e){return e.replace(/%3AB/g,";")},JSJaCDebugger.prototype.log=function(e,t){},JSJaCHttpBindingConnection.prototype=new JSJaCConnection,JSJaCHttpBindingConnection.prototype.inherit=function(e){if(e.jid){var t=new JSJaCJID(e.jid);this.domain=t.getDomain(),this.username=t.getNode(),this.resource=t.getResource()}else this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource;this._sid=e.sid,this._rid=e.rid,this._min_polling=e.polling,this._inactivity=e.inactivity,this._setHold(e.requests-1),this.setPollInterval(this._timerval),e.wait&&(this._wait=e.wait),this._connected=!0,this._handleEvent("onconnect"),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())},JSJaCHttpBindingConnection.prototype.setPollInterval=function(e){return e&&!isNaN(e)&&(this.isPolling()?this._min_polling&&e<1e3*this._min_polling?this._timerval=1e3*this._min_polling:this._inactivity&&e>1e3*this._inactivity?this._timerval=1e3*this._inactivity:this._timerval=e:this._timerval=100),this._timerval},JSJaCHttpBindingConnection.prototype.isPolling=function(){return 0===this._hold},JSJaCHttpBindingConnection.prototype._getFreeSlot=function(){for(var e=0;e<this._hold+1;e++)if(void 0===this._req[e]||void 0===this._req[e].r||4==this._req[e].r.readyState)return e;return-1},JSJaCHttpBindingConnection.prototype._getHold=function(){return this._hold},JSJaCHttpBindingConnection.prototype._getRequestPacket=function(e,t){var n;if(this._rid<this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid];else{this._pQueue.length&&(n=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)),this._last_requests[this._rid]={},this._last_requests[this._rid]=n,this._last_rid=this._rid;for(var r in this._last_requests)this._last_requests.hasOwnProperty(r)&&r<this._rid-this._hold&&delete this._last_requests[r]}return n},JSJaCHttpBindingConnection.prototype._getRequestString=function(e,t){e=e||"";var n="";if(this._rid<=this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid].xml;else{for(var r="";this._pQueue.length;){r+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}n="<body rid='"+this._rid+"' sid='"+this._sid+"' xmlns='http://jabber.org/protocol/httpbind'",JSJAC_HAVEKEYS&&(n+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),n+=" newkey='"+this._keys.getKey()+"'")),t?n+=" type='terminate'":this._reinit&&(JSJACHBC_USE_BOSH_VER&&(n+=" xml:lang='"+this._xmllang+"' xmpp:restart='true' xmlns:xmpp='urn:xmpp:xbosh' to='"+this.domain+"'"),this._reinit=!1),n+=""!==r||""!==e?">"+e+r+"</body>":"/>",this._last_requests[this._rid]={},this._last_requests[this._rid].xml=n,this._last_rid=this._rid;for(var i in this._last_requests)this._last_requests.hasOwnProperty(i)&&i<this._rid-this._hold&&delete this._last_requests[i]}return n},JSJaCHttpBindingConnection.prototype._getInitialRequestString=function(){var e="<body content='text/xml; charset=utf-8' hold='"+this._hold+"' xmlns='http://jabber.org/protocol/httpbind' to='"+this.authhost+"' wait='"+this._wait+"' rid='"+this._rid+"'";if(this.host&&this.port&&(e+=" route='xmpp:"+this.host+":"+this.port+"'"),JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(hex_sha1,this.oDbg);e+=" newkey='"+this._keys.getKey()+"'"}return e+=" xml:lang='"+this._xmllang+"'",JSJACHBC_USE_BOSH_VER&&(e+=" ver='"+JSJACHBC_BOSH_VERSION+"'",e+=" xmlns:xmpp='urn:xmpp:xbosh'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(e+=" xmpp:version='1.0'")),e+="/>"},JSJaCHttpBindingConnection.prototype._getStreamID=function(e){if(this.oDbg.log(e.responseText,4),!e.responseXML||!e.responseXML.documentElement)return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));var t=e.responseXML.documentElement;return"terminate"==t.getAttribute("type")?void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")):(t.getAttribute("authid")&&(this.streamid=t.getAttribute("authid"),this.oDbg.log("got streamid: "+this.streamid,2)),this._parseStreamFeatures(t)?(this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval()),void(this.register?this._doInBandReg():this._doAuth())):void this._sendEmpty(JSJaC.bind(this._getStreamID,this)))},JSJaCHttpBindingConnection.prototype._getSuspendVars=function(){return"host,port,_rid,_last_rid,_wait,_min_polling,_inactivity,_hold,_last_requests,_pause".split(",")},JSJaCHttpBindingConnection.prototype._handleInitialResponse=function(e){try{this.oDbg.log(e.getAllResponseHeaders(),4),this.oDbg.log(e.responseText,4)}catch(e){this.oDbg.log("No response",4)}if(200!=e.status||!e.responseXML)return this.oDbg.log("initial response broken (status: "+e.status+")",1),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));var t=e.responseXML.documentElement;return t&&"body"==t.tagName&&t.namespaceURI==NS_BOSH?"terminate"==t.getAttribute("type")?(this.oDbg.log("invalid response:\n"+e.responseText,1),clearTimeout(this._timeout),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))):(this._sid=t.getAttribute("sid"),this.oDbg.log("got sid: "+this._sid,2),t.getAttribute("polling")&&(this._min_polling=t.getAttribute("polling")),t.getAttribute("inactivity")&&(this._inactivity=t.getAttribute("inactivity")),t.getAttribute("requests")&&this._setHold(t.getAttribute("requests")-1),this.oDbg.log("set hold to "+this._getHold(),2),t.getAttribute("ver")&&(this._bosh_version=t.getAttribute("ver")),t.getAttribute("maxpause")&&(this._pause=Number.min(t.getAttribute("maxpause"),JSJACHBC_MAXPAUSE)),this.setPollInterval(this._timerval),this._connected=!0,this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),void this._getStreamID(e)):(this.oDbg.log("no body element or incorrect body in initial response",1),void this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error")))},JSJaCHttpBindingConnection.prototype._parseResponse=function(e){if(!this.connected()||!e)return null;var t=e.r;try{if(404==t.status||403==t.status)return this._abort(),null;if(200!=t.status||!t.responseText&&""!=t.responseText){this._errcnt++;var n="invalid response ("+t.status+"):\n"+t.getAllResponseHeaders()+"\n"+t.responseText;return t.responseXML||(n+="\nResponse failed to parse!"),(this.oDbg.log(n,1),this._errcnt>JSJAC_ERR_COUNT)?(this._abort(),null):(this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null)}}catch(e){return this.oDbg.log("XMLHttpRequest error: status not available",1),this._errcnt++,this._errcnt>JSJAC_ERR_COUNT?this._abort():this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null}for(var r="<"==t.responseText[0]?t.responseText:b64decode(t.responseText),i=[],o=0,s=r.length;o<PACKET_HEADER_SIZE&&PACKET_HEADER_SIZE<=s;o++)i[o]=r.charCodeAt(o);var a=new Uint8Array(i),u=a.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),c=OPCODE_MAP.RECV.get(this._bytesToInteger(u)),l=r.slice(PACKET_HEADER_SIZE);if(void 0!==e.rid&&this._last_requests[e.rid]){if(this._last_requests[e.rid].handled)return this.oDbg.log("already handled "+e.rid,2),null;this._last_requests[e.rid].handled=!0}return this._errcnt=0,c?{event:c,body:l?JSON.parse(0==l.indexOf("{")?l:"{"+l):null}:null},JSJaCHttpBindingConnection.prototype._reInitStream=function(e){this._reinit=!0,this._sendEmpty(this._prepReInitStreamWait(e))},JSJaCHttpBindingConnection.prototype._prepReInitStreamWait=function(e){return JSJaC.bind(function(t){this._reInitStreamWait(t,e)},this)},JSJaCHttpBindingConnection.prototype._reInitStreamWait=function(e,t){this.oDbg.log("checking for stream features");var n,r,i=e.responseXML.documentElement;if(this.oDbg.log(i),i.getElementsByTagNameNS)this.oDbg.log("checking with namespace"),(n=i.getElementsByTagNameNS(NS_STREAM,"features").item(0))&&(r=n.getElementsByTagNameNS(NS_BIND,"bind").item(0));else{var o,s,a=i.getElementsByTagName("stream:features");for(o=0,s=a.length;o<s;o++)if(a.item(o).namespaceURI==NS_STREAM||a.item(o).getAttribute("xmlns")==NS_STREAM){n=a.item(o);break}if(n)for(r=n.getElementsByTagName("bind"),o=0,s=r.length;o<s;o++)if(r.item(o).namespaceURI==NS_BIND||r.item(o).getAttribute("xmlns")==NS_BIND){r=r.item(o);break}}this.oDbg.log(n),this.oDbg.log(r),n?r?t():(this.oDbg.log("no bind feature - giving up",1),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this._sendEmpty(this._prepReInitStreamWait(t))},JSJaCHttpBindingConnection.prototype._repeat=function(){this._rid>=this._last_rid&&(this._rid=this._last_rid-1),this._process()},JSJaCHttpBindingConnection.prototype._resume=function(){0===this._pause?this._repeat():this._process()},JSJaCHttpBindingConnection.prototype._setHold=function(e){return!e||isNaN(e)||e<0?e=0:e>JSJACHBC_MAX_HOLD&&(e=JSJACHBC_MAX_HOLD),this._hold=e,this._hold},JSJaCHttpBindingConnection.prototype._setupJumpRequest=function(e){var t={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase+"?rid="+this._rid+"&sid="+this._sid+"&useBase64=1",e),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(e){this.oDbg.log(e,1)}return t.r=n,t.rid=this._rid,t},JSJaCHttpBindingConnection.prototype._setupRequest=function(e){var t={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase,e),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(e){this.oDbg.log(e,1)}return t.r=n,t.rid=this._rid,t},JSJaCHttpBindingConnection.prototype._suspend=function(){if(0!==this._pause){var e=this._getFreeSlot();this._req[e]=this._setupRequest(!1);var t="<body pause='"+this._pause+"' xmlns='http://jabber.org/protocol/httpbind' sid='"+this._sid+"' rid='"+this._rid+"'";for(JSJAC_HAVEKEYS&&(t+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),t+=" newkey='"+this._keys.getKey()+"'")),t+=">";this._pQueue.length;){t+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}t+="</body>",this.oDbg.log("Disconnecting: "+t,4),this._req[e].r.send(t)}},JSJaCHttpPollingConnection.prototype=new JSJaCConnection,JSJaCHttpPollingConnection.prototype.isPolling=function(){return!0},JSJaCHttpPollingConnection.prototype._getFreeSlot=function(){return void 0===this._req[0]||void 0===this._req[0].r||4==this._req[0].r.readyState?0:-1},JSJaCHttpPollingConnection.prototype._getInitialRequestString=function(){var e="0";if(JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(b64_sha1,this.oDbg);e+=";"+this._keys.getKey()}var t=this.domain;return this.authhost&&(t=this.authhost),e+=",<stream:stream to='"+t+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(e+=" version='1.0'"),e+=">"},JSJaCHttpPollingConnection.prototype._getRequestString=function(e,t){var n=this._sid;for(JSJAC_HAVEKEYS&&(n+=";"+this._keys.getKey(),this._keys.lastKey()&&(this._keys=new JSJaCKeys(b64_sha1,this.oDbg),n+=";"+this._keys.getKey())),n+=",",e&&(n+=e);this._pQueue.length;)n+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length);return t&&(n+="</stream:stream>"),n},JSJaCHttpPollingConnection.prototype._getStreamID=function(){if(""===this._req[0].r.responseText)return this.oDbg.log("waiting for stream id",2),void(this._timeout=setTimeout(JSJaC.bind(this._sendEmpty,this),1e3));this.oDbg.log(this._req[0].r.responseText,4),this._req[0].r.responseText.match(/id=[\'\"]([^\'\"]+)[\'\"]/)&&(this.streamid=RegExp.$1),this.oDbg.log("got streamid: "+this.streamid,2);var e;try{var t=this._req[0].r.responseText;if(t.match(/<\/stream:stream>\s*$/)||(t+="</stream:stream>"),e=XmlDocument.create("doc"),e.loadXML(t),!this._parseStreamFeatures(e))return void(this.authtype="nonsasl")}catch(e){this.oDbg.log("loadXML: "+e.toString(),1)}this._connected=!0,this.register?this._doInBandReg():this._doAuth(),this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._getSuspendVars=function(){return[]},JSJaCHttpPollingConnection.prototype._handleInitialResponse=function(){this.oDbg.log(this._req[0].r.getAllResponseHeaders(),4);var e=this._req[0].r.getResponseHeader("Set-Cookie");e=e.split(";");for(var t=0;t<e.length;t++){var n=e[t].split("=");"ID"==n[0]&&(this._sid=n[1])}this.oDbg.log("got sid: "+this._sid,2),this._connected=!0,this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._getStreamID()},JSJaCHttpPollingConnection.prototype._parseResponse=function(e){var t=e.r;if(!this.connected())return null;if(200!=t.status)return this.oDbg.log("invalid response ("+t.status+"):"+t.responseText+"\n"+t.getAllResponseHeaders(),1),this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),null;this.oDbg.log(t.getAllResponseHeaders(),4);var n,r=t.getResponseHeader("Set-Cookie");if(null===r)n="-1:0";else{r=r.split(";");for(var i=0;i<r.length;i++){var o=r[i].split("=");"ID"==o[0]&&(n=o[1])}}if(void 0!==n&&-1!=n.indexOf(":0")){switch(n.substring(0,n.indexOf(":0"))){case"0":this.oDbg.log("invalid response:"+t.responseText,1);break;case"-1":this.oDbg.log("Internal Server Error",1);break;case"-2":this.oDbg.log("Bad Request",1);break;case"-3":this.oDbg.log("Key Sequence Error",1)}return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("500","wait","internal-server-error")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}if(!t.responseText)return null;try{var s=t.responseText.replace(/<\?xml.+\?>/,"");s.match(/<stream:stream/)&&(s+="</stream:stream>");var a=JSJaCHttpPollingConnection._parseTree("<body>"+s+"</body>");return a&&"parsererror"!=a.tagName?a:(this.oDbg.log("parsererror",1),a=JSJaCHttpPollingConnection._parseTree("<stream:stream xmlns:stream='http://etherx.jabber.org/streams'>"+t.responseText),a&&"parsererror"!=a.tagName?(this.oDbg.log("stream closed",1),a.getElementsByTagName("conflict").length>0&&this._setStatus("session-terminate-conflict"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this.oDbg.log("parsererror:"+a,1),a)}catch(e){this.oDbg.log("parse error:"+e.message,1)}return null},JSJaCHttpPollingConnection.prototype._reInitStream=function(e){
var t=this.authhost?this.authhost:this.domain;this._sendRaw("<stream:stream xmlns:stream='http://etherx.jabber.org/streams' xmlns='jabber:client' to='"+t+"' version='1.0'>",e)},JSJaCHttpPollingConnection.prototype._repeat=function(){this._resume()},JSJaCHttpPollingConnection.prototype._resume=function(){this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._setupRequest=function(e){var t=XmlHttp.create();try{t.open("POST",this._httpbase,e),t.overrideMimeType&&t.overrideMimeType("text/plain; charset=utf-8"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){this.oDbg.log(e,1)}var n={};return n.r=t,n},JSJaCHttpPollingConnection.prototype._suspend=function(){},JSJaCHttpPollingConnection._parseTree=function(e){try{var t=XmlDocument.create("body","foo");if(void 0!==t.loadXML)return t.loadXML(e),t.documentElement;if(window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml").documentElement}catch(e){}return null};var JSJACJID_FORBIDDEN=['"'," ","&","'","/",":","<",">","@"];JSJaCJID.prototype.getBareJID=function(){return this.getNode()+"@"+this.getDomain()},JSJaCJID.prototype.getNode=function(){return this._node},JSJaCJID.prototype.getDomain=function(){return this._domain},JSJaCJID.prototype.getResource=function(){return this._resource},JSJaCJID.prototype.setNode=function(e){return JSJaCJID._checkNodeName(e),this._node=e||"",this},JSJaCJID.prototype.setDomain=function(e){if(!e||""===e)throw new JSJaCJIDInvalidException("domain name missing");return JSJaCJID._checkNodeName(e),this._domain=e,this},JSJaCJID.prototype.setResource=function(e){return this._resource=e||"",this},JSJaCJID.prototype.toString=function(){var e="";return this.getNode()&&""!==this.getNode()&&(e=this.getNode()+"@"),e+=this.getDomain(),this.getResource()&&""!==this.getResource()&&(e+="/"+this.getResource()),e},JSJaCJID.prototype.removeResource=function(){return this.setResource()},JSJaCJID.prototype.clone=function(){return new JSJaCJID(this.toString())},JSJaCJID.prototype.isEntity=function(e){return e="string"==typeof e?new JSJaCJID(e):e.clone(),e.removeResource(),this.clone().removeResource().toString()===e.toString()},JSJaCJID._checkNodeName=function(e){if(e&&""!==e)for(var t=0;t<JSJACJID_FORBIDDEN.length;t++)if(-1!=e.indexOf(JSJACJID_FORBIDDEN[t]))throw new JSJaCJIDInvalidException("forbidden char in nodename: "+JSJACJID_FORBIDDEN[t])},JSJaCJSON.toString=function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n={array:function(e){var t,r,i,o,s=["["],a=e.length;for(i=0;i<a;i+=1)if(o=e[i],r=n[typeof o])try{o=r(o),"string"==typeof o&&(t&&(s[s.length]=","),s[s.length]=o,t=!0)}catch(e){}return s[s.length]="]",s.join("")},boolean:function(e){return String(e)},null:function(){return"null"},number:function(e){return isFinite(e)?String(e):"null"},object:function(e){if(e){if(e instanceof Array)return n.array(e);var t,r,i,o,s=[];s.push("{");for(i in e)if(e.hasOwnProperty(i)&&(o=e[i],r=n[typeof o]))try{o=r(o),"string"==typeof o&&(t&&(s[s.length]=","),s.push(n.string(i),":",o),t=!0)}catch(e){}return s[s.length]="}",s.join("")}return"null"},string:function(e){return/["\\\x00-\x1f]/.test(e)&&(e=e.replace(/([\x00-\x1f\\"])/g,function(e,n){var r=t[n];return r||(r=n.charCodeAt(),"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16))})),'"'+e+'"'}};switch(typeof e){case"object":return n.object(e);case"array":return n.array(e)}},JSJaCJSON.parse=function(str){try{return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+str+")")}catch(e){return!1}};var JSJACPACKET_USE_XMLNS=!0;JSJaCPacket.prototype.pType=function(){return this.name},JSJaCPacket.prototype.getDoc=function(){return this.doc},JSJaCPacket.prototype.getNode=function(){return this.getDoc()&&this.getDoc().documentElement?this.getDoc().documentElement:null},JSJaCPacket.prototype.setTo=function(e){return e?"string"==typeof e?this.getNode().setAttribute("to",e):this.getNode().setAttribute("to",e.toString()):this.getNode().removeAttribute("to"),this},JSJaCPacket.prototype.setFrom=function(e){return e?"string"==typeof e?this.getNode().setAttribute("from",e):this.getNode().setAttribute("from",e.toString()):this.getNode().removeAttribute("from"),this},JSJaCPacket.prototype.setID=function(e){return e?this.getNode().setAttribute("id",e):this.getNode().removeAttribute("id"),this},JSJaCPacket.prototype.setType=function(e){return e?this.getNode().setAttribute("type",e):this.getNode().removeAttribute("type"),this},JSJaCPacket.prototype.setXMLLang=function(e){return e?this.getNode().setAttribute("xml:lang",e):this.getNode().removeAttribute("xml:lang"),this},JSJaCPacket.prototype.getTo=function(){return this.getNode().getAttribute("to")},JSJaCPacket.prototype.getFrom=function(){return this.getNode().getAttribute("from")},JSJaCPacket.prototype.getToJID=function(){return new JSJaCJID(this.getTo())},JSJaCPacket.prototype.getFromJID=function(){return new JSJaCJID(this.getFrom())},JSJaCPacket.prototype.getID=function(){return this.getNode().getAttribute("id")},JSJaCPacket.prototype.getType=function(){return this.getNode().getAttribute("type")},JSJaCPacket.prototype.getXMLLang=function(){return this.getNode().getAttribute("xml:lang")},JSJaCPacket.prototype.getXMLNS=function(){return this.getNode().namespaceURI||this.getNode().getAttribute("xmlns")},JSJaCPacket.prototype.getChild=function(e,t){if(!this.getNode())return null;if(e=e||"*",t=t||"*",this.getNode().getElementsByTagNameNS)return this.getNode().getElementsByTagNameNS(t,e).item(0);var n=this.getNode().getElementsByTagName(e);if("*"==t)return n.item(0);for(var r=0;r<n.length;r++)if(n.item(r).namespaceURI==t||n.item(r).getAttribute("xmlns")==t)return n.item(r);return null},JSJaCPacket.prototype.getChildVal=function(e,t){var n=this.getChild(e,t),r="";if(n&&n.hasChildNodes())for(var i=0;i<n.childNodes.length;i++)n.childNodes.item(i).nodeValue&&(r+=n.childNodes.item(i).nodeValue);return r},JSJaCPacket.prototype.clone=function(){return JSJaCPacket.wrapNode(this.getNode())},JSJaCPacket.prototype.isError=function(){return"error"==this.getType()},JSJaCPacket.prototype.errorReply=function(e){var t=this.clone();return t.setTo(this.getFrom()),t.setFrom(),t.setType("error"),t.appendNode("error",{code:e.code,type:e.type},[[e.cond,{xmlns:NS_STANZAS}]]),t},JSJaCPacket.prototype.xml="undefined"!=typeof XMLSerializer?function(){var e=(new XMLSerializer).serializeToString(this.getNode());return void 0===e&&(e=(new XMLSerializer).serializeToString(this.doc)),e}:function(){return this.getDoc().xml},JSJaCPacket.prototype._getAttribute=function(e){return this.getNode().getAttribute(e)},document.ELEMENT_NODE||(document.ELEMENT_NODE=1,document.ATTRIBUTE_NODE=2,document.TEXT_NODE=3,document.CDATA_SECTION_NODE=4,document.ENTITY_REFERENCE_NODE=5,document.ENTITY_NODE=6,document.PROCESSING_INSTRUCTION_NODE=7,document.COMMENT_NODE=8,document.DOCUMENT_NODE=9,document.DOCUMENT_TYPE_NODE=10,document.DOCUMENT_FRAGMENT_NODE=11,document.NOTATION_NODE=12),JSJaCPacket.prototype._importNode=function(e,t){switch(e.nodeType){case document.ELEMENT_NODE:var n;n=this.getDoc().createElementNS?this.getDoc().createElementNS(e.namespaceURI,e.nodeName):this.getDoc().createElement(e.nodeName);var r,i;if(e.attributes&&e.attributes.length>0)for(r=0,i=e.attributes.length;r<i;r++){var o=e.attributes.item(r);("xmlns"!=o.nodeName||null===n.getAttribute("xmlns")&&!n.namespaceURI)&&(n.setAttributeNS&&o.namespaceURI?n.setAttributeNS(o.namespaceURI,o.name,o.value):n.setAttribute(o.name,o.value))}if(t&&e.childNodes&&e.childNodes.length>0)for(r=0,i=e.childNodes.length;r<i;r++)n.appendChild(this._importNode(e.childNodes.item(r),t));return n;case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return this.getDoc().createTextNode(e.nodeValue)}},JSJaCPacket.prototype._setChildNode=function(e,t){var n=this.getChild(e),r=this.getDoc().createTextNode(t);if(n)try{n.replaceChild(r,n.firstChild)}catch(e){}else{try{n=this.getDoc().createElementNS(this.getNode().namespaceURI,e)}catch(t){n=this.getDoc().createElement(e)}this.getNode().appendChild(n),n.appendChild(r)}return n},JSJaCPacket.prototype.buildNode=function(e){return JSJaCBuilder.buildNode(this.getDoc(),e,arguments[1],arguments[2],arguments[3])},JSJaCPacket.prototype.appendNode=function(e){return"object"==typeof e?this.getNode().appendChild(e):this.getNode().appendChild(this.buildNode(e,arguments[1],arguments[2],this.getNode().namespaceURI)),this},JSJaCPresence.prototype=new JSJaCPacket,JSJaCPresence.prototype.setStatus=function(e){return this._setChildNode("status",e),this},JSJaCPresence.prototype.setShow=function(e){return"chat"!=e&&"away"!=e&&"xa"!=e&&"dnd"!=e&&"unavailable"!=e||this._setChildNode("show",e),this},JSJaCPresence.prototype.setPriority=function(e){return this._setChildNode("priority",e),this},JSJaCPresence.prototype.setPresence=function(e,t,n){return e&&this.setShow(e),t&&this.setStatus(t),n&&this.setPriority(n),this},JSJaCPresence.prototype.getStatus=function(){return this.getChildVal("status")},JSJaCPresence.prototype.getShow=function(){return this.getChildVal("show")},JSJaCPresence.prototype.getPriority=function(){return this.getChildVal("priority")},JSJaCIQ.prototype=new JSJaCPacket,JSJaCIQ.prototype.setIQ=function(e,t,n){return e&&this.setTo(e),t&&this.setType(t),n&&this.setID(n),this},JSJaCIQ.prototype.setQuery=function(e){var t;try{t=this.getDoc().createElementNS(e,"query")}catch(n){t=this.getDoc().createElement("query"),t.setAttribute("xmlns",e)}return this.getNode().appendChild(t),t},JSJaCIQ.prototype.getQuery=function(){return this.getNode().getElementsByTagName("query").item(0)},JSJaCIQ.prototype.getQueryXMLNS=function(){return this.getQuery()?this.getQuery().namespaceURI||this.getQuery().getAttribute("xmlns"):null},JSJaCIQ.prototype.reply=function(e){var t=this.clone();if(t.setTo(this.getFrom()),t.setFrom(),t.setType("result"),e)if("string"==typeof e)t.getChild().appendChild(t.getDoc().loadXML(e));else if(e.constructor==Array)for(var n=t.getChild(),r=0;r<e.length;r++)"string"==typeof e[r]?n.appendChild(t.getDoc().loadXML(e[r])):"object"==typeof e[r]&&n.appendChild(e[r]);else"object"==typeof e&&t.getChild().appendChild(e);return t},JSJaCMessage.prototype=new JSJaCPacket,JSJaCMessage.prototype.setBody=function(e){return this._setChildNode("body",e),this},JSJaCMessage.prototype.setSubject=function(e){return this._setChildNode("subject",e),this},JSJaCMessage.prototype.setThread=function(e){return this._setChildNode("thread",e),this},JSJaCMessage.prototype.getThread=function(){return this.getChildVal("thread")},JSJaCMessage.prototype.getBody=function(){return this.getChildVal("body")},JSJaCMessage.prototype.getSubject=function(){return this.getChildVal("subject")},JSJaCPacket.wrapNode=function(e){var t=null;switch(e.nodeName.toLowerCase()){case"presence":t=new JSJaCPresence;break;case"message":t=new JSJaCMessage;break;case"iq":t=new JSJaCIQ}return t&&(t.getDoc().replaceChild(t._importNode(e,!0),t.getNode()),null==t.getDoc().xml&&null!=e&&null!=e.xml&&(t.getDoc().xml=e.xml)),t};var JSJaCUtils={xor:function(e,t){if(!e)return t;if(!t)return e;for(var n="",r=0;r<e.length;r++)n+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r));return n},cnonce:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.round(Math.random((new Date).getTime())*(t.length-1)));return n},now:function(){return Date.now&&"function"==typeof Date.now?Date.now():(new Date).getTime()}};JSJaCWebSocketConnection.prototype=new JSJaCConnection,JSJaCWebSocketConnection.prototype._cleanupWebSocket=function(){null!==this._ws&&(this._ws.onclose=null,this._ws.onerror=null,this._ws.onopen=null,this._ws.onmessage=null,this._ws.close(),this._ws=null)},JSJaCWebSocketConnection.prototype.connect=function(e){if(this._cleanupWebSocket(),this._setStatus("connecting"),e.appType&&(this.appType=e.appType),e.clientIdentify&&(this.clientIdentify=e.clientIdentify),this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource,this.pass=e.password||e.pass,this.authzid=e.authzid||"",this.register=e.register,this.authhost=e.authhost||this.domain,this.authtype=e.authtype||"sasl",this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,e.allow_plain?this._allow_plain=e.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,e.allow_scram?this._allow_scram=e.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,e.xmllang&&""!==e.xmllang?this._xmllang=e.xmllang:this._xmllang="en","undefined"==typeof WebSocket)return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this._ws=new WebSocket(this._httpbase,"xmpp"),this._ws.onclose=JSJaC.bind(this._onclose,this),this._ws.onerror=JSJaC.bind(this._onerror,this),this._ws.onopen=JSJaC.bind(this._onopen,this)},JSJaCWebSocketConnection.prototype._onopen=function(){var e={usr:this.username,atk:this.pass,br:this.resource};this.appType&&(e.appType=this.appType),this.clientIdentify&&(e.clientIdentify=this.clientIdentify),this._buildAndSend(new JumpPacket(e,OPCODE.AUTH.SEND)),this._ws.onmessage=JSJaC.bind(this._onAuthMessage,this)},JSJaCWebSocketConnection.prototype._onAuthMessage=function(e){var t=this;if(e.data instanceof Blob){var n=e.data,r=new FileReader;r.onload=function(e){if(e.target.readyState==FileReader.DONE){var n=new Uint8Array(e.target.result),r=t._bytesToInteger(n.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),i=n.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),o=n.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+r);if(t._bytesToInteger(i)==OPCODE.AUTH.RECV){var s=JSON.parse(t._uint8ArrayToString(o));if(YYIMChat.log("recv\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(s),3),200!=s.code)return void t._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"});t._handleEvent("packet_in",s),t._handleEvent(OPCODE.AUTH.KEY,s),t._connected=!0,t._handleEvent("onconnect"),t._ws.onmessage=JSJaC.bind(t._onJumpMessage,t)}else if(t._bytesToInteger(i)==OPCODE.STREAM_ERROR.RECV){var s=JSON.parse(t._uint8ArrayToString(o));if(YYIMChat.log("recv\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(s),3),200!=s.code)return void t._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"})}}},r.readAsArrayBuffer(n)}},JSJaCWebSocketConnection.prototype.sendJumpPacket=function(e,t,n){if(!this.connected())return!1;if(!e||!e.opcode)return!1;if(t&&this._validateCallbackable(e)){if(!e.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");e.content.id||(e.content.id=this._IDPrefix+this._ID++),this._registerPID(e,t,n)}e instanceof JumpPacket&&YYIMChat.log("send\t "+OPCODE_MAP.SEND.get(e.opcode)+"\n\t"+JSON.stringify(e),3,new Date);try{this._handleEvent("packet_out",e)}catch(e){return this.oDbg.log(e.toString(),1),!1}return this._buildAndSend(e),!0},JSJaCWebSocketConnection.prototype._buildAndSend=function(e){var t=null,n="Undefined"==Object.prototype.toString.call(e.content).slice(8,-1)||"Null"==Object.prototype.toString.call(e.content).slice(8,-1),r=new Blob([n?"":JSON.stringify(e.content)],{type:"text/json"}),i=new FileReader,o=this;i.onload=function(r){if(r.target.readyState==FileReader.DONE){t=this.result;var i=new Uint8Array(PACKET_HEADER_SIZE);i.set(o._numToBytes(e.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),i.set(o._numToBytes(e.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),n?i.set(o._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):i.set(o._numToBytes(t.byteLength,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),i.set(o._numToBytes(e.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),i.set(o._numToBytes(e.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START);var s;s=n?i:o._concatUint8Array(i,new Uint8Array(t)),o._ws.send(s)}},i.readAsArrayBuffer(r)},JSJaCWebSocketConnection.prototype._handleOpenStream=function(e){var t,n;if(this.oDbg.log(e.data,4),t=e.data,t=t.substr(t.indexOf("<stream:stream")),"/>"!==t.substr(-2)&&"</stream:stream>"!==t.substr(-16)&&(t+="</stream:stream>"),!(n=this._parseXml(t)))return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this.streamid=n.getAttribute("id"),this.oDbg.log("got streamid: "+this.streamid,2),this._ws.onmessage=JSJaC.bind(this._handleInitialResponse,this)},JSJaCWebSocketConnection.prototype._handleInitialResponse=function(e){var t=this._parseXml(e.data);if(!this._parseStreamFeatures(t))return void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));this._connected=!0,this.register?this._doInBandReg():this._doAuth()},JSJaCWebSocketConnection.prototype.disconnect=function(){this._setStatus("disconnecting"),this.connected()&&(this._connected=!1,this.oDbg.log("Disconnecting",4),this._cleanupWebSocket(),this.oDbg.log("Disconnected",2),this._handleEvent("ondisconnect"))},JSJaCWebSocketConnection.prototype._onclose=function(){this.oDbg.log("websocket closed",2),"disconnecting"!==this._status&&(this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")))},JSJaCWebSocketConnection.prototype._onerror=function(){this.oDbg.log("websocket error",1),this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype._onJumpMessage=function(e){var t=this;if(e.data instanceof Blob){var n=e.data,r=new FileReader;r.onload=function(e){if(e.target.readyState==FileReader.DONE){var n=new Uint8Array(e.target.result),r=t._bytesToInteger(n.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),i=n.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),o=n.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+r);t._parseUint8Array(i,o)}},r.readAsArrayBuffer(n)}},JSJaCWebSocketConnection.prototype._onmessage=function(e){var t,n,r;if(t=e.data,!0===this._connected&&this._setStatus("processing"),t&&""!==t){if(n=this._parseXml(t),n.namespaceURI===NS_STREAM&&"error"===n.localName)return n.getElementsByTagNameNS(NS_STREAMS,"conflict").length>0&&this._setStatus("session-terminate-conflict"),this._connected=!1,void this._handleEvent("onerror",JSJaCError("503","cancel","remote-stream-error"));r=JSJaCPacket.wrapNode(n),r&&(this.oDbg.log("async recv: "+e.data,4),this._handleEvent("packet_in",r),r.pType&&!this._handlePID(r)&&(this._handleEvent(r.pType()+"_in",r),this._handleEvent(r.pType(),r)))}},JSJaCWebSocketConnection.prototype._parseXml=function(e){var t;this.oDbg.log("Parsing: "+e,4);try{if(t=XmlDocument.create("stream",NS_STREAM),"</stream:stream>"==e.trim()){this.oDbg.log("session terminated",1),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto);try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(e){}return this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}return-1===e.indexOf("<stream:stream")?(t.loadXML("<stream:stream xmlns:stream='"+NS_STREAM+"' xmlns='jabber:client'>"+e+"</stream:stream>"),void 0===t.documentElement.firstChild.xml&&(t.documentElement.firstChild.xml=e),t.documentElement.firstChild):(t.loadXML(e),t.documentElement)}catch(e){this.oDbg.log("Error: "+e),this._connected=!1,this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error"))}return null},JSJaCWebSocketConnection.prototype._getInitialRequestString=function(){var e,t;return e=this.domain,this.authhost&&(e=this.authhost),t='<stream:stream to="'+e+'" xmlns="jabber:client" xmlns:stream="'+NS_STREAM+'"',"sasl"!==this.authtype&&"saslanon"!==this.authtype||(t+=' version="1.0"'),t+=">"},JSJaCWebSocketConnection.prototype.send=function(e,t,n){if(this._ws.onmessage=JSJaC.bind(this._onmessage,this),!e||!e.pType)return this.oDbg.log("no packet: "+e,1),!1;if(!this.connected())return!1;t&&(e.getID()||e.setID("JSJaCID_"+this._ID++),this._registerPID(e,t,n));try{this._handleEvent(e.pType()+"_out",e),this._handleEvent("packet_out",e),this._ws.send(e.xml())}catch(e){return this.oDbg.log(e.toString(),1),!1}return!0},JSJaCWebSocketConnection.prototype.resume=function(){return!1},JSJaCWebSocketConnection.prototype.suspend=function(){return!1},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S1=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S1,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S2=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S2,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S1=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S1,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S2=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S2,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDone=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDone,this)(t)},JSJaCWebSocketConnection.prototype._reInitStream=function(e){var t,n=this.domain;this.authhost&&(n=this.authhost),t='<stream:stream xmlns:stream="'+NS_STREAM+'" xmlns="jabber:client" to="'+n+'" version="1.0">',this._sendRaw(t,e)},JSJaCWebSocketConnection.prototype._sendRaw=function(e,t,n){return!!this._ws&&(t&&(this._ws.onmessage=JSJaC.bind(t,this,n)),this._ws.send(e),!0)},JSJaCWebSocketConnection.prototype._parseUint8Array=function(e,t){if(!0===this._connected&&this._setStatus("processing"),e&&t){var n=OPCODE_MAP.RECV.get(this._bytesToInteger(e));if(YYIMChat.log("recv\t"+OPCODE_MAP.RECV.get(this._bytesToInteger(e))+"\n\t"+this._uint8ArrayToString(t),3,new Date),0==t.byteLength)return this._handleEvent("packet_in"),void this._handleEvent(n);try{var r=JSON.parse(this._uint8ArrayToString(t));this._handlePID(r)||(this._handleEvent("packet_in",r),this._handleEvent(n,r))}catch(e){}}};var hexcase=0,b64pad="=";if("undefined"!=typeof atob&&"undefined"!=typeof btoa||b64arrays(),"undefined"==typeof atob?(b64decode=function(e){return utf8d2t(b64t2d(e))},b64decode_bin=function(e){for(var t=b64t2d(e),n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n}):(b64decode=function(e){return decodeURIComponent(escape(atob(e)))},b64decode_bin=atob),"undefined"==typeof btoa?b64encode=function(e){return b64d2t(utf8t2d(e))}:b64encode=function(e){return btoa(unescape(encodeURIComponent(e)))},window.XDomainRequest){window.ieXDRToXHR=function(e){"use strict";var t=e.XMLHttpRequest;e.XMLHttpRequest=function(){this.onreadystatechange=Object,this.xhr=null,this.xdr=null,this.readyState=0,this.status="",this.statusText=null,this.responseText=null,this.getResponseHeader=null,this.getAllResponseHeaders=null,this.setRequestHeader=null,this.abort=null,this.send=null,this.isxdr=!1;var e=this;e.xdrLoadedBinded=function(){e.xdrLoaded()},e.xdrErrorBinded=function(){e.xdrError()},e.xdrProgressBinded=function(){e.xdrProgress()},e.xhrReadyStateChangedBinded=function(){e.xhrReadyStateChanged()}},XMLHttpRequest.prototype.open=function(n,r,i,o,s){var a=document.createElement("a");a.href=r,a.hostname&&a.hostname!=document.domain?(null===this.xdr&&(this.xdr=new e.XDomainRequest),this.isxdr=!0,this.setXDRActive(),this.xdr.open(n,r)):(null===this.xhr&&(this.xhr=new t),this.isxdr=!1,this.setXHRActive(),this.xhr.open(n,r,i,o,s))},XMLHttpRequest.prototype.xdrGetResponseHeader=function(e){return"Content-Type"===e&&this.xdr.contentType>""?this.xdr.contentType:""},XMLHttpRequest.prototype.xdrGetAllResponseHeaders=function(){return this.xdr.contentType>""?"Content-Type: "+this.xdr.contentType:""},XMLHttpRequest.prototype.xdrSetRequestHeader=function(e,t){},XMLHttpRequest.prototype.xdrLoaded=function(){if(null!==this.onreadystatechange){if(this.readyState=4,this.status=200,this.statusText="OK",this.responseText=this.xdr.responseText,e.ActiveXObject){var t=new ActiveXObject("Microsoft.XMLDOM");t.async="false",t.loadXML(this.responseText),this.responseXML=t}this.onreadystatechange()}},XMLHttpRequest.prototype.xdrError=function(){null!==this.onreadystatechange&&(this.readyState=4,this.status=0,this.statusText="",this.responseText="",this.onreadystatechange())},XMLHttpRequest.prototype.xdrProgress=function(){null!==this.onreadystatechange&&3!==this.status&&(this.readyState=3,this.status=3,this.statusText="",this.onreadystatechange())},XMLHttpRequest.prototype.finalXDRRequest=function(){var e=this.xdr;delete e.onload,delete e.onerror,delete e.onprogress},XMLHttpRequest.prototype.sendXDR=function(e){var t=this.xdr;t.onload=this.xdrLoadedBinded,t.onerror=this.xdr.ontimeout=this.xdrErrorBinded,t.onprogress=this.xdrProgressBinded,this.responseText=null,this.xdr.send(e)},XMLHttpRequest.prototype.abortXDR=function(){this.finalXDRRequest(),this.xdr.abort()},XMLHttpRequest.prototype.setXDRActive=function(){this.send=this.sendXDR,this.abort=this.abortXDR,this.getResponseHeader=this.xdrGetResponseHeader,this.getAllResponseHeaders=this.xdrGetAllResponseHeaders,this.setRequestHeader=this.xdrSetRequestHeader},XMLHttpRequest.prototype.xhrGetResponseHeader=function(e){return this.xhr.getResponseHeader(e)},XMLHttpRequest.prototype.xhrGetAllResponseHeaders=function(){return this.xhr.getAllResponseHeaders()},XMLHttpRequest.prototype.xhrSetRequestHeader=function(e,t){return this.xhr.setRequestHeader(e,t)},XMLHttpRequest.prototype.xhrReadyStateChanged=function(){if(null!==this.onreadystatechange&&this.readyState!==this.xhr.readyState){var e=this.xhr;this.readyState=e.readyState,4===this.readyState&&(this.status=e.status,this.statusText=e.statusText,this.responseText=e.responseText,this.responseXML=e.responseXML),this.onreadystatechange()}},XMLHttpRequest.prototype.finalXHRRequest=function(){delete this.xhr.onreadystatechange},XMLHttpRequest.prototype.abortXHR=function(){this.finalXHRRequest(),this.xhr.abort()},XMLHttpRequest.prototype.sendXHR=function(e){this.xhr.onreadystatechange=this.xhrReadyStateChangedBinded,this.xhr.send(e)},XMLHttpRequest.prototype.setXHRActive=function(){this.send=this.sendXHR,this.abort=this.abortXHR,this.getResponseHeader=this.xhrGetResponseHeader,this.getAllResponseHeaders=this.xhrGetAllResponseHeaders,this.setRequestHeader=this.xhrSetRequestHeader},e.ieXDRToXHR=void 0};var isWebsocketSupport=function(){return!(navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1)&&(window.WebSocket=window.WebSocket||window.MozWebSocket,!!window.WebSocket)}();isWebsocketSupport||window.ieXDRToXHR(window)}String.prototype.htmlEnc=function(){if(!this)return this;var e=this.replace(/&/g,"&amp;");return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\n/g,"<br />")},String.prototype.revertHtmlEnc=function(){if(!this)return this;var e=this.replace(/&amp;/gi,"&");return e=e.replace(/&lt;/gi,"<"),e=e.replace(/&gt;/gi,">"),e=e.replace(/&quot;/gi,'"'),e=e.replace(/<br( )?(\/)?>/gi,"\n")},Date.jab2date=function(e){var t=new Date(Date.UTC(e.substr(0,4),e.substr(5,2)-1,e.substr(8,2),e.substr(11,2),e.substr(14,2),e.substr(17,2)));if("Z"!=e.substr(e.length-6,1)){var n=new Date;n.setTime(0),n.setUTCHours(e.substr(e.length-5,2)),n.setUTCMinutes(e.substr(e.length-2,2)),"+"==e.substr(e.length-6,1)?t.setTime(t.getTime()-n.getTime()):"-"==e.substr(e.length-6,1)&&t.setTime(t.getTime()+n.getTime())}return t},Date.hrTime=function(e){return Date.jab2date(e).toLocaleString()},Date.prototype.jabberDate=function(){var e=function(e){return e<10?"0"+e:e},t=this.getUTCFullYear()+"-";return t+=e(this.getUTCMonth()+1)+"-",t+=e(this.getUTCDate())+"T",t+=e(this.getUTCHours())+":",t+=e(this.getUTCMinutes())+":",t+=e(this.getUTCSeconds())+"Z"},Number.max=function(e,t){return e>t?e:t},Number.min=function(e,t){return e<t?e:t};var YYIMChat=function(){function e(e){this.level=e||(0==e?0:3),this.start=function(){},this.log=function(e,t,n,r){if(a.LOG.ENABLE&&!((t=t||(0==t?0:3))>this.level)&&"undefined"!=typeof console&&void 0!==console.group)try{switch(console.group(e),t){case 0:console.error(e),console.trace();break;case 1:console.warn(e),console.trace();break;case 2:console.info(e);break;case 4:console.debug(e);break;default:console.log(e)}var i=arguments.length;if(i>2)for(var o=2;o<i;o++){var s=arguments[o];s&&(s instanceof JSJaCPacket?console.info(s.doc.xml):console.debug(s))}console.groupEnd()}catch(e){try{console.error(e)}catch(e){}}},this.logParam=function(e){e=e||3;var t=this.logParam.caller;this.log("arguments:",e,t.arguments)},this.setLevel=function(e){return this.level=e,this},this.getLevel=function(){return this.level}}function t(){this.lastPongTime=Date.now(),this.pingInterval,this.pingTimeout,this.interval=0}function n(){this._inited=!1}function r(){this.daemon=new t,this.eventHandler=new n,this.connection=this.getConnection(),this.connectArg,this.waitingList=[],this.sending=!1,this.lastSendTime=0}function i(e){this.url=e.url,this.data=e.data,this.sCallback=e.successCallback,this.eCallback=e.errorCallback,this.xhr=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}(),this.timeout=1e4,this.timeoutIndex,this.loop=!1}function o(){this._user,this._token={},this.appkey,this.connectStatus=c.INIT,this.offlineStatus=[c.ERROR,c.OFFLINE,c.CONFLICT,c.AUTHERROR,c.ONCLIENTKICKOUT,c.INIT,c.ONUPDATEPASSWORD],this.onlineStatus=[c.CONNECTED,c.PROCESSING],this.init()}var s={};s.getBareJID=function(e){var t,n=o.getInstance().getUserBareJID();if(e){if(e instanceof JSJaCJID)return e.getBareJID()==n?e.toString():e.getBareJID();if("string"==typeof e)return t=new JSJaCJID(e),t.getBareJID()==n?t.toString():t.getBareJID();if(e.jid&&e.jid instanceof JSJaCJID)return t=e.jid,t.getBareJID()==n?t.toString():t.getBareJID()}throw new JSJaCJIDInvalidException("invalid jid: "+e)},s.getID=function(e){var t,n,r,i;return i=YYIMCommonUtil.isStringAndNotEmpty(e)?(t=o.getInstance().getAppkey(),r=e.indexOf("@"),-1!=r?(n=e.substring(0,r),n.indexOf(t)>0?n.replace(t,""):n):e.indexOf(t)>0?e.replace(t,""):e):null,i?i.toString():i},s.getNode=function(e){if(e=e.toString(),YYIMCommonUtil.isStringAndNotEmpty(e)){var t=o.getInstance().getAppkey(),n=e;if(n.indexOf("@")>-1){if(0===n.indexOf("@"))throw'"'+e+'" Can\'t start with  "@"!';n=n.substring(0,n.indexOf("@"))}if(n.indexOf(".")>-1){if(0===n.indexOf("."))throw'"'+e+'" Can\'t start with "."!';n=n.substring(0,n.indexOf("."))}return n?n+t:n}throw'"'+e+"\" Can't be Number Or Empty!"},s.getResource=function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)&&-1!=e.indexOf("/")?e.substring(e.indexOf("/")+1):null},s.buildUserJID=function(e,t){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+a.YY_IM_DOMAIN+(t?"/"+t:""):null},s.getDomain=function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)&&-1!=e.indexOf("@")?e.substring(e.indexOf("@")+1):null},s.buildChatGroupJID=function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+a.DOMAIN.CHATROOM:null},s.buildPubAccountJID=function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+a.DOMAIN.PUBACCOUNT:null},s.getChatTypeByJid=function(e){if(e)switch(s.getDomain(e)){case a.DOMAIN.CHATROOM:return g.GROUP_CHAT;case a.DOMAIN.PUBACCOUNT:return g.PUB_ACCOUNT;default:return g.CHAT}},jQuery.support.cors=!0;var a,u=function(){function e(e){e=e||{},l=e.clientMark||l,o=e.wsurl||o,s=e.wsport||s,u=e.hbport||u,c=e.servlet||c,h=e.todoServlet||h,n()&&(c=c.replace(/^https?:\/\//,location.protocol+"//")),(/https/.test(location.protocol)||!0===e.useHttps)&&(s=5225),a={YY_IM_DOMAIN:i,RESOURCE:l+"-v2.6",MULTI_TENANCY:{ENABLE:!0,ETP_KEY:e.etp||"etp",APP_KEY:e.app||"app",SEPARATOR:"."},SENDINTERVAL:30,GROUP:{MEMBERSLIMIT:5},ROSTER:{BATCHVCRADMAXLIMIT:50},INPUT_STATE:{INTERVAL:2e3},UPLOAD:{AUTO_SEND:!0,MULTI_SELECTION:!1,PREVENT_DUPLICATES:!1,PREVIEW_SIZE:{WIDTH:100,
HEIGHT:100},FLASH_SWF_URL:e.flash_swf_url||"./Moxie.swf",SILVERLIGHT_XAP_URL:e.silverlight_xap_url||"./Moxie.xap",MEDIATYPE:{IMAGE:1,FILE:2,DOC:3},IMAGE_TYPES:/\.(png|jpe?g|gif)$/i},TIMECORRECTION:{AUTOCORRECTION:!0,TIMES:3,RESIDUAL:50,RESULT:0,LOAD:!1},MULTIPARTYCALL:{ADDRESS:"http://dudu.yonyoutelecom.cn/httpIntf/createConference.do",ACCOUNT:"",KEY:"",PHONESMAXLENGTH:200},SERVLET:{REST_RESOURCE_SERVLET:c+"sysadmin/rest/resource/",REST_VERSION_SERVLET:c+"sysadmin/rest/version/",REST_USER_SERVLET:c+"sysadmin/rest/user/",REST_UPLOAD_SERVLET:c+"im_upload/rest/resource/",REST_DOWNLOAD_SERVLET:c+"im_download/rest/resource/",REST_TRANSFORM_SERVLET:c+"im_download/rest/transform/resource/",REST_SYSTEM_SERVLET:c+"sysadmin/rest/system/",REST_SYSTEM_CUSTOMER_USER:c+"sysadmin/rest/customer/user/",REST_TODO_USER:h+"todocenter/user/todo/"},SUPPORT:{isWebSocketSupport:function(){return window.WebSocket=window.WebSocket||window.MozWebSocket,!!window.WebSocket}()},CONNECTION:{TIMERVAL:2e3,WAIT:300,SECURE:!1,ALLOW_PLAIN:!0,ENABLE_WEBSOCKET:!0,ENABLE_LOCAL_CONNECTION:!0,USE_HTTPS:function(){return!(!/https/.test(location.protocol)&&!0!==e.useHttps)}(),SERVER_NAME:i,HTTP_BASE:o,HTTP_BIND_PORT:u,WS_PORT:s},PING:{INTERVAL:1e4,SLOW_INTERVAL:3e4,TIMEOUT:1e4},DOMAIN:{CHATROOM:"conference."+i,SEARCH:"search."+i,PUBACCOUNT:"pubaccount."+i},EXPIRATION:{INVALID:216e5,INSPECTION_INTERVAL:18e5},LOG:{ENABLE:!!e.logEnable,FILTER_LEVEL:3},BROWSER:t()},a.getHttpBindUrl=function(){return(this.CONNECTION.USE_HTTPS?"https://":"http://")+this.CONNECTION.HTTP_BASE+":"+this.CONNECTION.HTTP_BIND_PORT+"/http-bind/"},a.getWebSocketUrl=function(){return(this.CONNECTION.USE_HTTPS?"wss://":"ws://")+this.CONNECTION.HTTP_BASE+":"+this.CONNECTION.WS_PORT},a.useWebSocket=function(){return this.SUPPORT.isWebSocketSupport&&this.CONNECTION.ENABLE_WEBSOCKET},a.getConnectionArgObj=function(){return{domain:this.CONNECTION.SERVER_NAME,resource:this.RESOURCE,allow_plain:this.CONNECTION.ALLOW_PLAIN,secure:this.CONNECTION.SECURE,register:!1}},a.getLocationOrigin=function(){return location.origin?location.origin:location.protocol+"//"+location.host},a.getClientMark=r}function t(){var e=navigator.userAgent.toLowerCase();return{version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],webkit:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)}}function n(){var e=t();return!!(e.msie&&parseInt(e.version)<10)}function r(){return l}var i="im.yyuap.com",o="stellar.yyuap.com",s=5227,u=7075,c="http://im.yyuap.com/",l="web",h="https://pubaccount.yonyoucloud.com/";return{init:e}}();u.init();var c={INIT:"init",OFFLINE:"offline",CONNECTING:"connecting",PROCESSING:"processing",CONFLICT:"conflict",CONNECTED:"connected",ERROR:"error",AUTHERROR:"AuthError",ONCLIENTKICKOUT:"onClientKickout",ONUPDATEPASSWORD:"onUpdatePassword"},l={FAVORITE:"favorite",REMOVE:"remove",NONE:"none"},h={CHAT:"chat",AWAY:"away",XA:"xa",DND:"dnd",UNAVAILABLE:"unavailable"},d={SET:"set",RESULT:"result",GET:"get",SUBMIT:"submit",UNAVAILABLE:"unavailable"},p={SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",PROBE:"probe",UNAVAILABLE:"unavailable",COLLECT:"collect"},f={ADD:"add",REMOVE:"remove"},g={CHAT:"chat",GROUP_CHAT:"groupchat",PUB_ACCOUNT:"pubaccount"},m={TEXT:2,FILE:4,IMAGE:8,REDPACKET:9,SMALLVIDEO:10,REVOCATION:13,MERGEFORWARD:15,SINGLEGRAPHIC:16,MOREGRAPHIC:32,AUDO:64,LOCATION:128,SHARE:256,WHITEBOARD:1024};return t.prototype.startPing=function(e){!0===e&&(this.isOnline=e),r.getInstance().connected()?(this.interval=this.interval?a.PING.INTERVAL:a.PING.SLOW_INTERVAL,this.ping()):this.stopPing()},t.prototype.stopPing=function(e){!1===e&&(this.isOnline=e),clearTimeout(this.pingTimeout),clearTimeout(this.pingInterval)},t.prototype.ping=function(){var e=this;if(this.isOnline){if(!this.sending){this.stopPing(),this.interval=this.interval||a.PING.SLOW_INTERVAL;var t=Date.now()-(this.lastPongTime+this.interval);if(t>=0)try{this.sending=!0,this.interval=a.PING.SLOW_INTERVAL,r.getInstance().send(new JumpPacket(null,OPCODE.PING.SEND))}catch(t){e.stopPing(),o.getInstance().log("Ping_Error.",0,t),o.getInstance().onConnectError({errorCode:408,message:""})}else this.pingInterval=setTimeout(this.ping.bind(this),-t)}}else this.stopPing()},t.prototype.pong=function(){this.lastPongTime=Date.now(),this.isOnline?(o.getInstance().log("pong\t"+new Date(this.lastPongTime),3,this.lastPongTime),this.sending=!1,this.ping()):this.stopPing()},t.prototype.setTimeout=function(){if(this.isOnline){var e=Date.now();o.getInstance().log("setPingTimeout\t"+new Date(e),3,e),clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(this.timeoutHandler.bind(this),a.PING.TIMEOUT)}else this.stopPing()},t.prototype.timeoutHandler=function(){this.sending=!1,this.stopPing(),o.getInstance().log("Ping_Timeout.",0),o.getInstance().onConnectError({errorCode:408,message:""})},n.prototype._init=function(){if(o.getInstance().log("YYIMConnectEventHandler.prototype.registerHandler",3),!this._inited){var e=r.getInstance();e.registerHandler("onConnect",this.onConnected),e.registerHandler("onError",this.onConnectError),e.registerHandler("onDisconnect",this.onDisConnect),e.registerHandler("onStatusChanged",this.connectStatusChangeHandler),e.registerHandler(OPCODE.STREAM_ERROR.KEY,this.onStreamError),e.registerHandler(OPCODE.PACKET_ERROR.KEY,this.onPacketError),e.registerHandler("packet_in",e.getDaemon().pong.bind(e.getDaemon())),this._inited=!0}},n.prototype.onConnected=function(){o.getInstance().onOpened(),r.getInstance().getDaemon().startPing(!0)},n.prototype.onConnectError=function(e){o.getInstance().log("YYIMConnectEventHandler.prototype.onConnectError ",0,e),errorCode=e.getAttribute("code"),r.getInstance().getDaemon().stopPing(!1),401==errorCode?o.getInstance().onAuthError({errorCode:401,message:""}):409==errorCode?o.getInstance().onConflicted({errorCode:409,message:""}):4010==errorCode?o.getInstance().onClientKickout({errorCode:4010,message:""}):4011==errorCode?o.getInstance().onUpdatePassword({errorCode:4011,message:""}):o.getInstance().onConnectError({errorCode:errorCode,message:""})},n.prototype.onStreamError=function(e){o.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,e),r.getInstance().getDaemon().stopPing(!1),errorCode=e.code,401==errorCode?o.getInstance().onAuthError({errorCode:401,message:""}):409==errorCode?o.getInstance().onConflicted({errorCode:409,message:""}):4010==errorCode?o.getInstance().onClientKickout({errorCode:4010,message:""}):4011==errorCode?o.getInstance().onUpdatePassword({errorCode:4011,message:""}):o.getInstance().onConnectError({errorCode:errorCode,message:""})},n.prototype.onPacketError=function(e){o.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,e)},n.prototype.onDisConnect=function(){o.getInstance().onClosed(),r.getInstance().getDaemon().stopPing(!1)},n.prototype.connectStatusChangeHandler=function(e){o.getInstance().onStatusChanged(e)},r.getInstance=function(){return r._instance||(r._instance=new r,r._instance._init()),r._instance},r.prototype.getDaemon=function(){return this.daemon},r.prototype._init=function(){o.getInstance().exeBackhander("monitor"),this.eventHandler._init(),this.registerHandler(OPCODE.AUTH.KEY,function(e){var t=new JSJaCJID(e.jid),n=s.getID(e.jid);o.getInstance()._user={jid:t,name:n},o.getInstance().onUserBind(n,t.getResource())})},r.prototype.registerHandler=function(e,t,n,r){if(this.connection)return void this.connection.registerHandler.apply(this.connection,arguments);throw"connection is undefined!"},r.prototype.connected=function(){return!(!this.connection||!this.connection.connected())},r.prototype.getConnection=function(){return this.connection||(a.useWebSocket()?this.connection=new JSJaCWebSocketConnection({httpbase:a.getWebSocketUrl()}):this.connection=new JSJaCHttpBindingConnection({httpbase:a.getHttpBindUrl(),timerval:a.CONNECTION.TIMERVAL,wait:a.CONNECTION.WAIT})),this.connection},r.prototype.connect=function(e){e=e||{},this.connectArg||(this.connectArg=a.getConnectionArgObj()),e.username&&(this.connectArg.username=e.username),e.token&&(this.connectArg.password=e.token),e.appType&&(this.connectArg.appType=e.appType),e.identify&&(this.connectArg.clientIdentify=e.identify),o.getInstance()._user={jid:new JSJaCJID(this.connectArg.username+"@"+a.YY_IM_DOMAIN+"/"+this.connectArg.resource),name:this.connectArg.username},this.connection.connect(this.connectArg)},r.prototype.disconnect=function(){this.daemon.stopPing(!1),this.connection&&this.connection.disconnect()},r.prototype.send=function(e,t,n,r){this.waitingList.push({packet:e,callback:t,data:n,callbackContext:r}),this.sending||this.sendInterval()},r.prototype.sendInterval=function(){var e=this;if(this.waitingList.length){this.sending=!0;var t=(new Date).getTime()-this.lastSendTime;if(t>=a.SENDINTERVAL){var n=this.waitingList.shift();this.sendJumpPacket(n),n.packet&&n.packet.opcode!=OPCODE.PING.SEND&&this.getDaemon().startPing(),n.packet&&n.packet.opcode==OPCODE.PING.SEND&&this.getDaemon().setTimeout(),this.lastSendTime=(new Date).getTime(),this.sendInterval()}else setTimeout(function(){e.sendInterval()},a.SENDINTERVAL-t)}else this.sending=!1},r.prototype.sendJumpPacket=function(e){if(e)return e.callbackContext?this.connection.sendJumpPacket(e.packet,e.callback.bind(e.callbackContext),e.data):this.connection.sendJumpPacket(e.packet,e.callback,e.data)},i.prototype.get=function(){var e=this.xhr;e.open("GET",this.url,!0),i.prototype._listenFn.call(this),e.send()},i.prototype.post=function(){var e=this.xhr;e.open("POST",this.url,!0),i.prototype._listenFn.call(this),e.setRequestHeader("Content-Type","x-www-form-urlencoded"),e.send(this.data)},i.prototype.isLoop=function(e){this.loop=e},i.prototype.stopLoop=function(){clearTimeout(_self.timeoutIndex)},i.prototype._listenFn=function(){var e=this,t=this.xhr;this.timeoutIndex=setTimeout(function(){e.loop&&i.prototype.get.call(e),e.eCallback(t.responseText)},e.timeout),t.onreadystatechange=function(){4==t.readyState&&(clearTimeout(e.timeoutIndex),200==t.status?e.sCallback(t.responseText):e.eCallback(t.responseText))}},o.getInstance=function(){return o._instance||(o._instance=new o),o._instance},o.prototype.log=function(t,n,r,i){this._logger=this._logger||new e(a.LOG.FILTER_LEVEL),this._logger.log(t,n,r,i)},o.prototype.init=function(e){var t=this;e=e||{},this.onClosed=function(t){this.onConnectStatusChanged(c.OFFLINE),e.onClosed&&e.onClosed(t)},this.onAuthError=function(t){this.onConnectStatusChanged(c.AUTHERROR),e.onAuthError&&e.onAuthError(t)},this.onStatusChanged=function(e){YYIMCommonUtil.isStringAndNotEmpty(e)&&this.onConnectStatusChanged(e)},this.onConnectStatusChanged=function(e){this.connectStatus=e||this.connectStatus,this.log("connectStatus: ",3,this.connectStatus)},this.onOpened=function(t){this.onConnectStatusChanged(c.CONNECTED),this.getTimeCorrection&&this.getTimeCorrection(),e.onOpened&&e.onOpened(t)},this.onUpdatePassword=function(t){this.disConnect(c.ONUPDATEPASSWORD),e.onUpdatePassword&&e.onUpdatePassword(t)},this.onClientKickout=function(t){this.disConnect(c.ONCLIENTKICKOUT),e.onClientKickout&&e.onClientKickout(t)},this.onConflicted=function(t){this.disConnect(c.CONFLICT),e.onConflicted&&e.onConflicted(t)},this.onConnectError=function(n){this.connectStatus==c.OFFLINE||this.connectStatus==c.INIT||this.connectStatus==c.CONFLICT||this.connectStatus==c.AUTHERROR||this.connectStatus==c.ONCLIENTKICKOUT||this.connectStatus==c.ONUPDATEPASSWORD?this.ConnectErrorTimer&&(clearInterval(this.ConnectErrorTimer),this.ConnectErrorTimer=null):(this.onConnectStatusChanged(c.ERROR),this.ConnectErrorTimer||(this.ConnectErrorTimer=setInterval(function(){t.connectStatus==c.CONNECTED||t.connectStatus==c.PROCESSING||t.connectStatus==c.OFFLINE||t.connectStatus==c.INIT?(clearInterval(t.ConnectErrorTimer),t.ConnectErrorTimer=null):t.connectStatus==c.ERROR&&(t.log("",3,n),t.connect(),t.onConnectStatusChanged(c.CONNECTING))},500)),e.onConnectError&&e.onConnectError(n))},this.onUserBind=e.onUserBind||function(){},this.onExpiration=e.onExpiration,this.exeBackhander("initCallback",e),function(){jQuery(window).on({"unload offline":function(){t.connectStatus!=c.INIT&&t.disConnect()},online:function(){t.connectStatus!=c.INIT&&t.connectStatus!=c.CONFLICT&&t.connectStatus!=c.AUTHERROR&&t.connectStatus!=c.ONCLIENTKICKOUT&&t.connectStatus!=c.ONUPDATEPASSWORD&&t.connect()}})}(),jQuery.ajaxSetup({statusCode:{401:function(){e.onExpirationed&&e.onExpirationed()}}})},o.prototype.initSDK=function(e){u.init(e);var t=a.MULTI_TENANCY;this.appkey=t.SEPARATOR+t.APP_KEY+t.SEPARATOR+t.ETP_KEY},o.prototype.logEnable=function(e){YYIMUtil.isWhateType(e,"Boolean")?a.LOG.ENABLE=e:a.LOG.ENABLE=!a.LOG.ENABLE},o.prototype.getTenancy=function(){return a.MULTI_TENANCY},o.prototype.getAppkey=function(){return this.appkey},o.prototype.isOnline=function(){return this.onlineStatus.indexOf(this.connectStatus)>-1},o.prototype.disConnect=function(e){this.getExpirationTimer&&(clearInterval(this.getExpirationTimer),this.getExpirationTimer=0),r.getInstance().disconnect(),this.onConnectStatusChanged(e||c.OFFLINE)},o.prototype.connect=function(){this.isOnline()||r.getInstance().connect()},o.prototype.getToken=function(){try{if(this.getExpiration()&&YYIMUtil.isWhateType(this.onExpiration,"Function")&&this.getExpiration()-this.getServerNow()<=a.EXPIRATION.INVALID){var e=this;this.onExpiration(function(t,n){t&&(e._token.token=t),n&&(e._token.expiration=n)})}}catch(e){this.log("Token winll Invalid. Auto Get Token Error.",0)}return this._token.token},o.prototype.getExpiration=function(){return this._token.expiration},o.prototype.login=function(e){if(e=e||{},this._token={token:e.token,expiration:e.expiration},e.username&&e.token){if(this.isOnline()||r.getInstance().connect({username:s.getNode(e.username),token:e.token,appType:e.appType,identify:e.identify}),YYIMUtil.isWhateType(this.onExpiration,"Function")&&!this.getExpirationTimer){var t=this;this.getExpirationTimer=setInterval(function(){t.getToken()},a.EXPIRATION.INSPECTION_INTERVAL)}}else this.log((e.username?"":"Username ")+(e.token?"":"Token ")+" Illegal.",0)},o.prototype.getConnectStatus=function(){return this.connectStatus},o.prototype.logout=function(){this.disConnect.apply(this,arguments),this.onConnectStatusChanged(c.INIT)},o.prototype.getUserBareJID=function(){return this._user.jid.getBareJID()},o.prototype.getUserFullJID=function(){return this._user.jid.toString()},o.prototype.getUserNode=function(){return s.getNode(this.getUserBareJID())},o.prototype.getUserID=function(){return s.getID(this.getUserBareJID())},o.prototype.getResource=function(){return a.RESOURCE},o.prototype.getServerName=function(){return a.CONNECTION.SERVER_NAME},o.prototype.getServletPath=function(){return a.SERVLET},o.prototype.getJIDUtil=function(){return s},o.prototype.getServerNow=function(){return a.TIMECORRECTION.AUTOCORRECTION?(new Date).getTime()+YYIMChat.getConfig().TIMECORRECTION.RESULT:(new Date).getTime()},o.prototype.getBrowser=function(){return a.BROWSER},o.prototype.getConstants=function(){return{FAVORITE_TYPE:l,STATUS:h,TYPE:d,PRESENCE_TYPE:p,COLLECT_TYPE:f,CHAT_TYPE:g,MESSAGE_CONTENT_TYPE:m}},o.prototype.getConfig=function(){return a},o.prototype.getConnection=function(){return r.getInstance()},o.prototype.getJIDUtil=function(){return s},o.prototype.getUtil=function(){return YYIMUtil},o.prototype.setBackhander=function(e){if(e){this.backhanders=this.backhanders||{};for(var t in e)this.backhanders[t]=this.backhanders[t]||{},jQuery.extend(this.backhanders[t],e[t])}},o.prototype.exeBackhander=function(e,t){if(this.backhanders=this.backhanders||{},e&&this.backhanders[e])for(var n in this.backhanders[e])if(YYIMUtil.isWhateType(this.backhanders[e][n],"Function"))try{this.backhanders[e][n](t||{})}catch(t){this.log("exeBackhander: "+e+" "+n+" Error.",0)}},o.getInstance()}();